{"version":3,"sources":["assets/scripts/baccarat/BaccaratController.js"],"names":["BaccaratEvent","require","BaccaratController","SmartFoxSDK","BaseController","extend","m_tableInfo","registerEvents","_super","ZoneInstance","addEventListenerExtension","RESPONSE_NAME","LOAD_GAME_RES","onLoadGameEvent","BET_RES","onUserBetEvent","END_BETTING","onEndBettingEvent","HISTORY_RESULT","onHistoryResultEvent","HISTORY_DETAIL","HistoryDetailEvent","removeEvents","removeEventListenerExtension","onEventLogin","event","_requestJoinRoom","zoneName","onEventUserExitRoom","user","isItMe","getUI","node","active","UIManger","show","preLoadUI","pop","LoadGameEvent","fromEvent","hideAll","showListMyChipBet","listMyChipPot","showListChipBet","listChipPot","users","push","mySelf","i","getRoom","getUserList","length","u","name","showListUsers","updateCau","allCau","isBetting","_turnOnTime","time","showNoti","runEffectGirl","_turnOffTime","resumeGame","cardPlayer","cardBanker","winpot","usersOnboard","chipUserOnBoard","bind","userBet","BetEvent","userName","betChip","typePot","runActionChangeMoney","actionFlyChipToPot","getUserByName","updateChip","endBetting","EndBetting","showResult","showSoiCau","onHistoryEvent","items","HistoryEvent","src","data","onLeaderBoardEvent","LeaderBoardEvent","onPublicMessage","sender","msg","message","dataSender","dn","get","fb","msgItem","instance","getInstance","module","exports"],"mappings":";;;;;;AAAA,IAAIA,aAAa,GAAGC,OAAO,CAAC,eAAD,CAA3B;;AACA,IAAIC,kBAAkB,GAAGC,WAAW,CAACC,cAAZ,CAA2BC,MAA3B,CAAkC;AACvDC,EAAAA,WAAW,EAAG,EADyC;AAEvDC,EAAAA,cAFuD,4BAEvC;AACZ,SAAKC,MAAL;;AACA,SAAKC,YAAL,CAAkBC,yBAAlB,CAA4CV,aAAa,CAACW,aAAd,CAA4BC,aAAxE,EAAuF,KAAKC,eAA5F,EAA6G,IAA7G;AACA,SAAKJ,YAAL,CAAkBC,yBAAlB,CAA4CV,aAAa,CAACW,aAAd,CAA4BG,OAAxE,EAAiF,KAAKC,cAAtF,EAAsG,IAAtG;AACA,SAAKN,YAAL,CAAkBC,yBAAlB,CAA4CV,aAAa,CAACW,aAAd,CAA4BK,WAAxE,EAAqF,KAAKC,iBAA1F,EAA6G,IAA7G;AACA,SAAKR,YAAL,CAAkBC,yBAAlB,CAA4CV,aAAa,CAACW,aAAd,CAA4BO,cAAxE,EAAwF,KAAKC,oBAA7F,EAAmH,IAAnH;AACA,SAAKV,YAAL,CAAkBC,yBAAlB,CAA4CV,aAAa,CAACW,aAAd,CAA4BS,cAAxE,EAAwF,KAAKC,kBAA7F,EAAiH,IAAjH;AACH,GATsD;AAUvDC,EAAAA,YAVuD,0BAUzC;AACV,SAAKd,MAAL;;AACA,SAAKC,YAAL,CAAkBc,4BAAlB,CAA+CvB,aAAa,CAACW,aAAd,CAA4BC,aAA3E,EAA0F,KAAKC,eAA/F,EAAgH,IAAhH;AACA,SAAKJ,YAAL,CAAkBc,4BAAlB,CAA+CvB,aAAa,CAACW,aAAd,CAA4BG,OAA3E,EAAoF,KAAKC,cAAzF,EAAyG,IAAzG;AACA,SAAKN,YAAL,CAAkBc,4BAAlB,CAA+CvB,aAAa,CAACW,aAAd,CAA4BK,WAA3E,EAAwF,KAAKC,iBAA7F,EAAgH,IAAhH;AACA,SAAKR,YAAL,CAAkBc,4BAAlB,CAA+CvB,aAAa,CAACW,aAAd,CAA4BO,cAA3E,EAA2F,KAAKC,oBAAhG,EAAsH,IAAtH;AACA,SAAKV,YAAL,CAAkBc,4BAAlB,CAA+CvB,aAAa,CAACW,aAAd,CAA4BS,cAA3E,EAA2F,KAAKC,kBAAhG,EAAoH,IAApH;AACH,GAjBsD;AAkBvDG,EAAAA,YAlBuD,wBAkB1CC,KAlB0C,EAkBpC;AACf,SAAKjB,MAAL,CAAYiB,KAAZ;;AACA,SAAKC,gBAAL,CAAsB,KAAKC,QAA3B;AACH,GArBsD;AAsBvDC,EAAAA,mBAtBuD,+BAsBnCH,KAtBmC,EAsB7B;AACtB,QAAII,IAAI,GAAGJ,KAAK,CAACI,IAAjB;;AACA,QAAGA,IAAI,CAACC,MAAR,EAAe;AACX,UAAI,KAAKC,KAAL,MAAgB,IAApB,EACI,KAAKA,KAAL,GAAaC,IAAb,CAAkBC,MAAlB,GAA2B,KAA3B;AACJC,MAAAA,QAAQ,CAACC,IAAT,CAAc,QAAd;AACH;AACJ,GA7BsD;AA8BvDtB,EAAAA,eA9BuD,2BA8BvCY,KA9BuC,EA8BjC;AAClB,SAAKW,SAAL,CAAe;AAACC,MAAAA,GAAG,EAAE;AAAN,KAAf,EAA2B,YAAY;AACnC,WAAK/B,WAAL,GAAmB,IAAIN,aAAa,CAACsC,aAAlB,GAAkCC,SAAlC,CAA4Cd,KAA5C,CAAnB;AACA,WAAKM,KAAL,GAAaS,OAAb;AACA,WAAKT,KAAL,GAAaU,iBAAb,CAA+B,KAAKnC,WAAL,CAAiBoC,aAAhD;AACA,WAAKX,KAAL,GAAaY,eAAb,CAA6B,KAAKrC,WAAL,CAAiBsC,WAA9C;AAEA,UAAIC,KAAK,GAAG,EAAZ;AACAA,MAAAA,KAAK,CAACC,IAAN,CAAW,KAAKrC,YAAL,CAAkBsC,MAA7B;;AACA,WAAI,IAAIC,CAAC,GAAG,CAAZ,EAAeA,CAAC,GAAG,KAAKC,OAAL,GAAeC,WAAf,GAA6BC,MAAhD,EAAuDH,CAAC,EAAxD,EAA2D;AACvD,YAAII,CAAC,GAAG,KAAKH,OAAL,GAAeC,WAAf,GAA6BF,CAA7B,CAAR;;AACA,YAAGI,CAAC,CAACC,IAAF,IAAU,KAAK5C,YAAL,CAAkBsC,MAAlB,CAAyBM,IAAnC,IAA2CR,KAAK,CAACM,MAAN,GAAe,CAA7D,EAA+D;AAC3DN,UAAAA,KAAK,CAACC,IAAN,CAAWM,CAAX;AACH;AACJ;;AACD,WAAKrB,KAAL,GAAauB,aAAb,CAA2BT,KAA3B;AACA,WAAKd,KAAL,GAAawB,SAAb,CAAuB,KAAKjD,WAAL,CAAiBkD,MAAxC;;AACA,UAAG,KAAKlD,WAAL,CAAiBmD,SAApB,EAA8B;AAC1B,aAAK1B,KAAL,GAAa2B,WAAb,CAAyB,KAAKpD,WAAL,CAAiBqD,IAA1C,EAAgD,KAAKrD,WAAL,CAAiBqD,IAAjE,EAAuE,KAAKrD,WAAL,CAAiBmD,SAAxF;;AACA,YAAI,KAAKnD,WAAL,CAAiBqD,IAAjB,IAAwB,EAA5B,EAA+B;AAC3B,eAAK5B,KAAL,GAAa6B,QAAb,CAAsB,cAAtB;AACH;;AACD,aAAK7B,KAAL,GAAa8B,aAAb,CAA2B,GAA3B;AACH,OAND,MAMK;AACD,aAAK9B,KAAL,GAAa+B,YAAb;;AACA,aAAK/B,KAAL,GAAa2B,WAAb,CAAyB,KAAKpD,WAAL,CAAiBqD,IAA1C,EAAgD,KAAKrD,WAAL,CAAiBqD,IAAjE,EAAuE,KAAKrD,WAAL,CAAiBmD,SAAxF;;AACA,aAAK1B,KAAL,GAAagC,UAAb,CAAwB,KAAKzD,WAAL,CAAiB0D,UAAzC,EAAqD,KAAK1D,WAAL,CAAiB2D,UAAtE,EAAkF,KAAK3D,WAAL,CAAiB4D,MAAnG,EAA2G,KAAK5D,WAAL,CAAiBqD,IAA5H,EAAkI,KAAKrD,WAAL,CAAiB6D,YAAnJ,EAAiK,KAAK7D,WAAL,CAAiB8D,eAAlL;AACH;AACJ,KA3B0B,CA2BzBC,IA3ByB,CA2BpB,IA3BoB,CAA3B;AA4BH,GA3DsD;AA4DvDtD,EAAAA,cA5DuD,0BA4DxCU,KA5DwC,EA4DlC;AACjB,QAAI6C,OAAO,GAAG,IAAItE,aAAa,CAACuE,QAAlB,GAA6BhC,SAA7B,CAAuCd,KAAvC,CAAd;AACA,QAAI+C,QAAQ,GAAGF,OAAO,CAACE,QAAvB;AACA,QAAIC,OAAO,GAAGH,OAAO,CAACG,OAAtB;AACA,QAAIC,OAAO,GAAGJ,OAAO,CAACI,OAAtB;AACA,SAAKpE,WAAL,CAAiBsC,WAAjB,CAA6B8B,OAA7B,KAAyCD,OAAzC;AACA,SAAK1C,KAAL,GAAaY,eAAb,CAA6B,KAAKrC,WAAL,CAAiBsC,WAA9C;;AACA,QAAG,KAAKnC,YAAL,CAAkBsC,MAAlB,CAAyBM,IAAzB,IAAiCmB,QAApC,EAA6C;AACzC,WAAKlE,WAAL,CAAiBoC,aAAjB,CAA+BgC,OAA/B,KAA2CD,OAA3C;AACA,WAAK1C,KAAL,GAAaU,iBAAb,CAA+B,KAAKnC,WAAL,CAAiBoC,aAAhD;AACH;;AACD,SAAKX,KAAL,GAAa4C,oBAAb,CAAkCH,QAAlC,EAA4C,CAACC,OAA7C,EAAsD,CAAtD;AACA,SAAK1C,KAAL,GAAa6C,kBAAb,CAAgCJ,QAAhC,EAA0CE,OAA1C,EAAmDD,OAAnD;AACA,QAAI5C,IAAI,GAAG,KAAKoB,OAAL,GAAe4B,aAAf,CAA6BL,QAA7B,CAAX;AACA,QAAG3C,IAAH,EACI,KAAKE,KAAL,GAAa+C,UAAb,CAAwBjD,IAAxB;AACP,GA5EsD;AA6EvDZ,EAAAA,iBA7EuD,6BA6ErCQ,KA7EqC,EA6E/B;AACpB,QAAIsD,UAAU,GAAG,IAAI/E,aAAa,CAACgF,UAAlB,GAA+BzC,SAA/B,CAAyCd,KAAzC,CAAjB;AACA,SAAKnB,WAAL,CAAiBmD,SAAjB,GAAmC,KAAnC;AACA,SAAKnD,WAAL,CAAiB8D,eAAjB,GAAmCW,UAAU,CAACX,eAA9C;AACA,SAAK9D,WAAL,CAAiB6D,YAAjB,GAAmCY,UAAU,CAACZ,YAA9C;AACA,SAAK7D,WAAL,CAAiB0D,UAAjB,GAAmCe,UAAU,CAACf,UAA9C;AACA,SAAK1D,WAAL,CAAiB2D,UAAjB,GAAmCc,UAAU,CAACd,UAA9C;AACA,SAAK3D,WAAL,CAAiB4D,MAAjB,GAAmCa,UAAU,CAACb,MAA9C;;AACA,SAAKnC,KAAL,GAAa+B,YAAb;;AACA,SAAK/B,KAAL,GAAa2B,WAAb,CAAyB,EAAzB,EAA6B,EAA7B,EAAiC,KAAKpD,WAAL,CAAiBmD,SAAlD;;AACA,SAAK1B,KAAL,GAAa6B,QAAb,CAAsB,eAAtB;AACA,SAAK7B,KAAL,GAAakD,UAAb,CAAwB,KAAK3E,WAAL,CAAiB0D,UAAzC,EAAqD,KAAK1D,WAAL,CAAiB2D,UAAtE,EAAkF,KAAK3D,WAAL,CAAiB4D,MAAnG,EAA4G,KAAK5D,WAAL,CAAiB8D,eAA7H,EAA+I,KAAK9D,WAAL,CAAiB6D,YAAhK,EAA8K,CAA9K;AACH,GAzFsD;AA0FvDhD,EAAAA,oBA1FuD,gCA0FlCM,KA1FkC,EA0F5B,CAE1B,CA5FsD;AA6FvDJ,EAAAA,kBA7FuD,8BA6FpCI,KA7FoC,EA6F9B;AACrB,QAAI+B,MAAM,GAAG,IAAIxD,aAAa,CAACqB,kBAAlB,GAAuCkB,SAAvC,CAAiDd,KAAjD,CAAb;AACA,SAAKM,KAAL,GAAamD,UAAb,CAAwB1B,MAAxB;AACH,GAhGsD;AAiGvD2B,EAAAA,cAjGuD,0BAiGxC1D,KAjGwC,EAiGlC;AACjB,QAAI2D,KAAK,GAAG,IAAIpF,aAAa,CAACqF,YAAlB,GAAiC9C,SAAjC,CAA2Cd,KAA3C,CAAZ;AACA,SAAKM,KAAL,GAAaI,IAAb,CAAkB,uBAAlB,EAA2C;AAACE,MAAAA,GAAG,EAAE,IAAN;AAAYiD,MAAAA,GAAG,EAAE,UAAjB;AAA6BC,MAAAA,IAAI,EAAE;AAACH,QAAAA,KAAK,EAAEA;AAAR;AAAnC,KAA3C;AACH,GApGsD;AAqGvDI,EAAAA,kBArGuD,8BAqGpC/D,KArGoC,EAqG9B;AACrB,QAAI2D,KAAK,GAAG,IAAIpF,aAAa,CAACyF,gBAAlB,GAAqClD,SAArC,CAA+Cd,KAA/C,CAAZ;AACA,SAAKM,KAAL,GAAaI,IAAb,CAAkB,gBAAlB,EAAoC;AAACE,MAAAA,GAAG,EAAE,IAAN;AAAYiD,MAAAA,GAAG,EAAE,UAAjB;AAA6BC,MAAAA,IAAI,EAAE;AAACH,QAAAA,KAAK,EAAEA;AAAR;AAAnC,KAApC;AACH,GAxGsD;AAyGvDM,EAAAA,eAzGuD,2BAyGvCjE,KAzGuC,EAyGjC;AAClB,QAAIkE,MAAM,GAAGlE,KAAK,CAACkE,MAAnB;AACA,QAAIC,GAAG,GAAGnE,KAAK,CAACoE,OAAhB;AACA,QAAIN,IAAI,GAAG9D,KAAK,CAAC8D,IAAjB;AACA,QAAIO,UAAU,GAAGP,IAAI,IAAI,IAAR,GAAe;AAACQ,MAAAA,EAAE,EAAER,IAAI,CAACS,GAAL,CAAS,IAAT,CAAL;AAAqBC,MAAAA,EAAE,EAAGV,IAAI,CAACS,GAAL,CAAS,IAAT;AAA1B,KAAf,GAA2D;AAACD,MAAAA,EAAE,EAAE,KAAL;AAAYE,MAAAA,EAAE,EAAG;AAAjB,KAA5E;AACA,QAAIC,OAAO,GAAG,EAAd;AACAA,IAAAA,OAAO,CAACP,MAAR,GAAiBA,MAAjB;AACAO,IAAAA,OAAO,CAACN,GAAR,GAAcA,GAAd;AACAM,IAAAA,OAAO,CAACJ,UAAR,GAAqBA,UAArB;AACA,SAAK/D,KAAL,GAAa2D,eAAb,CAA6BQ,OAA7B;AACH;AAnHsD,CAAlC,CAAzB;AAqHA,IAAIC,QAAQ,GAAG,IAAf;;AACA,IAAIC,WAAW,GAAG,SAAdA,WAAc,GAAY;AAC1B,MAAGD,QAAQ,IAAI,IAAf,EACIA,QAAQ,GAAG,IAAIjG,kBAAJ,CAAuB,YAAvB,EAAqC,UAArC,CAAX;AACJ,SAAOiG,QAAP;AACH,CAJD;;AAKAhG,WAAW,CAACD,kBAAZ,GAAiCmG,MAAM,CAACC,OAAP,GAAiBF,WAAW,EAA7D","sourceRoot":"/","sourcesContent":["let BaccaratEvent = require('BaccaratEvent')\nlet BaccaratController = SmartFoxSDK.BaseController.extend({\n    m_tableInfo : {},\n    registerEvents(){\n        this._super();\n        this.ZoneInstance.addEventListenerExtension(BaccaratEvent.RESPONSE_NAME.LOAD_GAME_RES, this.onLoadGameEvent, this);\n        this.ZoneInstance.addEventListenerExtension(BaccaratEvent.RESPONSE_NAME.BET_RES, this.onUserBetEvent, this);\n        this.ZoneInstance.addEventListenerExtension(BaccaratEvent.RESPONSE_NAME.END_BETTING, this.onEndBettingEvent, this);\n        this.ZoneInstance.addEventListenerExtension(BaccaratEvent.RESPONSE_NAME.HISTORY_RESULT, this.onHistoryResultEvent, this);\n        this.ZoneInstance.addEventListenerExtension(BaccaratEvent.RESPONSE_NAME.HISTORY_DETAIL, this.HistoryDetailEvent, this);\n    },\n    removeEvents(){\n        this._super();\n        this.ZoneInstance.removeEventListenerExtension(BaccaratEvent.RESPONSE_NAME.LOAD_GAME_RES, this.onLoadGameEvent, this);\n        this.ZoneInstance.removeEventListenerExtension(BaccaratEvent.RESPONSE_NAME.BET_RES, this.onUserBetEvent, this);\n        this.ZoneInstance.removeEventListenerExtension(BaccaratEvent.RESPONSE_NAME.END_BETTING, this.onEndBettingEvent, this);\n        this.ZoneInstance.removeEventListenerExtension(BaccaratEvent.RESPONSE_NAME.HISTORY_RESULT, this.onHistoryResultEvent, this);\n        this.ZoneInstance.removeEventListenerExtension(BaccaratEvent.RESPONSE_NAME.HISTORY_DETAIL, this.HistoryDetailEvent, this);\n    },\n    onEventLogin(event){\n        this._super(event);\n        this._requestJoinRoom(this.zoneName);\n    },\n    onEventUserExitRoom(event){\n        let user = event.user;\n        if(user.isItMe){\n            if (this.getUI() != null)\n                this.getUI().node.active = false;\n            UIManger.show(\"UIHome\");\n        }\n    },\n    onLoadGameEvent(event){\n        this.preLoadUI({pop: true},function () {\n            this.m_tableInfo = new BaccaratEvent.LoadGameEvent().fromEvent(event);\n            this.getUI().hideAll();\n            this.getUI().showListMyChipBet(this.m_tableInfo.listMyChipPot);\n            this.getUI().showListChipBet(this.m_tableInfo.listChipPot);\n\n            let users = [];\n            users.push(this.ZoneInstance.mySelf);\n            for(let i = 0; i < this.getRoom().getUserList().length;i++){\n                let u = this.getRoom().getUserList()[i];\n                if(u.name != this.ZoneInstance.mySelf.name && users.length < 6){\n                    users.push(u);\n                }\n            }\n            this.getUI().showListUsers(users);\n            this.getUI().updateCau(this.m_tableInfo.allCau);\n            if(this.m_tableInfo.isBetting){\n                this.getUI()._turnOnTime(this.m_tableInfo.time, this.m_tableInfo.time, this.m_tableInfo.isBetting);\n                if (this.m_tableInfo.time >=29){\n                    this.getUI().showNoti(\"Bắt đầu cược\");\n                }\n                this.getUI().runEffectGirl(\"1\");\n            }else{\n                this.getUI()._turnOffTime();\n                this.getUI()._turnOnTime(this.m_tableInfo.time, this.m_tableInfo.time, this.m_tableInfo.isBetting);\n                this.getUI().resumeGame(this.m_tableInfo.cardPlayer, this.m_tableInfo.cardBanker, this.m_tableInfo.winpot, this.m_tableInfo.time, this.m_tableInfo.usersOnboard, this.m_tableInfo.chipUserOnBoard);\n            }\n        }.bind(this))\n    },\n    onUserBetEvent(event){\n        let userBet = new BaccaratEvent.BetEvent().fromEvent(event);\n        let userName = userBet.userName;\n        let betChip = userBet.betChip;\n        let typePot = userBet.typePot;\n        this.m_tableInfo.listChipPot[typePot] += betChip;\n        this.getUI().showListChipBet(this.m_tableInfo.listChipPot);\n        if(this.ZoneInstance.mySelf.name == userName){\n            this.m_tableInfo.listMyChipPot[typePot] += betChip;\n            this.getUI().showListMyChipBet(this.m_tableInfo.listMyChipPot);\n        }\n        this.getUI().runActionChangeMoney(userName, -betChip, 1);\n        this.getUI().actionFlyChipToPot(userName, typePot, betChip);\n        let user = this.getRoom().getUserByName(userName);\n        if(user)\n            this.getUI().updateChip(user);\n    },\n    onEndBettingEvent(event){\n        let endBetting = new BaccaratEvent.EndBetting().fromEvent(event);\n        this.m_tableInfo.isBetting       = false;\n        this.m_tableInfo.chipUserOnBoard = endBetting.chipUserOnBoard;\n        this.m_tableInfo.usersOnboard    = endBetting.usersOnboard;\n        this.m_tableInfo.cardPlayer      = endBetting.cardPlayer;\n        this.m_tableInfo.cardBanker      = endBetting.cardBanker;\n        this.m_tableInfo.winpot          = endBetting.winpot;\n        this.getUI()._turnOffTime();\n        this.getUI()._turnOnTime(20, 20, this.m_tableInfo.isBetting);\n        this.getUI().showNoti(\"Dừng đặt cược\");\n        this.getUI().showResult(this.m_tableInfo.cardPlayer, this.m_tableInfo.cardBanker, this.m_tableInfo.winpot,  this.m_tableInfo.chipUserOnBoard,  this.m_tableInfo.usersOnboard, 1);\n    },\n    onHistoryResultEvent(event){\n\n    },\n    HistoryDetailEvent(event){\n        let allCau = new BaccaratEvent.HistoryDetailEvent().fromEvent(event);\n        this.getUI().showSoiCau(allCau);\n    },\n    onHistoryEvent(event){\n        let items = new BaccaratEvent.HistoryEvent().fromEvent(event);\n        this.getUI().show(\"UIBaccaratTransaction\", {pop: true, src: 'baccarat', data: {items: items}});\n    },\n    onLeaderBoardEvent(event){\n        let items = new BaccaratEvent.LeaderBoardEvent().fromEvent(event);\n        this.getUI().show(\"UIBaccaratRank\", {pop: true, src: 'baccarat', data: {items: items}});\n    },\n    onPublicMessage(event){\n        let sender = event.sender;\n        let msg = event.message;\n        let data = event.data;\n        let dataSender = data != null ? {dn: data.get(\"dn\"), fb : data.get(\"fb\")} : {dn: \"...\", fb : \"\"};\n        let msgItem = {};\n        msgItem.sender = sender;\n        msgItem.msg = msg;\n        msgItem.dataSender = dataSender;\n        this.getUI().onPublicMessage(msgItem);\n    },\n});\nlet instance = null;\nlet getInstance = function () {\n    if(instance == null)\n        instance = new BaccaratController('UIBaccarat', 'baccarat');\n    return instance;\n}\nSmartFoxSDK.BaccaratController = module.exports = getInstance();\n"]}