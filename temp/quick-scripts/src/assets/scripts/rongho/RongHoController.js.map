{"version":3,"sources":["assets/scripts/rongho/RongHoController.js"],"names":["RongHoEvent","require","RongHoController","SmartFoxSDK","BaseController","extend","m_tableInfo","registerEvents","_super","ZoneInstance","addEventListenerExtension","RESPONSE_NAME","LOAD_GAME_RES","onLoadGameEvent","BET_RES","onUserBetEvent","END_BETTING","onEndBettingEvent","removeEvents","removeEventListenerExtension","onHistoryEvent","event","history","HistoryEvent","fromEvent","getUI","show","pop","src","data","items","onLeaderBoardEvent","rank","LeaderBoardEvent","onEventLogin","_requestJoinRoom","zoneName","onEventRoomJoin","updateUserCount","onEventUserEnterRoom","user","addNodePlayerEnterRoom","onEventUserExitRoom","isItMe","node","active","UIManger","removeNodePlayer","preLoadUI","LoadGameEvent","controller","cc","lastTime","time","Date","getTime","resetBetRongHo","resumeGame","bind","Math","floor","showListMyChipBet","listMyChipPot","showListChipBet","listChipPot","users","push","mySelf","i","getRoom","getUserList","length","u","name","showListUsers","isBetting","_stopEffectWinPot","ToastDatCua","_turnOnTime","_turnOffTime","xocxoc","result","winpot","isWin","userBet","BetEvent","userName","betChip","typePot","actionFlyChipToPot","getUserByName","updateChip","endBetting","EndBetting","winChip","onPublicMessage","sender","msg","message","dataSender","dn","get","fb","msgItem","instance","getInstance","module","exports"],"mappings":"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","sourceRoot":"/","sourcesContent":["let RongHoEvent = require('RongHoEvent')\nlet RongHoController = SmartFoxSDK.BaseController.extend({\n    m_tableInfo : null,\n    registerEvents(){\n        this._super();\n        this.ZoneInstance.addEventListenerExtension(RongHoEvent.RESPONSE_NAME.LOAD_GAME_RES, this.onLoadGameEvent, this);\n        this.ZoneInstance.addEventListenerExtension(RongHoEvent.RESPONSE_NAME.BET_RES, this.onUserBetEvent, this);\n        this.ZoneInstance.addEventListenerExtension(RongHoEvent.RESPONSE_NAME.END_BETTING, this.onEndBettingEvent, this);\n    },\n    removeEvents(){\n        this._super();\n        this.ZoneInstance.removeEventListenerExtension(RongHoEvent.RESPONSE_NAME.LOAD_GAME_RES, this.onLoadGameEvent, this);\n        this.ZoneInstance.removeEventListenerExtension(RongHoEvent.RESPONSE_NAME.BET_RES, this.onUserBetEvent, this);\n        this.ZoneInstance.removeEventListenerExtension(RongHoEvent.RESPONSE_NAME.END_BETTING, this.onEndBettingEvent, this);\n    },\n    onHistoryEvent(event){\n        let history = new RongHoEvent.HistoryEvent().fromEvent(event);\n        this.getUI().show(\"UIRongHoTransaction\", {pop: true, src: 'rongho', data: {items: history.items}});\n    },\n    onLeaderBoardEvent(event){\n        let rank = new RongHoEvent.LeaderBoardEvent().fromEvent(event);\n        this.getUI().show(\"UIRongHoRank\", {pop: true, src: 'rongho', data: {items: rank.items}});\n    },\n    onEventLogin(event){\n        this._super(event);\n        this._requestJoinRoom(this.zoneName);\n    },\n    onEventRoomJoin(event){\n        this._super(event);\n        if(this.getUI())\n            this.getUI().updateUserCount();\n    },\n    onEventUserEnterRoom(event){\n        this._super(event);\n        let user = event.user;\n        if(this.getUI()){\n            this.getUI().updateUserCount();\n            this.getUI().addNodePlayerEnterRoom(user);\n        }\n    },\n    onEventUserExitRoom(event){\n        let user = event.user;\n        if(user.isItMe){\n            if (this.getUI() != null)\n                this.getUI().node.active = false;\n            UIManger.show(\"UIHome\");\n        }else{\n            if(this.getUI()){\n                this.getUI().updateUserCount();\n                this.getUI().removeNodePlayer(user);\n            }\n        }\n    },\n    onLoadGameEvent(event){\n        this.preLoadUI({pop: true},function () {\n            this.m_tableInfo = new RongHoEvent.LoadGameEvent().fromEvent(event);\n            this.getUI().controller = this;\n            cc.lastTime      = this.m_tableInfo.time + new Date().getTime()/1000;\n            this.getUI().resetBetRongHo();\n            this.resumeGame();\n        }.bind(this))\n    },\n    resumeGame() {\n        if (this.m_tableInfo != null) {\n            this.m_tableInfo.time = Math.floor(cc.lastTime - new Date().getTime() / 1000);\n            this.getUI().showListMyChipBet(this.m_tableInfo.listMyChipPot);\n            this.getUI().showListChipBet(this.m_tableInfo.listChipPot);\n            let users = [];\n            users.push(this.ZoneInstance.mySelf);\n            for (let i = 0; i < this.getRoom().getUserList().length; i++) {\n                let u = this.getRoom().getUserList()[i];\n                if (u.name != this.ZoneInstance.mySelf.name && users.length < 6) {\n                    users.push(u);\n                }\n            }\n            this.getUI().showListUsers(users);\n            if (this.m_tableInfo.isBetting) {\n                this.getUI()._stopEffectWinPot();\n                this.getUI().ToastDatCua();\n                this.getUI()._turnOnTime(this.m_tableInfo.time, this.m_tableInfo.isBetting);\n            } else {\n                this.getUI()._turnOffTime();\n                this.getUI().xocxoc(this.m_tableInfo.result, this.m_tableInfo.winpot, this.m_tableInfo.isWin);\n            }\n        }\n    },\n    onUserBetEvent(event){\n        let userBet = new RongHoEvent.BetEvent().fromEvent(event);\n        let userName = userBet.userName;\n        let betChip = userBet.betChip;\n        let typePot = userBet.typePot;\n\n        this.m_tableInfo.listChipPot[typePot] += betChip;\n        this.getUI().showListChipBet(this.m_tableInfo.listChipPot);\n        if(this.ZoneInstance.mySelf.name == userName){\n            this.m_tableInfo.listMyChipPot[typePot] += betChip;\n            this.getUI().showListMyChipBet(this.m_tableInfo.listMyChipPot);\n        }\n        this.getUI().actionFlyChipToPot(userName, typePot, betChip);\n        // user bet\n        let user = this.getRoom().getUserByName(userName);\n        if(user)\n            this.getUI().updateChip(user);\n    },\n    onEndBettingEvent(event){\n        let endBetting = new RongHoEvent.EndBetting().fromEvent(event);\n        this.m_tableInfo.isBetting = false;\n        this.m_tableInfo.result  = endBetting.result;\n        this.m_tableInfo.winpot  = endBetting.winpot;\n        this.m_tableInfo.winChip = endBetting.winChip;\n        this.getUI()._turnOffTime();\n        this.getUI().xocxoc(endBetting.result, endBetting.winpot,  endBetting.winChip > 0 ? true : false);\n    },\n    onPublicMessage(event){\n        let sender = event.sender;\n        let msg = event.message;\n        let data = event.data;\n        let dataSender = data != null ? {dn: data.get(\"dn\"), fb : data.get(\"fb\")} : {dn: \"...\", fb : \"\"};\n        let msgItem = {};\n        msgItem.sender = sender;\n        msgItem.msg = msg;\n        msgItem.dataSender = dataSender;\n        this.getUI().onPublicMessage(msgItem);\n    },\n});\nlet instance = null;\nlet getInstance = function () {\n    if(instance == null)\n        instance = new RongHoController('UIRongHo', 'rongho');\n    return instance;\n}\nSmartFoxSDK.RongHoController = module.exports = getInstance();\n"]}