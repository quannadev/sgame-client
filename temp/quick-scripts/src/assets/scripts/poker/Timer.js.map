{"version":3,"sources":["assets/scripts/poker/Timer.js"],"names":["cc","Class","VozBaseComponent","properties","progressBar","ProgressBar","_tick","_totalTimeProgress","_remainTurnTime","_timeWarning","_cbCompleteProgress","_cbWarning","_isWarning","lb_time","Label","onEnable","node","active","addEventTimerComplete","cb","addEventTimerWarning","setTimeWarning","timeWarning","setCurrentProgress","currentTime","setTotalProgress","totalTime","setTotalRemain","remainTime","turnOnTimer","turnOffTimer","progress","Date","now","unschedule","updateTimer","schedule","dt","newTick","string","Math","floor"],"mappings":"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","sourceRoot":"/","sourcesContent":["cc.Class({\n    extends: cc.VozBaseComponent,\n\n    properties: {\n        progressBar: cc.ProgressBar,\n        _tick: 0,\n        _totalTimeProgress: 10,\n        _remainTurnTime: 30,\n        _timeWarning: 5,\n        _cbCompleteProgress: null,\n        _cbWarning: null,\n        _isWarning: false,\n        lb_time : cc.Label\n    },\n    onEnable(){\n        this._tick = 0;\n        this._totalTimeProgress = 10;\n        this._remainTurnTime = 10;\n        this.lb_time.node.active = false;\n    },\n    addEventTimerComplete(cb){\n        this._cbCompleteProgress = cb;\n    },\n    addEventTimerWarning(cb){\n        this._cbWarning = cb;\n    },\n    setTimeWarning(timeWarning){\n        this._timeWarning = timeWarning\n    },\n    setCurrentProgress(currentTime){\n        this._remainTurnTime = currentTime;\n    },\n    setTotalProgress(totalTime){\n        this._totalTimeProgress = totalTime;\n    },\n    setTotalRemain(remainTime){\n        this._remainTurnTime = remainTime;\n    },\n    turnOnTimer(){\n        this.turnOffTimer();\n        this.progressBar.node.active = true;\n        this.progressBar.progress = 0;\n        this._tick = this._remainTurnTime * 1000  + Date.now();\n        this.unschedule(this.updateTimer, 0.1);\n        this.schedule(this.updateTimer, 0.1);\n    },\n    turnOffTimer(){\n        this.lb_time.node.active = false;\n        this._cbCompleteProgress = null;\n        this._cbWarning = null;\n        this._isWarning = false;\n        this.progressBar.node.active = false;\n        this.unschedule(this.updateTimer, 0.1);\n    },\n    updateTimer(dt){\n        let newTick = (this._totalTimeProgress * 1000 + Date.now() - this._tick) / 1000;\n        if(newTick <= this._totalTimeProgress){\n            this.lb_time.node.active = true;\n            // if(this.lb_time.node.y == 0){\n            //     this.lb_time.node.y = 20;\n            //     this.lb_time.node.stopAllActions();\n            //     this.lb_time.node.runAction(cc.sequence(cc.moveTo(0.1, cc.v2(0, 0)),cc.delayTime(0.9), cc.callFunc(function () {\n            //         this.node.y = 0;\n            //     }, this.lb_time)));\n            // }\n            this.lb_time.string = this._totalTimeProgress - Math.floor(newTick);\n            this.progressBar.progress = newTick /this._totalTimeProgress;\n            if(!this._isWarning && (this._totalTimeProgress - newTick) <= this._timeWarning){\n                this._isWarning = true;\n                if(this._cbWarning)\n                    this._cbWarning();\n            }\n        }else{\n            if(this._cbCompleteProgress)\n                this._cbCompleteProgress();\n            this.turnOffTimer();\n        }\n    }\n});\n"]}