{"version":3,"sources":["assets/scripts/abase/UIManager.js"],"names":["UIManger","show","name","option","complete","cc","error","scene","director","getScene","node","find","active","_setOption","setSiblingIndex","_pop","ui","_getUIFromIndex","currentUI","mm","Loading","hide","src","undefined","loader","loadRes","err","prefab","console","log","setAutoReleaseRecursively","instantiate","pop","addChild","from","Number","isInteger","childrenCount","index","element","children","startsWith","data","script","getComponent","_data","getUIFromName","window","module","exports"],"mappings":"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","sourceRoot":"/","sourcesContent":["let UIManger = {};\nUIManger.show = function(name, option, complete){\n    if (!name || name === '') {\n        cc.error('name is empty!');\n        return;\n    }\n    const scene = cc.director.getScene();\n    const node = cc.find(name, scene);\n    if (node) {\n        node.active = false;\n        this._setOption(node, option);\n        node.setSiblingIndex(-1);\n        node.active = true;\n        if (!node._pop) {\n            let ui = this._getUIFromIndex(-2);\n            if (ui) {\n                if (ui.name!= cc.currentUI){\n                    ui.active = false;\n                }\n\n            }\n        }\n        mm.Loading.hide();\n        if(complete)\n            complete();\n        return\n    }\n    if (option && (option.src !== undefined) && (option.src !== null)) {\n        name = option.src+\"/\"+ name;\n    }\n    cc.loader.loadRes(name,(err, prefab) => {\n        if(err){\n            console.log(err);\n            return;\n        }\n        if (cc.find(name, scene)) {\n            if(complete)\n                complete();\n            return\n        }\n        cc.loader.setAutoReleaseRecursively(prefab, true);\n        const node = cc.instantiate(prefab);\n        if (!node) {\n            cc.error('prefab instantiation failed!')\n        } else {\n            let ui = this._getUIFromIndex(-1);\n            if (ui) {\n                ui.active = !!(option && option.pop);\n            }\n            this._setOption(node, option);\n            scene.addChild(node);\n            mm.Loading.hide();\n            if(complete) complete();\n        }\n    });\n},\nUIManger._getUIFromIndex = function(from) {\n    const scene = cc.director.getScene();\n    if (!Number.isInteger(from)) {\n        from = scene.childrenCount - 1\n    }\n    if (from < 0) {\n        from += scene.childrenCount\n    }\n    if ((from < 0) || (from > scene.childrenCount - 1)) {\n        cc.log('_getUIFromIndex error, from = ' + from + '!');\n        return\n    }\n    for (let index = from; index >= 0; index--) {\n        let element = scene.children[index];\n\n        if (element.name.startsWith('UI')) {\n            return element\n        }\n    }\n},\nUIManger._setOption = function(node, option) {\n    if (option && (option.data !== undefined) && (option.data !== null)) {\n        const script = node.getComponent(node.name);\n        if (script) {\n            script._data = option.data\n        }\n    }\n    node._pop = !!(option && option.pop);\n}\nUIManger.getUIFromName = function(name){\n    if (!name || !name.startsWith('UI')) {\n        return;\n    }\n    const scene = cc.director.getScene();\n    return cc.find(name, scene)\n}\nwindow.UIManger = module.exports = UIManger;\n"]}