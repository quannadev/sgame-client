
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/scripts/xocdia/XocDiaController.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '5ec5cXKwLBIIa8zDzEVyEFS', 'XocDiaController');
// scripts/xocdia/XocDiaController.js

"use strict";

var XocDiaEvent = require('XocDiaEvent');

var XocDiaController = SmartFoxSDK.BaseController.extend({
  m_tableInfo: null,
  registerEvents: function registerEvents() {
    this._super();

    this.ZoneInstance.addEventListenerExtension(XocDiaEvent.RESPONSE_NAME.LOAD_GAME_RES, this.onLoadGameEvent, this);
    this.ZoneInstance.addEventListenerExtension(XocDiaEvent.RESPONSE_NAME.BET_RES, this.onUserBetEvent, this);
    this.ZoneInstance.addEventListenerExtension(XocDiaEvent.RESPONSE_NAME.END_BETTING, this.onEndBettingEvent, this);
    this.ZoneInstance.addEventListenerExtension(XocDiaEvent.RESPONSE_NAME.HISTORY_RESULT, this.onHistoryResultEvent, this);
  },
  removeEvents: function removeEvents() {
    this._super();

    this.ZoneInstance.removeEventListenerExtension(XocDiaEvent.RESPONSE_NAME.LOAD_GAME_RES, this.onLoadGameEvent, this);
    this.ZoneInstance.removeEventListenerExtension(XocDiaEvent.RESPONSE_NAME.BET_RES, this.onUserBetEvent, this);
    this.ZoneInstance.removeEventListenerExtension(XocDiaEvent.RESPONSE_NAME.END_BETTING, this.onEndBettingEvent, this);
    this.ZoneInstance.removeEventListenerExtension(XocDiaEvent.RESPONSE_NAME.HISTORY_RESULT, this.onHistoryResultEvent, this);
  },
  onHistoryEvent: function onHistoryEvent(event) {
    var history = new XocDiaEvent.HistoryEvent().fromEvent(event);
    this.getUI().show("UIXocDiaTransaction", {
      pop: true,
      src: 'xocdia',
      data: {
        items: history.items
      }
    });
  },
  onLeaderBoardEvent: function onLeaderBoardEvent(event) {
    var rank = new XocDiaEvent.LeaderBoardEvent().fromEvent(event);
    this.getUI().show("UIXocDiaRank", {
      pop: true,
      src: 'xocdia',
      data: {
        items: rank.items
      }
    });
  },
  onEventLogin: function onEventLogin(event) {
    this._super(event);

    this._requestJoinRoom(this.zoneName);
  },
  onEventRoomJoin: function onEventRoomJoin(event) {
    this._super(event);

    if (this.getUI()) this.getUI().updateUserCount();
  },
  onEventUserEnterRoom: function onEventUserEnterRoom(event) {
    this._super(event);

    var user = event.user;

    if (this.getUI()) {
      this.getUI().updateUserCount();
      this.getUI().addNodePlayerEnterRoom(user);
    }
  },
  onEventUserExitRoom: function onEventUserExitRoom(event) {
    var user = event.user;

    if (user.isItMe) {
      if (this.getUI() != null) this.getUI().node.active = false;
      UIManger.show("UIHome");
    } else {
      if (this.getUI()) {
        this.getUI().updateUserCount();
        this.getUI().removeNodePlayer(user);
      }
    }
  },
  onLoadGameEvent: function onLoadGameEvent(event) {
    this.preLoadUI({
      pop: true
    }, function () {
      if (!this.m_tableInfo) this.m_tableInfo = {};
      var loadEvent = new XocDiaEvent.LoadGameEvent().fromEvent(event);
      this.m_tableInfo.listMyChipPot = loadEvent.listMyChipPot;
      this.m_tableInfo.listChipPot = loadEvent.listChipPot;
      this.m_tableInfo.isBetting = loadEvent.isBetting;
      this.m_tableInfo.time = loadEvent.time + 1;
      if (loadEvent.result) this.m_tableInfo.result = loadEvent.result;
      if (loadEvent.winpot) this.m_tableInfo.winpot = loadEvent.winpot;
      cc.lastTime = this.m_tableInfo.time + new Date().getTime() / 1000;
      this.getUI().controller = this;
      this.resumeGame();
    }.bind(this));
  },
  resumeGame: function resumeGame() {
    if (this.m_tableInfo != null) {
      this.m_tableInfo.time = Math.floor(cc.lastTime - new Date().getTime() / 1000);
      this.getUI().showListMyChipBet(this.m_tableInfo.listMyChipPot);
      this.getUI().showListChipBet(this.m_tableInfo.listChipPot);
      var users = [];
      users.push(this.ZoneInstance.mySelf);

      for (var i = 0; i < this.getRoom().getUserList().length; i++) {
        var u = this.getRoom().getUserList()[i];

        if (u.name != this.ZoneInstance.mySelf.name && users.length < 6) {
          users.push(u);
        }
      }

      this.getUI().showListUsers(users);

      if (this.m_tableInfo.isBetting) {
        this.getUI()._stopEffectWinPot();

        this.getUI().ToastDatCua();

        this.getUI()._turnOffTime();

        this.getUI()._turnOnTime(this.m_tableInfo.time, this.m_tableInfo.isBetting);
      } else {
        this.getUI()._turnOffTime();

        this.getUI().resumeXocXoc(this.m_tableInfo.result, this.m_tableInfo.winpot, this.m_tableInfo.time, this.m_tableInfo.isWin);
      }
    }
  },
  onUserBetEvent: function onUserBetEvent(event) {
    if (!this.m_tableInfo) return;
    var userBet = new XocDiaEvent.BetEvent().fromEvent(event);
    var userName = userBet.userName;
    var betChip = userBet.betChip;
    var typePot = userBet.typePot;
    this.m_tableInfo.listChipPot[typePot] += betChip;
    this.getUI().showListChipBet(this.m_tableInfo.listChipPot);

    if (this.ZoneInstance.mySelf.name == userName) {
      this.m_tableInfo.listMyChipPot[typePot] += betChip;
      this.getUI().showListMyChipBet(this.m_tableInfo.listMyChipPot);
    }

    this.getUI().actionFlyChipToPot(userName, typePot, betChip); // user bet

    var user = this.getRoom().getUserByName(userName);
    if (user) this.getUI().updateChip(user, 0);
  },
  onEndBettingEvent: function onEndBettingEvent(event) {
    var endBetting = new XocDiaEvent.EndBetting().fromEvent(event);
    if (!this.m_tableInfo) this.m_tableInfo = {};
    this.m_tableInfo.isBetting = false;
    this.m_tableInfo.result = endBetting.result;
    this.m_tableInfo.winpot = endBetting.winpot;
    this.m_tableInfo.winChip = endBetting.winChip;
    this.m_tableInfo.isWin = endBetting.winChip > 0;
    this.m_tableInfo.refund = endBetting.refund;

    this.getUI()._turnOffTime();

    this.getUI().xocxoc(endBetting.result, endBetting.winpot, endBetting.winChip > 0 ? true : false);
  },
  onHistoryResultEvent: function onHistoryResultEvent(event) {
    var history = new XocDiaEvent.HistoryResponse().fromEvent(event);
    console.log(history.result);
    this.getUI().showSoiCau(history.result);
  },
  onPublicMessage: function onPublicMessage(event) {
    var sender = event.sender;
    var msg = event.message;
    var data = event.data;
    var dataSender = data != null ? {
      dn: data.get("dn"),
      fb: data.get("fb")
    } : {
      dn: "...",
      fb: ""
    };
    var msgItem = {};
    msgItem.sender = sender;
    msgItem.msg = msg;
    msgItem.dataSender = dataSender;
    this.getUI().onPublicMessage(msgItem);
  }
});
var instance = null;

var getInstance = function getInstance() {
  if (instance == null) instance = new XocDiaController('UIXocDia', 'xocdia');
  return instance;
};

SmartFoxSDK.XocDiaController = module.exports = getInstance();

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcc2NyaXB0c1xceG9jZGlhXFxYb2NEaWFDb250cm9sbGVyLmpzIl0sIm5hbWVzIjpbIlhvY0RpYUV2ZW50IiwicmVxdWlyZSIsIlhvY0RpYUNvbnRyb2xsZXIiLCJTbWFydEZveFNESyIsIkJhc2VDb250cm9sbGVyIiwiZXh0ZW5kIiwibV90YWJsZUluZm8iLCJyZWdpc3RlckV2ZW50cyIsIl9zdXBlciIsIlpvbmVJbnN0YW5jZSIsImFkZEV2ZW50TGlzdGVuZXJFeHRlbnNpb24iLCJSRVNQT05TRV9OQU1FIiwiTE9BRF9HQU1FX1JFUyIsIm9uTG9hZEdhbWVFdmVudCIsIkJFVF9SRVMiLCJvblVzZXJCZXRFdmVudCIsIkVORF9CRVRUSU5HIiwib25FbmRCZXR0aW5nRXZlbnQiLCJISVNUT1JZX1JFU1VMVCIsIm9uSGlzdG9yeVJlc3VsdEV2ZW50IiwicmVtb3ZlRXZlbnRzIiwicmVtb3ZlRXZlbnRMaXN0ZW5lckV4dGVuc2lvbiIsIm9uSGlzdG9yeUV2ZW50IiwiZXZlbnQiLCJoaXN0b3J5IiwiSGlzdG9yeUV2ZW50IiwiZnJvbUV2ZW50IiwiZ2V0VUkiLCJzaG93IiwicG9wIiwic3JjIiwiZGF0YSIsIml0ZW1zIiwib25MZWFkZXJCb2FyZEV2ZW50IiwicmFuayIsIkxlYWRlckJvYXJkRXZlbnQiLCJvbkV2ZW50TG9naW4iLCJfcmVxdWVzdEpvaW5Sb29tIiwiem9uZU5hbWUiLCJvbkV2ZW50Um9vbUpvaW4iLCJ1cGRhdGVVc2VyQ291bnQiLCJvbkV2ZW50VXNlckVudGVyUm9vbSIsInVzZXIiLCJhZGROb2RlUGxheWVyRW50ZXJSb29tIiwib25FdmVudFVzZXJFeGl0Um9vbSIsImlzSXRNZSIsIm5vZGUiLCJhY3RpdmUiLCJVSU1hbmdlciIsInJlbW92ZU5vZGVQbGF5ZXIiLCJwcmVMb2FkVUkiLCJsb2FkRXZlbnQiLCJMb2FkR2FtZUV2ZW50IiwibGlzdE15Q2hpcFBvdCIsImxpc3RDaGlwUG90IiwiaXNCZXR0aW5nIiwidGltZSIsInJlc3VsdCIsIndpbnBvdCIsImNjIiwibGFzdFRpbWUiLCJEYXRlIiwiZ2V0VGltZSIsImNvbnRyb2xsZXIiLCJyZXN1bWVHYW1lIiwiYmluZCIsIk1hdGgiLCJmbG9vciIsInNob3dMaXN0TXlDaGlwQmV0Iiwic2hvd0xpc3RDaGlwQmV0IiwidXNlcnMiLCJwdXNoIiwibXlTZWxmIiwiaSIsImdldFJvb20iLCJnZXRVc2VyTGlzdCIsImxlbmd0aCIsInUiLCJuYW1lIiwic2hvd0xpc3RVc2VycyIsIl9zdG9wRWZmZWN0V2luUG90IiwiVG9hc3REYXRDdWEiLCJfdHVybk9mZlRpbWUiLCJfdHVybk9uVGltZSIsInJlc3VtZVhvY1hvYyIsImlzV2luIiwidXNlckJldCIsIkJldEV2ZW50IiwidXNlck5hbWUiLCJiZXRDaGlwIiwidHlwZVBvdCIsImFjdGlvbkZseUNoaXBUb1BvdCIsImdldFVzZXJCeU5hbWUiLCJ1cGRhdGVDaGlwIiwiZW5kQmV0dGluZyIsIkVuZEJldHRpbmciLCJ3aW5DaGlwIiwicmVmdW5kIiwieG9jeG9jIiwiSGlzdG9yeVJlc3BvbnNlIiwiY29uc29sZSIsImxvZyIsInNob3dTb2lDYXUiLCJvblB1YmxpY01lc3NhZ2UiLCJzZW5kZXIiLCJtc2ciLCJtZXNzYWdlIiwiZGF0YVNlbmRlciIsImRuIiwiZ2V0IiwiZmIiLCJtc2dJdGVtIiwiaW5zdGFuY2UiLCJnZXRJbnN0YW5jZSIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsSUFBSUEsV0FBVyxHQUFHQyxPQUFPLENBQUMsYUFBRCxDQUF6Qjs7QUFDQSxJQUFJQyxnQkFBZ0IsR0FBR0MsV0FBVyxDQUFDQyxjQUFaLENBQTJCQyxNQUEzQixDQUFrQztBQUNyREMsRUFBQUEsV0FBVyxFQUFHLElBRHVDO0FBRXJEQyxFQUFBQSxjQUZxRCw0QkFFckM7QUFDWixTQUFLQyxNQUFMOztBQUNBLFNBQUtDLFlBQUwsQ0FBa0JDLHlCQUFsQixDQUE0Q1YsV0FBVyxDQUFDVyxhQUFaLENBQTBC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QUFDQSxRQUFJNEUsVUFBVSxHQUFHNUUsSUFBSSxJQUFJLElBQVIsR0FBZTtBQUFDNkUsTUFBQUEsRUFBRSxFQUFFN0UsSUFBSSxDQUFDOEUsR0FBTCxDQUFTLElBQVQsQ0FBTDtBQUFxQkMsTUFBQUEsRUFBRSxFQUFHL0UsSUFBSSxDQUFDOEUsR0FBTCxDQUFTLElBQVQ7QUFBMUIsS0FBZixHQUEyRDtBQUFDRCxNQUFBQSxFQUFFLEVBQUUsS0FBTDtBQUFZRSxNQUFBQSxFQUFFLEVBQUc7QUFBakIsS0FBNUU7QUFDQSxRQUFJQyxPQUFPLEdBQUcsRUFBZDtBQUNBQSxJQUFBQSxPQUFPLENBQUNQLE1BQVIsR0FBaUJBLE1BQWpCO0FBQ0FPLElBQUFBLE9BQU8sQ0FBQ04sR0FBUixHQUFjQSxHQUFkO0FBQ0FNLElBQUFBLE9BQU8sQ0FBQ0osVUFBUixHQUFxQkEsVUFBckI7QUFDQSxTQUFLaEYsS0FBTCxHQUFhNEUsZUFBYixDQUE2QlEsT0FBN0I7QUFDSDtBQWxKb0QsQ0FBbEMsQ0FBdkI7QUFvSkEsSUFBSUMsUUFBUSxHQUFHLElBQWY7O0FBQ0EsSUFBSUMsV0FBVyxHQUFHLFNBQWRBLFdBQWMsR0FBWTtBQUMxQixNQUFHRCxRQUFRLElBQUksSUFBZixFQUNJQSxRQUFRLEdBQUcsSUFBSTlHLGdCQUFKLENBQXFCLFVBQXJCLEVBQWlDLFFBQWpDLENBQVg7QUFDSixTQUFPOEcsUUFBUDtBQUNILENBSkQ7O0FBS0E3RyxXQUFXLENBQUNELGdCQUFaLEdBQStCZ0gsTUFBTSxDQUFDQyxPQUFQLEdBQWlCRixXQUFXLEVBQTNEIiwic291cmNlUm9vdCI6Ii8iLCJzb3VyY2VzQ29udGVudCI6WyJsZXQgWG9jRGlhRXZlbnQgPSByZXF1aXJlKCdYb2NEaWFFdmVudCcpXHJcbmxldCBYb2NEaWFDb250cm9sbGVyID0gU21hcnRGb3hTREsuQmFzZUNvbnRyb2xsZXIuZXh0ZW5kKHtcclxuICAgIG1fdGFibGVJbmZvIDogbnVsbCxcclxuICAgIHJlZ2lzdGVyRXZlbnRzKCl7XHJcbiAgICAgICAgdGhpcy5fc3VwZXIoKTtcclxuICAgICAgICB0aGlzLlpvbmVJbnN0YW5jZS5hZGRFdmVudExpc3RlbmVyRXh0ZW5zaW9uKFhvY0RpYUV2ZW50LlJFU1BPTlNFX05BTUUuTE9BRF9HQU1FX1JFUywgdGhpcy5vbkxvYWRHYW1lRXZlbnQsIHRoaXMpO1xyXG4gICAgICAgIHRoaXMuWm9uZUluc3RhbmNlLmFkZEV2ZW50TGlzdGVuZXJFeHRlbnNpb24oWG9jRGlhRXZlbnQuUkVTUE9OU0VfTkFNRS5CRVRfUkVTLCB0aGlzLm9uVXNlckJldEV2ZW50LCB0aGlzKTtcclxuICAgICAgICB0aGlzLlpvbmVJbnN0YW5jZS5hZGRFdmVudExpc3RlbmVyRXh0ZW5zaW9uKFhvY0RpYUV2ZW50LlJFU1BPTlNFX05BTUUuRU5EX0JFVFRJTkcsIHRoaXMub25FbmRCZXR0aW5nRXZlbnQsIHRoaXMpO1xyXG4gICAgICAgIHRoaXMuWm9uZUluc3RhbmNlLmFkZEV2ZW50TGlzdGVuZXJFeHRlbnNpb24oWG9jRGlhRXZlbnQuUkVTUE9OU0VfTkFNRS5ISVNUT1JZX1JFU1VMVCwgdGhpcy5vbkhpc3RvcnlSZXN1bHRFdmVudCwgdGhpcyk7XHJcbiAgICB9LFxyXG4gICAgcmVtb3ZlRXZlbnRzKCl7XHJcbiAgICAgICAgdGhpcy5fc3VwZXIoKTtcclxuICAgICAgICB0aGlzLlpvbmVJbnN0YW5jZS5yZW1vdmVFdmVudExpc3RlbmVyRXh0ZW5zaW9uKFhvY0RpYUV2ZW50LlJFU1BPTlNFX05BTUUuTE9BRF9HQU1FX1JFUywgdGhpcy5vbkxvYWRHYW1lRXZlbnQsIHRoaXMpO1xyXG4gICAgICAgIHRoaXMuWm9uZUluc3RhbmNlLnJlbW92ZUV2ZW50TGlzdGVuZXJFeHRlbnNpb24oWG9jRGlhRXZlbnQuUkVTUE9OU0VfTkFNRS5CRVRfUkVTLCB0aGlzLm9uVXNlckJldEV2ZW50LCB0aGlzKTtcclxuICAgICAgICB0aGlzLlpvbmVJbnN0YW5jZS5yZW1vdmVFdmVudExpc3RlbmVyRXh0ZW5zaW9uKFhvY0RpYUV2ZW50LlJFU1BPTlNFX05BTUUuRU5EX0JFVFRJTkcsIHRoaXMub25FbmRCZXR0aW5nRXZlbnQsIHRoaXMpO1xyXG4gICAgICAgIHRoaXMuWm9uZUluc3RhbmNlLnJlbW92ZUV2ZW50TGlzdGVuZXJFeHRlbnNpb24oWG9jRGlhRXZlbnQuUkVTUE9OU0VfTkFNRS5ISVNUT1JZX1JFU1VMVCwgdGhpcy5vbkhpc3RvcnlSZXN1bHRFdmVudCwgdGhpcyk7XHJcbiAgICB9LFxyXG4gICAgb25IaXN0b3J5RXZlbnQoZXZlbnQpe1xyXG4gICAgICAgIGxldCBoaXN0b3J5ID0gbmV3IFhvY0RpYUV2ZW50Lkhpc3RvcnlFdmVudCgpLmZyb21FdmVudChldmVudCk7XHJcbiAgICAgICAgdGhpcy5nZXRVSSgpLnNob3coXCJVSVhvY0RpYVRyYW5zYWN0aW9uXCIsIHtwb3A6IHRydWUsIHNyYzogJ3hvY2RpYScsIGRhdGE6IHtpdGVtczogaGlzdG9yeS5pdGVtc319KTtcclxuICAgIH0sXHJcbiAgICBvbkxlYWRlckJvYXJkRXZlbnQoZXZlbnQpe1xyXG4gICAgICAgIGxldCByYW5rID0gbmV3IFhvY0RpYUV2ZW50LkxlYWRlckJvYXJkRXZlbnQoKS5mcm9tRXZlbnQoZXZlbnQpO1xyXG4gICAgICAgIHRoaXMuZ2V0VUkoKS5zaG93KFwiVUlYb2NEaWFSYW5rXCIsIHtwb3A6IHRydWUsIHNyYzogJ3hvY2RpYScsIGRhdGE6IHtpdGVtczogcmFuay5pdGVtc319KTtcclxuICAgIH0sXHJcbiAgICBvbkV2ZW50TG9naW4oZXZlbnQpe1xyXG4gICAgICAgIHRoaXMuX3N1cGVyKGV2ZW50KTtcclxuICAgICAgICB0aGlzLl9yZXF1ZXN0Sm9pblJvb20odGhpcy56b25lTmFtZSk7XHJcbiAgICB9LFxyXG4gICAgb25FdmVudFJvb21Kb2luKGV2ZW50KXtcclxuICAgICAgICB0aGlzLl9zdXBlcihldmVudCk7XHJcbiAgICAgICAgaWYodGhpcy5nZXRVSSgpKVxyXG4gICAgICAgICAgICB0aGlzLmdldFVJKCkudXBkYXRlVXNlckNvdW50KCk7XHJcbiAgICB9LFxyXG4gICAgb25FdmVudFVzZXJFbnRlclJvb20oZXZlbnQpe1xyXG4gICAgICAgIHRoaXMuX3N1cGVyKGV2ZW50KTtcclxuICAgICAgICBsZXQgdXNlciA9IGV2ZW50LnVzZXI7XHJcbiAgICAgICAgaWYodGhpcy5nZXRVSSgpKXtcclxuICAgICAgICAgICAgdGhpcy5nZXRVSSgpLnVwZGF0ZVVzZXJDb3VudCgpO1xyXG4gICAgICAgICAgICB0aGlzLmdldFVJKCkuYWRkTm9kZVBsYXllckVudGVyUm9vbSh1c2VyKTtcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG4gICAgb25FdmVudFVzZXJFeGl0Um9vbShldmVudCl7XHJcbiAgICAgICAgbGV0IHVzZXIgPSBldmVudC51c2VyO1xyXG4gICAgICAgIGlmKHVzZXIuaXNJdE1lKXtcclxuICAgICAgICAgICAgaWYgKHRoaXMuZ2V0VUkoKSAhPSBudWxsKVxyXG4gICAgICAgICAgICAgICAgdGhpcy5nZXRVSSgpLm5vZGUuYWN0aXZlID0gZmFsc2U7XHJcbiAgICAgICAgICAgIFVJTWFuZ2VyLnNob3coXCJVSUhvbWVcIik7XHJcbiAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgIGlmKHRoaXMuZ2V0VUkoKSl7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmdldFVJKCkudXBkYXRlVXNlckNvdW50KCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmdldFVJKCkucmVtb3ZlTm9kZVBsYXllcih1c2VyKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH0sXHJcbiAgICBvbkxvYWRHYW1lRXZlbnQoZXZlbnQpe1xyXG4gICAgICAgIHRoaXMucHJlTG9hZFVJKHtwb3A6IHRydWV9LGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgaWYoIXRoaXMubV90YWJsZUluZm8pXHJcbiAgICAgICAgICAgICAgICB0aGlzLm1fdGFibGVJbmZvID0ge307XHJcbiAgICAgICAgICAgIGxldCBsb2FkRXZlbnQgPSBuZXcgWG9jRGlhRXZlbnQuTG9hZEdhbWVFdmVudCgpLmZyb21FdmVudChldmVudCk7XHJcbiAgICAgICAgICAgIHRoaXMubV90YWJsZUluZm8ubGlzdE15Q2hpcFBvdCA9IGxvYWRFdmVudC5saXN0TXlDaGlwUG90O1xyXG4gICAgICAgICAgICB0aGlzLm1fdGFibGVJbmZvLmxpc3RDaGlwUG90ID0gbG9hZEV2ZW50Lmxpc3RDaGlwUG90O1xyXG4gICAgICAgICAgICB0aGlzLm1fdGFibGVJbmZvLmlzQmV0dGluZyA9IGxvYWRFdmVudC5pc0JldHRpbmc7XHJcbiAgICAgICAgICAgIHRoaXMubV90YWJsZUluZm8udGltZSA9IGxvYWRFdmVudC50aW1lKzE7XHJcbiAgICAgICAgICAgIGlmKGxvYWRFdmVudC5yZXN1bHQpXHJcbiAgICAgICAgICAgICAgICB0aGlzLm1fdGFibGVJbmZvLnJlc3VsdCA9IGxvYWRFdmVudC5yZXN1bHQ7XHJcbiAgICAgICAgICAgIGlmKGxvYWRFdmVudC53aW5wb3QpXHJcbiAgICAgICAgICAgICAgICB0aGlzLm1fdGFibGVJbmZvLndpbnBvdCA9IGxvYWRFdmVudC53aW5wb3Q7XHJcbiAgICAgICAgICAgIGNjLmxhc3RUaW1lICAgICAgPSB0aGlzLm1fdGFibGVJbmZvLnRpbWUgKyBuZXcgRGF0ZSgpLmdldFRpbWUoKS8xMDAwO1xyXG4gICAgICAgICAgICB0aGlzLmdldFVJKCkuY29udHJvbGxlciA9IHRoaXM7XHJcbiAgICAgICAgICAgIHRoaXMucmVzdW1lR2FtZSgpO1xyXG5cclxuICAgICAgICB9LmJpbmQodGhpcykpXHJcbiAgICB9LFxyXG4gICAgcmVzdW1lR2FtZSgpIHtcclxuICAgICAgICBpZiAodGhpcy5tX3RhYmxlSW5mbyAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgIHRoaXMubV90YWJsZUluZm8udGltZSA9IE1hdGguZmxvb3IoY2MubGFzdFRpbWUgLSBuZXcgRGF0ZSgpLmdldFRpbWUoKSAvIDEwMDApO1xyXG4gICAgICAgICAgICB0aGlzLmdldFVJKCkuc2hvd0xpc3RNeUNoaXBCZXQodGhpcy5tX3RhYmxlSW5mby5saXN0TXlDaGlwUG90KTtcclxuICAgICAgICAgICAgdGhpcy5nZXRVSSgpLnNob3dMaXN0Q2hpcEJldCh0aGlzLm1fdGFibGVJbmZvLmxpc3RDaGlwUG90KTtcclxuICAgICAgICAgICAgbGV0IHVzZXJzID0gW107XHJcbiAgICAgICAgICAgIHVzZXJzLnB1c2godGhpcy5ab25lSW5zdGFuY2UubXlTZWxmKTtcclxuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmdldFJvb20oKS5nZXRVc2VyTGlzdCgpLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgdSA9IHRoaXMuZ2V0Um9vbSgpLmdldFVzZXJMaXN0KClbaV07XHJcbiAgICAgICAgICAgICAgICBpZiAodS5uYW1lICE9IHRoaXMuWm9uZUluc3RhbmNlLm15U2VsZi5uYW1lICYmIHVzZXJzLmxlbmd0aCA8IDYpIHtcclxuICAgICAgICAgICAgICAgICAgICB1c2Vycy5wdXNoKHUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuZ2V0VUkoKS5zaG93TGlzdFVzZXJzKHVzZXJzKTtcclxuICAgICAgICAgICAgaWYgKHRoaXMubV90YWJsZUluZm8uaXNCZXR0aW5nKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmdldFVJKCkuX3N0b3BFZmZlY3RXaW5Qb3QoKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuZ2V0VUkoKS5Ub2FzdERhdEN1YSgpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5nZXRVSSgpLl90dXJuT2ZmVGltZSgpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5nZXRVSSgpLl90dXJuT25UaW1lKHRoaXMubV90YWJsZUluZm8udGltZSwgdGhpcy5tX3RhYmxlSW5mby5pc0JldHRpbmcpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5nZXRVSSgpLl90dXJuT2ZmVGltZSgpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5nZXRVSSgpLnJlc3VtZVhvY1hvYyh0aGlzLm1fdGFibGVJbmZvLnJlc3VsdCwgdGhpcy5tX3RhYmxlSW5mby53aW5wb3QsIHRoaXMubV90YWJsZUluZm8udGltZSwgdGhpcy5tX3RhYmxlSW5mby5pc1dpbik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9LFxyXG4gICAgb25Vc2VyQmV0RXZlbnQoZXZlbnQpe1xyXG4gICAgICAgIGlmKCF0aGlzLm1fdGFibGVJbmZvKVxyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgbGV0IHVzZXJCZXQgPSBuZXcgWG9jRGlhRXZlbnQuQmV0RXZlbnQoKS5mcm9tRXZlbnQoZXZlbnQpO1xyXG4gICAgICAgIGxldCB1c2VyTmFtZSA9IHVzZXJCZXQudXNlck5hbWU7XHJcbiAgICAgICAgbGV0IGJldENoaXAgPSB1c2VyQmV0LmJldENoaXA7XHJcbiAgICAgICAgbGV0IHR5cGVQb3QgPSB1c2VyQmV0LnR5cGVQb3Q7XHJcblxyXG4gICAgICAgIHRoaXMubV90YWJsZUluZm8ubGlzdENoaXBQb3RbdHlwZVBvdF0gKz0gYmV0Q2hpcDtcclxuICAgICAgICB0aGlzLmdldFVJKCkuc2hvd0xpc3RDaGlwQmV0KHRoaXMubV90YWJsZUluZm8ubGlzdENoaXBQb3QpO1xyXG4gICAgICAgIGlmKHRoaXMuWm9uZUluc3RhbmNlLm15U2VsZi5uYW1lID09IHVzZXJOYW1lKXtcclxuICAgICAgICAgICAgdGhpcy5tX3RhYmxlSW5mby5saXN0TXlDaGlwUG90W3R5cGVQb3RdICs9IGJldENoaXA7XHJcbiAgICAgICAgICAgIHRoaXMuZ2V0VUkoKS5zaG93TGlzdE15Q2hpcEJldCh0aGlzLm1fdGFibGVJbmZvLmxpc3RNeUNoaXBQb3QpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmdldFVJKCkuYWN0aW9uRmx5Q2hpcFRvUG90KHVzZXJOYW1lLCB0eXBlUG90LCBiZXRDaGlwKTtcclxuICAgICAgICAvLyB1c2VyIGJldFxyXG4gICAgICAgIGxldCB1c2VyID0gdGhpcy5nZXRSb29tKCkuZ2V0VXNlckJ5TmFtZSh1c2VyTmFtZSk7XHJcbiAgICAgICAgaWYodXNlcilcclxuICAgICAgICAgICAgdGhpcy5nZXRVSSgpLnVwZGF0ZUNoaXAodXNlciwgMCk7XHJcbiAgICB9LFxyXG4gICAgb25FbmRCZXR0aW5nRXZlbnQoZXZlbnQpe1xyXG4gICAgICAgIGxldCBlbmRCZXR0aW5nID0gbmV3IFhvY0RpYUV2ZW50LkVuZEJldHRpbmcoKS5mcm9tRXZlbnQoZXZlbnQpO1xyXG4gICAgICAgIGlmKCF0aGlzLm1fdGFibGVJbmZvKVxyXG4gICAgICAgICAgICB0aGlzLm1fdGFibGVJbmZvID0ge307XHJcbiAgICAgICAgdGhpcy5tX3RhYmxlSW5mby5pc0JldHRpbmcgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLm1fdGFibGVJbmZvLnJlc3VsdCA9IGVuZEJldHRpbmcucmVzdWx0O1xyXG4gICAgICAgIHRoaXMubV90YWJsZUluZm8ud2lucG90ID0gZW5kQmV0dGluZy53aW5wb3Q7XHJcbiAgICAgICAgdGhpcy5tX3RhYmxlSW5mby53aW5DaGlwID0gZW5kQmV0dGluZy53aW5DaGlwO1xyXG4gICAgICAgIHRoaXMubV90YWJsZUluZm8uaXNXaW4gID0gZW5kQmV0dGluZy53aW5DaGlwID4gMDtcclxuICAgICAgICB0aGlzLm1fdGFibGVJbmZvLnJlZnVuZCA9IGVuZEJldHRpbmcucmVmdW5kO1xyXG4gICAgICAgIHRoaXMuZ2V0VUkoKS5fdHVybk9mZlRpbWUoKTtcclxuICAgICAgICB0aGlzLmdldFVJKCkueG9jeG9jKGVuZEJldHRpbmcucmVzdWx0LCBlbmRCZXR0aW5nLndpbnBvdCwgIGVuZEJldHRpbmcud2luQ2hpcCA+IDAgPyB0cnVlIDogZmFsc2UpO1xyXG4gICAgfSxcclxuICAgIG9uSGlzdG9yeVJlc3VsdEV2ZW50KGV2ZW50KXtcclxuICAgICAgICBsZXQgaGlzdG9yeSA9IG5ldyBYb2NEaWFFdmVudC5IaXN0b3J5UmVzcG9uc2UoKS5mcm9tRXZlbnQoZXZlbnQpO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKGhpc3RvcnkucmVzdWx0KTtcclxuICAgICAgICB0aGlzLmdldFVJKCkuc2hvd1NvaUNhdShoaXN0b3J5LnJlc3VsdCk7XHJcbiAgICB9LFxyXG4gICAgb25QdWJsaWNNZXNzYWdlKGV2ZW50KXtcclxuICAgICAgICBsZXQgc2VuZGVyID0gZXZlbnQuc2VuZGVyO1xyXG4gICAgICAgIGxldCBtc2cgPSBldmVudC5tZXNzYWdlO1xyXG4gICAgICAgIGxldCBkYXRhID0gZXZlbnQuZGF0YTtcclxuICAgICAgICBsZXQgZGF0YVNlbmRlciA9IGRhdGEgIT0gbnVsbCA/IHtkbjogZGF0YS5nZXQoXCJkblwiKSwgZmIgOiBkYXRhLmdldChcImZiXCIpfSA6IHtkbjogXCIuLi5cIiwgZmIgOiBcIlwifTtcclxuICAgICAgICBsZXQgbXNnSXRlbSA9IHt9O1xyXG4gICAgICAgIG1zZ0l0ZW0uc2VuZGVyID0gc2VuZGVyO1xyXG4gICAgICAgIG1zZ0l0ZW0ubXNnID0gbXNnO1xyXG4gICAgICAgIG1zZ0l0ZW0uZGF0YVNlbmRlciA9IGRhdGFTZW5kZXI7XHJcbiAgICAgICAgdGhpcy5nZXRVSSgpLm9uUHVibGljTWVzc2FnZShtc2dJdGVtKTtcclxuICAgIH0sXHJcbn0pO1xyXG5sZXQgaW5zdGFuY2UgPSBudWxsO1xyXG5sZXQgZ2V0SW5zdGFuY2UgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICBpZihpbnN0YW5jZSA9PSBudWxsKVxyXG4gICAgICAgIGluc3RhbmNlID0gbmV3IFhvY0RpYUNvbnRyb2xsZXIoJ1VJWG9jRGlhJywgJ3hvY2RpYScpO1xyXG4gICAgcmV0dXJuIGluc3RhbmNlO1xyXG59XHJcblNtYXJ0Rm94U0RLLlhvY0RpYUNvbnRyb2xsZXIgPSBtb2R1bGUuZXhwb3J0cyA9IGdldEluc3RhbmNlKCk7XHJcbiJdfQ==