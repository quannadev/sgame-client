
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/scripts/poker/UIPoker.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, 'e8debnA7Y5Kg47AGSDTbMUL', 'UIPoker');
// scripts/poker/UIPoker.js

"use strict";

cc.Class({
  "extends": cc.BaseGame,
  properties: {
    ChatEmojiLayer: cc.Node,
    Action: cc.Node,
    CommunityCard: cc.Node,
    lb_total_bet: cc.Label,
    PokerTextWinner: cc.Node,
    PotPrefab: cc.Prefab,
    buy_in: 0,
    bet: 500,
    POS_6: cc.Node,
    POS_9: cc.Node
  },
  onLoad: function onLoad() {
    // init prefab pot
    this.PoolPot = [];

    for (var i = 0; i < 9; i++) {
      var pot = cc.instantiate(this.PotPrefab);
      this.node.addChild(pot);
      pot.active = false;
      this.PoolPot.push(pot);
    }
  },
  onEnable: function onEnable() {
    this.buy_in = this._data.buy_in;
    this._number_desk = this._data.number_desk;
    this._room = this._data.room;
    this.poses = [];

    if (this._number_desk == 6) {
      this.POS_6.active = true;
      this.POS_9.active = false;
      this._CURRENT_POS = this.POS_6;
    } else {
      this.POS_6.active = false;
      this.POS_9.active = true;
      this._CURRENT_POS = this.POS_9;
    }

    for (var i = 0; i < this._CURRENT_POS._children.length; i++) {
      var pos = this._CURRENT_POS._children[i];
      this.poses.push(this._CURRENT_POS._children[i]);
      pos.on("touchend", function () {
        this.requestSitOn();
      }, this);
      pos.active = false;
    }

    this.countOut = 0;
  },
  onDisable: function onDisable() {
    this.nodePlayers.removeAllChildren(true);
    this.getCommunityCard().reset();
    this.hideDeskEmpty();
    this.lb_total_bet.node.parent.active = false;
    this.hidePokerTextWinner();
    this.WaitingTimer.active = false;
  },
  runActionChipToPot: function runActionChipToPot(betChip, cb) {
    if (betChip <= 0) {
      if (cb) cb();
      return;
    }

    for (var i = 0; i < this.controller.m_tableInfo.m_listUser.length; i++) {
      var player = this._getJSPlayerByName(this.controller.m_tableInfo.m_listUser[i]);

      var convertPosBet = this.getPositionInOtherNode(player.BetChip, this.node);
      var pot = this.requestPoolPot();
      pot.position = convertPosBet;
      pot.active = true;
      pot.getChildByName("money").getComponent(cc.Label).string = Utils.formatCurrency(betChip);
      pot.runAction(cc.sequence(cc.moveTo(0.3, this.lb_total_bet.node.parent.position), cc.callFunc(function () {
        this.active = false;
        if (cb) cb();
      }, pot)));
    }
  },
  hidePokerTextWinner: function hidePokerTextWinner() {
    this.PokerTextWinner.active = false;
    var animation = this.PokerTextWinner.getComponent(sp.Skeleton);
    animation.setAnimation(0, "NONE", false);
  },
  showPokerTextWinner: function showPokerTextWinner(nameWin) {
    var winningHands = {
      HIGHCARD: "Bai-Cao",
      PAIR: "Mot-Doi",
      TWOPAIR: "Hai-Doi",
      THREEOFAKIND: "Xam",
      STRAIGHT: "Sanh",
      FLUSH: "Thung",
      FULLHOUSE: "Cu-Lu",
      FOUROFAKIND: "Tu-Quy",
      STRAIGHTFLUSH: "Sanh-Thung",
      ROYALFLUSH: "Thung_Pha-Sanh"
    };
    this.PokerTextWinner.active = true;
    var animation = this.PokerTextWinner.getComponent(sp.Skeleton);

    if (nameWin == "Sanh-Thung") {
      animation.setAnimation(0, "Sanh", false);
      animation.setAnimation(1, "Thung", false);
    } else if (winningHands[nameWin]) {
      animation.setAnimation(0, winningHands[nameWin], true);
    } else {
      this.PokerTextWinner.active = false;
    }
  },
  eventBack: function eventBack() {
    if (!this.controller.m_tableInfo.m_isGameStart || this.controller.m_tableInfo.m_listActiveUserName.length <= 1) {
      this.requestLeaveRoom();
    } else {
      var isSitOut = true;

      if (this.controller.m_tableInfo.m_listUserSitOut.indexOf(SmartFoxSDK.PokerController.ZoneInstance.mySelf.name) >= 0) {
        isSitOut = false;
      }

      var sitOutRequest = new PokerRequest.SitOutRequest();
      sitOutRequest.setRoomId(this._room.id);
      sitOutRequest.setSitOut(isSitOut);
      SmartFoxSDK.PokerController.ZoneInstance.send(sitOutRequest.toSRequest());
    }
  },
  requestSitOn: function requestSitOn() {
    var myName = SmartFoxSDK.PokerController.ZoneInstance.mySelf.name;

    if (this._getJSPlayerByName(myName) == null) {
      var sitOnRequest = new PokerRequest.SitOnRequest().setRoomId(this._room.id).setAutoSitOn().setBuyIn(this.buy_in);
      SmartFoxSDK.PokerController.ZoneInstance.send(sitOnRequest.toSRequest());
      this.hideDeskEmpty();
    }
  },
  getCommunityCard: function getCommunityCard() {
    return this.CommunityCard.getComponent(this.CommunityCard.name);
  },
  getAction: function getAction() {
    return this.Action.getComponent(this.Action.name);
  },
  setMoneyPot: function setMoneyPot(money) {
    if (money > 0) {
      this.lb_total_bet.string = Utils.formatCurrency(money);
      this.lb_total_bet.node.parent.active = true;
    } else {
      this.lb_total_bet.node.parent.active = false;
    }
  },
  processBetChipToPot: function processBetChipToPot(cb) {
    var betChip = 0; // sum all pot of user to total pot

    for (var i = 0; i < this.controller.m_tableInfo.m_listDesk.length; i++) {
      var desk = this.controller.m_tableInfo.m_listDesk[i];

      var player = this._getJSPlayerById(desk.DeskId);

      if (player) {
        betChip = player.m_total_bet;
        this.controller.m_tableInfo.m_potChip += player.m_total_bet; // reset bet of user

        player.resetBet();
      }
    } // action sum all pot of user to total pot


    this.runActionChipToPot(betChip, function () {
      this.lb_total_bet.string = Utils.formatCurrency(this.controller.m_tableInfo.m_potChip);
      this.lb_total_bet.node.parent.active = true;

      if (cb) {
        cb();
      }
    }.bind(this));
  },
  requestPoolPot: function requestPoolPot() {
    for (var i = 0; i < this.PoolPot.length; i++) {
      if (!this.PoolPot[i].active) {
        this.PoolPot[i].active = true;
        return this.PoolPot[i];
      }
    }

    var pot = cc.instantiate(this.PotPrefab);
    this.node.addChild(pot);
    this.PoolPot.push(pot);
    return pot;
  },
  runActionPotChipToWinner: function runActionPotChipToWinner(moneyWin, winner, cb, target) {
    var player = this._getJSPlayerByName(winner);

    if (player) {
      var pot = this.requestPoolPot();
      var self = this;
      var convertPosBet = this.getPositionInOtherNode(player.BetChip, this.node);
      pot.position = this.lb_total_bet.node.parent.position;
      pot.getChildByName("money").getComponent(cc.Label).string = Utils.formatCurrency(moneyWin);
      pot.runAction(cc.sequence(cc.moveTo(0.5, convertPosBet), cc.callFunc(function () {
        this.active = false;
        self.lb_total_bet.node.parent.active = false;
        if (cb) cb(moneyWin, target);
      }, pot)));
    }
  },
  eventShowChat: function eventShowChat(event, data) {
    this.ChatEmojiLayer.active = !this.ChatEmojiLayer.active;
    if (this.ChatEmojiLayer.active) this.ChatEmojiLayer.getComponent("ChatEmojiLayer").initController(SmartFoxSDK.PokerController.ZoneInstance);
  },
  onPublicMessage: function onPublicMessage(messData) {
    var playerJs = this._getJSPlayerByName(messData.sender.name);

    if (playerJs != null) {
      playerJs.onPublicMessage(messData.msg);
    }
  },
  updateUserVariable: function updateUserVariable(subChip) {
    var jsPlayer = this._getJSPlayerByName(SmartFoxSDK.PokerController.ZoneInstance.mySelf.name);

    jsPlayer.setMoney(GameVariables.Poker.getChip(SmartFoxSDK.PokerController.ZoneInstance.mySelf) - subChip);
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0cy9zY3JpcHRzL3Bva2VyL1VJUG9rZXIuanMiXSwibmFtZXMiOlsiY2MiLCJDbGFzcyIsIkJhc2VHYW1lIiwicHJvcGVydGllcyIsIkNoYXRFbW9qaUxheWVyIiwiTm9kZSIsIkFjdGlvbiIsIkNvbW11bml0eUNhcmQiLCJsYl90b3RhbF9iZXQiLCJMYWJlbCIsIlBva2VyVGV4dFdpbm5lciIsIlBvdFByZWZhYiIsIlByZWZhYiIsImJ1eV9pbiIsImJldCIsIlBPU182IiwiUE9TXzkiLCJvbkxvYWQiLCJQb29sUG90IiwiaSIsInBvdCIsImluc3RhbnRpYXRlIiwibm9kZSIsImFkZENoaWxkIiwiYWN0aXZlIiwicHVzaCIsIm9uRW5hYmxlIiwiX2RhdGEiLCJfbnVtYmVyX2Rlc2siLCJudW1iZXJfZGVzayIsIl9yb29tIiwicm9vbSIsInBvc2VzIiwiX0NVUlJFTlRfUE9TIiwiX2NoaWxkcmVuIiwibGVuZ3RoIiwicG9zIiwib24iLCJyZXF1ZXN0U2l0T24iLCJjb3VudE91dCIsIm9uRGlzYWJsZSIsIm5vZGVQbGF5ZXJzIiwicmVtb3ZlQWxsQ2hpbGRyZW4iLCJnZXRDb21tdW5pdHlDYXJkIiwicmVzZXQiLCJoaWRlRGVza0VtcHR5IiwicGFyZW50IiwiaGlkZVBva2VyVGV4dFdpbm5lciIsIldhaXRpbmdUaW1lciIsInJ1bkFjdGlvbkNoaXBUb1BvdCIsImJldENoaXAiLCJjYiIsImNvbnRyb2xsZXIiLCJtX3RhYmxlSW5mbyIsIm1fbGlzdFVzZXIiLCJwbGF5ZXIiLCJfZ2V0SlNQbGF5ZXJCeU5hbWUiLCJjb252ZXJ0UG9zQmV0IiwiZ2V0UG9zaXRpb25Jbk90aGVyTm9kZSIsIkJldENoaXAiLCJyZXF1ZXN0UG9vbFBvdCIsInBvc2l0aW9uIiwiZ2V0Q2hpbGRCeU5hbWUiLCJnZXRDb21wb25lbnQiLCJzdHJpbmciLCJVdGlscyIsImZvcm1hdEN1cnJlbmN5IiwicnVuQWN0aW9uIiwic2VxdWVuY2UiLCJtb3ZlVG8iLCJjYWxsRnVuYyIsImFuaW1hdGlvbiIsInNwIiwiU2tlbGV0b24iLCJzZXRBbmltYXRpb24iLCJzaG93UG9rZXJUZXh0V2lubmVyIiwibmFtZVdpbiIsIndpbm5pbmdIYW5kcyIsIkhJR0hDQVJEIiwiUEFJUiIsIlRXT1BBSVIiLCJUSFJFRU9GQUtJTkQiLCJTVFJBSUdIVCIsIkZMVVNIIiwiRlVMTEhPVVNFIiwiRk9VUk9GQUtJTkQiLCJTVFJBSUdIVEZMVVNIIiwiUk9ZQUxGTFVTSCIsImV2ZW50QmFjayIsIm1faXNHYW1lU3RhcnQiLCJtX2xpc3RBY3RpdmVVc2VyTmFtZSIsInJlcXVlc3RMZWF2ZVJvb20iLCJpc1NpdE91dCIsIm1fbGlzdFVzZXJTaXRPdXQiLCJpbmRleE9mIiwiU21hcnRGb3hTREsiLCJQb2tlckNvbnRyb2xsZXIiLCJab25lSW5zdGFuY2UiLCJteVNlbGYiLCJuYW1lIiwic2l0T3V0UmVxdWVzdCIsIlBva2VyUmVxdWVzdCIsIlNpdE91dFJlcXVlc3QiLCJzZXRSb29tSWQiLCJpZCIsInNldFNpdE91dCIsInNlbmQiLCJ0b1NSZXF1ZXN0IiwibXlOYW1lIiwic2l0T25SZXF1ZXN0IiwiU2l0T25SZXF1ZXN0Iiwic2V0QXV0b1NpdE9uIiwic2V0QnV5SW4iLCJnZXRBY3Rpb24iLCJzZXRNb25leVBvdCIsIm1vbmV5IiwicHJvY2Vzc0JldENoaXBUb1BvdCIsIm1fbGlzdERlc2siLCJkZXNrIiwiX2dldEpTUGxheWVyQnlJZCIsIkRlc2tJZCIsIm1fdG90YWxfYmV0IiwibV9wb3RDaGlwIiwicmVzZXRCZXQiLCJiaW5kIiwicnVuQWN0aW9uUG90Q2hpcFRvV2lubmVyIiwibW9uZXlXaW4iLCJ3aW5uZXIiLCJ0YXJnZXQiLCJzZWxmIiwiZXZlbnRTaG93Q2hhdCIsImV2ZW50IiwiZGF0YSIsImluaXRDb250cm9sbGVyIiwib25QdWJsaWNNZXNzYWdlIiwibWVzc0RhdGEiLCJwbGF5ZXJKcyIsInNlbmRlciIsIm1zZyIsInVwZGF0ZVVzZXJWYXJpYWJsZSIsInN1YkNoaXAiLCJqc1BsYXllciIsInNldE1v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OUY7QUFDUCxHQXRNSTtBQXVNTHFDLEVBQUFBLGVBdk1LLDJCQXVNV0MsUUF2TVgsRUF1TXFCO0FBQ3RCLFFBQUlDLFFBQVEsR0FBRyxLQUFLaEYsa0JBQUwsQ0FBd0IrRSxRQUFRLENBQUNFLE1BQVQsQ0FBZ0J0QyxJQUF4QyxDQUFmOztBQUNBLFFBQUdxQyxRQUFRLElBQUksSUFBZixFQUFvQjtBQUNoQkEsTUFBQUEsUUFBUSxDQUFDRixlQUFULENBQXlCQyxRQUFRLENBQUNHLEdBQWxDO0FBQ0g7QUFDSixHQTVNSTtBQTZNTEMsRUFBQUEsa0JBN01LLDhCQTZNY0MsT0E3TWQsRUE2TXNCO0FBQ3ZCLFFBQUlDLFFBQVEsR0FBTSxLQUFLckYsa0JBQUwsQ0FBd0J1QyxXQUFXLENBQUNDLGVBQVosQ0FBNEJDLFlBQTVCLENBQXlDQyxNQUF6QyxDQUFnREMsSUFBeEUsQ0FBbEI7O0FBQ0EwQyxJQUFBQSxRQUFRLENBQUNDLFFBQVQsQ0FBa0JDLGFBQWEsQ0FBQ0MsS0FBZCxDQUFvQkMsT0FBcEIsQ0FBNEJsRCxXQUFXLENBQUNDLGVBQVosQ0FBNEJDLFlBQTVCLENBQXlDQyxNQUFyRSxJQUE2RTBDLE9BQS9GO0FBQ0g7QUFoTkksQ0FBVCIsInNvdXJjZVJvb3QiOiIvIiwic291cmNlc0NvbnRlbnQiOlsiY2MuQ2xhc3Moe1xuICAgIGV4dGVuZHM6IGNjLkJhc2VHYW1lLFxuXG4gICAgcHJvcGVydGllczoge1xuICAgICAgICBDaGF0RW1vamlMYXllcjogY2MuTm9kZSxcbiAgICAgICAgQWN0aW9uOiBjYy5Ob2RlLFxuICAgICAgICBDb21tdW5pdHlDYXJkOiBjYy5Ob2RlLFxuICAgICAgICBsYl90b3RhbF9iZXQ6IGNjLkxhYmVsLFxuICAgICAgICBQb2tlclRleHRXaW5uZXI6IGNjLk5vZGUsXG4gICAgICAgIFBvdFByZWZhYjogY2MuUHJlZmFiLFxuICAgICAgICBidXlfaW46IDAsXG4gICAgICAgIGJldDogNTAwLFxuICAgICAgICBQT1NfNjogY2MuTm9kZSxcbiAgICAgICAgUE9TXzk6IGNjLk5vZGUsXG4gICAgfSxcbiAgICBvbkxvYWQoKXtcbiAgICAgICAgLy8gaW5pdCBwcmVmYWIgcG90XG4gICAgICAgIHRoaXMuUG9vbFBvdCA9IFtdO1xuICAgICAgICBmb3IobGV0IGkgPSAwOyBpIDwgOTtpKyspe1xuICAgICAgICAgICAgbGV0IHBvdCA9IGNjLmluc3RhbnRpYXRlKHRoaXMuUG90UHJlZmFiKTtcbiAgICAgICAgICAgIHRoaXMubm9kZS5hZGRDaGlsZChwb3QpO1xuICAgICAgICAgICAgcG90LmFjdGl2ZSA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy5Qb29sUG90LnB1c2gocG90KTtcbiAgICAgICAgfVxuICAgIH0sXG4gICAgb25FbmFibGUoKXtcbiAgICAgICAgdGhpcy5idXlfaW4gPSB0aGlzLl9kYXRhLmJ1eV9pbjtcbiAgICAgICAgdGhpcy5fbnVtYmVyX2Rlc2sgPSB0aGlzLl9kYXRhLm51bWJlcl9kZXNrO1xuICAgICAgICB0aGlzLl9yb29tID0gdGhpcy5fZGF0YS5yb29tO1xuICAgICAgICB0aGlzLnBvc2VzID0gW107XG4gICAgICAgIGlmKHRoaXMuX251bWJlcl9kZXNrID09IDYpe1xuICAgICAgICAgICAgdGhpcy5QT1NfNi5hY3RpdmUgPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy5QT1NfOS5hY3RpdmUgPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMuX0NVUlJFTlRfUE9TID0gdGhpcy5QT1NfNjtcbiAgICAgICAgfWVsc2Uge1xuICAgICAgICAgICAgdGhpcy5QT1NfNi5hY3RpdmUgPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMuUE9TXzkuYWN0aXZlID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMuX0NVUlJFTlRfUE9TID0gdGhpcy5QT1NfOTtcbiAgICAgICAgfVxuICAgICAgICBmb3IobGV0IGkgPSAwOyBpIDwgdGhpcy5fQ1VSUkVOVF9QT1MuX2NoaWxkcmVuLmxlbmd0aDtpKyspe1xuICAgICAgICAgICAgbGV0IHBvcyA9IHRoaXMuX0NVUlJFTlRfUE9TLl9jaGlsZHJlbltpXTtcbiAgICAgICAgICAgIHRoaXMucG9zZXMucHVzaCh0aGlzLl9DVVJSRU5UX1BPUy5fY2hpbGRyZW5baV0pO1xuICAgICAgICAgICAgcG9zLm9uKFwidG91Y2hlbmRcIiwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHRoaXMucmVxdWVzdFNpdE9uKCk7XG4gICAgICAgICAgICB9LCB0aGlzKTtcbiAgICAgICAgICAgIHBvcy5hY3RpdmUgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmNvdW50T3V0ID0gMDtcbiAgICB9LFxuICAgIG9uRGlzYWJsZSgpe1xuICAgICAgICB0aGlzLm5vZGVQbGF5ZXJzLnJlbW92ZUFsbENoaWxkcmVuKHRydWUpO1xuICAgICAgICB0aGlzLmdldENvbW11bml0eUNhcmQoKS5yZXNldCgpO1xuICAgICAgICB0aGlzLmhpZGVEZXNrRW1wdHkoKTtcbiAgICAgICAgdGhpcy5sYl90b3RhbF9iZXQubm9kZS5wYXJlbnQuYWN0aXZlID0gZmFsc2U7XG4gICAgICAgIHRoaXMuaGlkZVBva2VyVGV4dFdpbm5lcigpO1xuICAgICAgICB0aGlzLldhaXRpbmdUaW1lci5hY3RpdmUgPSBmYWxzZTtcbiAgICB9LFxuICAgIHJ1bkFjdGlvbkNoaXBUb1BvdChiZXRDaGlwLCBjYil7XG4gICAgICAgIGlmKGJldENoaXAgPD0gMCl7XG4gICAgICAgICAgICBpZihjYilcbiAgICAgICAgICAgICAgICBjYigpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCB0aGlzLmNvbnRyb2xsZXIubV90YWJsZUluZm8ubV9saXN0VXNlci5sZW5ndGg7aSsrKXtcbiAgICAgICAgICAgIGxldCBwbGF5ZXIgPSB0aGlzLl9nZXRKU1BsYXllckJ5TmFtZSh0aGlzLmNvbnRyb2xsZXIubV90YWJsZUluZm8ubV9saXN0VXNlcltpXSk7XG4gICAgICAgICAgICBsZXQgY29udmVydFBvc0JldCA9IHRoaXMuZ2V0UG9zaXRpb25Jbk90aGVyTm9kZShwbGF5ZXIuQmV0Q2hpcCwgdGhpcy5ub2RlKTtcbiAgICAgICAgICAgIGxldCBwb3QgPSB0aGlzLnJlcXVlc3RQb29sUG90KCk7XG4gICAgICAgICAgICBwb3QucG9zaXRpb24gPSBjb252ZXJ0UG9zQmV0O1xuICAgICAgICAgICAgcG90LmFjdGl2ZSA9IHRydWU7XG4gICAgICAgICAgICBwb3QuZ2V0Q2hpbGRCeU5hbWUoXCJtb25leVwiKS5nZXRDb21wb25lbnQoY2MuTGFiZWwpLnN0cmluZyA9IFV0aWxzLmZvcm1hdEN1cnJlbmN5KGJldENoaXApO1xuICAgICAgICAgICAgcG90LnJ1bkFjdGlvbihjYy5zZXF1ZW5jZShjYy5tb3ZlVG8oMC4zLCB0aGlzLmxiX3RvdGFsX2JldC5ub2RlLnBhcmVudC5wb3NpdGlvbiksIGNjLmNhbGxGdW5jKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmFjdGl2ZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIGlmKGNiKVxuICAgICAgICAgICAgICAgICAgICBjYigpO1xuICAgICAgICAgICAgfSwgcG90KSkpXG4gICAgICAgIH1cbiAgICB9LFxuICAgIGhpZGVQb2tlclRleHRXaW5uZXIoKXtcbiAgICAgICAgdGhpcy5Qb2tlclRleHRXaW5uZXIuYWN0aXZlID0gZmFsc2U7XG4gICAgICAgIGxldCBhbmltYXRpb24gPSB0aGlzLlBva2VyVGV4dFdpbm5lci5nZXRDb21wb25lbnQoc3AuU2tlbGV0b24pO1xuICAgICAgICBhbmltYXRpb24uc2V0QW5pbWF0aW9uKDAsIFwiTk9ORVwiLCBmYWxzZSk7XG4gICAgfSxcbiAgICBzaG93UG9rZXJUZXh0V2lubmVyKG5hbWVXaW4pe1xuICAgICAgICBsZXQgd2lubmluZ0hhbmRzID0ge1xuICAgICAgICAgICAgSElHSENBUkQgOiBcIkJhaS1DYW9cIixcbiAgICAgICAgICAgIFBBSVI6IFwiTW90LURvaVwiLFxuICAgICAgICAgICAgVFdPUEFJUjogXCJIYWktRG9pXCIsXG4gICAgICAgICAgICBUSFJFRU9GQUtJTkQ6IFwiWGFtXCIsXG4gICAgICAgICAgICBTVFJBSUdIVDogXCJTYW5oXCIsXG4gICAgICAgICAgICBGTFVTSDogXCJUaHVuZ1wiLFxuICAgICAgICAgICAgRlVMTEhPVVNFOiBcIkN1LUx1XCIsXG4gICAgICAgICAgICBGT1VST0ZBS0lORDogXCJUdS1RdXlcIixcbiAgICAgICAgICAgIFNUUkFJR0hURkxVU0g6IFwiU2FuaC1UaHVuZ1wiLFxuICAgICAgICAgICAgUk9ZQUxGTFVTSDogXCJUaHVuZ19QaGEtU2FuaFwiXG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5Qb2tlclRleHRXaW5uZXIuYWN0aXZlID0gdHJ1ZTtcbiAgICAgICAgbGV0IGFuaW1hdGlvbiA9IHRoaXMuUG9rZXJUZXh0V2lubmVyLmdldENvbXBvbmVudChzcC5Ta2VsZXRvbik7XG4gICAgICAgIGlmKG5hbWVXaW4gPT0gXCJTYW5oLVRodW5nXCIpe1xuICAgICAgICAgICAgYW5pbWF0aW9uLnNldEFuaW1hdGlvbigwLCBcIlNhbmhcIiwgZmFsc2UpO1xuICAgICAgICAgICAgYW5pbWF0aW9uLnNldEFuaW1hdGlvbigxLCBcIlRodW5nXCIsIGZhbHNlKTtcbiAgICAgICAgfWVsc2UgaWYod2lubmluZ0hhbmRzW25hbWVXaW5dKXtcbiAgICAgICAgICAgIGFuaW1hdGlvbi5zZXRBbmltYXRpb24oMCwgd2lubmluZ0hhbmRzW25hbWVXaW5dLCB0cnVlKTtcbiAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICB0aGlzLlBva2VyVGV4dFdpbm5lci5hY3RpdmUgPSBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgfSxcbiAgICBldmVudEJhY2soKXtcbiAgICAgICAgaWYoIXRoaXMuY29udHJvbGxlci5tX3RhYmxlSW5mby5tX2lzR2FtZVN0YXJ0IHx8IHRoaXMuY29udHJvbGxlci5tX3RhYmxlSW5mby5tX2xpc3RBY3RpdmVVc2VyTmFtZS5sZW5ndGggPD0gMSl7XG4gICAgICAgICAgIHRoaXMucmVxdWVzdExlYXZlUm9vbSgpO1xuICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgIGxldCBpc1NpdE91dCA9IHRydWU7XG4gICAgICAgICAgICBpZih0aGlzLmNvbnRyb2xsZXIubV90YWJsZUluZm8ubV9saXN0VXNlclNpdE91dC5pbmRleE9mKFNtYXJ0Rm94U0RLLlBva2VyQ29udHJvbGxlci5ab25lSW5zdGFuY2UubXlTZWxmLm5hbWUpID49IDApe1xuICAgICAgICAgICAgICAgIGlzU2l0T3V0ID0gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsZXQgc2l0T3V0UmVxdWVzdCA9IG5ldyBQb2tlclJlcXVlc3QuU2l0T3V0UmVxdWVzdCgpO1xuICAgICAgICAgICAgc2l0T3V0UmVxdWVzdC5zZXRSb29tSWQodGhpcy5fcm9vbS5pZCk7XG4gICAgICAgICAgICBzaXRPdXRSZXF1ZXN0LnNldFNpdE91dChpc1NpdE91dCk7XG4gICAgICAgICAgICBTbWFydEZveFNESy5Qb2tlckNvbnRyb2xsZXIuWm9uZUluc3RhbmNlLnNlbmQoc2l0T3V0UmVxdWVzdC50b1NSZXF1ZXN0KCkpO1xuICAgICAgICB9XG4gICAgfSxcbiAgICByZXF1ZXN0U2l0T24oKXtcbiAgICAgICAgbGV0IG15TmFtZSA9IFNtYXJ0Rm94U0RLLlBva2VyQ29udHJvbGxlci5ab25lSW5zdGFuY2UubXlTZWxmLm5hbWU7XG4gICAgICAgIGlmKHRoaXMuX2dldEpTUGxheWVyQnlOYW1lKG15TmFtZSkgPT0gbnVsbCl7XG4gICAgICAgICAgICBsZXQgc2l0T25SZXF1ZXN0ID0gbmV3IFBva2VyUmVxdWVzdC5TaXRPblJlcXVlc3QoKS5zZXRSb29tSWQodGhpcy5fcm9vbS5pZCkuc2V0QXV0b1NpdE9uKCkuc2V0QnV5SW4odGhpcy5idXlfaW4pO1xuICAgICAgICAgICAgU21hcnRGb3hTREsuUG9rZXJDb250cm9sbGVyLlpvbmVJbnN0YW5jZS5zZW5kKHNpdE9uUmVxdWVzdC50b1NSZXF1ZXN0KCkpO1xuICAgICAgICAgICAgdGhpcy5oaWRlRGVza0VtcHR5KCk7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIGdldENvbW11bml0eUNhcmQoKXtcbiAgICAgICAgcmV0dXJuIHRoaXMuQ29tbXVuaXR5Q2FyZC5nZXRDb21wb25lbnQodGhpcy5Db21tdW5pdHlDYXJkLm5hbWUpO1xuICAgIH0sXG4gICAgZ2V0QWN0aW9uKCl7XG4gICAgICAgIHJldHVybiB0aGlzLkFjdGlvbi5nZXRDb21wb25lbnQodGhpcy5BY3Rpb24ubmFtZSk7XG4gICAgfSxcbiAgICBzZXRNb25leVBvdChtb25leSl7XG4gICAgICAgIGlmKG1vbmV5ID4gMCl7XG4gICAgICAgICAgICB0aGlzLmxiX3RvdGFsX2JldC5zdHJpbmcgPSBVdGlscy5mb3JtYXRDdXJyZW5jeShtb25leSk7XG4gICAgICAgICAgICB0aGlzLmxiX3RvdGFsX2JldC5ub2RlLnBhcmVudC5hY3RpdmUgPSB0cnVlO1xuICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgIHRoaXMubGJfdG90YWxfYmV0Lm5vZGUucGFyZW50LmFjdGl2ZSA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgfSxcbiAgICBwcm9jZXNzQmV0Q2hpcFRvUG90KGNiKXtcbiAgICAgICAgbGV0IGJldENoaXAgPSAwO1xuICAgICAgICAvLyBzdW0gYWxsIHBvdCBvZiB1c2VyIHRvIHRvdGFsIHBvdFxuICAgICAgICBmb3IobGV0IGkgPSAwOyBpIDwgdGhpcy5jb250cm9sbGVyLm1fdGFibGVJbmZvLm1fbGlzdERlc2subGVuZ3RoO2krKyl7XG4gICAgICAgICAgICBsZXQgZGVzayA9IHRoaXMuY29udHJvbGxlci5tX3RhYmxlSW5mby5tX2xpc3REZXNrW2ldO1xuICAgICAgICAgICAgbGV0IHBsYXllciA9IHRoaXMuX2dldEpTUGxheWVyQnlJZChkZXNrLkRlc2tJZCk7XG4gICAgICAgICAgICBpZihwbGF5ZXIpe1xuICAgICAgICAgICAgICAgIGJldENoaXAgPSBwbGF5ZXIubV90b3RhbF9iZXQ7XG4gICAgICAgICAgICAgICAgdGhpcy5jb250cm9sbGVyLm1fdGFibGVJbmZvLm1fcG90Q2hpcCArPSBwbGF5ZXIubV90b3RhbF9iZXQ7XG4gICAgICAgICAgICAgICAgLy8gcmVzZXQgYmV0IG9mIHVzZXJcbiAgICAgICAgICAgICAgICBwbGF5ZXIucmVzZXRCZXQoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICB9XG4gICAgICAgIC8vIGFjdGlvbiBzdW0gYWxsIHBvdCBvZiB1c2VyIHRvIHRvdGFsIHBvdFxuICAgICAgICB0aGlzLnJ1bkFjdGlvbkNoaXBUb1BvdChiZXRDaGlwLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB0aGlzLmxiX3RvdGFsX2JldC5zdHJpbmcgPSBVdGlscy5mb3JtYXRDdXJyZW5jeSh0aGlzLmNvbnRyb2xsZXIubV90YWJsZUluZm8ubV9wb3RDaGlwKTtcbiAgICAgICAgICAgIHRoaXMubGJfdG90YWxfYmV0Lm5vZGUucGFyZW50LmFjdGl2ZSA9IHRydWU7XG4gICAgICAgICAgICBpZihjYil7XG4gICAgICAgICAgICAgICAgY2IoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICB9LFxuICAgIHJlcXVlc3RQb29sUG90KCl7XG4gICAgICAgIGZvcihsZXQgaSAgPSAwOyBpIDwgdGhpcy5Qb29sUG90Lmxlbmd0aDtpKyspe1xuICAgICAgICAgICAgaWYoIXRoaXMuUG9vbFBvdFtpXS5hY3RpdmUpe1xuICAgICAgICAgICAgICAgIHRoaXMuUG9vbFBvdFtpXS5hY3RpdmUgPSB0cnVlO1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLlBvb2xQb3RbaV07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgbGV0IHBvdCA9IGNjLmluc3RhbnRpYXRlKHRoaXMuUG90UHJlZmFiKTtcbiAgICAgICAgdGhpcy5ub2RlLmFkZENoaWxkKHBvdCk7XG4gICAgICAgIHRoaXMuUG9vbFBvdC5wdXNoKHBvdCk7XG4gICAgICAgIHJldHVybiBwb3Q7XG4gICAgfSxcbiAgICBydW5BY3Rpb25Qb3RDaGlwVG9XaW5uZXIobW9uZXlXaW4gLCB3aW5uZXIsIGNiLCB0YXJnZXQpe1xuICAgICAgICBsZXQgcGxheWVyID0gdGhpcy5fZ2V0SlNQbGF5ZXJCeU5hbWUod2lubmVyKTtcbiAgICAgICAgaWYocGxheWVyKXtcbiAgICAgICAgICAgIGxldCBwb3QgPSB0aGlzLnJlcXVlc3RQb29sUG90KCk7XG4gICAgICAgICAgICBsZXQgc2VsZiA9IHRoaXM7XG4gICAgICAgICAgICBsZXQgY29udmVydFBvc0JldCA9IHRoaXMuZ2V0UG9zaXRpb25Jbk90aGVyTm9kZShwbGF5ZXIuQmV0Q2hpcCwgdGhpcy5ub2RlKTtcbiAgICAgICAgICAgIHBvdC5wb3NpdGlvbiA9IHRoaXMubGJfdG90YWxfYmV0Lm5vZGUucGFyZW50LnBvc2l0aW9uO1xuICAgICAgICAgICAgcG90LmdldENoaWxkQnlOYW1lKFwibW9uZXlcIikuZ2V0Q29tcG9uZW50KGNjLkxhYmVsKS5zdHJpbmcgPSBVdGlscy5mb3JtYXRDdXJyZW5jeShtb25leVdpbik7XG4gICAgICAgICAgICBwb3QucnVuQWN0aW9uKGNjLnNlcXVlbmNlKGNjLm1vdmVUbygwLjUsIGNvbnZlcnRQb3NCZXQpLCBjYy5jYWxsRnVuYyhmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5hY3RpdmUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICBzZWxmLmxiX3RvdGFsX2JldC5ub2RlLnBhcmVudC5hY3RpdmUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICBpZihjYilcbiAgICAgICAgICAgICAgICAgICAgY2IobW9uZXlXaW4sIHRhcmdldCk7XG4gICAgICAgICAgICB9LCBwb3QpKSlcbiAgICAgICAgfVxuICAgIH0sXG4gICAgZXZlbnRTaG93Q2hhdChldmVudCwgZGF0YSkge1xuICAgICAgICB0aGlzLkNoYXRFbW9qaUxheWVyLmFjdGl2ZSA9ICF0aGlzLkNoYXRFbW9qaUxheWVyLmFjdGl2ZTtcbiAgICAgICAgaWYgKHRoaXMuQ2hhdEVtb2ppTGF5ZXIuYWN0aXZlKVxuICAgICAgICAgICAgdGhpcy5DaGF0RW1vamlMYXllci5nZXRDb21wb25lbnQoXCJDaGF0RW1vamlMYXllclwiKS5pbml0Q29udHJvbGxlcihTbWFydEZveFNESy5Qb2tlckNvbnRyb2xsZXIuWm9uZUluc3RhbmNlKTtcbiAgICB9LFxuICAgIG9uUHVibGljTWVzc2FnZShtZXNzRGF0YSkge1xuICAgICAgICBsZXQgcGxheWVySnMgPSB0aGlzLl9nZXRKU1BsYXllckJ5TmFtZShtZXNzRGF0YS5zZW5kZXIubmFtZSk7XG4gICAgICAgIGlmKHBsYXllckpzICE9IG51bGwpe1xuICAgICAgICAgICAgcGxheWVySnMub25QdWJsaWNNZXNzYWdlKG1lc3NEYXRhLm1zZylcbiAgICAgICAgfVxuICAgIH0sXG4gICAgdXBkYXRlVXNlclZhcmlhYmxlKHN1YkNoaXApe1xuICAgICAgICBsZXQganNQbGF5ZXIgICAgPSB0aGlzLl9nZXRKU1BsYXllckJ5TmFtZShTbWFydEZveFNESy5Qb2tlckNvbnRyb2xsZXIuWm9uZUluc3RhbmNlLm15U2VsZi5uYW1lKTtcbiAgICAgICAganNQbGF5ZXIuc2V0TW9uZXkoR2FtZVZhcmlhYmxlcy5Qb2tlci5nZXRDaGlwKFNtYXJ0Rm94U0RLLlBva2VyQ29udHJvbGxlci5ab25lSW5zdGFuY2UubXlTZWxmKS1zdWJDaGlwKVxuICAgIH0sXG59KTtcbiJdfQ==