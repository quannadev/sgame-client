
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/scripts/poker/CommunityCards.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, 'f675coqnWtL06o3ZbZgYaBD', 'CommunityCards');
// scripts/poker/CommunityCards.js

"use strict";

// Learn cc.Class:
//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html
//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html
// Learn Attribute:
//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html
//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html
// Learn life-cycle callbacks:
//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html
//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html
var PokerCard = require('PokerCard');

cc.Class({
  "extends": cc.Component,
  properties: {
    cards: {
      type: cc.Node,
      "default": []
    }
  },
  onLoad: function onLoad() {
    this.posCards = [];

    for (var i = 0; i < this.cards.length; i++) {
      this.posCards.push(this.cards[i].position);
    }

    this.reset();
  },
  dealFlop: function dealFlop(cardIds) {
    if (cardIds.length != 3) {
      console.error("Size cards Flop != 3");
    } else {
      // actions
      for (var i = 0; i < 3; i++) {
        var card = this.cards[i].getComponent("Card");
        card.init(null);
        this.cards[i].position = this.posCards[0];
        this.cards[i].active = true;
      }

      var self = this;
      this.cards[0].runAction(cc.sequence(cc.moveTo(0.2, this.posCards[0]), cc.callFunc(function () {
        var card = self.cards[0].getComponent("Card");
        card.reveal(new PokerCard.Card(cardIds[0]));
      })));
      this.cards[1].runAction(cc.sequence(cc.moveTo(0.2, this.posCards[1]), cc.callFunc(function () {
        var card = self.cards[1].getComponent("Card");
        card.reveal(new PokerCard.Card(cardIds[1]));
      })));
      this.cards[2].runAction(cc.sequence(cc.moveTo(0.2, this.posCards[2]), cc.callFunc(function () {
        var card = self.cards[2].getComponent("Card");
        card.reveal(new PokerCard.Card(cardIds[2]));
      })));
    }
  },
  dealTurn: function dealTurn(cardIds) {
    if (cardIds.length != 1) {
      console.error("Size cards Turn != 1");
    } else {
      var card = this.cards[3].getComponent("Card");
      card.reveal(new PokerCard.Card(cardIds[0]));
    }
  },
  dealRiver: function dealRiver(cardIds) {
    if (cardIds.length != 1) {
      console.error("Size cards River != 1");
    } else {
      var card = this.cards[4].getComponent("Card");
      card.reveal(new PokerCard.Card(cardIds[0]));
    }
  },
  showDown: function showDown(cardIds) {
    for (var i = 0; i < cardIds.length; i++) {
      var card = this.cards[i].getComponent("Card");

      if (this.cards[i].active) {
        card.init(new PokerCard.Card(cardIds[i]));
      } else {
        card.reveal(new PokerCard.Card(cardIds[i]));
      }
    }
  },
  showCommunityCard: function showCommunityCard(cards) {
    if (cards.length == 0) return; // case if win before the turn river

    for (var i = 0; i < this.cards.length; i++) {
      if (cards[i]) {
        var card = this.cards[i].getComponent("Card");

        if (this.cards[i].active) {
          card.init(new PokerCard.Card(cards[i]));
        } else {
          card.reveal(new PokerCard.Card(cards[i]));
        }
      }
    }
  },
  showCommunityCardWin: function showCommunityCardWin(cards) {
    for (var i = 0; i < this.cards.length; i++) {
      var card = this.cards[i].getComponent("Card");

      if (card._card != null && cards.indexOf(card._card.id) < 0) {
        card.showOver();
      }
    }
  },
  reset: function reset() {
    for (var i = 0; i < this.cards.length; i++) {
      var card = this.cards[i].getComponent("Card");
      card.hideOver();
      this.cards[i].active = false;
    }
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0cy9zY3JpcHRzL3Bva2VyL0NvbW11bml0eUNhcmRzLmpzIl0sIm5hbWVzIjpbIlBva2VyQ2FyZCIsInJlcXVpcmUiLCJjYyIsIkNsYXNzIiwiQ29tcG9uZW50IiwicHJvcGVydGllcyIsImNhcmRzIiwidHlwZSIsIk5vZGUiLCJvbkxvYWQiLCJwb3NDYXJkcyIsImkiLCJsZW5ndGgiLCJwdXNoIiwicG9zaXRpb24iLCJyZXNldCIsImRlYWxGbG9wIiwiY2FyZElkcyIsImNvbnNvbGUiLCJlcnJvciIsImNhcmQiLCJnZXRDb21wb25lbnQiLCJpbml0IiwiYWN0aXZlIiwic2VsZiIsInJ1bkFjdGlvbiIsInNlcXVlbmNlIiwibW92ZVRvIiwiY2FsbEZ1bmMiLCJyZXZlYWwiLCJDYXJkIiwiZGVhbFR1cm4iLCJkZWFsUml2ZXIiLCJzaG93RG93biIsInNob3dDb21tdW5pdHlDYXJkIiwic2hvd0NvbW11bml0eUNhcmRXaW4iLCJfY2FyZCIsImluZGV4T2YiLCJpZCIsInNob3dPdmVyIiwiaGlkZU92ZXIiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSUEsU0FBUyxHQUFHQyxPQUFPLENBQUMsV0FBRCxDQUF2Qjs7QUFDQUMsRUFBRSxDQUFDQyxLQUFILENBQVM7QUFDTCxhQUFTRCxFQUFFLENBQUNFLFNBRFA7QUFHTEMsRUFBQUEsVUFBVSxFQUFFO0FBQ1JDLElBQUFBLEtBQUssRUFBRTtBQUNIQyxNQUFBQSxJQUFJLEVBQUVMLEVBQUUsQ0FBQ00sSUFETjtBQUVILGlCQUFTO0FBRk47QUFEQyxHQUhQO0FBU0xDLEVBQUFBLE1BVEssb0JBU0c7QUFDSixTQUFLQyxRQUFMLEdBQWlCLEVBQWpCOztBQUNBLFNBQUksSUFBSUMsQ0FBQyxHQUFHLENBQVosRUFBZUEsQ0FBQyxHQUFHLEtBQUtMLEtBQUwsQ0FBV00sTUFBOUIsRUFBcUNELENBQUMsRUFB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Q0FBQ2dCLEtBQUwsSUFBYyxJQUFkLElBQXNCOUIsS0FBSyxDQUFDK0IsT0FBTixDQUFjakIsSUFBSSxDQUFDZ0IsS0FBTCxDQUFXRSxFQUF6QixJQUErQixDQUF4RCxFQUEwRDtBQUN0RGxCLFFBQUFBLElBQUksQ0FBQ21CLFFBQUw7QUFDSDtBQUNKO0FBQ0osR0E5Rkk7QUErRkx4QixFQUFBQSxLQS9GSyxtQkErRkU7QUFDSCxTQUFJLElBQUlKLENBQUMsR0FBRyxDQUFaLEVBQWVBLENBQUMsR0FBRyxLQUFLTCxLQUFMLENBQVdNLE1BQTlCLEVBQXFDRCxDQUFDLEVBQXRDLEVBQXlDO0FBQ3JDLFVBQUlTLElBQUksR0FBRyxLQUFLZCxLQUFMLENBQVdLLENBQVgsRUFBY1UsWUFBZCxDQUEyQixNQUEzQixDQUFYO0FBQ0FELE1BQUFBLElBQUksQ0FBQ29CLFFBQUw7QUFDQSxXQUFLbEMsS0FBTCxDQUFXSyxDQUFYLEVBQWNZLE1BQWQsR0FBdUIsS0FBdkI7QUFDSDtBQUNKO0FBckdJLENBQVQiLCJzb3VyY2VSb290IjoiLyIsInNvdXJjZXNDb250ZW50IjpbIi8vIExlYXJuIGNjLkNsYXNzOlxuLy8gIC0gW0NoaW5lc2VdIGh0dHBzOi8vZG9jcy5jb2Nvcy5jb20vY3JlYXRvci9tYW51YWwvemgvc2NyaXB0aW5nL2NsYXNzLmh0bWxcbi8vICAtIFtFbmdsaXNoXSBodHRwOi8vZG9jcy5jb2NvczJkLXgub3JnL2NyZWF0b3IvbWFudWFsL2VuL3NjcmlwdGluZy9jbGFzcy5odG1sXG4vLyBMZWFybiBBdHRyaWJ1dGU6XG4vLyAgLSBbQ2hpbmVzZV0gaHR0cHM6Ly9kb2NzLmNvY29zLmNvbS9jcmVhdG9yL21hbnVhbC96aC9zY3JpcHRpbmcvcmVmZXJlbmNlL2F0dHJpYnV0ZXMuaHRtbFxuLy8gIC0gW0VuZ2xpc2hdIGh0dHA6Ly9kb2NzLmNvY29zMmQteC5vcmcvY3JlYXRvci9tYW51YWwvZW4vc2NyaXB0aW5nL3JlZmVyZW5jZS9hdHRyaWJ1dGVzLmh0bWxcbi8vIExlYXJuIGxpZmUtY3ljbGUgY2FsbGJhY2tzOlxuLy8gIC0gW0NoaW5lc2VdIGh0dHBzOi8vZG9jcy5jb2Nvcy5jb20vY3JlYXRvci9tYW51YWwvemgvc2NyaXB0aW5nL2xpZmUtY3ljbGUtY2FsbGJhY2tzLmh0bWxcbi8vICAtIFtFbmdsaXNoXSBodHRwczovL3d3dy5jb2NvczJkLXgub3JnL2RvY3MvY3JlYXRvci9tYW51YWwvZW4vc2NyaXB0aW5nL2xpZmUtY3ljbGUtY2FsbGJhY2tzLmh0bWxcbmxldCBQb2tlckNhcmQgPSByZXF1aXJlKCdQb2tlckNhcmQnKTtcbmNjLkNsYXNzKHtcbiAgICBleHRlbmRzOiBjYy5Db21wb25lbnQsXG5cbiAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgIGNhcmRzOiB7XG4gICAgICAgICAgICB0eXBlOiBjYy5Ob2RlLFxuICAgICAgICAgICAgZGVmYXVsdDogW11cbiAgICAgICAgfVxuICAgIH0sXG4gICAgb25Mb2FkKCl7XG4gICAgICAgIHRoaXMucG9zQ2FyZHMgID0gW107XG4gICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCB0aGlzLmNhcmRzLmxlbmd0aDtpKyspe1xuICAgICAgICAgICAgdGhpcy5wb3NDYXJkcy5wdXNoKHRoaXMuY2FyZHNbaV0ucG9zaXRpb24pO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMucmVzZXQoKTtcbiAgICB9LFxuICAgIGRlYWxGbG9wKGNhcmRJZHMpe1xuICAgICAgICBpZihjYXJkSWRzLmxlbmd0aCAhPSAzKXtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJTaXplIGNhcmRzIEZsb3AgIT0gM1wiKTtcbiAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAvLyBhY3Rpb25zXG4gICAgICAgICAgICBmb3IobGV0IGkgPSAwOyBpIDwgMztpKyspe1xuICAgICAgICAgICAgICAgIGxldCBjYXJkID0gdGhpcy5jYXJkc1tpXS5nZXRDb21wb25lbnQoXCJDYXJkXCIpO1xuICAgICAgICAgICAgICAgIGNhcmQuaW5pdChudWxsKTtcbiAgICAgICAgICAgICAgICB0aGlzLmNhcmRzW2ldLnBvc2l0aW9uID0gdGhpcy5wb3NDYXJkc1swXTtcbiAgICAgICAgICAgICAgICB0aGlzLmNhcmRzW2ldLmFjdGl2ZSA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsZXQgc2VsZiA9IHRoaXM7XG5cbiAgICAgICAgICAgIHRoaXMuY2FyZHNbMF0ucnVuQWN0aW9uKGNjLnNlcXVlbmNlKGNjLm1vdmVUbygwLjIsdGhpcy5wb3NDYXJkc1swXSksIGNjLmNhbGxGdW5jKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBsZXQgY2FyZCA9IHNlbGYuY2FyZHNbMF0uZ2V0Q29tcG9uZW50KFwiQ2FyZFwiKTtcbiAgICAgICAgICAgICAgICBjYXJkLnJldmVhbChuZXcgUG9rZXJDYXJkLkNhcmQoY2FyZElkc1swXSkpO1xuICAgICAgICAgICAgfSkpKTtcbiAgICAgICAgICAgIHRoaXMuY2FyZHNbMV0ucnVuQWN0aW9uKGNjLnNlcXVlbmNlKGNjLm1vdmVUbygwLjIsdGhpcy5wb3NDYXJkc1sxXSksIGNjLmNhbGxGdW5jKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBsZXQgY2FyZCA9IHNlbGYuY2FyZHNbMV0uZ2V0Q29tcG9uZW50KFwiQ2FyZFwiKTtcbiAgICAgICAgICAgICAgICBjYXJkLnJldmVhbChuZXcgUG9rZXJDYXJkLkNhcmQoY2FyZElkc1sxXSkpO1xuICAgICAgICAgICAgfSkpKTtcblxuICAgICAgICAgICAgdGhpcy5jYXJkc1syXS5ydW5BY3Rpb24oY2Muc2VxdWVuY2UoY2MubW92ZVRvKDAuMix0aGlzLnBvc0NhcmRzWzJdKSwgY2MuY2FsbEZ1bmMoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGxldCBjYXJkID0gc2VsZi5jYXJkc1syXS5nZXRDb21wb25lbnQoXCJDYXJkXCIpO1xuICAgICAgICAgICAgICAgIGNhcmQucmV2ZWFsKG5ldyBQb2tlckNhcmQuQ2FyZChjYXJkSWRzWzJdKSk7XG4gICAgICAgICAgICB9KSkpO1xuICAgICAgICB9XG4gICAgfSxcbiAgICBkZWFsVHVybihjYXJkSWRzKXtcbiAgICAgICAgaWYoY2FyZElkcy5sZW5ndGggIT0gMSl7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKFwiU2l6ZSBjYXJkcyBUdXJuICE9IDFcIik7XG4gICAgICAgIH1lbHNle1xuICAgICAgICAgICAgbGV0IGNhcmQgPSB0aGlzLmNhcmRzWzNdLmdldENvbXBvbmVudChcIkNhcmRcIik7XG4gICAgICAgICAgICBjYXJkLnJldmVhbChuZXcgUG9rZXJDYXJkLkNhcmQoY2FyZElkc1swXSkpO1xuICAgICAgICB9XG4gICAgfSxcbiAgICBkZWFsUml2ZXIoY2FyZElkcyl7XG4gICAgICAgIGlmKGNhcmRJZHMubGVuZ3RoICE9IDEpe1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIlNpemUgY2FyZHMgUml2ZXIgIT0gMVwiKTtcbiAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICBsZXQgY2FyZCA9IHRoaXMuY2FyZHNbNF0uZ2V0Q29tcG9uZW50KFwiQ2FyZFwiKTtcbiAgICAgICAgICAgIGNhcmQucmV2ZWFsKG5ldyBQb2tlckNhcmQuQ2FyZChjYXJkSWRzWzBdKSk7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIHNob3dEb3duKGNhcmRJZHMpe1xuICAgICAgICBmb3IobGV0IGkgPSAwOyBpIDwgY2FyZElkcy5sZW5ndGggO2krKyl7XG4gICAgICAgICAgICBsZXQgY2FyZCA9IHRoaXMuY2FyZHNbaV0uZ2V0Q29tcG9uZW50KFwiQ2FyZFwiKTtcbiAgICAgICAgICAgIGlmKHRoaXMuY2FyZHNbaV0uYWN0aXZlKXtcbiAgICAgICAgICAgICAgICBjYXJkLmluaXQobmV3IFBva2VyQ2FyZC5DYXJkKGNhcmRJZHNbaV0pKTtcbiAgICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgICAgIGNhcmQucmV2ZWFsKG5ldyBQb2tlckNhcmQuQ2FyZChjYXJkSWRzW2ldKSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfVxuICAgIH0sXG4gICAgc2hvd0NvbW11bml0eUNhcmQoY2FyZHMpe1xuICAgICAgICBpZihjYXJkcy5sZW5ndGggPT0gMClcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgLy8gY2FzZSBpZiB3aW4gYmVmb3JlIHRoZSB0dXJuIHJpdmVyXG4gICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCB0aGlzLmNhcmRzLmxlbmd0aDtpKyspe1xuICAgICAgICAgICAgaWYoY2FyZHNbaV0pe1xuICAgICAgICAgICAgICAgIGxldCBjYXJkID0gdGhpcy5jYXJkc1tpXS5nZXRDb21wb25lbnQoXCJDYXJkXCIpO1xuICAgICAgICAgICAgICAgIGlmKHRoaXMuY2FyZHNbaV0uYWN0aXZlKXtcbiAgICAgICAgICAgICAgICAgICAgY2FyZC5pbml0KG5ldyBQb2tlckNhcmQuQ2FyZChjYXJkc1tpXSkpO1xuICAgICAgICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgICAgICAgICBjYXJkLnJldmVhbChuZXcgUG9rZXJDYXJkLkNhcmQoY2FyZHNbaV0pKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgIH0sXG4gICAgc2hvd0NvbW11bml0eUNhcmRXaW4oY2FyZHMpe1xuICAgICAgICBmb3IobGV0IGkgPSAwOyBpIDwgdGhpcy5jYXJkcy5sZW5ndGg7aSsrKXtcbiAgICAgICAgICAgIGxldCBjYXJkID0gdGhpcy5jYXJkc1tpXS5nZXRDb21wb25lbnQoXCJDYXJkXCIpO1xuICAgICAgICAgICAgaWYoY2FyZC5fY2FyZCAhPSBudWxsICYmIGNhcmRzLmluZGV4T2YoY2FyZC5fY2FyZC5pZCkgPCAwKXtcbiAgICAgICAgICAgICAgICBjYXJkLnNob3dPdmVyKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9LFxuICAgIHJlc2V0KCl7XG4gICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCB0aGlzLmNhcmRzLmxlbmd0aDtpKyspe1xuICAgICAgICAgICAgbGV0IGNhcmQgPSB0aGlzLmNhcmRzW2ldLmdldENvbXBvbmVudChcIkNhcmRcIik7XG4gICAgICAgICAgICBjYXJkLmhpZGVPdmVyKCk7XG4gICAgICAgICAgICB0aGlzLmNhcmRzW2ldLmFjdGl2ZSA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgfVxufSk7XG4iXX0=