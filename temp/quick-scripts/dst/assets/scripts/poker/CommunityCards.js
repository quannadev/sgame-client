
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/scripts/poker/CommunityCards.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, 'f675coqnWtL06o3ZbZgYaBD', 'CommunityCards');
// scripts/poker/CommunityCards.js

"use strict";

// Learn cc.Class:
//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html
//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html
// Learn Attribute:
//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html
//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html
// Learn life-cycle callbacks:
//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html
//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html
var PokerCard = require('PokerCard');

cc.Class({
  "extends": cc.Component,
  properties: {
    cards: {
      type: cc.Node,
      "default": []
    }
  },
  onLoad: function onLoad() {
    this.posCards = [];

    for (var i = 0; i < this.cards.length; i++) {
      this.posCards.push(this.cards[i].position);
    }

    this.reset();
  },
  dealFlop: function dealFlop(cardIds) {
    if (cardIds.length != 3) {
      console.error("Size cards Flop != 3");
    } else {
      // actions
      for (var i = 0; i < 3; i++) {
        var card = this.cards[i].getComponent("Card");
        card.init(null);
        this.cards[i].position = this.posCards[0];
        this.cards[i].active = true;
      }

      var self = this;
      this.cards[0].runAction(cc.sequence(cc.moveTo(0.2, this.posCards[0]), cc.callFunc(function () {
        var card = self.cards[0].getComponent("Card");
        card.reveal(new PokerCard.Card(cardIds[0]));
      })));
      this.cards[1].runAction(cc.sequence(cc.moveTo(0.2, this.posCards[1]), cc.callFunc(function () {
        var card = self.cards[1].getComponent("Card");
        card.reveal(new PokerCard.Card(cardIds[1]));
      })));
      this.cards[2].runAction(cc.sequence(cc.moveTo(0.2, this.posCards[2]), cc.callFunc(function () {
        var card = self.cards[2].getComponent("Card");
        card.reveal(new PokerCard.Card(cardIds[2]));
      })));
    }
  },
  dealTurn: function dealTurn(cardIds) {
    if (cardIds.length != 1) {
      console.error("Size cards Turn != 1");
    } else {
      var card = this.cards[3].getComponent("Card");
      card.reveal(new PokerCard.Card(cardIds[0]));
    }
  },
  dealRiver: function dealRiver(cardIds) {
    if (cardIds.length != 1) {
      console.error("Size cards River != 1");
    } else {
      var card = this.cards[4].getComponent("Card");
      card.reveal(new PokerCard.Card(cardIds[0]));
    }
  },
  showDown: function showDown(cardIds) {
    for (var i = 0; i < cardIds.length; i++) {
      var card = this.cards[i].getComponent("Card");

      if (this.cards[i].active) {
        card.init(new PokerCard.Card(cardIds[i]));
      } else {
        card.reveal(new PokerCard.Card(cardIds[i]));
      }
    }
  },
  showCommunityCard: function showCommunityCard(cards) {
    if (cards.length == 0) return; // case if win before the turn river

    for (var i = 0; i < this.cards.length; i++) {
      if (cards[i]) {
        var card = this.cards[i].getComponent("Card");

        if (this.cards[i].active) {
          card.init(new PokerCard.Card(cards[i]));
        } else {
          card.reveal(new PokerCard.Card(cards[i]));
        }
      }
    }
  },
  showCommunityCardWin: function showCommunityCardWin(cards) {
    for (var i = 0; i < this.cards.length; i++) {
      var card = this.cards[i].getComponent("Card");

      if (card._card != null && cards.indexOf(card._card.id) < 0) {
        card.showOver();
      }
    }
  },
  reset: function reset() {
    for (var i = 0; i < this.cards.length; i++) {
      var card = this.cards[i].getComponent("Card");
      card.hideOver();
      this.cards[i].active = false;
    }
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcc2NyaXB0c1xccG9rZXJcXENvbW11bml0eUNhcmRzLmpzIl0sIm5hbWVzIjpbIlBva2VyQ2FyZCIsInJlcXVpcmUiLCJjYyIsIkNsYXNzIiwiQ29tcG9uZW50IiwicHJvcGVydGllcyIsImNhcmRzIiwidHlwZSIsIk5vZGUiLCJvbkxvYWQiLCJwb3NDYXJkcyIsImkiLCJsZW5ndGgiLCJwdXNoIiwicG9zaXRpb24iLCJyZXNldCIsImRlYWxGbG9wIiwiY2FyZElkcyIsImNvbnNvbGUiLCJlcnJvciIsImNhcmQiLCJnZXRDb21wb25lbnQiLCJpbml0IiwiYWN0aXZlIiwic2VsZiIsInJ1bkFjdGlvbiIsInNlcXVlbmNlIiwibW92ZVRvIiwiY2FsbEZ1bmMiLCJyZXZlYWwiLCJDYXJkIiwiZGVhbFR1cm4iLCJkZWFsUml2ZXIiLCJzaG93RG93biIsInNob3dDb21tdW5pdHlDYXJkIiwic2hvd0NvbW11bml0eUNhcmRXaW4iLCJfY2FyZCIsImluZGV4T2YiLCJpZCIsInNob3dPdmVyIiwiaGlkZU92ZXIiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSUEsU0FBUyxHQUFHQyxPQUFPLENBQUMsV0FBRCxDQUF2Qjs7QUFDQUMsRUFBRSxDQUFDQyxLQUFILENBQVM7QUFDTCxhQUFTRCxFQUFFLENBQUNFLFNBRFA7QUFHTEMsRUFBQUEsVUFBVSxFQUFFO0FBQ1JDLElBQUFBLEtBQUssRUFBRTtBQUNIQyxNQUFBQSxJQUFJLEVBQUVMLEVBQUUsQ0FBQ00sSUFETjtBQUVILGlCQUFTO0FBRk47QUFEQyxHQUhQO0FBU0xDLEVBQUFBLE1BVEssb0JBU0c7QUFDSixTQUFLQyxRQUFMLEdBQWlCLEVBQWpCOztBQUNBLFNBQUksSUFBSUMsQ0FBQyxHQUFHLENBQVosRUFBZUEsQ0FBQyxHQUFHLEtBQUtMLEtBQUwsQ0FBV00sTUFBOUIsRUFBcUNELENBQUMs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QUksQ0FBQ2dCLEtBQUwsSUFBYyxJQUFkLElBQXNCOUIsS0FBSyxDQUFDK0IsT0FBTixDQUFjakIsSUFBSSxDQUFDZ0IsS0FBTCxDQUFXRSxFQUF6QixJQUErQixDQUF4RCxFQUEwRDtBQUN0RGxCLFFBQUFBLElBQUksQ0FBQ21CLFFBQUw7QUFDSDtBQUNKO0FBQ0osR0E5Rkk7QUErRkx4QixFQUFBQSxLQS9GSyxtQkErRkU7QUFDSCxTQUFJLElBQUlKLENBQUMsR0FBRyxDQUFaLEVBQWVBLENBQUMsR0FBRyxLQUFLTCxLQUFMLENBQVdNLE1BQTlCLEVBQXFDRCxDQUFDLEVBQXRDLEVBQXlDO0FBQ3JDLFVBQUlTLElBQUksR0FBRyxLQUFLZCxLQUFMLENBQVdLLENBQVgsRUFBY1UsWUFBZCxDQUEyQixNQUEzQixDQUFYO0FBQ0FELE1BQUFBLElBQUksQ0FBQ29CLFFBQUw7QUFDQSxXQUFLbEMsS0FBTCxDQUFXSyxDQUFYLEVBQWNZLE1BQWQsR0FBdUIsS0FBdkI7QUFDSDtBQUNKO0FBckdJLENBQVQiLCJzb3VyY2VSb290IjoiLyIsInNvdXJjZXNDb250ZW50IjpbIi8vIExlYXJuIGNjLkNsYXNzOlxyXG4vLyAgLSBbQ2hpbmVzZV0gaHR0cHM6Ly9kb2NzLmNvY29zLmNvbS9jcmVhdG9yL21hbnVhbC96aC9zY3JpcHRpbmcvY2xhc3MuaHRtbFxyXG4vLyAgLSBbRW5nbGlzaF0gaHR0cDovL2RvY3MuY29jb3MyZC14Lm9yZy9jcmVhdG9yL21hbnVhbC9lbi9zY3JpcHRpbmcvY2xhc3MuaHRtbFxyXG4vLyBMZWFybiBBdHRyaWJ1dGU6XHJcbi8vICAtIFtDaGluZXNlXSBodHRwczovL2RvY3MuY29jb3MuY29tL2NyZWF0b3IvbWFudWFsL3poL3NjcmlwdGluZy9yZWZlcmVuY2UvYXR0cmlidXRlcy5odG1sXHJcbi8vICAtIFtFbmdsaXNoXSBodHRwOi8vZG9jcy5jb2NvczJkLXgub3JnL2NyZWF0b3IvbWFudWFsL2VuL3NjcmlwdGluZy9yZWZlcmVuY2UvYXR0cmlidXRlcy5odG1sXHJcbi8vIExlYXJuIGxpZmUtY3ljbGUgY2FsbGJhY2tzOlxyXG4vLyAgLSBbQ2hpbmVzZV0gaHR0cHM6Ly9kb2NzLmNvY29zLmNvbS9jcmVhdG9yL21hbnVhbC96aC9zY3JpcHRpbmcvbGlmZS1jeWNsZS1jYWxsYmFja3MuaHRtbFxyXG4vLyAgLSBbRW5nbGlzaF0gaHR0cHM6Ly93d3cuY29jb3MyZC14Lm9yZy9kb2NzL2NyZWF0b3IvbWFudWFsL2VuL3NjcmlwdGluZy9saWZlLWN5Y2xlLWNhbGxiYWNrcy5odG1sXHJcbmxldCBQb2tlckNhcmQgPSByZXF1aXJlKCdQb2tlckNhcmQnKTtcclxuY2MuQ2xhc3Moe1xyXG4gICAgZXh0ZW5kczogY2MuQ29tcG9uZW50LFxyXG5cclxuICAgIHByb3BlcnRpZXM6IHtcclxuICAgICAgICBjYXJkczoge1xyXG4gICAgICAgICAgICB0eXBlOiBjYy5Ob2RlLFxyXG4gICAgICAgICAgICBkZWZhdWx0OiBbXVxyXG4gICAgICAgIH1cclxuICAgIH0sXHJcbiAgICBvbkxvYWQoKXtcclxuICAgICAgICB0aGlzLnBvc0NhcmRzICA9IFtdO1xyXG4gICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCB0aGlzLmNhcmRzLmxlbmd0aDtpKyspe1xyXG4gICAgICAgICAgICB0aGlzLnBvc0NhcmRzLnB1c2godGhpcy5jYXJkc1tpXS5wb3NpdGlvbik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMucmVzZXQoKTtcclxuICAgIH0sXHJcbiAgICBkZWFsRmxvcChjYXJkSWRzKXtcclxuICAgICAgICBpZihjYXJkSWRzLmxlbmd0aCAhPSAzKXtcclxuICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIlNpemUgY2FyZHMgRmxvcCAhPSAzXCIpO1xyXG4gICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAvLyBhY3Rpb25zXHJcbiAgICAgICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCAzO2krKyl7XHJcbiAgICAgICAgICAgICAgICBsZXQgY2FyZCA9IHRoaXMuY2FyZHNbaV0uZ2V0Q29tcG9uZW50KFwiQ2FyZFwiKTtcclxuICAgICAgICAgICAgICAgIGNhcmQuaW5pdChudWxsKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuY2FyZHNbaV0ucG9zaXRpb24gPSB0aGlzLnBvc0NhcmRzWzBdO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jYXJkc1tpXS5hY3RpdmUgPSB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGxldCBzZWxmID0gdGhpcztcclxuXHJcbiAgICAgICAgICAgIHRoaXMuY2FyZHNbMF0ucnVuQWN0aW9uKGNjLnNlcXVlbmNlKGNjLm1vdmVUbygwLjIsdGhpcy5wb3NDYXJkc1swXSksIGNjLmNhbGxGdW5jKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIGxldCBjYXJkID0gc2VsZi5jYXJkc1swXS5nZXRDb21wb25lbnQoXCJDYXJkXCIpO1xyXG4gICAgICAgICAgICAgICAgY2FyZC5yZXZlYWwobmV3IFBva2VyQ2FyZC5DYXJkKGNhcmRJZHNbMF0pKTtcclxuICAgICAgICAgICAgfSkpKTtcclxuICAgICAgICAgICAgdGhpcy5jYXJkc1sxXS5ydW5BY3Rpb24oY2Muc2VxdWVuY2UoY2MubW92ZVRvKDAuMix0aGlzLnBvc0NhcmRzWzFdKSwgY2MuY2FsbEZ1bmMoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgbGV0IGNhcmQgPSBzZWxmLmNhcmRzWzFdLmdldENvbXBvbmVudChcIkNhcmRcIik7XHJcbiAgICAgICAgICAgICAgICBjYXJkLnJldmVhbChuZXcgUG9rZXJDYXJkLkNhcmQoY2FyZElkc1sxXSkpO1xyXG4gICAgICAgICAgICB9KSkpO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5jYXJkc1syXS5ydW5BY3Rpb24oY2Muc2VxdWVuY2UoY2MubW92ZVRvKDAuMix0aGlzLnBvc0NhcmRzWzJdKSwgY2MuY2FsbEZ1bmMoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgbGV0IGNhcmQgPSBzZWxmLmNhcmRzWzJdLmdldENvbXBvbmVudChcIkNhcmRcIik7XHJcbiAgICAgICAgICAgICAgICBjYXJkLnJldmVhbChuZXcgUG9rZXJDYXJkLkNhcmQoY2FyZElkc1syXSkpO1xyXG4gICAgICAgICAgICB9KSkpO1xyXG4gICAgICAgIH1cclxuICAgIH0sXHJcbiAgICBkZWFsVHVybihjYXJkSWRzKXtcclxuICAgICAgICBpZihjYXJkSWRzLmxlbmd0aCAhPSAxKXtcclxuICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIlNpemUgY2FyZHMgVHVybiAhPSAxXCIpO1xyXG4gICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICBsZXQgY2FyZCA9IHRoaXMuY2FyZHNbM10uZ2V0Q29tcG9uZW50KFwiQ2FyZFwiKTtcclxuICAgICAgICAgICAgY2FyZC5yZXZlYWwobmV3IFBva2VyQ2FyZC5DYXJkKGNhcmRJZHNbMF0pKTtcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG4gICAgZGVhbFJpdmVyKGNhcmRJZHMpe1xyXG4gICAgICAgIGlmKGNhcmRJZHMubGVuZ3RoICE9IDEpe1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKFwiU2l6ZSBjYXJkcyBSaXZlciAhPSAxXCIpO1xyXG4gICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICBsZXQgY2FyZCA9IHRoaXMuY2FyZHNbNF0uZ2V0Q29tcG9uZW50KFwiQ2FyZFwiKTtcclxuICAgICAgICAgICAgY2FyZC5yZXZlYWwobmV3IFBva2VyQ2FyZC5DYXJkKGNhcmRJZHNbMF0pKTtcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG4gICAgc2hvd0Rvd24oY2FyZElkcyl7XHJcbiAgICAgICAgZm9yKGxldCBpID0gMDsgaSA8IGNhcmRJZHMubGVuZ3RoIDtpKyspe1xyXG4gICAgICAgICAgICBsZXQgY2FyZCA9IHRoaXMuY2FyZHNbaV0uZ2V0Q29tcG9uZW50KFwiQ2FyZFwiKTtcclxuICAgICAgICAgICAgaWYodGhpcy5jYXJkc1tpXS5hY3RpdmUpe1xyXG4gICAgICAgICAgICAgICAgY2FyZC5pbml0KG5ldyBQb2tlckNhcmQuQ2FyZChjYXJkSWRzW2ldKSk7XHJcbiAgICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAgICAgY2FyZC5yZXZlYWwobmV3IFBva2VyQ2FyZC5DYXJkKGNhcmRJZHNbaV0pKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICB9XHJcbiAgICB9LFxyXG4gICAgc2hvd0NvbW11bml0eUNhcmQoY2FyZHMpe1xyXG4gICAgICAgIGlmKGNhcmRzLmxlbmd0aCA9PSAwKVxyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgLy8gY2FzZSBpZiB3aW4gYmVmb3JlIHRoZSB0dXJuIHJpdmVyXHJcbiAgICAgICAgZm9yKGxldCBpID0gMDsgaSA8IHRoaXMuY2FyZHMubGVuZ3RoO2krKyl7XHJcbiAgICAgICAgICAgIGlmKGNhcmRzW2ldKXtcclxuICAgICAgICAgICAgICAgIGxldCBjYXJkID0gdGhpcy5jYXJkc1tpXS5nZXRDb21wb25lbnQoXCJDYXJkXCIpO1xyXG4gICAgICAgICAgICAgICAgaWYodGhpcy5jYXJkc1tpXS5hY3RpdmUpe1xyXG4gICAgICAgICAgICAgICAgICAgIGNhcmQuaW5pdChuZXcgUG9rZXJDYXJkLkNhcmQoY2FyZHNbaV0pKTtcclxuICAgICAgICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAgICAgICAgIGNhcmQucmV2ZWFsKG5ldyBQb2tlckNhcmQuQ2FyZChjYXJkc1tpXSkpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgIH0sXHJcbiAgICBzaG93Q29tbXVuaXR5Q2FyZFdpbihjYXJkcyl7XHJcbiAgICAgICAgZm9yKGxldCBpID0gMDsgaSA8IHRoaXMuY2FyZHMubGVuZ3RoO2krKyl7XHJcbiAgICAgICAgICAgIGxldCBjYXJkID0gdGhpcy5jYXJkc1tpXS5nZXRDb21wb25lbnQoXCJDYXJkXCIpO1xyXG4gICAgICAgICAgICBpZihjYXJkLl9jYXJkICE9IG51bGwgJiYgY2FyZHMuaW5kZXhPZihjYXJkLl9jYXJkLmlkKSA8IDApe1xyXG4gICAgICAgICAgICAgICAgY2FyZC5zaG93T3ZlcigpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxuICAgIHJlc2V0KCl7XHJcbiAgICAgICAgZm9yKGxldCBpID0gMDsgaSA8IHRoaXMuY2FyZHMubGVuZ3RoO2krKyl7XHJcbiAgICAgICAgICAgIGxldCBjYXJkID0gdGhpcy5jYXJkc1tpXS5nZXRDb21wb25lbnQoXCJDYXJkXCIpO1xyXG4gICAgICAgICAgICBjYXJkLmhpZGVPdmVyKCk7XHJcbiAgICAgICAgICAgIHRoaXMuY2FyZHNbaV0uYWN0aXZlID0gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59KTtcclxuIl19