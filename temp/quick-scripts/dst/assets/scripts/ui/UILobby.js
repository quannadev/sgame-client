
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/scripts/ui/UILobby.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '35ba6fjfRFGgJuQ+BHrqfGw', 'UILobby');
// scripts/ui/UILobby.js

"use strict";

var Listview = require('Listview');

cc.Class({
  "extends": cc.VozBaseComponent,
  properties: {
    roomList: Listview,
    roomContent: [],
    lb_name: cc.Label,
    lb_chip: cc.Label,
    _currentGroup: null,
    Avatar: cc.Sprite,
    titleGame: cc.Label,
    UIPokerRank: cc.Node
  },
  onLoad: function onLoad() {
    // update avatar image
    Utils.loadRes(this.Avatar, "images/avatar/" + Config.getDefaultAvatar());
  },
  onEnable: function onEnable() {
    this.updateUserVariable(null);

    if (mm.game && mm.game[this._data.game]) {
      this.roomContent = mm.game[this._data.game].groups;
      this.roomList.numItems = this.roomContent.length;
    }

    if (this._data.game == "poker") {
      this.titleGame.string = "Poker";
    } else if (this._data.game == "tlmn") {
      this.titleGame.string = "TLMN";
    } else if (this._data.game == "bacay") {
      this.titleGame.string = "Ba Cây";
    } else if (this._data.game == "maubinh") {
      this.titleGame.string = "Mậu binh";
    } else {
      this.titleGame.string = "Casino";
    }

    mm.Loading.hide();
  },
  updateRank: function updateRank(arr) {
    if (this.UIPokerRank) this.UIPokerRank.getComponent(this.UIPokerRank.name).updateRank(arr);
  },
  updateUserVariable: function updateUserVariable(subChip) {
    if (PortalManager.getGameController(this._data.game)) {
      this.lb_name.string = Utils.formatText(GameVariables.Poker.getDisplayName(SmartFoxSDK.PortalController.ZoneInstance.mySelf), 20);
      this.lb_chip.string = Utils.addDotToNumber(GameVariables.Poker.getChip(SmartFoxSDK.PortalController.ZoneInstance.mySelf) - subChip);
    }
  },
  back: function back() {
    mm.audio.playButton();
    UIManger.show("UIHome");
  },
  onRenderLobby: function onRenderLobby(item, idx) {
    var jsItem = item.getComponent(item.name);
    jsItem.init(this.roomContent[idx]);
  },
  onSelectRoom: function onSelectRoom(item, idx) {
    mm.audio.playButton();
    var self = this;
    var groupId = this.roomContent[idx].group_id;
    var minChip = this.roomContent[idx].group_vars.bet_chip * 100;

    if (GameVariables.Poker.getChip(SmartFoxSDK.PortalController.ZoneInstance.mySelf) < minChip) {
      mm.Toast.showToast(1, "Bạn cần tối thiểu " + Utils.addDotToNumber(minChip) + 'đ');
      return;
    }

    if (groupId.includes("poker")) {
      var bet = this.roomContent[idx].group_vars.bet_chip;
      var min = this.roomContent[idx].group_vars.min_chip;
      var max = this.roomContent[idx].group_vars.max_chip;
      var remainChip = GameVariables.Poker.getChip(PortalManager.getGameController(this._data.game).ZoneInstance.mySelf);
      var currentChip = min;
      var distance = bet;

      if (GameVariables.Poker.getChip(PortalManager.getGameController(this._data.game).ZoneInstance.mySelf) < min) {
        mm.Toast.showToast(1, "Bạn cần tối thiểu " + Utils.addDotToNumber(min) + ' Chip ');
        return;
      }

      this.show("UIDialogBuyIn", {
        data: {
          distance: distance,
          remainChip: remainChip,
          currentChip: currentChip,
          min: min,
          max: max,
          cbYes: function cbYes(err) {
            if (err) {
              mm.Toast.showToast(0.5, err);
              return;
            }

            mm.Loading.show();
            SmartFoxSDK.PokerController.QuickJoinRoomConfig.buy_in = this.getBuyIn();
            SmartFoxSDK.PokerController.QuickJoinRoomConfig.number_desk = this._sizeDesk;
            var quickRequest = new CasinoRequest.QuickJoinGameRequest();
            quickRequest.setGame(self._data.game);
            quickRequest.setSizeDesk(this._sizeDesk);
            quickRequest.setGroup(groupId);
            SmartFoxSDK.PokerController.ZoneInstance.send(quickRequest.toSRequest());
            this.back();
          }
        },
        pop: true
      });
    } else {
      mm.Loading.show();
      var sizeDesk = 4;
      if (this._data.game == "bacay") sizeDesk = 6;
      var quickRequest = new CasinoRequest.QuickJoinGameRequest();
      quickRequest.setGroup(groupId);
      quickRequest.setSizeDesk(sizeDesk);
      PortalManager.getGameController(this._data.game).ZoneInstance.send(quickRequest.toSRequest());
    }
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0cy9zY3JpcHRzL3VpL1VJTG9iYnkuanMiXSwibmFtZXMiOlsiTGlzdHZpZXciLCJyZXF1aXJlIiwiY2MiLCJDbGFzcyIsIlZvekJhc2VDb21wb25lbnQiLCJwcm9wZXJ0aWVzIiwicm9vbUxpc3QiLCJyb29tQ29udGVudCIsImxiX25hbWUiLCJMYWJlbCIsImxiX2NoaXAiLCJfY3VycmVudEdyb3VwIiwiQXZhdGFyIiwiU3ByaXRlIiwidGl0bGVHYW1lIiwiVUlQb2tlclJhbmsiLCJOb2RlIiwib25Mb2FkIiwiVXRpbHMiLCJsb2FkUmVzIiwiQ29uZmlnIiwiZ2V0RGVmYXVsdEF2YXRhciIsIm9uRW5hYmxlIiwidXBkYXRlVXNlclZhcmlhYmxlIiwibW0iLCJnYW1lIiwiX2RhdGEiLCJncm91cHMiLCJudW1JdGVtcyIsImxlbmd0aCIsInN0cmluZyIsIkxvYWRpbmciLCJoaWRlIiwidXBkYXRlUmFuayIsImFyciIsImdldENvbXBvbmVudCIsIm5hbWUiLCJzdWJDaGlwIiwiUG9ydGFsTWFuYWdlciIsImdldEdhbWVDb250cm9sbGVyIiwiZm9ybWF0VGV4dCIsIkdhbWVWYXJpYWJsZXMiLCJQb2tlciIsImdldERpc3BsYXlOYW1lIiwiU21hcnRGb3hTREsiLCJQb3J0YWxDb250cm9sbGVyIiwiWm9uZUluc3RhbmNlIiwibXlTZWxmIiwiYWRkRG90VG9OdW1iZXIiLCJnZXRDaGlwIiwiYmFjayIsImF1ZGlvIiwicGxheUJ1dHRvbiIsIlVJTWFuZ2VyIiwic2hvdyIsIm9uUmVuZGVyTG9iYnkiLCJpdGVtIiwiaWR4IiwianNJdGVtIiwiaW5pdCIsIm9uU2VsZWN0Um9vbSIsInNlbGYiLCJncm91cElkIiwiZ3JvdXBfaWQiLCJtaW5DaGlwIiwiZ3JvdXBfdmFycyIsImJldF9jaGlwIiwiVG9hc3QiLCJzaG93VG9hc3QiLCJpbmNsdWRlcyIsImJldCIsIm1pbiIsIm1pbl9jaGlwIiwibWF4IiwibWF4X2NoaXAiLCJyZW1haW5DaGlwIiwiY3VycmVudENoaXAiLCJkaXN0YW5jZSIsImRhdGEiLCJjYlllcyIsImVyciIsIlBva2VyQ29udHJvbGxlciIsIlF1aWNrSm9pblJvb21Db25maWciLCJidXlfaW4iLCJnZXRCdXlJbiIsIm51bWJlcl9kZXNrIiwiX3NpemVEZXNrIiwicXVpY2tSZXF1ZXN0IiwiQ2FzaW5vUmVxdWVzdCIsIlF1aWNrSm9pbkdhbWVSZXF1ZXN0Iiwic2V0R2FtZSIsInNldFNpemVEZXNrIiwic2V0R3JvdXAiLCJzZW5kIiwidG9TUmVxdWVzdCIsInBvcCIsInNpemVEZXNrIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLElBQUlBLFFBQVEsR0FBR0MsT0FBTyxDQUFDLFVBQUQsQ0FBdEI7O0FBQ0FDLEVBQUUsQ0FBQ0MsS0FBSCxDQUFTO0FBQ0wsYUFBU0QsRUFBRSxDQUFDRSxnQkFEUDtBQUdMQyxFQUFBQSxVQUFVLEVBQUU7QUFDUkMsSUFBQUEsUUFBUSxFQUFFTixRQURGO0FBRVJPLElBQUFBLFdBQVcsRUFBRSxFQUZMO0FBR1JDLElBQUFBLE9BQU8sRUFBRU4sRUFBRSxDQUFDTyxLQUhKO0FBSVJDLElBQUFBLE9BQU8sRUFBRVIsRUFBRSxDQUFDTyxLQUpKO0FBS1JFLElBQUFBLGFBQWEsRUFBRSxJQUxQO0FBTVJDLElBQUFBLE1BQU0sRUFBRVYsRUFBRSxDQUFDVyxNQU5IO0FBT1JDLElBQUFBLFNBQVMsRUFBRVosRUFBRSxDQUFDTyxLQVBOO0FBUVJNLElBQUFBLFdBQVcsRUFBRWIsRUFBRSxDQUFDYztBQVJSLEdBSFA7QUFhTEMsRUFBQUEsTUFiSyxvQkFhRztBQUNKO0FBQ0FDLElBQUFBLEtBQUssQ0FBQ0MsT0FBTixDQUFjLEtBQUtQLE1BQW5CLEVBQTJCLG1CQUFpQlEsTUFBTSxDQUFDQyxnQkFBUCxFQUE1QztBQUNILEdBaEJJO0FBaUJMQyxFQUFBQSxRQWpCSyxzQkFpQks7QUFDTixTQUFLQyxrQkFBTCxDQUF3QixJQUF4Qjs7QUFDQSxRQUFHQyxFQUFFLENBQUNDLElBQUgsSUFBV0QsRUFBRSxDQUFD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QXNCOUIsT0FBdEI7QUFDQWxCLFlBQUFBLFdBQVcsQ0FBQ3FDLGVBQVosQ0FBNEJuQyxZQUE1QixDQUF5QytDLElBQXpDLENBQThDTixZQUFZLENBQUNPLFVBQWIsRUFBOUM7QUFDQSxpQkFBSzVDLElBQUw7QUFDSDtBQXBCeUIsU0FBUDtBQXFCdkI2QyxRQUFBQSxHQUFHLEVBQUU7QUFyQmtCLE9BQTNCO0FBc0JILEtBakNELE1BaUNNO0FBQ0Z2RSxNQUFBQSxFQUFFLENBQUNPLE9BQUgsQ0FBV3VCLElBQVg7QUFDQSxVQUFJMEMsUUFBUSxHQUFHLENBQWY7QUFDQSxVQUFHLEtBQUt0RSxLQUFMLENBQVdELElBQVgsSUFBbUIsT0FBdEIsRUFDSXVFLFFBQVEsR0FBRyxDQUFYO0FBQ0osVUFBSVQsWUFBWSxHQUFHLElBQUlDLGFBQWEsQ0FBQ0Msb0JBQWxCLEVBQW5CO0FBQ0FGLE1BQUFBLFlBQVksQ0FBQ0ssUUFBYixDQUFzQjlCLE9BQXRCO0FBQ0F5QixNQUFBQSxZQUFZLENBQUNJLFdBQWIsQ0FBeUJLLFFBQXpCO0FBQ0ExRCxNQUFBQSxhQUFhLENBQUNDLGlCQUFkLENBQWdDLEtBQUtiLEtBQUwsQ0FBV0QsSUFBM0MsRUFBaURxQixZQUFqRCxDQUE4RCtDLElBQTlELENBQW1FTixZQUFZLENBQUNPLFVBQWIsRUFBbkU7QUFDSDtBQUNKO0FBMUdJLENBQVQiLCJzb3VyY2VSb290IjoiLyIsInNvdXJjZXNDb250ZW50IjpbImxldCBMaXN0dmlldyA9IHJlcXVpcmUoJ0xpc3R2aWV3Jyk7XG5jYy5DbGFzcyh7XG4gICAgZXh0ZW5kczogY2MuVm96QmFzZUNvbXBvbmVudCxcblxuICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgcm9vbUxpc3Q6IExpc3R2aWV3LFxuICAgICAgICByb29tQ29udGVudDogW10sXG4gICAgICAgIGxiX25hbWU6IGNjLkxhYmVsLFxuICAgICAgICBsYl9jaGlwOiBjYy5MYWJlbCxcbiAgICAgICAgX2N1cnJlbnRHcm91cDogbnVsbCxcbiAgICAgICAgQXZhdGFyOiBjYy5TcHJpdGUsXG4gICAgICAgIHRpdGxlR2FtZTogY2MuTGFiZWwsXG4gICAgICAgIFVJUG9rZXJSYW5rOiBjYy5Ob2RlXG4gICAgfSxcbiAgICBvbkxvYWQoKXtcbiAgICAgICAgLy8gdXBkYXRlIGF2YXRhciBpbWFnZVxuICAgICAgICBVdGlscy5sb2FkUmVzKHRoaXMuQXZhdGFyLCBcImltYWdlcy9hdmF0YXIvXCIrQ29uZmlnLmdldERlZmF1bHRBdmF0YXIoKSk7XG4gICAgfSxcbiAgICBvbkVuYWJsZSgpe1xuICAgICAgICB0aGlzLnVwZGF0ZVVzZXJWYXJpYWJsZShudWxsKTtcbiAgICAgICAgaWYobW0uZ2FtZSAmJiBtbS5nYW1lW3RoaXMuX2RhdGEuZ2FtZV0pe1xuICAgICAgICAgICAgdGhpcy5yb29tQ29udGVudCA9IG1tLmdhbWVbdGhpcy5fZGF0YS5nYW1lXS5ncm91cHM7XG4gICAgICAgICAgICB0aGlzLnJvb21MaXN0Lm51bUl0ZW1zID0gdGhpcy5yb29tQ29udGVudC5sZW5ndGg7XG4gICAgICAgIH1cbiAgICAgICAgaWYodGhpcy5fZGF0YS5nYW1lID09IFwicG9rZXJcIil7XG4gICAgICAgICAgICB0aGlzLnRpdGxlR2FtZS5zdHJpbmcgPSBcIlBva2VyXCJcbiAgICAgICAgfWVsc2UgaWYodGhpcy5fZGF0YS5nYW1lID09IFwidGxtblwiKXtcbiAgICAgICAgICAgIHRoaXMudGl0bGVHYW1lLnN0cmluZyA9IFwiVExNTlwiXG4gICAgICAgIH1lbHNlIGlmKHRoaXMuX2RhdGEuZ2FtZSA9PSBcImJhY2F5XCIpe1xuICAgICAgICAgICAgdGhpcy50aXRsZUdhbWUuc3RyaW5nID0gXCJCYSBDw6J5XCJcbiAgICAgICAgfWVsc2UgaWYodGhpcy5fZGF0YS5nYW1lID09IFwibWF1YmluaFwiKXtcbiAgICAgICAgICAgIHRoaXMudGl0bGVHYW1lLnN0cmluZyA9IFwiTeG6rXUgYmluaFwiO1xuICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgIHRoaXMudGl0bGVHYW1lLnN0cmluZyA9IFwiQ2FzaW5vXCI7XG4gICAgICAgIH1cbiAgICAgICAgbW0uTG9hZGluZy5oaWRlKCk7XG4gICAgfSxcbiAgICB1cGRhdGVSYW5rKGFycil7XG4gICAgICAgIGlmKHRoaXMuVUlQb2tlclJhbmspXG4gICAgICAgICAgICB0aGlzLlVJUG9rZXJSYW5rLmdldENvbXBvbmVudCh0aGlzLlVJUG9rZXJSYW5rLm5hbWUpLnVwZGF0ZVJhbmsoYXJyKTtcbiAgICB9LFxuICAgIHVwZGF0ZVVzZXJWYXJpYWJsZShzdWJDaGlwKXtcbiAgICAgICAgaWYoUG9ydGFsTWFuYWdlci5nZXRHYW1lQ29udHJvbGxlcih0aGlzLl9kYXRhLmdhbWUpKXtcbiAgICAgICAgICAgIHRoaXMubGJfbmFtZS5zdHJpbmcgPSBVdGlscy5mb3JtYXRUZXh0KEdhbWVWYXJpYWJsZXMuUG9rZXIuZ2V0RGlzcGxheU5hbWUoU21hcnRGb3hTREsuUG9ydGFsQ29udHJvbGxlci5ab25lSW5zdGFuY2UubXlTZWxmKSwgMjApO1xuICAgICAgICAgICAgdGhpcy5sYl9jaGlwLnN0cmluZyA9IFV0aWxzLmFkZERvdFRvTnVtYmVyKEdhbWVWYXJpYWJsZXMuUG9rZXIuZ2V0Q2hpcChTbWFydEZveFNESy5Qb3J0YWxDb250cm9sbGVyLlpvbmVJbnN0YW5jZS5teVNlbGYpLXN1YkNoaXApO1xuICAgICAgICB9XG4gICAgfSxcbiAgICBiYWNrKCl7XG4gICAgICAgIG1tLmF1ZGlvLnBsYXlCdXR0b24oKTtcbiAgICAgICAgVUlNYW5nZXIuc2hvdyhcIlVJSG9tZVwiKTtcbiAgICB9LFxuICAgIG9uUmVuZGVyTG9iYnkoaXRlbSwgaWR4KXtcbiAgICAgICAgbGV0IGpzSXRlbSA9IGl0ZW0uZ2V0Q29tcG9uZW50KGl0ZW0ubmFtZSk7XG4gICAgICAgIGpzSXRlbS5pbml0KHRoaXMucm9vbUNvbnRlbnRbaWR4XSk7XG4gICAgfSxcbiAgICBvblNlbGVjdFJvb20oaXRlbSwgaWR4KXtcbiAgICAgICAgbW0uYXVkaW8ucGxheUJ1dHRvbigpO1xuICAgICAgICBsZXQgc2VsZiA9IHRoaXM7XG4gICAgICAgIGxldCBncm91cElkID0gdGhpcy5yb29tQ29udGVudFtpZHhdLmdyb3VwX2lkO1xuICAgICAgICBsZXQgbWluQ2hpcCA9IHRoaXMucm9vbUNvbnRlbnRbaWR4XS5ncm91cF92YXJzLmJldF9jaGlwKjEwMDtcbiAgICAgICAgaWYoR2FtZVZhcmlhYmxlcy5Qb2tlci5nZXRDaGlwKFNtYXJ0Rm94U0RLLlBvcnRhbENvbnRyb2xsZXIuWm9uZUluc3RhbmNlLm15U2VsZikgPCBtaW5DaGlwKXtcbiAgICAgICAgICAgIG1tLlRvYXN0LnNob3dUb2FzdCgxLCBcIkLhuqFuIGPhuqduIHThu5FpIHRoaeG7g3UgXCIrVXRpbHMuYWRkRG90VG9OdW1iZXIobWluQ2hpcCkgKyfEkScpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmKGdyb3VwSWQuaW5jbHVkZXMoXCJwb2tlclwiKSl7XG4gICAgICAgICAgICBsZXQgYmV0ID0gdGhpcy5yb29tQ29udGVudFtpZHhdLmdyb3VwX3ZhcnMuYmV0X2NoaXA7XG4gICAgICAgICAgICBsZXQgbWluID0gdGhpcy5yb29tQ29udGVudFtpZHhdLmdyb3VwX3ZhcnMubWluX2NoaXA7XG4gICAgICAgICAgICBsZXQgbWF4ID0gdGhpcy5yb29tQ29udGVudFtpZHhdLmdyb3VwX3ZhcnMubWF4X2NoaXA7XG4gICAgICAgICAgICBsZXQgcmVtYWluQ2hpcCA9IEdhbWVWYXJpYWJsZXMuUG9rZXIuZ2V0Q2hpcChQb3J0YWxNYW5hZ2VyLmdldEdhbWVDb250cm9sbGVyKHRoaXMuX2RhdGEuZ2FtZSkuWm9uZUluc3RhbmNlLm15U2VsZik7XG4gICAgICAgICAgICBsZXQgY3VycmVudENoaXAgPSBtaW47XG4gICAgICAgICAgICBsZXQgZGlzdGFuY2UgPSBiZXQ7XG4gICAgICAgICAgICBpZihHYW1lVmFyaWFibGVzLlBva2VyLmdldENoaXAoUG9ydGFsTWFuYWdlci5nZXRHYW1lQ29udHJvbGxlcih0aGlzLl9kYXRhLmdhbWUpLlpvbmVJbnN0YW5jZS5teVNlbGYpIDwgbWluKXtcbiAgICAgICAgICAgICAgICBtbS5Ub2FzdC5zaG93VG9hc3QoMSwgXCJC4bqhbiBj4bqnbiB04buRaSB0aGnhu4N1IFwiK1V0aWxzLmFkZERvdFRvTnVtYmVyKG1pbikgKycgQ2hpcCAnKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLnNob3coXCJVSURpYWxvZ0J1eUluXCIsIHtkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgIGRpc3RhbmNlOiBkaXN0YW5jZSxcbiAgICAgICAgICAgICAgICAgICAgcmVtYWluQ2hpcDogcmVtYWluQ2hpcCxcbiAgICAgICAgICAgICAgICAgICAgY3VycmVudENoaXA6IGN1cnJlbnRDaGlwLFxuICAgICAgICAgICAgICAgICAgICBtaW4gOiBtaW4sXG4gICAgICAgICAgICAgICAgICAgIG1heDogbWF4LFxuICAgICAgICAgICAgICAgICAgICBjYlllczogZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYoZXJyKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtbS5Ub2FzdC5zaG93VG9hc3QoMC41LCBlcnIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIG1tLkxvYWRpbmcuc2hvdygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgU21hcnRGb3hTREsuUG9rZXJDb250cm9sbGVyLlF1aWNrSm9pblJvb21Db25maWcuYnV5X2luID0gdGhpcy5nZXRCdXlJbigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgU21hcnRGb3hTREsuUG9rZXJDb250cm9sbGVyLlF1aWNrSm9pblJvb21Db25maWcubnVtYmVyX2Rlc2sgPSB0aGlzLl9zaXplRGVzaztcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBxdWlja1JlcXVlc3QgPSBuZXcgQ2FzaW5vUmVxdWVzdC5RdWlja0pvaW5HYW1lUmVxdWVzdCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcXVpY2tSZXF1ZXN0LnNldEdhbWUoc2VsZi5fZGF0YS5nYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHF1aWNrUmVxdWVzdC5zZXRTaXplRGVzayh0aGlzLl9zaXplRGVzayk7XG4gICAgICAgICAgICAgICAgICAgICAgICBxdWlja1JlcXVlc3Quc2V0R3JvdXAoZ3JvdXBJZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBTbWFydEZveFNESy5Qb2tlckNvbnRyb2xsZXIuWm9uZUluc3RhbmNlLnNlbmQocXVpY2tSZXF1ZXN0LnRvU1JlcXVlc3QoKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmJhY2soKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgIH0sIHBvcDogdHJ1ZX0pO1xuICAgICAgICB9ZWxzZSB7XG4gICAgICAgICAgICBtbS5Mb2FkaW5nLnNob3coKTtcbiAgICAgICAgICAgIGxldCBzaXplRGVzayA9IDQ7XG4gICAgICAgICAgICBpZih0aGlzLl9kYXRhLmdhbWUgPT0gXCJiYWNheVwiKVxuICAgICAgICAgICAgICAgIHNpemVEZXNrID0gNjtcbiAgICAgICAgICAgIGxldCBxdWlja1JlcXVlc3QgPSBuZXcgQ2FzaW5vUmVxdWVzdC5RdWlja0pvaW5HYW1lUmVxdWVzdCgpO1xuICAgICAgICAgICAgcXVpY2tSZXF1ZXN0LnNldEdyb3VwKGdyb3VwSWQpO1xuICAgICAgICAgICAgcXVpY2tSZXF1ZXN0LnNldFNpemVEZXNrKHNpemVEZXNrKTtcbiAgICAgICAgICAgIFBvcnRhbE1hbmFnZXIuZ2V0R2FtZUNvbnRyb2xsZXIodGhpcy5fZGF0YS5nYW1lKS5ab25lSW5zdGFuY2Uuc2VuZChxdWlja1JlcXVlc3QudG9TUmVxdWVzdCgpKTtcbiAgICAgICAgfVxuICAgIH1cbn0pO1xuIl19