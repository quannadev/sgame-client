
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/scripts/baccarat/ItemCard.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '7b49duTY1pDE6YIxipMMAVO', 'ItemCard');
// scripts/baccarat/ItemCard.js

"use strict";

cc.Class({
  "extends": cc.Component,
  properties: {
    _isSelected: false,
    bg: cc.Node,
    _card: null,
    _cbSelect: null,
    _removeSelect: true
  },
  onLoad: function onLoad() {},
  addEventSelect: function addEventSelect(cb) {
    this._cbSelect = cb;
  },
  isSelected: function isSelected() {
    return this._isSelected;
  },
  getCard: function getCard() {
    return this._card;
  },
  setCard: function setCard(card) {
    this._card = card;
  },
  loadCardBack: function loadCardBack(cb) {
    Utils.loadRes(this.bg.getComponent(cc.Sprite), "images/baccarat/cards/card_up", function () {
      if (cb) {
        cb();
      }
    });
  },
  _loadCard: function _loadCard() {
    Utils.loadRes(this.bg.getComponent(cc.Sprite), "images/baccarat/cards/" + this._card.nameFile);
  },
  init: function init(card, _removeSelect) {
    this.node.active = true;

    if (card == null) {
      this.loadCardBack();
    } else {
      this._card = card;

      if (_removeSelect != undefined) {
        this._removeSelect = _removeSelect;
      } else {
        this._removeSelect = true;
      }

      this._loadCard();
    }
  },
  reveal: function reveal(card, pIsFaceUp, cb) {
    this.node.active = true;
    this.loadCardBack();
    this._card = card;
    var self = this;
    var timeFlip = 0.45;
    var callFunc = cc.callFunc(function () {
      self._loadCard();

      if (!pIsFaceUp) self.node.skewY = 170;else self.node.skewY = 45;
    });

    if (!pIsFaceUp) {
      self.node.skewY = 0;
      var action = cc.skewBy(timeFlip / 2, 0, 10);
      var action2 = cc.skewTo(timeFlip / 2, 0, 180);
      self.node.runAction(cc.sequence(cc.delayTime(1), action, callFunc, action2, cc.delayTime(0.5), cc.callFunc(function () {
        if (cb) cb();
      })));
    } else {
      self.node.skewY = 180;

      var _action = cc.skewBy(timeFlip / 2, 0, -35);

      var _action2 = cc.skewTo(timeFlip / 2, 0, 0);

      self.node.runAction(cc.sequence(cc.delayTime(1), _action, callFunc, _action2, cc.delayTime(0.5), cc.callFunc(function () {
        if (cb) cb();
      })));
    }
  },
  switchCard: function switchCard(pIsFaceUp) {
    var self = this;
    var timeFlip = 0.45;
    var callFunc = cc.callFunc(function () {
      self._loadCard();

      if (!pIsFaceUp) self.node.skewY = 170;else self.node.skewY = 45;
    });
    self.node.skewY = 0;
    var action = cc.skewBy(timeFlip / 2, 0, 10);
    var action2 = cc.skewTo(timeFlip / 2, 0, 180);
    self.node.runAction(cc.sequence(action, callFunc, action2));

    if (!pIsFaceUp) {
      self.node.skewY = 0;

      var _action3 = cc.skewBy(timeFlip / 2, 0, 10);

      var _action4 = cc.skewTo(timeFlip / 2, 0, 180);

      self.node.runAction(cc.sequence(_action3, callFunc, _action4));
    } else {
      self.node.skewY = 180;

      var _action5 = cc.skewBy(timeFlip / 2, 0, -35);

      var _action6 = cc.skewTo(timeFlip / 2, 0, 0);

      self.node.runAction(cc.sequence(_action5, callFunc, _action6));
    }
  },
  reset: function reset() {
    this.loadCardBack();
    this.node._zIndex = 0;
    this.node.x = 0;
    this.node.y = 0;
    this._isSelected = false;
    this._card = null;
    this._cbSelect = null;
    this._removeSelect = true;
  },
  eventSelect: function eventSelect() {
    mm.audio.playButton();

    if (!this._removeSelect) {
      if (!this._isSelected) {
        this._isSelected = true;
        this.node.y = this.node.y + 20;

        if (this._cbSelect) {
          this._cbSelect(this.getCard().id);
        }
      } else {
        this._isSelected = false;
        this.node.y = this.node.y - 20;
      }
    }
  },
  setScaleCard: function setScaleCard(scaleCard) {
    this.node.width *= scaleCard;
    this.node.height *= scaleCard;
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcc2NyaXB0c1xcYmFjY2FyYXRcXEl0ZW1DYXJkLmpzIl0sIm5hbWVzIjpbImNjIiwiQ2xhc3MiLCJDb21wb25lbnQiLCJwcm9wZXJ0aWVzIiwiX2lzU2VsZWN0ZWQiLCJiZyIsIk5vZGUiLCJfY2FyZCIsIl9jYlNlbGVjdCIsIl9yZW1vdmVTZWxlY3QiLCJvbkxvYWQiLCJhZGRFdmVudFNlbGVjdCIsImNiIiwiaXNTZWxlY3RlZCIsImdldENhcmQiLCJzZXRDYXJkIiwiY2FyZCIsImxvYWRDYXJkQmFjayIsIlV0aWxzIiwibG9hZFJlcyIsImdldENvbXBvbmVudCIsIlNwcml0ZSIsIl9sb2FkQ2FyZCIsIm5hbWVGaWxlIiwiaW5pdCIsIm5vZGUiLCJhY3RpdmUiLCJ1bmRlZmluZWQiLCJyZXZlYWwiLCJwSXNGYWNlVXAiLCJzZWxmIiwidGltZUZsaXAiLCJjYWxsRnVuYyIsInNrZXdZIiwiYWN0aW9uIiwic2tld0J5IiwiYWN0aW9uMiIsInNrZXdUbyIsInJ1bkFjdGlvbiIsInNlcXVlbmNlIiwiZGVsYXlUaW1lIiwic3dpdGNoQ2FyZCIsInJlc2V0IiwiX3pJbmRleCIsIngiLCJ5IiwiZXZlbnRTZWxlY3QiLCJtbSIsImF1ZGlvIiwicGxheUJ1dHRvbiIsImlkIiwic2V0U2NhbGVDYXJkIiwic2NhbGVDYXJkIiwid2lkdGgiLCJoZWlnaHQiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUFBLEVBQUUsQ0FBQ0MsS0FBSCxDQUFTO0FBQ0wsYUFBU0QsRUFBRSxDQUFDRSxTQURQO0FBR0xDLEVBQUFBLFVBQVUsRUFBRTtBQUNSQyxJQUFBQSxXQUFXLEVBQUUsS0FETDtBQUVSQyxJQUFBQSxFQUFFLEVBQUdMLEVBQUUsQ0FBQ00sSUFGQTtBQUdSQyxJQUFBQSxLQUFLLEVBQUUsSUFIQztBQUlSQyxJQUFBQSxTQUFTLEVBQUcsSUFKSjtBQUtSQyxJQUFBQSxhQUFhLEVBQUU7QUFMUCxHQUhQO0FBVUxDLEVBQUFBLE1BVkssb0JBVUcs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QjtBQUNBLGFBQUtxQixJQUFMLENBQVVvQixDQUFWLEdBQWMsS0FBS3BCLElBQUwsQ0FBVW9CLENBQVYsR0FBYyxFQUE1QjtBQUNIO0FBQ0o7QUFDSixHQXRJSTtBQXVJTE0sRUFBQUEsWUF2SUssd0JBdUlRQyxTQXZJUixFQXVJa0I7QUFDbkIsU0FBSzNCLElBQUwsQ0FBVTRCLEtBQVYsSUFBb0JELFNBQXBCO0FBQ0EsU0FBSzNCLElBQUwsQ0FBVTZCLE1BQVYsSUFBb0JGLFNBQXBCO0FBQ0g7QUExSUksQ0FBVCIsInNvdXJjZVJvb3QiOiIvIiwic291cmNlc0NvbnRlbnQiOlsiY2MuQ2xhc3Moe1xyXG4gICAgZXh0ZW5kczogY2MuQ29tcG9uZW50LFxyXG5cclxuICAgIHByb3BlcnRpZXM6IHtcclxuICAgICAgICBfaXNTZWxlY3RlZDogZmFsc2UsXHJcbiAgICAgICAgYmcgOiBjYy5Ob2RlLFxyXG4gICAgICAgIF9jYXJkOiBudWxsLFxyXG4gICAgICAgIF9jYlNlbGVjdCA6IG51bGwsXHJcbiAgICAgICAgX3JlbW92ZVNlbGVjdDogdHJ1ZVxyXG4gICAgfSxcclxuICAgIG9uTG9hZCgpe1xyXG5cclxuICAgIH0sXHJcbiAgICBhZGRFdmVudFNlbGVjdChjYil7XHJcbiAgICAgICAgdGhpcy5fY2JTZWxlY3QgPSBjYjtcclxuICAgIH0sXHJcbiAgICBpc1NlbGVjdGVkKCl7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2lzU2VsZWN0ZWQ7XHJcbiAgICB9LFxyXG4gICAgZ2V0Q2FyZCgpe1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9jYXJkO1xyXG4gICAgfSxcclxuICAgIHNldENhcmQoY2FyZCl7XHJcbiAgICAgICAgdGhpcy5fY2FyZCA9IGNhcmQ7XHJcbiAgICB9LFxyXG4gICAgbG9hZENhcmRCYWNrKGNiKXtcclxuICAgICAgICBVdGlscy5sb2FkUmVzKHRoaXMuYmcuZ2V0Q29tcG9uZW50KGNjLlNwcml0ZSksIFwiaW1hZ2VzL2JhY2NhcmF0L2NhcmRzL2NhcmRfdXBcIiwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBpZiAoY2Ipe1xyXG4gICAgICAgICAgICAgICAgY2IoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pXHJcbiAgICB9LFxyXG4gICAgX2xvYWRDYXJkKCl7XHJcbiAgICAgICAgVXRpbHMubG9hZFJlcyh0aGlzLmJnLmdldENvbXBvbmVudChjYy5TcHJpdGUpLCBcImltYWdlcy9iYWNjYXJhdC9jYXJkcy9cIit0aGlzLl9jYXJkLm5hbWVGaWxlKVxyXG4gICAgfSxcclxuICAgIGluaXQoY2FyZCwgX3JlbW92ZVNlbGVjdCl7XHJcbiAgICAgICAgdGhpcy5ub2RlLmFjdGl2ZSA9IHRydWU7XHJcbiAgICAgICAgaWYoY2FyZCA9PSBudWxsKXtcclxuICAgICAgICAgICAgdGhpcy5sb2FkQ2FyZEJhY2soKTtcclxuICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgdGhpcy5fY2FyZCA9IGNhcmQ7XHJcbiAgICAgICAgICAgIGlmKF9yZW1vdmVTZWxlY3QgIT0gdW5kZWZpbmVkKXtcclxuICAgICAgICAgICAgICAgIHRoaXMuX3JlbW92ZVNlbGVjdCA9IF9yZW1vdmVTZWxlY3Q7XHJcbiAgICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fcmVtb3ZlU2VsZWN0ID0gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLl9sb2FkQ2FyZCgpO1xyXG4gICAgICAgIH1cclxuICAgIH0sXHJcbiAgICByZXZlYWwoY2FyZCwgcElzRmFjZVVwLCBjYil7XHJcbiAgICAgICAgdGhpcy5ub2RlLmFjdGl2ZSA9IHRydWU7XHJcbiAgICAgICAgdGhpcy5sb2FkQ2FyZEJhY2soKTtcclxuICAgICAgICB0aGlzLl9jYXJkID0gY2FyZDtcclxuICAgICAgICBsZXQgc2VsZiA9IHRoaXM7XHJcbiAgICAgICAgbGV0IHRpbWVGbGlwID0gMC40NTtcclxuICAgICAgICBsZXQgY2FsbEZ1bmMgPSBjYy5jYWxsRnVuYyhmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHNlbGYuX2xvYWRDYXJkKCk7XHJcbiAgICAgICAgICAgIGlmKCFwSXNGYWNlVXApXHJcbiAgICAgICAgICAgICAgICBzZWxmLm5vZGUuc2tld1kgPSAxNzA7XHJcbiAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgIHNlbGYubm9kZS5za2V3WSA9IDQ1O1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGlmKCFwSXNGYWNlVXApXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBzZWxmLm5vZGUuc2tld1kgPSAwO1xyXG4gICAgICAgICAgICBsZXQgYWN0aW9uID0gY2Muc2tld0J5KHRpbWVGbGlwLzIsMCwxMCk7XHJcbiAgICAgICAgICAgIGxldCBhY3Rpb24yID0gY2Muc2tld1RvKHRpbWVGbGlwLzIsMCwxODApO1xyXG4gICAgICAgICAgICBzZWxmLm5vZGUucnVuQWN0aW9uKGNjLnNlcXVlbmNlKGNjLmRlbGF5VGltZSgxKSwgYWN0aW9uLGNhbGxGdW5jLGFjdGlvbjIsIGNjLmRlbGF5VGltZSgwLjUpLCBjYy5jYWxsRnVuYyhmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoY2IpXHJcbiAgICAgICAgICAgICAgICAgICAgY2IoKTtcclxuICAgICAgICAgICAgfSkpKTtcclxuICAgICAgICB9ZWxzZVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgc2VsZi5ub2RlLnNrZXdZID0gMTgwO1xyXG4gICAgICAgICAgICBsZXQgYWN0aW9uID0gY2Muc2tld0J5KHRpbWVGbGlwLzIsMCwtMzUpO1xyXG4gICAgICAgICAgICBsZXQgYWN0aW9uMiA9IGNjLnNrZXdUbyh0aW1lRmxpcC8yLDAsMCk7XHJcbiAgICAgICAgICAgIHNlbGYubm9kZS5ydW5BY3Rpb24oY2Muc2VxdWVuY2UoY2MuZGVsYXlUaW1lKDEpLCBhY3Rpb24sY2FsbEZ1bmMsYWN0aW9uMiwgY2MuZGVsYXlUaW1lKDAuNSksIGNjLmNhbGxGdW5jKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIGlmIChjYilcclxuICAgICAgICAgICAgICAgICAgICBjYigpO1xyXG4gICAgICAgICAgICB9KSkpO1xyXG4gICAgICAgIH1cclxuICAgIH0sXHJcbiAgICBzd2l0Y2hDYXJkKHBJc0ZhY2VVcCkge1xyXG4gICAgICAgIGxldCBzZWxmID0gdGhpcztcclxuICAgICAgICBsZXQgdGltZUZsaXAgPSAwLjQ1O1xyXG4gICAgICAgIGxldCBjYWxsRnVuYyA9IGNjLmNhbGxGdW5jKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgc2VsZi5fbG9hZENhcmQoKTtcclxuICAgICAgICAgICAgaWYoIXBJc0ZhY2VVcClcclxuICAgICAgICAgICAgICAgIHNlbGYubm9kZS5za2V3WSA9IDE3MDtcclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgc2VsZi5ub2RlLnNrZXdZID0gNDU7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgc2VsZi5ub2RlLnNrZXdZID0gMDtcclxuICAgICAgICBsZXQgYWN0aW9uID0gY2Muc2tld0J5KHRpbWVGbGlwLzIsMCwxMCk7XHJcbiAgICAgICAgbGV0IGFjdGlvbjIgPSBjYy5za2V3VG8odGltZUZsaXAvMiwwLDE4MCk7XHJcbiAgICAgICAgc2VsZi5ub2RlLnJ1bkFjdGlvbihjYy5zZXF1ZW5jZShhY3Rpb24sY2FsbEZ1bmMsYWN0aW9uMikpO1xyXG4gICAgICAgIGlmKCFwSXNGYWNlVXApXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBzZWxmLm5vZGUuc2tld1kgPSAwO1xyXG4gICAgICAgICAgICBsZXQgYWN0aW9uID0gY2Muc2tld0J5KHRpbWVGbGlwLzIsMCwxMCk7XHJcbiAgICAgICAgICAgIGxldCBhY3Rpb24yID0gY2Muc2tld1RvKHRpbWVGbGlwLzIsMCwxODApO1xyXG4gICAgICAgICAgICBzZWxmLm5vZGUucnVuQWN0aW9uKGNjLnNlcXVlbmNlKGFjdGlvbixjYWxsRnVuYyxhY3Rpb24yKSk7XHJcbiAgICAgICAgfWVsc2VcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHNlbGYubm9kZS5za2V3WSA9IDE4MDtcclxuICAgICAgICAgICAgbGV0IGFjdGlvbiA9IGNjLnNrZXdCeSh0aW1lRmxpcC8yLDAsLTM1KTtcclxuICAgICAgICAgICAgbGV0IGFjdGlvbjIgPSBjYy5za2V3VG8odGltZUZsaXAvMiwwLDApO1xyXG4gICAgICAgICAgICBzZWxmLm5vZGUucnVuQWN0aW9uKGNjLnNlcXVlbmNlKGFjdGlvbixjYWxsRnVuYyxhY3Rpb24yKSk7XHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxuICAgIHJlc2V0KCl7XHJcbiAgICAgICAgdGhpcy5sb2FkQ2FyZEJhY2soKTtcclxuICAgICAgICB0aGlzLm5vZGUuX3pJbmRleCA9IDA7XHJcbiAgICAgICAgdGhpcy5ub2RlLnggPSAwO1xyXG4gICAgICAgIHRoaXMubm9kZS55ID0gMDtcclxuICAgICAgICB0aGlzLl9pc1NlbGVjdGVkID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5fY2FyZCA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5fY2JTZWxlY3QgPSBudWxsO1xyXG4gICAgICAgIHRoaXMuX3JlbW92ZVNlbGVjdCA9IHRydWU7XHJcbiAgICB9LFxyXG4gICAgZXZlbnRTZWxlY3QoKXtcclxuICAgICAgICBtbS5hdWRpby5wbGF5QnV0dG9uKCk7XHJcbiAgICAgICAgaWYoIXRoaXMuX3JlbW92ZVNlbGVjdCl7XHJcbiAgICAgICAgICAgIGlmKCF0aGlzLl9pc1NlbGVjdGVkKXtcclxuICAgICAgICAgICAgICAgIHRoaXMuX2lzU2VsZWN0ZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5ub2RlLnkgPSB0aGlzLm5vZGUueSArIDIwO1xyXG4gICAgICAgICAgICAgICAgaWYodGhpcy5fY2JTZWxlY3Qpe1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2NiU2VsZWN0KHRoaXMuZ2V0Q2FyZCgpLmlkKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9pc1NlbGVjdGVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB0aGlzLm5vZGUueSA9IHRoaXMubm9kZS55IC0gMjA7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9LFxyXG4gICAgc2V0U2NhbGVDYXJkKHNjYWxlQ2FyZCl7XHJcbiAgICAgICAgdGhpcy5ub2RlLndpZHRoICAqPSBzY2FsZUNhcmQ7XHJcbiAgICAgICAgdGhpcy5ub2RlLmhlaWdodCAqPSBzY2FsZUNhcmQ7XHJcbiAgICB9XHJcbn0pO1xyXG4iXX0=