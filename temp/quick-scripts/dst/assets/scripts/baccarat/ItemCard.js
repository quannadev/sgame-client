
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/scripts/baccarat/ItemCard.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '7b49duTY1pDE6YIxipMMAVO', 'ItemCard');
// scripts/baccarat/ItemCard.js

"use strict";

cc.Class({
  "extends": cc.Component,
  properties: {
    _isSelected: false,
    bg: cc.Node,
    _card: null,
    _cbSelect: null,
    _removeSelect: true
  },
  onLoad: function onLoad() {},
  addEventSelect: function addEventSelect(cb) {
    this._cbSelect = cb;
  },
  isSelected: function isSelected() {
    return this._isSelected;
  },
  getCard: function getCard() {
    return this._card;
  },
  setCard: function setCard(card) {
    this._card = card;
  },
  loadCardBack: function loadCardBack(cb) {
    Utils.loadRes(this.bg.getComponent(cc.Sprite), "images/baccarat/cards/card_up", function () {
      if (cb) {
        cb();
      }
    });
  },
  _loadCard: function _loadCard() {
    Utils.loadRes(this.bg.getComponent(cc.Sprite), "images/baccarat/cards/" + this._card.nameFile);
  },
  init: function init(card, _removeSelect) {
    this.node.active = true;

    if (card == null) {
      this.loadCardBack();
    } else {
      this._card = card;

      if (_removeSelect != undefined) {
        this._removeSelect = _removeSelect;
      } else {
        this._removeSelect = true;
      }

      this._loadCard();
    }
  },
  reveal: function reveal(card, pIsFaceUp, cb) {
    this.node.active = true;
    this.loadCardBack();
    this._card = card;
    var self = this;
    var timeFlip = 0.45;
    var callFunc = cc.callFunc(function () {
      self._loadCard();

      if (!pIsFaceUp) self.node.skewY = 170;else self.node.skewY = 45;
    });

    if (!pIsFaceUp) {
      self.node.skewY = 0;
      var action = cc.skewBy(timeFlip / 2, 0, 10);
      var action2 = cc.skewTo(timeFlip / 2, 0, 180);
      self.node.runAction(cc.sequence(cc.delayTime(1), action, callFunc, action2, cc.delayTime(0.5), cc.callFunc(function () {
        if (cb) cb();
      })));
    } else {
      self.node.skewY = 180;

      var _action = cc.skewBy(timeFlip / 2, 0, -35);

      var _action2 = cc.skewTo(timeFlip / 2, 0, 0);

      self.node.runAction(cc.sequence(cc.delayTime(1), _action, callFunc, _action2, cc.delayTime(0.5), cc.callFunc(function () {
        if (cb) cb();
      })));
    }
  },
  switchCard: function switchCard(pIsFaceUp) {
    var self = this;
    var timeFlip = 0.45;
    var callFunc = cc.callFunc(function () {
      self._loadCard();

      if (!pIsFaceUp) self.node.skewY = 170;else self.node.skewY = 45;
    });
    self.node.skewY = 0;
    var action = cc.skewBy(timeFlip / 2, 0, 10);
    var action2 = cc.skewTo(timeFlip / 2, 0, 180);
    self.node.runAction(cc.sequence(action, callFunc, action2));

    if (!pIsFaceUp) {
      self.node.skewY = 0;

      var _action3 = cc.skewBy(timeFlip / 2, 0, 10);

      var _action4 = cc.skewTo(timeFlip / 2, 0, 180);

      self.node.runAction(cc.sequence(_action3, callFunc, _action4));
    } else {
      self.node.skewY = 180;

      var _action5 = cc.skewBy(timeFlip / 2, 0, -35);

      var _action6 = cc.skewTo(timeFlip / 2, 0, 0);

      self.node.runAction(cc.sequence(_action5, callFunc, _action6));
    }
  },
  reset: function reset() {
    this.loadCardBack();
    this.node._zIndex = 0;
    this.node.x = 0;
    this.node.y = 0;
    this._isSelected = false;
    this._card = null;
    this._cbSelect = null;
    this._removeSelect = true;
  },
  eventSelect: function eventSelect() {
    mm.audio.playButton();

    if (!this._removeSelect) {
      if (!this._isSelected) {
        this._isSelected = true;
        this.node.y = this.node.y + 20;

        if (this._cbSelect) {
          this._cbSelect(this.getCard().id);
        }
      } else {
        this._isSelected = false;
        this.node.y = this.node.y - 20;
      }
    }
  },
  setScaleCard: function setScaleCard(scaleCard) {
    this.node.width *= scaleCard;
    this.node.height *= scaleCard;
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0cy9zY3JpcHRzL2JhY2NhcmF0L0l0ZW1DYXJkLmpzIl0sIm5hbWVzIjpbImNjIiwiQ2xhc3MiLCJDb21wb25lbnQiLCJwcm9wZXJ0aWVzIiwiX2lzU2VsZWN0ZWQiLCJiZyIsIk5vZGUiLCJfY2FyZCIsIl9jYlNlbGVjdCIsIl9yZW1vdmVTZWxlY3QiLCJvbkxvYWQiLCJhZGRFdmVudFNlbGVjdCIsImNiIiwiaXNTZWxlY3RlZCIsImdldENhcmQiLCJzZXRDYXJkIiwiY2FyZCIsImxvYWRDYXJkQmFjayIsIlV0aWxzIiwibG9hZFJlcyIsImdldENvbXBvbmVudCIsIlNwcml0ZSIsIl9sb2FkQ2FyZCIsIm5hbWVGaWxlIiwiaW5pdCIsIm5vZGUiLCJhY3RpdmUiLCJ1bmRlZmluZWQiLCJyZXZlYWwiLCJwSXNGYWNlVXAiLCJzZWxmIiwidGltZUZsaXAiLCJjYWxsRnVuYyIsInNrZXdZIiwiYWN0aW9uIiwic2tld0J5IiwiYWN0aW9uMiIsInNrZXdUbyIsInJ1bkFjdGlvbiIsInNlcXVlbmNlIiwiZGVsYXlUaW1lIiwic3dpdGNoQ2FyZCIsInJlc2V0IiwiX3pJbmRleCIsIngiLCJ5IiwiZXZlbnRTZWxlY3QiLCJtbSIsImF1ZGlvIiwicGxheUJ1dHRvbiIsImlkIiwic2V0U2NhbGVDYXJkIiwic2NhbGVDYXJkIiwid2lkdGgiLCJoZWlnaHQiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUFBLEVBQUUsQ0FBQ0MsS0FBSCxDQUFTO0FBQ0wsYUFBU0QsRUFBRSxDQUFDRSxTQURQO0FBR0xDLEVBQUFBLFVBQVUsRUFBRTtBQUNSQyxJQUFBQSxXQUFXLEVBQUUsS0FETDtBQUVSQyxJQUFBQSxFQUFFLEVBQUdMLEVBQUUsQ0FBQ00sSUFGQTtBQUdSQyxJQUFBQSxLQUFLLEVBQUUsSUFIQztBQUlSQyxJQUFBQSxTQUFTLEVBQUcsSUFKSjtBQUtSQyxJQUFBQSxhQUFhLEVBQUU7QUFMUCxHQUhQO0FBVUxDLEVBQUFBLE1BVkssb0JBVUcsQ0FF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QUNBLGFBQUtxQixJQUFMLENBQVVvQixDQUFWLEdBQWMsS0FBS3BCLElBQUwsQ0FBVW9CLENBQVYsR0FBYyxFQUE1QjtBQUNIO0FBQ0o7QUFDSixHQXRJSTtBQXVJTE0sRUFBQUEsWUF2SUssd0JBdUlRQyxTQXZJUixFQXVJa0I7QUFDbkIsU0FBSzNCLElBQUwsQ0FBVTRCLEtBQVYsSUFBb0JELFNBQXBCO0FBQ0EsU0FBSzNCLElBQUwsQ0FBVTZCLE1BQVYsSUFBb0JGLFNBQXBCO0FBQ0g7QUExSUksQ0FBVCIsInNvdXJjZVJvb3QiOiIvIiwic291cmNlc0NvbnRlbnQiOlsiY2MuQ2xhc3Moe1xuICAgIGV4dGVuZHM6IGNjLkNvbXBvbmVudCxcblxuICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgX2lzU2VsZWN0ZWQ6IGZhbHNlLFxuICAgICAgICBiZyA6IGNjLk5vZGUsXG4gICAgICAgIF9jYXJkOiBudWxsLFxuICAgICAgICBfY2JTZWxlY3QgOiBudWxsLFxuICAgICAgICBfcmVtb3ZlU2VsZWN0OiB0cnVlXG4gICAgfSxcbiAgICBvbkxvYWQoKXtcblxuICAgIH0sXG4gICAgYWRkRXZlbnRTZWxlY3QoY2Ipe1xuICAgICAgICB0aGlzLl9jYlNlbGVjdCA9IGNiO1xuICAgIH0sXG4gICAgaXNTZWxlY3RlZCgpe1xuICAgICAgICByZXR1cm4gdGhpcy5faXNTZWxlY3RlZDtcbiAgICB9LFxuICAgIGdldENhcmQoKXtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2NhcmQ7XG4gICAgfSxcbiAgICBzZXRDYXJkKGNhcmQpe1xuICAgICAgICB0aGlzLl9jYXJkID0gY2FyZDtcbiAgICB9LFxuICAgIGxvYWRDYXJkQmFjayhjYil7XG4gICAgICAgIFV0aWxzLmxvYWRSZXModGhpcy5iZy5nZXRDb21wb25lbnQoY2MuU3ByaXRlKSwgXCJpbWFnZXMvYmFjY2FyYXQvY2FyZHMvY2FyZF91cFwiLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZiAoY2Ipe1xuICAgICAgICAgICAgICAgIGNiKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgfSxcbiAgICBfbG9hZENhcmQoKXtcbiAgICAgICAgVXRpbHMubG9hZFJlcyh0aGlzLmJnLmdldENvbXBvbmVudChjYy5TcHJpdGUpLCBcImltYWdlcy9iYWNjYXJhdC9jYXJkcy9cIit0aGlzLl9jYXJkLm5hbWVGaWxlKVxuICAgIH0sXG4gICAgaW5pdChjYXJkLCBfcmVtb3ZlU2VsZWN0KXtcbiAgICAgICAgdGhpcy5ub2RlLmFjdGl2ZSA9IHRydWU7XG4gICAgICAgIGlmKGNhcmQgPT0gbnVsbCl7XG4gICAgICAgICAgICB0aGlzLmxvYWRDYXJkQmFjaygpO1xuICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgIHRoaXMuX2NhcmQgPSBjYXJkO1xuICAgICAgICAgICAgaWYoX3JlbW92ZVNlbGVjdCAhPSB1bmRlZmluZWQpe1xuICAgICAgICAgICAgICAgIHRoaXMuX3JlbW92ZVNlbGVjdCA9IF9yZW1vdmVTZWxlY3Q7XG4gICAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICAgICB0aGlzLl9yZW1vdmVTZWxlY3QgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5fbG9hZENhcmQoKTtcbiAgICAgICAgfVxuICAgIH0sXG4gICAgcmV2ZWFsKGNhcmQsIHBJc0ZhY2VVcCwgY2Ipe1xuICAgICAgICB0aGlzLm5vZGUuYWN0aXZlID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5sb2FkQ2FyZEJhY2soKTtcbiAgICAgICAgdGhpcy5fY2FyZCA9IGNhcmQ7XG4gICAgICAgIGxldCBzZWxmID0gdGhpcztcbiAgICAgICAgbGV0IHRpbWVGbGlwID0gMC40NTtcbiAgICAgICAgbGV0IGNhbGxGdW5jID0gY2MuY2FsbEZ1bmMoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgc2VsZi5fbG9hZENhcmQoKTtcbiAgICAgICAgICAgIGlmKCFwSXNGYWNlVXApXG4gICAgICAgICAgICAgICAgc2VsZi5ub2RlLnNrZXdZID0gMTcwO1xuICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgIHNlbGYubm9kZS5za2V3WSA9IDQ1O1xuICAgICAgICB9KTtcbiAgICAgICAgaWYoIXBJc0ZhY2VVcClcbiAgICAgICAge1xuICAgICAgICAgICAgc2VsZi5ub2RlLnNrZXdZID0gMDtcbiAgICAgICAgICAgIGxldCBhY3Rpb24gPSBjYy5za2V3QnkodGltZUZsaXAvMiwwLDEwKTtcbiAgICAgICAgICAgIGxldCBhY3Rpb24yID0gY2Muc2tld1RvKHRpbWVGbGlwLzIsMCwxODApO1xuICAgICAgICAgICAgc2VsZi5ub2RlLnJ1bkFjdGlvbihjYy5zZXF1ZW5jZShjYy5kZWxheVRpbWUoMSksIGFjdGlvbixjYWxsRnVuYyxhY3Rpb24yLCBjYy5kZWxheVRpbWUoMC41KSwgY2MuY2FsbEZ1bmMoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGlmIChjYilcbiAgICAgICAgICAgICAgICAgICAgY2IoKTtcbiAgICAgICAgICAgIH0pKSk7XG4gICAgICAgIH1lbHNlXG4gICAgICAgIHtcbiAgICAgICAgICAgIHNlbGYubm9kZS5za2V3WSA9IDE4MDtcbiAgICAgICAgICAgIGxldCBhY3Rpb24gPSBjYy5za2V3QnkodGltZUZsaXAvMiwwLC0zNSk7XG4gICAgICAgICAgICBsZXQgYWN0aW9uMiA9IGNjLnNrZXdUbyh0aW1lRmxpcC8yLDAsMCk7XG4gICAgICAgICAgICBzZWxmLm5vZGUucnVuQWN0aW9uKGNjLnNlcXVlbmNlKGNjLmRlbGF5VGltZSgxKSwgYWN0aW9uLGNhbGxGdW5jLGFjdGlvbjIsIGNjLmRlbGF5VGltZSgwLjUpLCBjYy5jYWxsRnVuYyhmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgaWYgKGNiKVxuICAgICAgICAgICAgICAgICAgICBjYigpO1xuICAgICAgICAgICAgfSkpKTtcbiAgICAgICAgfVxuICAgIH0sXG4gICAgc3dpdGNoQ2FyZChwSXNGYWNlVXApIHtcbiAgICAgICAgbGV0IHNlbGYgPSB0aGlzO1xuICAgICAgICBsZXQgdGltZUZsaXAgPSAwLjQ1O1xuICAgICAgICBsZXQgY2FsbEZ1bmMgPSBjYy5jYWxsRnVuYyhmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBzZWxmLl9sb2FkQ2FyZCgpO1xuICAgICAgICAgICAgaWYoIXBJc0ZhY2VVcClcbiAgICAgICAgICAgICAgICBzZWxmLm5vZGUuc2tld1kgPSAxNzA7XG4gICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgc2VsZi5ub2RlLnNrZXdZID0gNDU7XG4gICAgICAgIH0pO1xuICAgICAgICBzZWxmLm5vZGUuc2tld1kgPSAwO1xuICAgICAgICBsZXQgYWN0aW9uID0gY2Muc2tld0J5KHRpbWVGbGlwLzIsMCwxMCk7XG4gICAgICAgIGxldCBhY3Rpb24yID0gY2Muc2tld1RvKHRpbWVGbGlwLzIsMCwxODApO1xuICAgICAgICBzZWxmLm5vZGUucnVuQWN0aW9uKGNjLnNlcXVlbmNlKGFjdGlvbixjYWxsRnVuYyxhY3Rpb24yKSk7XG4gICAgICAgIGlmKCFwSXNGYWNlVXApXG4gICAgICAgIHtcbiAgICAgICAgICAgIHNlbGYubm9kZS5za2V3WSA9IDA7XG4gICAgICAgICAgICBsZXQgYWN0aW9uID0gY2Muc2tld0J5KHRpbWVGbGlwLzIsMCwxMCk7XG4gICAgICAgICAgICBsZXQgYWN0aW9uMiA9IGNjLnNrZXdUbyh0aW1lRmxpcC8yLDAsMTgwKTtcbiAgICAgICAgICAgIHNlbGYubm9kZS5ydW5BY3Rpb24oY2Muc2VxdWVuY2UoYWN0aW9uLGNhbGxGdW5jLGFjdGlvbjIpKTtcbiAgICAgICAgfWVsc2VcbiAgICAgICAge1xuICAgICAgICAgICAgc2VsZi5ub2RlLnNrZXdZID0gMTgwO1xuICAgICAgICAgICAgbGV0IGFjdGlvbiA9IGNjLnNrZXdCeSh0aW1lRmxpcC8yLDAsLTM1KTtcbiAgICAgICAgICAgIGxldCBhY3Rpb24yID0gY2Muc2tld1RvKHRpbWVGbGlwLzIsMCwwKTtcbiAgICAgICAgICAgIHNlbGYubm9kZS5ydW5BY3Rpb24oY2Muc2VxdWVuY2UoYWN0aW9uLGNhbGxGdW5jLGFjdGlvbjIpKTtcbiAgICAgICAgfVxuICAgIH0sXG4gICAgcmVzZXQoKXtcbiAgICAgICAgdGhpcy5sb2FkQ2FyZEJhY2soKTtcbiAgICAgICAgdGhpcy5ub2RlLl96SW5kZXggPSAwO1xuICAgICAgICB0aGlzLm5vZGUueCA9IDA7XG4gICAgICAgIHRoaXMubm9kZS55ID0gMDtcbiAgICAgICAgdGhpcy5faXNTZWxlY3RlZCA9IGZhbHNlO1xuICAgICAgICB0aGlzLl9jYXJkID0gbnVsbDtcbiAgICAgICAgdGhpcy5fY2JTZWxlY3QgPSBudWxsO1xuICAgICAgICB0aGlzLl9yZW1vdmVTZWxlY3QgPSB0cnVlO1xuICAgIH0sXG4gICAgZXZlbnRTZWxlY3QoKXtcbiAgICAgICAgbW0uYXVkaW8ucGxheUJ1dHRvbigpO1xuICAgICAgICBpZighdGhpcy5fcmVtb3ZlU2VsZWN0KXtcbiAgICAgICAgICAgIGlmKCF0aGlzLl9pc1NlbGVjdGVkKXtcbiAgICAgICAgICAgICAgICB0aGlzLl9pc1NlbGVjdGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB0aGlzLm5vZGUueSA9IHRoaXMubm9kZS55ICsgMjA7XG4gICAgICAgICAgICAgICAgaWYodGhpcy5fY2JTZWxlY3Qpe1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9jYlNlbGVjdCh0aGlzLmdldENhcmQoKS5pZCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAgICAgdGhpcy5faXNTZWxlY3RlZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIHRoaXMubm9kZS55ID0gdGhpcy5ub2RlLnkgLSAyMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0sXG4gICAgc2V0U2NhbGVDYXJkKHNjYWxlQ2FyZCl7XG4gICAgICAgIHRoaXMubm9kZS53aWR0aCAgKj0gc2NhbGVDYXJkO1xuICAgICAgICB0aGlzLm5vZGUuaGVpZ2h0ICo9IHNjYWxlQ2FyZDtcbiAgICB9XG59KTtcbiJdfQ==