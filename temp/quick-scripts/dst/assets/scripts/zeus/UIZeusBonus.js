
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/scripts/zeus/UIZeusBonus.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, 'f9e8bpyjAVNmoOJW0dkn31Q', 'UIZeusBonus');
// scripts/zeus/UIZeusBonus.js

"use strict";

var Helper = require("Helper");

cc.Class({
  "extends": cc.VozBaseComponent,
  properties: {
    lbTime: cc.Label,
    lbMoneyWin: cc.Label,
    lbTotalWin: cc.Label,
    specialSelect: cc.Node,
    resultWin: cc.Node,
    totalMoneyWin: 0,
    totalSelect: 0,
    totalTime: 15,
    listItemX: {
      type: cc.Node,
      "default": []
    },
    listXSpecial: {
      type: cc.SpriteFrame,
      "default": []
    },
    gifts: [],
    xSpecial: 0
  },
  onEnable: function onEnable() {
    this.gifts = this._data.gifts;
    this.xSpecial = this._data.xSpecial;
    this.totalTime = 20;
    this.totalMoneyWin = 0;
    this.specialSelect.active = false;
    this.resultWin.active = false;
    this.totalSelect = this.gifts.length;
    this.lbTime.string = this.totalTime;
    this.schedule(this.countTime, 1);
  },
  countTime: function countTime() {
    this.totalTime--;

    if (this.totalTime < 1) {
      this.unschedule(this.countTime);
      this.eventClose();
    }

    this.lbTime.string = this.totalTime;
  },
  showMoneyWin: function showMoneyWin() {
    this.scheduleOnce(function () {
      this.specialSelect.active = true;
      Promise.all(this.listItemX.map(function (itemX, index) {
        itemX.active = true;
      }));
    }, 1);
  },
  eventSelect: function eventSelect(event, data) {
    if (this.totalSelect > 0) {
      this.totalSelect--;

      if (this.gifts[this.totalSelect] > 0) {
        event.target.getChildByName("lb_money").active = true;
        event.target.getChildByName("Zeus-BonusGame").getComponent(sp.Skeleton).setAnimation(0, "Attack", false);
        var lastMoney = this.totalMoneyWin;
        this.totalMoneyWin += this.gifts[this.totalSelect];
        Helper.numberTo(event.target.getChildByName("lb_money").getComponent(cc.Label), 0, this.gifts[this.totalSelect], 1200, true);
        Helper.numberTo(this.lbMoneyWin, lastMoney, this.totalMoneyWin, 1200, true);
      } else {
        event.target.getChildByName("Zeus-BonusGame").getComponent(sp.Skeleton).setAnimation(0, "Idle-Miss", false);
      }

      if (this.totalSelect == 0) {
        this.showMoneyWin();
      }
    }
  },
  eventClose: function eventClose() {
    this.back();
  },
  eventSelectSpecial: function eventSelectSpecial(event, data) {
    var self = this;
    var pos = parseInt(data);
    this.listItemX[pos].getComponent(sp.Skeleton).setAnimation(0, "Attack", false);
    this.listItemX[pos].getComponent(sp.Skeleton).setCompleteListener(function (trackEntry, loopCount) {
      var xSpecialItem = self.listItemX[pos].getChildByName("xSpecial");
      xSpecialItem.active = true;
      xSpecialItem.getComponent(cc.Sprite).spriteFrame = self.listXSpecial[self.xSpecial - 1];
      self.scheduleOnce(function () {
        Promise.all(this.listItemX.map(function (itemX, index) {
          itemX.active = false;
        }));
        Helper.numberTo(self.lbTotalWin, 0, self._data.total, 500, true);
        self.resultWin.active = true;
        self.scheduleOnce(function () {
          self.eventClose();
        }, 2);
      }, 2);
    });
    self.scheduleOnce(function () {
      var _loop = function _loop(i) {
        if (i != pos) {
          self.listItemX[i].getComponent(sp.Skeleton).setAnimation(0, "Attack", false);
          self.listItemX[i].getComponent(sp.Skeleton).setCompleteListener(function (trackEntry, loopCount) {
            var xSpecialNew = self.listItemX[i].getChildByName("xSpecial");
            xSpecialNew.active = true;
            var ranPos = Math.floor(Math.random() * 5);
            xSpecialNew.getComponent(cc.Sprite).spriteFrame = self.listXSpecial[ranPos];
          });
        }
      };

      for (var i = 0; i < self.listItemX.length; i++) {
        _loop(i);
      }
    }, 0.5);
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcc2NyaXB0c1xcemV1c1xcVUlaZXVzQm9udXMuanMiXSwibmFtZXMiOlsiSGVscGVyIiwicmVxdWlyZSIsImNjIiwiQ2xhc3MiLCJWb3pCYXNlQ29tcG9uZW50IiwicHJvcGVydGllcyIsImxiVGltZSIsIkxhYmVsIiwibGJNb25leVdpbiIsImxiVG90YWxXaW4iLCJzcGVjaWFsU2VsZWN0IiwiTm9kZSIsInJlc3VsdFdpbiIsInRvdGFsTW9uZXlXaW4iLCJ0b3RhbFNlbGVjdCIsInRvdGFsVGltZSIsImxpc3RJdGVtWCIsInR5cGUiLCJsaXN0WFNwZWNpYWwiLCJTcHJpdGVGcmFtZSIsImdpZnRzIiwieFNwZWNpYWwiLCJvbkVuYWJsZSIsIl9kYXRhIiwiYWN0aXZlIiwibGVuZ3RoIiwic3RyaW5nIiwic2NoZWR1bGUiLCJjb3VudFRpbWUiLCJ1bnNjaGVkdWxlIiwiZXZlbnRDbG9zZSIsInNob3dNb25leVdpbiIsInNjaGVkdWxlT25jZSIsIlByb21pc2UiLCJhbGwiLCJtYXAiLCJpdGVtWCIsImluZGV4IiwiZXZlbnRTZWxlY3QiLCJldmVudCIsImRhdGEiLCJ0YXJnZXQiLCJnZXRDaGlsZEJ5TmFtZSIsImdldENvbXBvbmVudCIsInNwIiwiU2tlbGV0b24iLCJzZXRBbmltYXRpb24iLCJsYXN0TW9uZXkiLCJudW1iZXJUbyIsImJhY2siLCJldmVudFNlbGVjdFNwZWNpYWwiLCJzZWxmIiwicG9zIiwicGFyc2VJbnQiLCJzZXRDb21wbGV0ZUxpc3RlbmVyIiwidHJhY2tFbnRyeSIsImxvb3BDb3VudCIsInhTcGVjaWFsSXRlbSIsIlNwcml0ZSIsInNwcml0ZUZyYW1lIiwidG90YWwiLCJpIiwieFNwZWNpYWxOZXciLCJyYW5Qb3MiLCJNYXRoIiwiZmxvb3IiLCJyYW5kb20iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsSUFBSUEsTUFBTSxHQUFHQyxPQUFPLENBQUMsUUFBRCxDQUFwQjs7QUFDQUMsRUFBRSxDQUFDQyxL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IEhlbHBlciA9IHJlcXVpcmUoXCJIZWxwZXJcIik7XHJcbmNjLkNsYXNzKHtcclxuICAgIGV4dGVuZHM6IGNjLlZvekJhc2VDb21wb25lbnQsXHJcblxyXG4gICAgcHJvcGVydGllczoge1xyXG4gICAgICAgIGxiVGltZSAgICAgIDogY2MuTGFiZWwsXHJcbiAgICAgICAgbGJNb25leVdpbiAgOiBjYy5MYWJlbCxcclxuICAgICAgICBsYlRvdGFsV2luICA6IGNjLkxhYmVsLFxyXG4gICAgICAgIHNwZWNpYWxTZWxlY3QgICA6IGNjLk5vZGUsXHJcbiAgICAgICAgcmVzdWx0V2luICAgOiBjYy5Ob2RlLFxyXG4gICAgICAgIHRvdGFsTW9uZXlXaW4gOiAwLFxyXG4gICAgICAgIHRvdGFsU2VsZWN0IDogMCxcclxuICAgICAgICB0b3RhbFRpbWUgICA6IDE1LFxyXG4gICAgICAgIGxpc3RJdGVtWCAgOiB7XHJcbiAgICAgICAgICAgIHR5cGU6IGNjLk5vZGUsXHJcbiAgICAgICAgICAgIGRlZmF1bHQ6IFtdXHJcbiAgICAgICAgfSxcclxuICAgICAgICBsaXN0WFNwZWNpYWwgIDoge1xyXG4gICAgICAgICAgICB0eXBlOiBjYy5TcHJpdGVGcmFtZSxcclxuICAgICAgICAgICAgZGVmYXVsdDogW11cclxuICAgICAgICB9LFxyXG4gICAgICAgIGdpZnRzICAgOiBbXSxcclxuICAgICAgICB4U3BlY2lhbCAgIDogMCxcclxuICAgIH0sXHJcbiAgICBvbkVuYWJsZSAoKSB7XHJcbiAgICAgICAgdGhpcy5naWZ0cyAgICAgICAgICAgICAgPSB0aGlzLl9kYXRhLmdpZnRzO1xyXG4gICAgICAgIHRoaXMueFNwZWNpYWwgICAgICAgICAgID0gdGhpcy5fZGF0YS54U3BlY2lhbDtcclxuICAgICAgICB0aGlzLnRvdGFsVGltZSAgICAgICAgICA9IDIwO1xyXG4gICAgICAgIHRoaXMudG90YWxNb25leVdpbiAgICAgID0gMDtcclxuICAgICAgICB0aGlzLnNwZWNpYWxTZWxlY3QuYWN0aXZlICAgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLnJlc3VsdFdpbi5hY3RpdmUgICAgICAgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLnRvdGFsU2VsZWN0ICAgICAgICA9IHRoaXMuZ2lmdHMubGVuZ3RoO1xyXG4gICAgICAgIHRoaXMubGJUaW1lLnN0cmluZyAgICAgID0gdGhpcy50b3RhbFRpbWU7XHJcbiAgICAgICAgdGhpcy5zY2hlZHVsZSh0aGlzLmNvdW50VGltZSwgMSk7XHJcbiAgICB9LFxyXG4gICAgY291bnRUaW1lKCkge1xyXG4gICAgICAgIHRoaXMudG90YWxUaW1lLS07XHJcbiAgICAgICAgaWYgKCB0aGlzLnRvdGFsVGltZSA8IDEpe1xyXG4gICAgICAgICAgICB0aGlzLnVuc2NoZWR1bGUodGhpcy5jb3VudFRpbWUpO1xyXG4gICAgICAgICAgICB0aGlzLmV2ZW50Q2xvc2UoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5sYlRpbWUuc3RyaW5nICAgICAgPSB0aGlzLnRvdGFsVGltZTtcclxuICAgIH0sXHJcbiAgICBzaG93TW9uZXlXaW4oKSB7XHJcbiAgICAgICAgdGhpcy5zY2hlZHVsZU9uY2UoZnVuY3Rpb24gKCl7XHJcbiAgICAgICAgICAgIHRoaXMuc3BlY2lhbFNlbGVjdC5hY3RpdmUgICA9IHRydWU7XHJcbiAgICAgICAgICAgIFByb21pc2UuYWxsKHRoaXMubGlzdEl0ZW1YLm1hcChmdW5jdGlvbiAoaXRlbVgsIGluZGV4KSB7XHJcbiAgICAgICAgICAgICAgICBpdGVtWC5hY3RpdmUgPSB0cnVlO1xyXG4gICAgICAgICAgICB9KSk7XHJcbiAgICAgICAgfSwgMSk7XHJcbiAgICB9LFxyXG4gICAgZXZlbnRTZWxlY3QoZXZlbnQsIGRhdGEpIHtcclxuICAgICAgICBpZiAodGhpcy50b3RhbFNlbGVjdCA+IDApe1xyXG4gICAgICAgICAgICB0aGlzLnRvdGFsU2VsZWN0LS07XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmdpZnRzW3RoaXMudG90YWxTZWxlY3RdID4gMCl7XHJcbiAgICAgICAgICAgICAgICBldmVudC50YXJnZXQuZ2V0Q2hpbGRCeU5hbWUoXCJsYl9tb25leVwiKS5hY3RpdmUgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgZXZlbnQudGFyZ2V0LmdldENoaWxkQnlOYW1lKFwiWmV1cy1Cb251c0dhbWVcIikuZ2V0Q29tcG9uZW50KHNwLlNrZWxldG9uKS5zZXRBbmltYXRpb24oMCwgXCJBdHRhY2tcIiwgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgbGV0IGxhc3RNb25leSA9IHRoaXMudG90YWxNb25leVdpbjtcclxuICAgICAgICAgICAgICAgIHRoaXMudG90YWxNb25leVdpbiArPSB0aGlzLmdpZnRzW3RoaXMudG90YWxTZWxlY3RdO1xyXG4gICAgICAgICAgICAgICAgSGVscGVyLm51bWJlclRvKGV2ZW50LnRhcmdldC5nZXRDaGlsZEJ5TmFtZShcImxiX21vbmV5XCIpLmdldENvbXBvbmVudChjYy5MYWJlbCksIDAgLCB0aGlzLmdpZnRzW3RoaXMudG90YWxTZWxlY3RdLCAxMjAwLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgIEhlbHBlci5udW1iZXJUbyh0aGlzLmxiTW9uZXlXaW4sIGxhc3RNb25leSAsIHRoaXMudG90YWxNb25leVdpbiwgMTIwMCwgdHJ1ZSk7XHJcbiAgICAgICAgICAgIH0gZWxzZXtcclxuICAgICAgICAgICAgICAgIGV2ZW50LnRhcmdldC5nZXRDaGlsZEJ5TmFtZShcIlpldXMtQm9udXNHYW1lXCIpLmdldENvbXBvbmVudChzcC5Ta2VsZXRvbikuc2V0QW5pbWF0aW9uKDAsIFwiSWRsZS1NaXNzXCIsIGZhbHNlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAodGhpcy50b3RhbFNlbGVjdCA9PSAwKXtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2hvd01vbmV5V2luKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9LFxyXG4gICAgZXZlbnRDbG9zZSgpIHtcclxuICAgICAgICB0aGlzLmJhY2soKTtcclxuICAgIH0sXHJcbiAgICBldmVudFNlbGVjdFNwZWNpYWwoZXZlbnQsIGRhdGEpIHtcclxuICAgICAgICBsZXQgc2VsZiA9IHRoaXM7XHJcbiAgICAgICAgbGV0IHBvcyA9IHBhcnNlSW50KGRhdGEpO1xyXG4gICAgICAgIHRoaXMubGlzdEl0ZW1YW3Bvc10uZ2V0Q29tcG9uZW50KHNwLlNrZWxldG9uKS5zZXRBbmltYXRpb24oMCwgXCJBdHRhY2tcIiwgZmFsc2UpO1xyXG4gICAgICAgIHRoaXMubGlzdEl0ZW1YW3Bvc10uZ2V0Q29tcG9uZW50KHNwLlNrZWxldG9uKS5zZXRDb21wbGV0ZUxpc3RlbmVyKCh0cmFja0VudHJ5LCBsb29wQ291bnQpID0+IHtcclxuICAgICAgICAgICAgbGV0IHhTcGVjaWFsSXRlbSA9IHNlbGYubGlzdEl0ZW1YW3Bvc10uZ2V0Q2hpbGRCeU5hbWUoXCJ4U3BlY2lhbFwiKTtcclxuICAgICAgICAgICAgeFNwZWNpYWxJdGVtLmFjdGl2ZSA9IHRydWU7XHJcbiAgICAgICAgICAgIHhTcGVjaWFsSXRlbS5nZXRDb21wb25lbnQoY2MuU3ByaXRlKS5zcHJpdGVGcmFtZSA9IHNlbGYubGlzdFhTcGVjaWFsW3NlbGYueFNwZWNpYWwtMV07XHJcbiAgICAgICAgICAgIHNlbGYuc2NoZWR1bGVPbmNlKGZ1bmN0aW9uICgpe1xyXG4gICAgICAgICAgICAgICAgUHJvbWlzZS5hbGwodGhpcy5saXN0SXRlbVgubWFwKGZ1bmN0aW9uIChpdGVtWCwgaW5kZXgpIHtcclxuICAgICAgICAgICAgICAgICAgICBpdGVtWC5hY3RpdmUgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH0pKTtcclxuICAgICAgICAgICAgICAgIEhlbHBlci5udW1iZXJUbyhzZWxmLmxiVG90YWxXaW4sIDAgLCBzZWxmLl9kYXRhLnRvdGFsLCA1MDAsIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgc2VsZi5yZXN1bHRXaW4uYWN0aXZlICAgID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIHNlbGYuc2NoZWR1bGVPbmNlKGZ1bmN0aW9uICgpe1xyXG4gICAgICAgICAgICAgICAgICAgIHNlbGYuZXZlbnRDbG9zZSgpO1xyXG4gICAgICAgICAgICAgICAgfSwgMik7XHJcbiAgICAgICAgICAgIH0sIDIpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHNlbGYuc2NoZWR1bGVPbmNlKGZ1bmN0aW9uICgpe1xyXG4gICAgICAgICAgICBmb3IgKGxldCBpPTA7IGk8IHNlbGYubGlzdEl0ZW1YLmxlbmd0aDsgaSsrKXtcclxuICAgICAgICAgICAgICAgIGlmIChpICE9IHBvcyl7XHJcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5saXN0SXRlbVhbaV0uZ2V0Q29tcG9uZW50KHNwLlNrZWxldG9uKS5zZXRBbmltYXRpb24oMCwgXCJBdHRhY2tcIiwgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgIHNlbGYubGlzdEl0ZW1YW2ldLmdldENvbXBvbmVudChzcC5Ta2VsZXRvbikuc2V0Q29tcGxldGVMaXN0ZW5lcigodHJhY2tFbnRyeSwgbG9vcENvdW50KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCB4U3BlY2lhbE5ldyA9IHNlbGYubGlzdEl0ZW1YW2ldLmdldENoaWxkQnlOYW1lKFwieFNwZWNpYWxcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHhTcGVjaWFsTmV3LmFjdGl2ZSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCByYW5Qb3MgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkqNSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHhTcGVjaWFsTmV3LmdldENvbXBvbmVudChjYy5TcHJpdGUpLnNwcml0ZUZyYW1lID0gc2VsZi5saXN0WFNwZWNpYWxbcmFuUG9zXTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0sIDAuNSk7XHJcbiAgICB9XHJcbn0pO1xyXG4iXX0=