
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/scripts/abase/BaseGame.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, 'ca0723sVk5KNYGPH7Sc5VSZ', 'BaseGame');
// scripts/abase/BaseGame.js

"use strict";

cc.BaseGame = cc.Class({
  "extends": cc.VozBaseComponent,
  properties: {
    poses: {
      "default": [],
      type: cc.Node
    },
    nodePlayers: cc.Node,
    WaitingTimer: cc.Node,
    BaseController: cc.Node,
    prefabPlayer: cc.Prefab,
    _number_desk: 4,
    _CURRENT_POS: cc.Node,
    controller: null,
    _room: null,
    lb_bet_title: cc.Label,
    lb_id_table: cc.Label
  },
  requestLeaveRoom: function requestLeaveRoom() {
    mm.Loading.show();
    this.controller.ZoneInstance.send(new SmartFoxSDK.SmartFox.Requests.System.LeaveRoomRequest(this._room));
  },
  setInfoTable: function setInfoTable(table_name, table_bet) {
    this.lb_id_table.string = table_name;
    this.lb_bet_title.string = table_bet;
  },
  eventBack: function eventBack() {},
  setWaitingTimer: function setWaitingTimer(isOn, totalProcess, currentProcess) {
    if (isOn) {
      this.WaitingTimer.active = true;
      var timer = this.WaitingTimer.getComponent(this.WaitingTimer.name);
      timer.setTotalProgress(totalProcess);
      timer.setCurrentProgress(currentProcess);
      timer.turnOnTimer();
    } else {
      this.WaitingTimer.active = false;
    }
  },
  showDeskEmpty: function showDeskEmpty() {
    if (this._isPlayer(this.controller.ZoneInstance.mySelf.name)) return;

    for (var i = 0; i < this._CURRENT_POS._children.length; i++) {
      var player = this._getJSPlayerById(i);

      if (!player) {
        this._CURRENT_POS._children[i].active = true;
      }
    }
  },
  hideDeskEmpty: function hideDeskEmpty() {
    for (var i = 0; i < this._number_desk; i++) {
      var player = this._getJSPlayerById(i);

      if (!player) {
        this._CURRENT_POS._children[i].active = false;
      }
    }
  },
  _changeToMyView: function _changeToMyView() {
    if (this._isPlayer(this.controller.ZoneInstance.mySelf.name)) {
      var myId = this._getPlayerId(this.controller.ZoneInstance.mySelf.name);

      var myPos = myId;
      var maxUsers = this._number_desk;
      var distanceToZero = maxUsers - myPos;

      for (var i = 0; i < maxUsers; i++) {
        var nodePlayer = this._getNodePlayerById(i);

        if (cc.isValid(nodePlayer)) {
          var newIndex = (i + distanceToZero) % maxUsers;
          nodePlayer.position = this.poses[newIndex];

          var js = this._getJSPlayer(nodePlayer);

          js.newPos = newIndex;
          js.number_desk = this._number_desk;
          js.updatePosHand();
        }
      }
    }
  },
  _updateNodePlayers: function _updateNodePlayers(m_listDesk) {
    // process List Desk for player
    for (var i = 0; i < m_listDesk.length; i++) {
      var desk = m_listDesk[i];

      var nodePlayer = this._getNodePlayerById(desk.DeskId);

      if (nodePlayer == null) {
        nodePlayer = cc.instantiate(this.prefabPlayer);
        this.nodePlayers.addChild(nodePlayer);
      }

      nodePlayer.position = this.poses[desk.DeskId].position;
      nodePlayer.playerId = desk.DeskId;
      desk.displayName = GameVariables.getDisplayName(this._room.getUserByName(desk.UserName));

      this._getJSPlayer(nodePlayer).setDesk(desk);
    }

    this._changeToMyView();
  },
  removePlayer: function removePlayer(userOut) {
    // remove player in active
    // remove desk in listDesk mm.mm_tableInfo
    // remove user in mm.m_tableInfo.m_listUser
    for (var i = 0; i < userOut.length; i++) {
      var player = this._getJSPlayerByName(userOut);

      if (player && player.getDesk().UserName == userOut[i]) {
        this._removeNodePlayerById(player.getDesk().DeskId);

        this.controller.m_tableInfo.m_listDesk.splice(this.controller.m_tableInfo.m_listDesk.indexOf(player.getDesk()), 1);
        this.controller.m_tableInfo.m_listUser.splice(this.controller.m_tableInfo.m_listUser.indexOf(userOut[i]), 1);
      }
    }
  },
  turnOffAllTimerPlayers: function turnOffAllTimerPlayers() {
    if (this.controller.m_tableInfo && this.controller.m_tableInfo.m_listActiveUserName) {
      for (var i = 0; i < this.controller.m_tableInfo.m_listActiveUserName.length; i++) {
        var player = this._getJSPlayerByName(this.controller.m_tableInfo.m_listActiveUserName[i]);

        if (player) {
          player.turnOffTimer();
        }
      }
    }
  },
  _getNodePlayerById: function _getNodePlayerById(idPlayer) {
    for (var i = 0; i < this.nodePlayers._children.length; i++) {
      if (this.nodePlayers._children[i].playerId == idPlayer) {
        return this.nodePlayers._children[i];
      }
    }

    return null;
  },
  _removeNodePlayerById: function _removeNodePlayerById(idPlayer) {
    for (var i = 0; i < this.nodePlayers._children.length; i++) {
      if (this.nodePlayers._children[i].playerId == idPlayer) {
        this.nodePlayers._children[i].active = false;
        this.nodePlayers.removeChild(this.nodePlayers._children[i], true);
        break;
      }
    }
  },
  _getJSPlayer: function _getJSPlayer(nodePlayer) {
    return nodePlayer.getComponent(nodePlayer.name);
  },
  _getJSPlayerById: function _getJSPlayerById(idPlayer) {
    var nodePlayer = this._getNodePlayerById(idPlayer);

    if (cc.isValid(nodePlayer)) return this._getJSPlayer(nodePlayer);
    return null;
  },
  _getJSPlayerByName: function _getJSPlayerByName(username) {
    var deskId = this._getPlayerId(username);

    var player = this._getJSPlayerById(deskId);

    return player;
  },
  _getPlayerId: function _getPlayerId(username) {
    if (this.controller.m_tableInfo && this.controller.m_tableInfo.m_listDesk) {
      for (var i = 0; i < this.controller.m_tableInfo.m_listDesk.length; i++) {
        var desk = this.controller.m_tableInfo.m_listDesk[i];

        if (desk.UserName == username) {
          return desk.DeskId;
        }
      }
    }

    return -1;
  },
  _isPlayer: function _isPlayer(username) {
    if (this.controller.m_tableInfo && this.controller.m_tableInfo.m_listDesk) {
      for (var i = 0; i < this.controller.m_tableInfo.m_listDesk.length; i++) {
        var desk = this.controller.m_tableInfo.m_listDesk[i];

        if (desk.UserName == username) {
          return true;
        }
      }
    }

    return false;
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0cy9zY3JpcHRzL2FiYXNlL0Jhc2VHYW1lLmpzIl0sIm5hbWVzIjpbImNjIiwiQmFzZUdhbWUiLCJDbGFzcyIsIlZvekJhc2VDb21wb25lbnQiLCJwcm9wZXJ0aWVzIiwicG9zZXMiLCJ0eXBlIiwiTm9kZSIsIm5vZGVQbGF5ZXJzIiwiV2FpdGluZ1RpbWVyIiwiQmFzZUNvbnRyb2xsZXIiLCJwcmVmYWJQbGF5ZXIiLCJQcmVmYWIiLCJfbnVtYmVyX2Rlc2siLCJfQ1VSUkVOVF9QT1MiLCJjb250cm9sbGVyIiwiX3Jvb20iLCJsYl9iZXRfdGl0bGUiLCJMYWJlbCIsImxiX2lkX3RhYmxlIiwicmVxdWVzdExlYXZlUm9vbSIsIm1tIiwiTG9hZGluZyIsInNob3ciLCJab25lSW5zdGFuY2UiLCJzZW5kIiwiU21hcnRGb3hTREsiLCJTbWFydEZveCIsIlJlcXVlc3RzIiwiU3lzdGVtIiwiTGVhdmVSb29tUmVxdWVzdCIsInNldEluZm9UYWJsZSIsInRhYmxlX25hbWUiLCJ0YWJsZV9iZXQiLCJzdHJpbmciLCJldmVudEJhY2siLCJzZXRXYWl0aW5nVGltZXIiLCJpc09uIiwidG90YWxQcm9jZXNzIiwiY3VycmVudFByb2Nlc3MiLCJhY3RpdmUiLCJ0aW1lciIsImdldENvbXBvbmVudCIsIm5hbWUiLCJzZXRUb3RhbFByb2dyZXNzIiwic2V0Q3VycmVudFByb2dyZXNzIiwidHVybk9uVGltZXIiLCJzaG93RGVza0VtcHR5IiwiX2lzUGxheWVyIiwibXlTZWxmIiwiaSIsIl9jaGlsZHJlbiIsImxlbmd0aCIsInBsYXllciIsIl9nZXRKU1BsYXllckJ5SWQiLCJoaWRlRGVza0VtcHR5IiwiX2NoYW5nZVRvTXlWaWV3IiwibXlJZCIsIl9nZXRQbGF5ZXJJZCIsIm15UG9zIiwibWF4VXNlcnMiLCJkaXN0YW5jZVRvWmVybyIsIm5vZGVQbGF5ZXIiLCJfZ2V0Tm9kZVBsYXllckJ5SWQiLCJpc1ZhbGlkIiwibmV3SW5kZXgiLCJwb3NpdGlvbiIsImpzIiwiX2dldEpTUGxheWVyIiwibmV3UG9zIiwibnVtYmVyX2Rlc2siLCJ1cGRhdGVQb3NIYW5kIiwiX3VwZGF0ZU5vZGVQbGF5ZXJzIiwibV9saXN0RGVzayIsImRlc2siLCJEZXNrSWQiLCJpbnN0YW50aWF0ZSIsImFkZENoaWxkIiwicGxheWVySWQiLCJkaXNwbGF5TmFtZSIsIkdhbWVWYXJpYWJsZXMiLCJnZXREaXNwbGF5TmFtZSIsImdldFVzZXJCeU5hbWUiLCJVc2VyTmFtZSIsInNldERlc2siLCJyZW1vdmVQbGF5ZXIiLCJ1c2VyT3V0IiwiX2dldEpTUGxheWVyQnlOYW1lIiwiZ2V0RGVzayIsIl9yZW1vdmVOb2RlUGxheWVyQnlJZCIsIm1fdGFibGVJbmZvIiwic3BsaWNlIiwiaW5kZXhPZiIsIm1fbGlzdFVzZXIiLCJ0dXJuT2ZmQWxsVGltZXJQbGF5ZXJzIiwibV9saXN0QWN0aXZlVXNlck5hbWUiLCJ0dXJuT2ZmVGltZXIiLCJpZFBsYXllciIsInJlbW92ZUNoaWxkIiwidXNlcm5hbWUiLCJkZXNrSWQiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUFBLEVBQUUsQ0FBQ0MsUUFBSCxHQUFjRCxFQUFFLENBQUNFLEtBQUgsQ0FBUztBQUNuQixhQUFTRixFQUFFLENBQUNHLGdCQURPO0FBR25CQyxFQUFBQSxVQUFVLEVBQUU7QUFDUkMsSUFBQUEsS0FBSyxFQUFFO0FBQ0gsaUJBQVMsRUFETjtBQUVIQyxNQUFBQSxJQUFJLEVBQUVOLEVBQUUsQ0FBQ087QUFGTixLQURDO0FBS1JDLElBQUFBLFdBQVcsRUFBRVIsRUFBRSxDQUFDTyxJQUxSO0FBTVJFLElBQUFBLFlBQVksRUFBRVQsRUFBRSxDQUFDTyxJQU5UO0FBT1JHLElBQUFBLGNBQWMsRUFBRVYsRUFBRSxDQUFDTyxJQVBYO0FBUVJJLElBQUFBLFlBQVksRUFBRVgsRUFBRSxDQUFDWSxNQVJUO0FBU1JDLElBQUFBLFlBQVksRUFBRSxDQVROO0FBVVJDLElBQUFBLFlBQVksRUFBRWQsRUFBRSxDQUFDTyxJQVZUO0FBV1JRLElBQUFB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bEUsRUFBcUU7QUFDakUsWUFBSXdCLElBQUksR0FBRyxLQUFLM0QsVUFBTCxDQUFnQjJFLFdBQWhCLENBQTRCakIsVUFBNUIsQ0FBdUN2QixDQUF2QyxDQUFYOztBQUNBLFlBQUd3QixJQUFJLENBQUNTLFFBQUwsSUFBaUJnQixRQUFwQixFQUE2QjtBQUN6QixpQkFBTyxJQUFQO0FBQ0g7QUFDSjtBQUNKOztBQUNELFdBQU8sS0FBUDtBQUNIO0FBMUtrQixDQUFULENBQWQiLCJzb3VyY2VSb290IjoiLyIsInNvdXJjZXNDb250ZW50IjpbImNjLkJhc2VHYW1lID0gY2MuQ2xhc3Moe1xuICAgIGV4dGVuZHM6IGNjLlZvekJhc2VDb21wb25lbnQsXG5cbiAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgIHBvc2VzOiB7XG4gICAgICAgICAgICBkZWZhdWx0OiBbXSxcbiAgICAgICAgICAgIHR5cGU6IGNjLk5vZGVcbiAgICAgICAgfSxcbiAgICAgICAgbm9kZVBsYXllcnM6IGNjLk5vZGUsXG4gICAgICAgIFdhaXRpbmdUaW1lcjogY2MuTm9kZSxcbiAgICAgICAgQmFzZUNvbnRyb2xsZXI6IGNjLk5vZGUsXG4gICAgICAgIHByZWZhYlBsYXllcjogY2MuUHJlZmFiLFxuICAgICAgICBfbnVtYmVyX2Rlc2s6IDQsXG4gICAgICAgIF9DVVJSRU5UX1BPUzogY2MuTm9kZSxcbiAgICAgICAgY29udHJvbGxlcjogbnVsbCxcbiAgICAgICAgX3Jvb206IG51bGwsXG4gICAgICAgIGxiX2JldF90aXRsZTogY2MuTGFiZWwsXG4gICAgICAgIGxiX2lkX3RhYmxlOiBjYy5MYWJlbFxuICAgIH0sXG4gICAgcmVxdWVzdExlYXZlUm9vbSgpe1xuICAgICAgICBtbS5Mb2FkaW5nLnNob3coKTtcbiAgICAgICAgdGhpcy5jb250cm9sbGVyLlpvbmVJbnN0YW5jZS5zZW5kKG5ldyBTbWFydEZveFNESy5TbWFydEZveC5SZXF1ZXN0cy5TeXN0ZW0uTGVhdmVSb29tUmVxdWVzdCh0aGlzLl9yb29tKSk7XG4gICAgfSxcbiAgICBzZXRJbmZvVGFibGUodGFibGVfbmFtZSwgdGFibGVfYmV0KXtcbiAgICAgICAgdGhpcy5sYl9pZF90YWJsZS5zdHJpbmcgPSB0YWJsZV9uYW1lO1xuICAgICAgICB0aGlzLmxiX2JldF90aXRsZS5zdHJpbmcgPSB0YWJsZV9iZXQ7XG4gICAgfSxcbiAgICBldmVudEJhY2soKXtcblxuICAgIH0sXG4gICAgc2V0V2FpdGluZ1RpbWVyKGlzT24sIHRvdGFsUHJvY2VzcywgY3VycmVudFByb2Nlc3Mpe1xuICAgICAgICBpZihpc09uKXtcbiAgICAgICAgICAgIHRoaXMuV2FpdGluZ1RpbWVyLmFjdGl2ZSA9IHRydWU7XG4gICAgICAgICAgICBsZXQgdGltZXIgPSB0aGlzLldhaXRpbmdUaW1lci5nZXRDb21wb25lbnQodGhpcy5XYWl0aW5nVGltZXIubmFtZSk7XG4gICAgICAgICAgICB0aW1lci5zZXRUb3RhbFByb2dyZXNzKHRvdGFsUHJvY2Vzcyk7XG4gICAgICAgICAgICB0aW1lci5zZXRDdXJyZW50UHJvZ3Jlc3MoY3VycmVudFByb2Nlc3MpO1xuICAgICAgICAgICAgdGltZXIudHVybk9uVGltZXIoKTtcbiAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICB0aGlzLldhaXRpbmdUaW1lci5hY3RpdmUgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgIH0sXG4gICAgc2hvd0Rlc2tFbXB0eSgpe1xuICAgICAgICBpZih0aGlzLl9pc1BsYXllcih0aGlzLmNvbnRyb2xsZXIuWm9uZUluc3RhbmNlLm15U2VsZi5uYW1lKSlcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgZm9yKGxldCBpID0gMDsgaSA8IHRoaXMuX0NVUlJFTlRfUE9TLl9jaGlsZHJlbi5sZW5ndGg7IGkrKyl7XG4gICAgICAgICAgICBsZXQgcGxheWVyID0gdGhpcy5fZ2V0SlNQbGF5ZXJCeUlkKGkpO1xuICAgICAgICAgICAgaWYoIXBsYXllcil7XG4gICAgICAgICAgICAgICAgdGhpcy5fQ1VSUkVOVF9QT1MuX2NoaWxkcmVuW2ldLmFjdGl2ZSA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9LFxuICAgIGhpZGVEZXNrRW1wdHkoKXtcbiAgICAgICAgZm9yKGxldCBpID0gMDsgaSA8IHRoaXMuX251bWJlcl9kZXNrOyBpKyspe1xuICAgICAgICAgICAgbGV0IHBsYXllciA9IHRoaXMuX2dldEpTUGxheWVyQnlJZChpKTtcbiAgICAgICAgICAgIGlmKCFwbGF5ZXIpe1xuICAgICAgICAgICAgICAgIHRoaXMuX0NVUlJFTlRfUE9TLl9jaGlsZHJlbltpXS5hY3RpdmUgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0sXG4gICAgX2NoYW5nZVRvTXlWaWV3KCl7XG4gICAgICAgIGlmKHRoaXMuX2lzUGxheWVyKHRoaXMuY29udHJvbGxlci5ab25lSW5zdGFuY2UubXlTZWxmLm5hbWUpKXtcbiAgICAgICAgICAgIGxldCBteUlkID0gdGhpcy5fZ2V0UGxheWVySWQodGhpcy5jb250cm9sbGVyLlpvbmVJbnN0YW5jZS5teVNlbGYubmFtZSk7XG4gICAgICAgICAgICBsZXQgbXlQb3MgPSBteUlkO1xuICAgICAgICAgICAgbGV0IG1heFVzZXJzID0gdGhpcy5fbnVtYmVyX2Rlc2s7XG4gICAgICAgICAgICBsZXQgZGlzdGFuY2VUb1plcm8gPSBtYXhVc2VycyAtIG15UG9zO1xuICAgICAgICAgICAgZm9yKGxldCBpID0gMDsgaSA8IG1heFVzZXJzOyBpKyspe1xuICAgICAgICAgICAgICAgIGxldCBub2RlUGxheWVyID0gdGhpcy5fZ2V0Tm9kZVBsYXllckJ5SWQoaSk7XG4gICAgICAgICAgICAgICAgaWYoY2MuaXNWYWxpZChub2RlUGxheWVyKSl7XG4gICAgICAgICAgICAgICAgICAgIGxldCBuZXdJbmRleCA9IChpICsgZGlzdGFuY2VUb1plcm8pICUgbWF4VXNlcnM7XG4gICAgICAgICAgICAgICAgICAgIG5vZGVQbGF5ZXIucG9zaXRpb24gPSB0aGlzLnBvc2VzW25ld0luZGV4XTtcbiAgICAgICAgICAgICAgICAgICAgbGV0IGpzID0gdGhpcy5fZ2V0SlNQbGF5ZXIobm9kZVBsYXllcik7XG4gICAgICAgICAgICAgICAgICAgIGpzLm5ld1BvcyA9IG5ld0luZGV4O1xuICAgICAgICAgICAgICAgICAgICBqcy5udW1iZXJfZGVzayA9IHRoaXMuX251bWJlcl9kZXNrO1xuICAgICAgICAgICAgICAgICAgICBqcy51cGRhdGVQb3NIYW5kKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSxcbiAgICBfdXBkYXRlTm9kZVBsYXllcnMobV9saXN0RGVzayl7XG4gICAgICAgIC8vIHByb2Nlc3MgTGlzdCBEZXNrIGZvciBwbGF5ZXJcbiAgICAgICAgZm9yKGxldCBpID0gMDsgaSA8IG1fbGlzdERlc2subGVuZ3RoO2krKyl7XG4gICAgICAgICAgICBsZXQgZGVzayA9IG1fbGlzdERlc2tbaV07XG4gICAgICAgICAgICBsZXQgbm9kZVBsYXllciA9IHRoaXMuX2dldE5vZGVQbGF5ZXJCeUlkKGRlc2suRGVza0lkKTtcbiAgICAgICAgICAgIGlmKG5vZGVQbGF5ZXIgPT0gbnVsbCl7XG4gICAgICAgICAgICAgICAgbm9kZVBsYXllciA9IGNjLmluc3RhbnRpYXRlKHRoaXMucHJlZmFiUGxheWVyKTtcbiAgICAgICAgICAgICAgICB0aGlzLm5vZGVQbGF5ZXJzLmFkZENoaWxkKG5vZGVQbGF5ZXIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbm9kZVBsYXllci5wb3NpdGlvbiA9IHRoaXMucG9zZXNbZGVzay5EZXNrSWRdLnBvc2l0aW9uO1xuICAgICAgICAgICAgbm9kZVBsYXllci5wbGF5ZXJJZCA9IGRlc2suRGVza0lkO1xuICAgICAgICAgICAgZGVzay5kaXNwbGF5TmFtZSA9IEdhbWVWYXJpYWJsZXMuZ2V0RGlzcGxheU5hbWUodGhpcy5fcm9vbS5nZXRVc2VyQnlOYW1lKGRlc2suVXNlck5hbWUpKTtcbiAgICAgICAgICAgIHRoaXMuX2dldEpTUGxheWVyKG5vZGVQbGF5ZXIpLnNldERlc2soZGVzayk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fY2hhbmdlVG9NeVZpZXcoKTtcbiAgICB9LFxuXG4gICAgcmVtb3ZlUGxheWVyKHVzZXJPdXQpe1xuICAgICAgICAvLyByZW1vdmUgcGxheWVyIGluIGFjdGl2ZVxuICAgICAgICAvLyByZW1vdmUgZGVzayBpbiBsaXN0RGVzayBtbS5tbV90YWJsZUluZm9cbiAgICAgICAgLy8gcmVtb3ZlIHVzZXIgaW4gbW0ubV90YWJsZUluZm8ubV9saXN0VXNlclxuICAgICAgICBmb3IobGV0IGkgPSAwOyBpIDwgdXNlck91dC5sZW5ndGg7IGkrKyl7XG4gICAgICAgICAgICBsZXQgcGxheWVyID0gdGhpcy5fZ2V0SlNQbGF5ZXJCeU5hbWUodXNlck91dCk7XG4gICAgICAgICAgICBpZihwbGF5ZXIgJiYgcGxheWVyLmdldERlc2soKS5Vc2VyTmFtZSA9PSB1c2VyT3V0W2ldKXtcbiAgICAgICAgICAgICAgICB0aGlzLl9yZW1vdmVOb2RlUGxheWVyQnlJZChwbGF5ZXIuZ2V0RGVzaygpLkRlc2tJZCk7XG4gICAgICAgICAgICAgICAgdGhpcy5jb250cm9sbGVyLm1fdGFibGVJbmZvLm1fbGlzdERlc2suc3BsaWNlKHRoaXMuY29udHJvbGxlci5tX3RhYmxlSW5mby5tX2xpc3REZXNrLmluZGV4T2YocGxheWVyLmdldERlc2soKSksIDEpO1xuICAgICAgICAgICAgICAgIHRoaXMuY29udHJvbGxlci5tX3RhYmxlSW5mby5tX2xpc3RVc2VyLnNwbGljZSh0aGlzLmNvbnRyb2xsZXIubV90YWJsZUluZm8ubV9saXN0VXNlci5pbmRleE9mKHVzZXJPdXRbaV0pLCAxKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0sXG4gICAgdHVybk9mZkFsbFRpbWVyUGxheWVycygpe1xuICAgICAgICBpZih0aGlzLmNvbnRyb2xsZXIubV90YWJsZUluZm8gJiYgdGhpcy5jb250cm9sbGVyLm1fdGFibGVJbmZvLm1fbGlzdEFjdGl2ZVVzZXJOYW1lKXtcbiAgICAgICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCB0aGlzLmNvbnRyb2xsZXIubV90YWJsZUluZm8ubV9saXN0QWN0aXZlVXNlck5hbWUubGVuZ3RoO2krKyl7XG4gICAgICAgICAgICAgICAgbGV0IHBsYXllciA9IHRoaXMuX2dldEpTUGxheWVyQnlOYW1lKHRoaXMuY29udHJvbGxlci5tX3RhYmxlSW5mby5tX2xpc3RBY3RpdmVVc2VyTmFtZVtpXSk7XG4gICAgICAgICAgICAgICAgaWYocGxheWVyKXtcbiAgICAgICAgICAgICAgICAgICAgcGxheWVyLnR1cm5PZmZUaW1lcigpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0sXG4gICAgX2dldE5vZGVQbGF5ZXJCeUlkKGlkUGxheWVyKXtcbiAgICAgICAgZm9yKGxldCBpID0gMDsgaSA8IHRoaXMubm9kZVBsYXllcnMuX2NoaWxkcmVuLmxlbmd0aDtpKyspe1xuICAgICAgICAgICAgaWYodGhpcy5ub2RlUGxheWVycy5fY2hpbGRyZW5baV0ucGxheWVySWQgPT0gaWRQbGF5ZXIpe1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLm5vZGVQbGF5ZXJzLl9jaGlsZHJlbltpXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9LFxuICAgIF9yZW1vdmVOb2RlUGxheWVyQnlJZChpZFBsYXllcil7XG4gICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCB0aGlzLm5vZGVQbGF5ZXJzLl9jaGlsZHJlbi5sZW5ndGg7aSsrKXtcbiAgICAgICAgICAgIGlmKHRoaXMubm9kZVBsYXllcnMuX2NoaWxkcmVuW2ldLnBsYXllcklkID09IGlkUGxheWVyKXtcbiAgICAgICAgICAgICAgICB0aGlzLm5vZGVQbGF5ZXJzLl9jaGlsZHJlbltpXS5hY3RpdmUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB0aGlzLm5vZGVQbGF5ZXJzLnJlbW92ZUNoaWxkKHRoaXMubm9kZVBsYXllcnMuX2NoaWxkcmVuW2ldLCB0cnVlKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0sXG4gICAgX2dldEpTUGxheWVyKG5vZGVQbGF5ZXIpe1xuICAgICAgICByZXR1cm4gbm9kZVBsYXllci5nZXRDb21wb25lbnQobm9kZVBsYXllci5uYW1lKTtcbiAgICB9LFxuICAgIF9nZXRKU1BsYXllckJ5SWQoaWRQbGF5ZXIpe1xuICAgICAgICBsZXQgbm9kZVBsYXllciA9IHRoaXMuX2dldE5vZGVQbGF5ZXJCeUlkKGlkUGxheWVyKTtcbiAgICAgICAgaWYoY2MuaXNWYWxpZChub2RlUGxheWVyKSlcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9nZXRKU1BsYXllcihub2RlUGxheWVyKTtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfSxcbiAgICBfZ2V0SlNQbGF5ZXJCeU5hbWUodXNlcm5hbWUpe1xuICAgICAgICBsZXQgZGVza0lkID0gdGhpcy5fZ2V0UGxheWVySWQodXNlcm5hbWUpO1xuICAgICAgICBsZXQgcGxheWVyID0gdGhpcy5fZ2V0SlNQbGF5ZXJCeUlkKGRlc2tJZCk7XG4gICAgICAgIHJldHVybiBwbGF5ZXI7XG4gICAgfSxcbiAgICBfZ2V0UGxheWVySWQodXNlcm5hbWUpe1xuICAgICAgICBpZih0aGlzLmNvbnRyb2xsZXIubV90YWJsZUluZm8gJiYgdGhpcy5jb250cm9sbGVyLm1fdGFibGVJbmZvLm1fbGlzdERlc2spe1xuICAgICAgICAgICAgZm9yKGxldCBpID0gMDsgaSA8IHRoaXMuY29udHJvbGxlci5tX3RhYmxlSW5mby5tX2xpc3REZXNrLmxlbmd0aDtpKyspe1xuICAgICAgICAgICAgICAgIGxldCBkZXNrID0gdGhpcy5jb250cm9sbGVyLm1fdGFibGVJbmZvLm1fbGlzdERlc2tbaV07XG4gICAgICAgICAgICAgICAgaWYoZGVzay5Vc2VyTmFtZSA9PSB1c2VybmFtZSl7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBkZXNrLkRlc2tJZDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIC0xO1xuICAgIH0sXG4gICAgX2lzUGxheWVyKHVzZXJuYW1lKXtcbiAgICAgICAgaWYodGhpcy5jb250cm9sbGVyLm1fdGFibGVJbmZvICYmIHRoaXMuY29udHJvbGxlci5tX3RhYmxlSW5mby5tX2xpc3REZXNrKXtcbiAgICAgICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCB0aGlzLmNvbnRyb2xsZXIubV90YWJsZUluZm8ubV9saXN0RGVzay5sZW5ndGg7aSsrKXtcbiAgICAgICAgICAgICAgICBsZXQgZGVzayA9IHRoaXMuY29udHJvbGxlci5tX3RhYmxlSW5mby5tX2xpc3REZXNrW2ldO1xuICAgICAgICAgICAgICAgIGlmKGRlc2suVXNlck5hbWUgPT0gdXNlcm5hbWUpe1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbn0pO1xuIl19