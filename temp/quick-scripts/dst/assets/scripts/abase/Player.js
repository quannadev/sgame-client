
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/scripts/abase/Player.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '873b8/Bpl9O9p48P2WXbeiQ', 'Player');
// scripts/abase/Player.js

"use strict";

cc.Player = cc.Class({
  "extends": cc.VozBaseComponent,
  properties: {
    emoijNode: cc.Node,
    state: cc.Node,
    Status: cc.Node,
    avatar: cc.Node,
    progressBar: cc.ProgressBar,
    sp_avatar: cc.Sprite,
    _tick: 0,
    _desk: null,
    _totalTimeProgress: 30,
    _remainTurnTime: 30,
    _timeWarning: 5,
    _cbCompleteProgress: null,
    _cbWarning: null,
    _isWarning: false,
    lb_name: cc.Label,
    lb_money: cc.Label,
    SitOut: cc.Node,
    MoneyWin: cc.Label,
    zoneName: "portal"
  },
  onLoad: function onLoad() {
    // set default
    this._totalTimeProgress = 30;
    this._remainTurnTime = this._totalTimeProgress;
    this._timeWarning = 5;
    this._tick = 0;
  },
  onEnable: function onEnable() {
    this.zoneName = "portal";
    this.state.active = false;
    this.Status.active = false;
    this.SitOut.active = false;
    if (cc.isValid(this.MoneyWin)) this.MoneyWin.active = false;
  },
  showMoneyWinEffect: function showMoneyWinEffect(money) {
    if (money > 0) {
      this.showWinEffect();
      this.showMoneyWin(money);
    } else {
      this.showMoneyWin(money);
    }
  },
  showMoneyWin: function showMoneyWin(money, cb) {
    var pre = money > 0 ? "+" : "-";
    this.MoneyWin.string = pre + "" + Utils.addDotToNumber(Math.abs(money));
    this.MoneyWin.node.active = true;
    this.MoneyWin.node.stopAllActions();
    this.MoneyWin.node.position = cc.v2(0, 20);
    var nodeTo = cc.v2(0, 120);
    var self = this;
    this.MoneyWin.node.runAction(cc.sequence(cc.moveTo(1, nodeTo).easing(cc.easeOut(0.5)), cc.delayTime(2), cc.callFunc(function () {
      self.MoneyWin.string = 0;
      self.MoneyWin.node.active = false;
      if (cb) cb();
    })));
  },
  setDesk: function setDesk(desk) {
    this.turnOffTimer();
    this._desk = desk;
    this.updateDeskInfo();
  },
  showWinEffect: function showWinEffect() {
    mm.audio.playWin();
    this.node.getChildByName("PokerWinEffect").active = true;
    var win1 = this.node.getChildByName("PokerWinEffect").getChildByName("Win1");
    var animation1 = win1.getComponent(sp.Skeleton);
    animation1.setAnimation(0, "Idle", true);
    var win2 = this.node.getChildByName("PokerWinEffect").getChildByName("Win2");
    var animation2 = win2.getComponent(sp.Skeleton);
    animation2.setAnimation(0, "Idle", true);
    this.node.getChildByName("thang-text").active = true;
  },
  hideWinEffect: function hideWinEffect() {
    var win1 = this.node.getChildByName("PokerWinEffect").getChildByName("Win1");
    var animation1 = win1.getComponent(sp.Skeleton);
    animation1.setAnimation(0, "NONE", false);
    var win2 = this.node.getChildByName("PokerWinEffect").getChildByName("Win2");
    var animation2 = win2.getComponent(sp.Skeleton);
    animation2.setAnimation(0, "NONE", false);
    this.node.getChildByName("PokerWinEffect").active = false;
    this.node.getChildByName("thang-text").active = false;
  },
  updateDeskInfo: function updateDeskInfo() {
    if (this._desk) {
      this.setNameDisplay(this._desk.displayName);
      this.setMoney(this._desk.UserChip); // update Avatar

      if (this.isItMe()) {
        Utils.loadRes(this.sp_avatar, "images/avatar/" + Config.getDefaultAvatar());
      } else {
        Utils.loadRes(this.sp_avatar, "images/avatar/" + (this._desk.DeskId + 1));
      }
    }
  },
  getDesk: function getDesk() {
    return this._desk;
  },
  isItMe: function isItMe() {
    if (this._desk.UserName == PortalManager.getGameController(this.zoneName).ZoneInstance.mySelf.name) {
      return true;
    }

    return false;
  },
  setNameDisplay: function setNameDisplay(name) {
    this.lb_name.string = name == undefined || name == null ? "Guest" : Utils.formatText(name, 12);
  },
  setMoney: function setMoney(money) {
    // this.lb_money.string = Utils.formatCurrency(money);
    this.lb_money.string = Utils.addDotToNumber(money);
  },
  addEventTimerComplete: function addEventTimerComplete(cb) {
    this._cbCompleteProgress = cb;
  },
  addEventTimerWarning: function addEventTimerWarning(cb) {
    this._cbWarning = cb;
  },
  setTimeWarning: function setTimeWarning(timeWarning) {
    this._timeWarning = timeWarning;
  },
  setCurrentProgress: function setCurrentProgress(currentTime) {
    this._remainTurnTime = currentTime;
  },
  setTotalProgress: function setTotalProgress(totalTime) {
    this._totalTimeProgress = totalTime;
  },
  setSitOut: function setSitOut(isSitOut) {
    this.SitOut.active = isSitOut;
  },
  turnOnTimer: function turnOnTimer() {
    this.turnOffTimer();
    this.progressBar.node.active = true;
    this.progressBar.progress = 0;
    this._tick = this._remainTurnTime * 1000 + Date.now();
    this.unschedule(this.updateTimer, 0.1);
    this.schedule(this.updateTimer, 0.1);
  },
  turnOffTimer: function turnOffTimer() {
    this._cbCompleteProgress = null;
    this._cbWarning = null;
    this._isWarning = false;
    this.progressBar.node.active = false;
    this.unschedule(this.updateTimer, 0.1);
  },
  updateTimer: function updateTimer(dt) {
    var newTick = (this._totalTimeProgress * 1000 + Date.now() - this._tick) / 1000;

    if (newTick <= this._totalTimeProgress) {
      this.progressBar.progress = newTick / this._totalTimeProgress;

      if (!this._isWarning && this._totalTimeProgress - newTick <= this._timeWarning) {
        this._isWarning = true;
        if (this._cbWarning) this._cbWarning();
      }
    } else {
      if (this._cbCompleteProgress) this._cbCompleteProgress();
      this.turnOffTimer();
    }
  },
  updatePosHand: function updatePosHand() {},
  onPreStartEvent: function onPreStartEvent(preStartRes) {
    this.reset();
  },
  onStartEvent: function onStartEvent(startEvent) {},
  onTurnEvent: function onTurnEvent(userTurnRes) {},
  onFoldEvent: function onFoldEvent(userFoldRes) {},
  reset: function reset() {
    this.MoneyWin.node.active = false;
    this.state.active = false;
    this.Status.active = false;
    this.hideWinEffect();
  },
  onPublicMessage: function onPublicMessage(msgItem) {
    if (this.emoijNode != undefined) {
      var self = this;
      var isEmoij = msgItem.indexOf("emoij_") >= 0;
      var emojiNode = this.emoijNode.getChildByName("EMOJ");
      var boxNode = this.emoijNode.getChildByName("box");
      emojiNode.active = false;
      boxNode.active = false;

      if (isEmoij) {
        emojiNode.active = true;
        emojiNode.opacity = 255;
        var type = msgItem.replace("emoij_", "");
        emojiNode.stopAllActions();
        emojiNode.getComponent(sp.Skeleton).setAnimation(0, type, false);
        emojiNode.runAction(cc.sequence(cc.delayTime(1.5), cc.fadeOut(2), cc.callFunc(function () {
          emojiNode.active = false;
        })));
      } else {
        boxNode.active = true;
        boxNode.opacity = 255;
        boxNode.stopAllActions();
        boxNode.getChildByName("lb_chat").getComponent(cc.Label).string = msgItem;
        boxNode.getComponent(cc.Layout).updateLayout();
        boxNode.runAction(cc.sequence(cc.delayTime(2), cc.fadeOut(2), cc.callFunc(function () {
          boxNode.active = false;
        })));
      }
    }
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0cy9zY3JpcHRzL2FiYXNlL1BsYXllci5qcyJdLCJuYW1lcyI6WyJjYyIsIlBsYXllciIsIkNsYXNzIiwiVm96QmFzZUNvbXBvbmVudCIsInByb3BlcnRpZXMiLCJlbW9pak5vZGUiLCJOb2RlIiwic3RhdGUiLCJTdGF0dXMiLCJhdmF0YXIiLCJwcm9ncmVzc0JhciIsIlByb2dyZXNzQmFyIiwic3BfYXZhdGFyIiwiU3ByaXRlIiwiX3RpY2siLCJfZGVzayIsIl90b3RhbFRpbWVQcm9ncmVzcyIsIl9yZW1haW5UdXJuVGltZSIsIl90aW1lV2FybmluZyIsIl9jYkNvbXBsZXRlUHJvZ3Jlc3MiLCJfY2JXYXJuaW5nIiwiX2lzV2FybmluZyIsImxiX25hbWUiLCJMYWJlbCIsImxiX21vbmV5IiwiU2l0T3V0IiwiTW9uZXlXaW4iLCJ6b25lTmFtZSIsIm9uTG9hZCIsIm9uRW5hYmxlIiwiYWN0aXZlIiwiaXNWYWxpZCIsInNob3dNb25leVdpbkVmZmVjdCIsIm1vbmV5Iiwic2hvd1dpbkVmZmVjdCIsInNob3dNb25leVdpbiIsImNiIiwicHJlIiwic3RyaW5nIiwiVXRpbHMiLCJhZGREb3RUb051bWJlciIsIk1hdGgiLCJhYnMiLCJub2RlIiwic3RvcEFsbEFjdGlvbnMiLCJwb3NpdGlvbiIsInYyIiwibm9kZVRvIiwic2VsZiIsInJ1bkFjdGlvbiIsInNlcXVlbmNlIiwibW92ZVRvIiwiZWFzaW5nIiwiZWFzZU91dCIsImRlbGF5VGltZSIsImNhbGxGdW5jIiwic2V0RGVzayIsImRlc2siLCJ0dXJuT2ZmVGltZXIiLCJ1cGRhdGVEZXNrSW5mbyIsIm1tIiwiYXVkaW8iLCJwbGF5V2luIiwiZ2V0Q2hpbGRCeU5hbWUiLCJ3aW4xIiwiYW5pbWF0aW9uMSIsImdldENvbXBvbmVudCIsInNwIiwiU2tlbGV0b24iLCJzZXRBbmltYXRpb24iLCJ3aW4yIiwiYW5pbWF0aW9uMiIsImhpZGVXaW5FZmZlY3QiLCJzZXROYW1lRGlzcGxheSIsImRpc3BsYXlOYW1lIiwic2V0TW9uZXkiLCJVc2VyQ2hpcCIsImlzSXRNZSIsImxvYWRSZXMiLCJDb25maWciLCJnZXREZWZhdWx0QXZhdGFyIiwiRGVza0lkIiwiZ2V0RGVzayIsIlVzZXJOYW1lIiwiUG9ydGFsTWFuYWdlciIsImdldEdhbWVDb250cm9sbGVyIiwiWm9uZUluc3RhbmNlIiwibXlTZWxmIiwibmFtZSIsInVuZGVmaW5lZCIsImZvcm1hdFRleHQiLCJhZGRFdmVudFRpbWVyQ29tcGxldGUiLCJhZGRFdmVudFRpbWVyV2FybmluZyIsInNldFRpbWVXYXJuaW5nIiwidGltZVdhcm5pbmciLCJzZXRDdXJyZW50UHJvZ3Jlc3MiLCJjdXJyZW50VGltZSIsInNldFRvdGFsUHJvZ3Jlc3MiLCJ0b3RhbFRpbWUiLCJzZXRTaXRPdXQiLCJpc1NpdE91dCIsInR1cm5PblRpbWVyIiwicHJvZ3Jlc3MiLCJEYXRlIiwibm93IiwidW5zY2hlZHVsZSIsInVwZGF0ZVRpbWVyIiwic2NoZWR1bGUiLCJkdCIsIm5ld1RpY2siLCJ1cGRhdGVQb3NIYW5kIiwib25QcmVTdGFydEV2ZW50IiwicHJlU3RhcnRSZXMiLCJyZXNldCIsIm9uU3RhcnRFdmVudCIsInN0YXJ0RXZlbnQiLCJvblR1cm5FdmVudCIsInVzZXJUdXJuUmVzIiwib25Gb2xkRXZlbnQiLCJ1c2VyRm9sZFJlcyIsIm9uUHVibGljTWVzc2FnZSIsIm1zZ0l0ZW0iLCJpc0Vtb2lqIiwiaW5kZXhPZiIsImVtb2ppTm9kZSIsImJveE5vZGUiLCJvcGFjaXR5IiwidHlwZSIsInJlcGxhY2UiLCJmYWRlT3V0IiwiTGF5b3V0IiwidXBkYXRlTGF5b3V0Il0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7OztBQUFBQSxFQUFFLENBQUNDLE1BQUgsR0FBWUQsRUFBRSxDQUFDRSxLQUFILENBQVM7QUFDakIsYUFBU0YsRUFBRSxDQUFDRyxnQkFESztBQUdqQkMsRUFBQUEsVUFBVSxFQUFFO0FBQ1JDLElBQUFBLFNBQVMsRUFBR0wsRUFBRSxDQUFDTSxJQURQO0FBRVJDLElB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QixDQUFULENBQVoiLCJzb3VyY2VSb290IjoiLyIsInNvdXJjZXNDb250ZW50IjpbImNjLlBsYXllciA9IGNjLkNsYXNzKHtcbiAgICBleHRlbmRzOiBjYy5Wb3pCYXNlQ29tcG9uZW50LFxuXG4gICAgcHJvcGVydGllczoge1xuICAgICAgICBlbW9pak5vZGUgOiBjYy5Ob2RlLFxuICAgICAgICBzdGF0ZSA6IGNjLk5vZGUsXG4gICAgICAgIFN0YXR1czogY2MuTm9kZSxcbiAgICAgICAgYXZhdGFyOiBjYy5Ob2RlLFxuICAgICAgICBwcm9ncmVzc0JhcjogY2MuUHJvZ3Jlc3NCYXIsXG4gICAgICAgIHNwX2F2YXRhcjogY2MuU3ByaXRlLFxuICAgICAgICBfdGljazogMCxcbiAgICAgICAgX2Rlc2s6IG51bGwsXG4gICAgICAgIF90b3RhbFRpbWVQcm9ncmVzczogMzAsXG4gICAgICAgIF9yZW1haW5UdXJuVGltZTogMzAsXG4gICAgICAgIF90aW1lV2FybmluZzogNSxcbiAgICAgICAgX2NiQ29tcGxldGVQcm9ncmVzczogbnVsbCxcbiAgICAgICAgX2NiV2FybmluZzogbnVsbCxcbiAgICAgICAgX2lzV2FybmluZzogZmFsc2UsXG4gICAgICAgIGxiX25hbWU6IGNjLkxhYmVsLFxuICAgICAgICBsYl9tb25leTogY2MuTGFiZWwsXG4gICAgICAgIFNpdE91dDogY2MuTm9kZSxcbiAgICAgICAgTW9uZXlXaW46IGNjLkxhYmVsLFxuICAgICAgICB6b25lTmFtZTogXCJwb3J0YWxcIlxuICAgIH0sXG4gICAgb25Mb2FkKCl7XG4gICAgICAgIC8vIHNldCBkZWZhdWx0XG4gICAgICAgIHRoaXMuX3RvdGFsVGltZVByb2dyZXNzID0gMzA7XG4gICAgICAgIHRoaXMuX3JlbWFpblR1cm5UaW1lID0gdGhpcy5fdG90YWxUaW1lUHJvZ3Jlc3M7XG4gICAgICAgIHRoaXMuX3RpbWVXYXJuaW5nID0gNTtcbiAgICAgICAgdGhpcy5fdGljayA9IDA7XG4gICAgfSxcbiAgICBvbkVuYWJsZSgpe1xuICAgICAgICB0aGlzLnpvbmVOYW1lID0gXCJwb3J0YWxcIjtcbiAgICAgICAgdGhpcy5zdGF0ZS5hY3RpdmUgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5TdGF0dXMuYWN0aXZlID0gZmFsc2U7XG4gICAgICAgIHRoaXMuU2l0T3V0LmFjdGl2ZSA9IGZhbHNlO1xuICAgICAgICBpZihjYy5pc1ZhbGlkKHRoaXMuTW9uZXlXaW4pKVxuICAgICAgICAgICAgdGhpcy5Nb25leVdpbi5hY3RpdmUgPSBmYWxzZTtcbiAgICB9LFxuICAgIHNob3dNb25leVdpbkVmZmVjdChtb25leSkge1xuICAgICAgICBpZiAobW9uZXkgPiAwKXtcbiAgICAgICAgICAgIHRoaXMuc2hvd1dpbkVmZmVjdCgpO1xuICAgICAgICAgICAgdGhpcy5zaG93TW9uZXlXaW4obW9uZXkpO1xuICAgICAgICB9ZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnNob3dNb25leVdpbihtb25leSk7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIHNob3dNb25leVdpbihtb25leSwgY2Ipe1xuICAgICAgICBsZXQgcHJlID0gbW9uZXkgPiAwID8gXCIrXCIgOiBcIi1cIjtcbiAgICAgICAgdGhpcy5Nb25leVdpbi5zdHJpbmcgPSBwcmUgKyBcIlwiK1V0aWxzLmFkZERvdFRvTnVtYmVyKE1hdGguYWJzKG1vbmV5KSk7XG4gICAgICAgIHRoaXMuTW9uZXlXaW4ubm9kZS5hY3RpdmUgPSB0cnVlO1xuICAgICAgICB0aGlzLk1vbmV5V2luLm5vZGUuc3RvcEFsbEFjdGlvbnMoKTtcbiAgICAgICAgdGhpcy5Nb25leVdpbi5ub2RlLnBvc2l0aW9uID0gY2MudjIoMCwgMjApO1xuICAgICAgICBsZXQgbm9kZVRvICAgICAgICAgICA9IGNjLnYyKDAsIDEyMCk7XG4gICAgICAgIGxldCBzZWxmID0gdGhpcztcbiAgICAgICAgdGhpcy5Nb25leVdpbi5ub2RlLnJ1bkFjdGlvbihjYy5zZXF1ZW5jZShjYy5tb3ZlVG8oMSwgbm9kZVRvKS5lYXNpbmcoY2MuZWFzZU91dCgwLjUpKSwgY2MuZGVsYXlUaW1lKDIpLCBjYy5jYWxsRnVuYyhmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBzZWxmLk1vbmV5V2luLnN0cmluZyAgICAgID0gMDtcbiAgICAgICAgICAgIHNlbGYuTW9uZXlXaW4ubm9kZS5hY3RpdmUgPSBmYWxzZTtcbiAgICAgICAgICAgIGlmIChjYilcbiAgICAgICAgICAgICAgICBjYigpO1xuICAgICAgICB9KSkpO1xuICAgIH0sXG4gICAgc2V0RGVzayhkZXNrKXtcbiAgICAgICAgdGhpcy50dXJuT2ZmVGltZXIoKTtcbiAgICAgICAgdGhpcy5fZGVzayA9IGRlc2s7XG4gICAgICAgIHRoaXMudXBkYXRlRGVza0luZm8oKTtcbiAgICB9LFxuICAgIHNob3dXaW5FZmZlY3QoKXtcbiAgICAgICAgbW0uYXVkaW8ucGxheVdpbigpO1xuICAgICAgICB0aGlzLm5vZGUuZ2V0Q2hpbGRCeU5hbWUoXCJQb2tlcldpbkVmZmVjdFwiKS5hY3RpdmUgPSB0cnVlO1xuICAgICAgICBsZXQgd2luMSA9IHRoaXMubm9kZS5nZXRDaGlsZEJ5TmFtZShcIlBva2VyV2luRWZmZWN0XCIpLmdldENoaWxkQnlOYW1lKFwiV2luMVwiKTtcbiAgICAgICAgbGV0IGFuaW1hdGlvbjEgPSB3aW4xLmdldENvbXBvbmVudChzcC5Ta2VsZXRvbik7XG4gICAgICAgIGFuaW1hdGlvbjEuc2V0QW5pbWF0aW9uKDAsXCJJZGxlXCIsIHRydWUpO1xuXG4gICAgICAgIGxldCB3aW4yID0gdGhpcy5ub2RlLmdldENoaWxkQnlOYW1lKFwiUG9rZXJXaW5FZmZlY3RcIikuZ2V0Q2hpbGRCeU5hbWUoXCJXaW4yXCIpO1xuICAgICAgICBsZXQgYW5pbWF0aW9uMiA9IHdpbjIuZ2V0Q29tcG9uZW50KHNwLlNrZWxldG9uKTtcbiAgICAgICAgYW5pbWF0aW9uMi5zZXRBbmltYXRpb24oMCxcIklkbGVcIiwgdHJ1ZSk7XG5cbiAgICAgICAgdGhpcy5ub2RlLmdldENoaWxkQnlOYW1lKFwidGhhbmctdGV4dFwiKS5hY3RpdmUgPSB0cnVlO1xuICAgIH0sXG4gICAgaGlkZVdpbkVmZmVjdCgpe1xuICAgICAgICBsZXQgd2luMSA9IHRoaXMubm9kZS5nZXRDaGlsZEJ5TmFtZShcIlBva2VyV2luRWZmZWN0XCIpLmdldENoaWxkQnlOYW1lKFwiV2luMVwiKTtcbiAgICAgICAgbGV0IGFuaW1hdGlvbjEgPSB3aW4xLmdldENvbXBvbmVudChzcC5Ta2VsZXRvbik7XG4gICAgICAgIGFuaW1hdGlvbjEuc2V0QW5pbWF0aW9uKDAsXCJOT05FXCIsIGZhbHNlKTtcblxuICAgICAgICBsZXQgd2luMiA9IHRoaXMubm9kZS5nZXRDaGlsZEJ5TmFtZShcIlBva2VyV2luRWZmZWN0XCIpLmdldENoaWxkQnlOYW1lKFwiV2luMlwiKTtcbiAgICAgICAgbGV0IGFuaW1hdGlvbjIgPSB3aW4yLmdldENvbXBvbmVudChzcC5Ta2VsZXRvbik7XG4gICAgICAgIGFuaW1hdGlvbjIuc2V0QW5pbWF0aW9uKDAsXCJOT05FXCIsIGZhbHNlKTtcblxuICAgICAgICB0aGlzLm5vZGUuZ2V0Q2hpbGRCeU5hbWUoXCJQb2tlcldpbkVmZmVjdFwiKS5hY3RpdmUgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5ub2RlLmdldENoaWxkQnlOYW1lKFwidGhhbmctdGV4dFwiKS5hY3RpdmUgPSBmYWxzZTtcbiAgICB9LFxuICAgIHVwZGF0ZURlc2tJbmZvKCl7XG4gICAgICAgIGlmKHRoaXMuX2Rlc2spe1xuICAgICAgICAgICAgdGhpcy5zZXROYW1lRGlzcGxheSh0aGlzLl9kZXNrLmRpc3BsYXlOYW1lKTtcbiAgICAgICAgICAgIHRoaXMuc2V0TW9uZXkodGhpcy5fZGVzay5Vc2VyQ2hpcCk7XG4gICAgICAgICAgICAvLyB1cGRhdGUgQXZhdGFyXG4gICAgICAgICAgICBpZih0aGlzLmlzSXRNZSgpKXtcbiAgICAgICAgICAgICAgICBVdGlscy5sb2FkUmVzKHRoaXMuc3BfYXZhdGFyLCBcImltYWdlcy9hdmF0YXIvXCIrQ29uZmlnLmdldERlZmF1bHRBdmF0YXIoKSk7XG4gICAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICAgICBVdGlscy5sb2FkUmVzKHRoaXMuc3BfYXZhdGFyLCBcImltYWdlcy9hdmF0YXIvXCIrKHRoaXMuX2Rlc2suRGVza0lkICsxKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9LFxuICAgIGdldERlc2soKXtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2Rlc2s7XG4gICAgfSxcbiAgICBpc0l0TWUoKXtcbiAgICAgICAgaWYodGhpcy5fZGVzay5Vc2VyTmFtZSA9PSBQb3J0YWxNYW5hZ2VyLmdldEdhbWVDb250cm9sbGVyKHRoaXMuem9uZU5hbWUpLlpvbmVJbnN0YW5jZS5teVNlbGYubmFtZSl7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSxcbiAgICBzZXROYW1lRGlzcGxheShuYW1lKXtcbiAgICAgICAgdGhpcy5sYl9uYW1lLnN0cmluZyA9IChuYW1lID09IHVuZGVmaW5lZCB8fCBuYW1lID09IG51bGwpID8gXCJHdWVzdFwiIDogVXRpbHMuZm9ybWF0VGV4dChuYW1lLCAxMik7XG4gICAgfSxcbiAgICBzZXRNb25leShtb25leSl7XG4gICAgICAgIC8vIHRoaXMubGJfbW9uZXkuc3RyaW5nID0gVXRpbHMuZm9ybWF0Q3VycmVuY3kobW9uZXkpO1xuICAgICAgICB0aGlzLmxiX21vbmV5LnN0cmluZyA9IFV0aWxzLmFkZERvdFRvTnVtYmVyKG1vbmV5KTtcbiAgICB9LFxuICAgIGFkZEV2ZW50VGltZXJDb21wbGV0ZShjYil7XG4gICAgICAgIHRoaXMuX2NiQ29tcGxldGVQcm9ncmVzcyA9IGNiO1xuICAgIH0sXG4gICAgYWRkRXZlbnRUaW1lcldhcm5pbmcoY2Ipe1xuICAgICAgICB0aGlzLl9jYldhcm5pbmcgPSBjYjtcbiAgICB9LFxuICAgIHNldFRpbWVXYXJuaW5nKHRpbWVXYXJuaW5nKXtcbiAgICAgICAgdGhpcy5fdGltZVdhcm5pbmcgPSB0aW1lV2FybmluZ1xuICAgIH0sXG4gICAgc2V0Q3VycmVudFByb2dyZXNzKGN1cnJlbnRUaW1lKXtcbiAgICAgICAgdGhpcy5fcmVtYWluVHVyblRpbWUgPSBjdXJyZW50VGltZTtcbiAgICB9LFxuICAgIHNldFRvdGFsUHJvZ3Jlc3ModG90YWxUaW1lKXtcbiAgICAgICAgdGhpcy5fdG90YWxUaW1lUHJvZ3Jlc3MgPSB0b3RhbFRpbWU7XG4gICAgfSxcbiAgICBzZXRTaXRPdXQoaXNTaXRPdXQpe1xuICAgICAgICB0aGlzLlNpdE91dC5hY3RpdmUgPSBpc1NpdE91dDtcbiAgICB9LFxuICAgIHR1cm5PblRpbWVyKCl7XG4gICAgICAgIHRoaXMudHVybk9mZlRpbWVyKCk7XG4gICAgICAgIHRoaXMucHJvZ3Jlc3NCYXIubm9kZS5hY3RpdmUgPSB0cnVlO1xuICAgICAgICB0aGlzLnByb2dyZXNzQmFyLnByb2dyZXNzID0gMDtcbiAgICAgICAgdGhpcy5fdGljayA9IHRoaXMuX3JlbWFpblR1cm5UaW1lICogMTAwMCAgKyBEYXRlLm5vdygpO1xuICAgICAgICB0aGlzLnVuc2NoZWR1bGUodGhpcy51cGRhdGVUaW1lciwgMC4xKTtcbiAgICAgICAgdGhpcy5zY2hlZHVsZSh0aGlzLnVwZGF0ZVRpbWVyLCAwLjEpO1xuICAgIH0sXG4gICAgdHVybk9mZlRpbWVyKCl7XG4gICAgICAgIHRoaXMuX2NiQ29tcGxldGVQcm9ncmVzcyA9IG51bGw7XG4gICAgICAgIHRoaXMuX2NiV2FybmluZyA9IG51bGw7XG4gICAgICAgIHRoaXMuX2lzV2FybmluZyA9IGZhbHNlO1xuICAgICAgICB0aGlzLnByb2dyZXNzQmFyLm5vZGUuYWN0aXZlID0gZmFsc2U7XG4gICAgICAgIHRoaXMudW5zY2hlZHVsZSh0aGlzLnVwZGF0ZVRpbWVyLCAwLjEpO1xuICAgIH0sXG4gICAgdXBkYXRlVGltZXIoZHQpe1xuICAgICAgICBsZXQgbmV3VGljayA9ICh0aGlzLl90b3RhbFRpbWVQcm9ncmVzcyAqIDEwMDAgKyBEYXRlLm5vdygpIC0gdGhpcy5fdGljaykgLyAxMDAwO1xuICAgICAgICBpZihuZXdUaWNrIDw9IHRoaXMuX3RvdGFsVGltZVByb2dyZXNzKXtcbiAgICAgICAgICAgIHRoaXMucHJvZ3Jlc3NCYXIucHJvZ3Jlc3MgPSBuZXdUaWNrIC90aGlzLl90b3RhbFRpbWVQcm9ncmVzcztcbiAgICAgICAgICAgIGlmKCF0aGlzLl9pc1dhcm5pbmcgJiYgKHRoaXMuX3RvdGFsVGltZVByb2dyZXNzIC0gbmV3VGljaykgPD0gdGhpcy5fdGltZVdhcm5pbmcpe1xuICAgICAgICAgICAgICAgIHRoaXMuX2lzV2FybmluZyA9IHRydWU7XG4gICAgICAgICAgICAgICAgaWYodGhpcy5fY2JXYXJuaW5nKVxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9jYldhcm5pbmcoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICBpZih0aGlzLl9jYkNvbXBsZXRlUHJvZ3Jlc3MpXG4gICAgICAgICAgICAgICAgdGhpcy5fY2JDb21wbGV0ZVByb2dyZXNzKCk7XG4gICAgICAgICAgICB0aGlzLnR1cm5PZmZUaW1lcigpO1xuICAgICAgICB9XG4gICAgfSxcbiAgICB1cGRhdGVQb3NIYW5kKCl7XG5cbiAgICB9LFxuICAgIG9uUHJlU3RhcnRFdmVudChwcmVTdGFydFJlcyl7XG4gICAgICAgIHRoaXMucmVzZXQoKTtcbiAgICB9LFxuICAgIG9uU3RhcnRFdmVudChzdGFydEV2ZW50KXtcblxuICAgIH0sXG4gICAgb25UdXJuRXZlbnQodXNlclR1cm5SZXMpe1xuXG4gICAgfSxcbiAgICBvbkZvbGRFdmVudCh1c2VyRm9sZFJlcyl7XG5cbiAgICB9LFxuICAgIHJlc2V0KCl7XG4gICAgICAgIHRoaXMuTW9uZXlXaW4ubm9kZS5hY3RpdmUgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5zdGF0ZS5hY3RpdmUgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5TdGF0dXMuYWN0aXZlID0gZmFsc2U7XG4gICAgICAgIHRoaXMuaGlkZVdpbkVmZmVjdCgpO1xuICAgIH0sXG4gICAgb25QdWJsaWNNZXNzYWdlKG1zZ0l0ZW0pe1xuICAgICAgICBpZiAodGhpcy5lbW9pak5vZGUgIT0gdW5kZWZpbmVkKXtcbiAgICAgICAgICAgIGxldCBzZWxmICAgID0gdGhpcztcbiAgICAgICAgICAgIGxldCBpc0Vtb2lqID0gbXNnSXRlbS5pbmRleE9mKFwiZW1vaWpfXCIpID49IDA7XG4gICAgICAgICAgICBsZXQgZW1vamlOb2RlID0gdGhpcy5lbW9pak5vZGUuZ2V0Q2hpbGRCeU5hbWUoXCJFTU9KXCIpO1xuICAgICAgICAgICAgbGV0IGJveE5vZGUgICA9IHRoaXMuZW1vaWpOb2RlLmdldENoaWxkQnlOYW1lKFwiYm94XCIpO1xuICAgICAgICAgICAgZW1vamlOb2RlLmFjdGl2ZSA9IGZhbHNlO1xuICAgICAgICAgICAgYm94Tm9kZS5hY3RpdmUgICA9IGZhbHNlO1xuICAgICAgICAgICAgaWYgKGlzRW1vaWope1xuICAgICAgICAgICAgICAgIGVtb2ppTm9kZS5hY3RpdmUgICA9IHRydWU7XG4gICAgICAgICAgICAgICAgZW1vamlOb2RlLm9wYWNpdHkgID0gMjU1O1xuICAgICAgICAgICAgICAgIGxldCB0eXBlID0gbXNnSXRlbS5yZXBsYWNlKFwiZW1vaWpfXCIsIFwiXCIpO1xuICAgICAgICAgICAgICAgIGVtb2ppTm9kZS5zdG9wQWxsQWN0aW9ucygpO1xuICAgICAgICAgICAgICAgIGVtb2ppTm9kZS5nZXRDb21wb25lbnQoc3AuU2tlbGV0b24pLnNldEFuaW1hdGlvbigwLCB0eXBlLCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgZW1vamlOb2RlLnJ1bkFjdGlvbihjYy5zZXF1ZW5jZShjYy5kZWxheVRpbWUoMS41KSwgY2MuZmFkZU91dCgyKSwgY2MuY2FsbEZ1bmMoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBlbW9qaU5vZGUuYWN0aXZlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgfSkpKTtcbiAgICAgICAgICAgIH1lbHNlIHtcbiAgICAgICAgICAgICAgICBib3hOb2RlLmFjdGl2ZSAgID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBib3hOb2RlLm9wYWNpdHkgID0gMjU1O1xuICAgICAgICAgICAgICAgIGJveE5vZGUuc3RvcEFsbEFjdGlvbnMoKTtcbiAgICAgICAgICAgICAgICBib3hOb2RlLmdldENoaWxkQnlOYW1lKFwibGJfY2hhdFwiKS5nZXRDb21wb25lbnQoY2MuTGFiZWwpLnN0cmluZyA9IG1zZ0l0ZW07XG4gICAgICAgICAgICAgICAgYm94Tm9kZS5nZXRDb21wb25lbnQoY2MuTGF5b3V0KS51cGRhdGVMYXlvdXQoKTtcbiAgICAgICAgICAgICAgICBib3hOb2RlLnJ1bkFjdGlvbihjYy5zZXF1ZW5jZShjYy5kZWxheVRpbWUoMiksIGNjLmZhZGVPdXQoMiksIGNjLmNhbGxGdW5jKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgYm94Tm9kZS5hY3RpdmUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9KSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSxcbn0pO1xuIl19