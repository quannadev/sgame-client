
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/scripts/roulette/RouletteController.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, 'c6becu6MepCoaEfVitqr71V', 'RouletteController');
// scripts/roulette/RouletteController.js

"use strict";

var RouletteEvent = require('RouletteEvent');

var RouletteController = SmartFoxSDK.BaseController.extend({
  m_tableInfo: null,
  registerEvents: function registerEvents() {
    this._super();

    this.ZoneInstance.addEventListenerExtension(RouletteEvent.RESPONSE_NAME.LOAD_GAME_RES, this.onLoadGameEvent, this);
    this.ZoneInstance.addEventListenerExtension(RouletteEvent.RESPONSE_NAME.BET_RES, this.onUserBetEvent, this);
    this.ZoneInstance.addEventListenerExtension(RouletteEvent.RESPONSE_NAME.END_BETTING, this.onEndBettingEvent, this);
    this.ZoneInstance.addEventListenerExtension(RouletteEvent.RESPONSE_NAME.HISTORY_RESULT, this.onHistoryResultEvent, this);
  },
  removeEvents: function removeEvents() {
    this._super();

    this.ZoneInstance.removeEventListenerExtension(RouletteEvent.RESPONSE_NAME.LOAD_GAME_RES, this.onLoadGameEvent, this);
    this.ZoneInstance.removeEventListenerExtension(RouletteEvent.RESPONSE_NAME.BET_RES, this.onUserBetEvent, this);
    this.ZoneInstance.removeEventListenerExtension(RouletteEvent.RESPONSE_NAME.END_BETTING, this.onEndBettingEvent, this);
    this.ZoneInstance.removeEventListenerExtension(RouletteEvent.RESPONSE_NAME.HISTORY_RESULT, this.onHistoryResultEvent, this);
  },
  onEventLogin: function onEventLogin(event) {
    this._super(event);

    this._requestJoinRoom(this.zoneName);
  },
  onEventUserExitRoom: function onEventUserExitRoom(event) {
    var user = event.user;

    if (user.isItMe) {
      if (this.getUI() != null) this.getUI().node.active = false;
      UIManger.show("UIHome");
    }
  },
  onLoadGameEvent: function onLoadGameEvent(event) {
    this.preLoadUI({
      pop: true
    }, function () {
      this.m_tableInfo = new RouletteEvent.LoadGameEvent().fromEvent(event);
      this.getUI().hideAll();
      var users = [];
      users.push(this.ZoneInstance.mySelf);

      for (var i = 0; i < this.getRoom().getUserList().length; i++) {
        var u = this.getRoom().getUserList()[i];

        if (u.name != this.ZoneInstance.mySelf.name && users.length < 6) {
          users.push(u);
        }
      }

      this.getUI().showListUsers(users);

      if (this.m_tableInfo.isBetting) {
        this.getUI()._turnOnTime(this.m_tableInfo.time, this.m_tableInfo.time, this.m_tableInfo.isBetting);

        this.getUI().showNoti("Bắt đầu cược");
      } else {
        this.getUI()._turnOffTime();

        this.getUI()._turnOnTime(this.m_tableInfo.time, this.m_tableInfo.time, this.m_tableInfo.isBetting);

        this.getUI().resumeGame(this.m_tableInfo.winpot, this.m_tableInfo.time, this.m_tableInfo.usersOnboard, this.m_tableInfo.chipUserOnBoard, this.m_tableInfo.result, this.m_tableInfo.winChip);
      }

      this.getUI().updateTotalBet(this.m_tableInfo.totalUserBet);
      this.getUI().addChipToPot(this.m_tableInfo.listTypePotBet, this.m_tableInfo.listMyChipPot);
    }.bind(this));
  },
  onUserBetEvent: function onUserBetEvent(event) {
    var userBet = new RouletteEvent.BetEvent().fromEvent(event);
    var userName = userBet.userName;
    var betChip = userBet.betChip;
    var typePot = userBet.typePot;
    var totalBet = userBet.totalBet;

    if (this.ZoneInstance.mySelf.name == userName) {
      this.getUI().updateListChipBet(userBet.typePot, userBet.betChip);
    }

    this.getUI().updateTotalBet(totalBet);
    this.getUI().runActionChangeMoney(userName, -betChip, 1);
    this.getUI().actionFlyChipToPot(userName, typePot, betChip);
    var user = this.getRoom().getUserByName(userName);
    if (user) this.getUI().updateChip(user);
  },
  onEndBettingEvent: function onEndBettingEvent(event) {
    var endBetting = new RouletteEvent.EndBetting().fromEvent(event);
    this.m_tableInfo.isBetting = false;
    this.m_tableInfo.chipUserOnBoard = endBetting.chipUserOnBoard;
    this.m_tableInfo.usersOnboard = endBetting.usersOnboard;
    this.m_tableInfo.winpot = endBetting.winpot;
    this.m_tableInfo.winChip = endBetting.winChip;
    this.m_tableInfo.result = endBetting.result;

    this.getUI()._turnOffTime();

    this.getUI()._turnOnTime(20, 20, this.m_tableInfo.isBetting);

    this.getUI().showNoti("Kết thúc cược!");
    this.getUI().showResult(this.m_tableInfo.result);
  },
  onHistoryResultEvent: function onHistoryResultEvent(event) {
    var history = new RouletteEvent.HistoryResponse().fromEvent(event);
    this.getUI().showSoiCau(history.result);
  },
  onHistoryEvent: function onHistoryEvent(event) {
    var historyEvent = new RouletteEvent.HistoryEvent().fromEvent(event);
    this.getUI().show("UIRouletteTransaction", {
      pop: true,
      src: 'roulette',
      data: {
        items: historyEvent.items
      }
    });
  },
  onLeaderBoardEvent: function onLeaderBoardEvent(event) {
    var leaderBoardEvent = new RouletteEvent.LeaderBoardEvent().fromEvent(event);
    this.getUI().show("UIRouletteRank", {
      pop: true,
      src: 'roulette',
      data: {
        items: leaderBoardEvent.items
      }
    });
  },
  onPublicMessage: function onPublicMessage(event) {
    var sender = event.sender;
    var msg = event.message;
    var data = event.data;
    var dataSender = data != null ? {
      dn: data.get("dn"),
      fb: data.get("fb")
    } : {
      dn: "...",
      fb: ""
    };
    var msgItem = {};
    msgItem.sender = sender;
    msgItem.msg = msg;
    msgItem.dataSender = dataSender;
    this.getUI().onPublicMessage(msgItem);
  }
});
var instance = null;

var getInstance = function getInstance() {
  if (instance == null) instance = new RouletteController('UIRoulette', 'roulette');
  return instance;
};

SmartFoxSDK.RouletteController = module.exports = getInstance();

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0cy9zY3JpcHRzL3JvdWxldHRlL1JvdWxldHRlQ29udHJvbGxlci5qcyJdLCJuYW1lcyI6WyJSb3VsZXR0ZUV2ZW50IiwicmVxdWlyZSIsIlJvdWxldHRlQ29udHJvbGxlciIsIlNtYXJ0Rm94U0RLIiwiQmFzZUNvbnRyb2xsZXIiLCJleHRlbmQiLCJtX3RhYmxlSW5mbyIsInJlZ2lzdGVyRXZlbnRzIiwiX3N1cGVyIiwiWm9uZUluc3RhbmNlIiwiYWRkRXZlbnRMaXN0ZW5lckV4dGVuc2lvbiIsIlJFU1BPTlNFX05BTUUiLCJMT0FEX0dBTUVfUkVTIiwib25Mb2FkR2FtZUV2ZW50IiwiQkVUX1JFUyIsIm9uVXNlckJldEV2ZW50IiwiRU5EX0JFVFRJTkciLCJvbkVuZEJldHRpbmdFdmVudCIsIkhJU1RPUllfUkVTVUxUIiwib25IaXN0b3J5UmVzdWx0RXZlbnQiLCJyZW1vdmVFdmVudHMiLCJyZW1vdmVFdmVudExpc3RlbmVyRXh0ZW5zaW9uIiwib25FdmVudExvZ2luIiwiZXZlbnQiLCJfcmVxdWVzdEpvaW5Sb29tIiwiem9uZU5hbWUiLCJvbkV2ZW50VXNlckV4aXRSb29tIiwidXNlciIsImlzSXRNZSIsImdldFVJIiwibm9kZSIsImFjdGl2ZSIsIlVJTWFuZ2VyIiwic2hvdyIsInByZUxvYWRVSSIsInBvcCIsIkxvYWRHYW1lRXZlbnQiLCJmcm9tRXZlbnQiLCJoaWRlQWxsIiwidXNlcnMiLCJwdXNoIiwibXlTZWxmIiwiaSIsImdldFJvb20iLCJnZXRVc2VyTGlzdCIsImxlbmd0aCIsInUiLCJuYW1lIiwic2hvd0xpc3RVc2VycyIsImlzQmV0dGluZyIsIl90dXJuT25UaW1lIiwidGltZSIsInNob3dOb3RpIiwiX3R1cm5PZmZUaW1lIiwicmVzdW1lR2FtZSIsIndpbnBvdCIsInVzZXJzT25ib2FyZCIsImNoaXBVc2VyT25Cb2FyZCIsInJlc3VsdCIsIndpbkNoaXAiLCJ1cGRhdGVUb3RhbEJldCIsInRvdGFsVXNlckJldCIsImFkZENoaXBUb1BvdCIsImxpc3RUeXBlUG90QmV0IiwibGlzdE15Q2hpcFBvdCIsImJpbmQiLCJ1c2VyQmV0IiwiQmV0RXZlbnQiLCJ1c2VyTmFtZSIsImJldENoaXAiLCJ0eXBlUG90IiwidG90YWxCZXQiLCJ1cGRhdGVMaXN0Q2hpcEJldCIsInJ1bkFjdGlvbkNoYW5nZU1vbmV5IiwiYWN0aW9uRmx5Q2hpcFRvUG90IiwiZ2V0VXNlckJ5TmFtZSIsInVwZGF0ZUNoaXAiLCJlbmRCZXR0aW5nIiwiRW5kQmV0dGluZyIsInNob3dSZXN1bHQiLCJoaXN0b3J5IiwiSGlzdG9yeVJlc3BvbnNlIiwic2hvd1NvaUNhdSIsIm9uSGlzdG9yeUV2ZW50IiwiaGlzdG9yeUV2ZW50IiwiSGlzdG9yeUV2ZW50Iiwic3JjIiwiZGF0YSIsIml0ZW1zIiwib25MZWFkZXJCb2FyZEV2ZW50IiwibGVhZGVyQm9hcmRFdmVudCIsIkxlYWRlckJvYXJkRXZlbnQiLCJvblB1YmxpY01lc3NhZ2UiLCJzZW5kZXIiLCJtc2ciLCJtZXNzYWdlIiwiZGF0YVNlbmRlciIsImRuIiwiZ2V0IiwiZmIiLCJtc2dJdGVtIiwiaW5zdGFuY2UiLCJnZXRJbnN0YW5jZSIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsSUFBSUEsYUFBYSxHQUFHQyxPQUFPLENBQUMsZUFBRCxDQUEzQjs7QUFDQSxJQUFJQyxrQkFBa0IsR0FBR0MsV0FBVyxDQUFDQyxjQUFaLENBQTJCQyxNQUEzQixDQUFrQztBQUN2REMsRUFBQUEsV0FBVyxFQUFHLElBRHlDO0FBRXZEQyxFQUFBQSxjQUZ1RCw0QkFFdkM7QUFDWixTQUFLQyxNQUFMOztBQUNBLFNBQUtDLFlBQUwsQ0FBa0JDLHlCQUFsQixDQUE0Q1YsYUFBYSxDQUFDVyxhQUFkLENBQTRCQyxhQUF4RSxFQUF1RixLQUFLQyxlQUE1RixFQUE2RyxJQUE3RztBQUNBLFNBQUtKLFlBQUwsQ0FBa0JDLHlCQUFsQixDQUE0Q1YsYUFBYSxDQUFDVyxhQUFkLENBQTRCRyxPQUF4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NkJRLE9BQTdCO0FBQ0g7QUF4R3NELENBQWxDLENBQXpCO0FBMEdBLElBQUlDLFFBQVEsR0FBRyxJQUFmOztBQUNBLElBQUlDLFdBQVcsR0FBRyxTQUFkQSxXQUFjLEdBQVk7QUFDMUIsTUFBR0QsUUFBUSxJQUFJLElBQWYsRUFDSUEsUUFBUSxHQUFHLElBQUluRyxrQkFBSixDQUF1QixZQUF2QixFQUFxQyxVQUFyQyxDQUFYO0FBQ0osU0FBT21HLFFBQVA7QUFDSCxDQUpEOztBQUtBbEcsV0FBVyxDQUFDRCxrQkFBWixHQUFpQ3FHLE1BQU0sQ0FBQ0MsT0FBUCxHQUFpQkYsV0FBVyxFQUE3RCIsInNvdXJjZVJvb3QiOiIvIiwic291cmNlc0NvbnRlbnQiOlsibGV0IFJvdWxldHRlRXZlbnQgPSByZXF1aXJlKCdSb3VsZXR0ZUV2ZW50JylcbmxldCBSb3VsZXR0ZUNvbnRyb2xsZXIgPSBTbWFydEZveFNESy5CYXNlQ29udHJvbGxlci5leHRlbmQoe1xuICAgIG1fdGFibGVJbmZvIDogbnVsbCxcbiAgICByZWdpc3RlckV2ZW50cygpe1xuICAgICAgICB0aGlzLl9zdXBlcigpO1xuICAgICAgICB0aGlzLlpvbmVJbnN0YW5jZS5hZGRFdmVudExpc3RlbmVyRXh0ZW5zaW9uKFJvdWxldHRlRXZlbnQuUkVTUE9OU0VfTkFNRS5MT0FEX0dBTUVfUkVTLCB0aGlzLm9uTG9hZEdhbWVFdmVudCwgdGhpcyk7XG4gICAgICAgIHRoaXMuWm9uZUluc3RhbmNlLmFkZEV2ZW50TGlzdGVuZXJFeHRlbnNpb24oUm91bGV0dGVFdmVudC5SRVNQT05TRV9OQU1FLkJFVF9SRVMsIHRoaXMub25Vc2VyQmV0RXZlbnQsIHRoaXMpO1xuICAgICAgICB0aGlzLlpvbmVJbnN0YW5jZS5hZGRFdmVudExpc3RlbmVyRXh0ZW5zaW9uKFJvdWxldHRlRXZlbnQuUkVTUE9OU0VfTkFNRS5FTkRfQkVUVElORywgdGhpcy5vbkVuZEJldHRpbmdFdmVudCwgdGhpcyk7XG4gICAgICAgIHRoaXMuWm9uZUluc3RhbmNlLmFkZEV2ZW50TGlzdGVuZXJFeHRlbnNpb24oUm91bGV0dGVFdmVudC5SRVNQT05TRV9OQU1FLkhJU1RPUllfUkVTVUxULCB0aGlzLm9uSGlzdG9yeVJlc3VsdEV2ZW50LCB0aGlzKTtcbiAgICB9LFxuICAgIHJlbW92ZUV2ZW50cygpe1xuICAgICAgICB0aGlzLl9zdXBlcigpO1xuICAgICAgICB0aGlzLlpvbmVJbnN0YW5jZS5yZW1vdmVFdmVudExpc3RlbmVyRXh0ZW5zaW9uKFJvdWxldHRlRXZlbnQuUkVTUE9OU0VfTkFNRS5MT0FEX0dBTUVfUkVTLCB0aGlzLm9uTG9hZEdhbWVFdmVudCwgdGhpcyk7XG4gICAgICAgIHRoaXMuWm9uZUluc3RhbmNlLnJlbW92ZUV2ZW50TGlzdGVuZXJFeHRlbnNpb24oUm91bGV0dGVFdmVudC5SRVNQT05TRV9OQU1FLkJFVF9SRVMsIHRoaXMub25Vc2VyQmV0RXZlbnQsIHRoaXMpO1xuICAgICAgICB0aGlzLlpvbmVJbnN0YW5jZS5yZW1vdmVFdmVudExpc3RlbmVyRXh0ZW5zaW9uKFJvdWxldHRlRXZlbnQuUkVTUE9OU0VfTkFNRS5FTkRfQkVUVElORywgdGhpcy5vbkVuZEJldHRpbmdFdmVudCwgdGhpcyk7XG4gICAgICAgIHRoaXMuWm9uZUluc3RhbmNlLnJlbW92ZUV2ZW50TGlzdGVuZXJFeHRlbnNpb24oUm91bGV0dGVFdmVudC5SRVNQT05TRV9OQU1FLkhJU1RPUllfUkVTVUxULCB0aGlzLm9uSGlzdG9yeVJlc3VsdEV2ZW50LCB0aGlzKTtcbiAgICB9LFxuICAgIG9uRXZlbnRMb2dpbihldmVudCl7XG4gICAgICAgIHRoaXMuX3N1cGVyKGV2ZW50KTtcbiAgICAgICAgdGhpcy5fcmVxdWVzdEpvaW5Sb29tKHRoaXMuem9uZU5hbWUpO1xuICAgIH0sXG4gICAgb25FdmVudFVzZXJFeGl0Um9vbShldmVudCl7XG4gICAgICAgIGxldCB1c2VyID0gZXZlbnQudXNlcjtcbiAgICAgICAgaWYodXNlci5pc0l0TWUpe1xuICAgICAgICAgICAgaWYgKHRoaXMuZ2V0VUkoKSAhPSBudWxsKVxuICAgICAgICAgICAgICAgIHRoaXMuZ2V0VUkoKS5ub2RlLmFjdGl2ZSA9IGZhbHNlO1xuICAgICAgICAgICAgVUlNYW5nZXIuc2hvdyhcIlVJSG9tZVwiKTtcbiAgICAgICAgfVxuICAgIH0sXG4gICAgb25Mb2FkR2FtZUV2ZW50KGV2ZW50KXtcbiAgICAgICAgdGhpcy5wcmVMb2FkVUkoe3BvcDogdHJ1ZX0sZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdGhpcy5tX3RhYmxlSW5mbyA9IG5ldyBSb3VsZXR0ZUV2ZW50LkxvYWRHYW1lRXZlbnQoKS5mcm9tRXZlbnQoZXZlbnQpO1xuICAgICAgICAgICAgdGhpcy5nZXRVSSgpLmhpZGVBbGwoKTtcbiAgICAgICAgICAgIGxldCB1c2VycyA9IFtdO1xuICAgICAgICAgICAgdXNlcnMucHVzaCh0aGlzLlpvbmVJbnN0YW5jZS5teVNlbGYpO1xuICAgICAgICAgICAgZm9yKGxldCBpID0gMDsgaSA8IHRoaXMuZ2V0Um9vbSgpLmdldFVzZXJMaXN0KCkubGVuZ3RoO2krKyl7XG4gICAgICAgICAgICAgICAgbGV0IHUgPSB0aGlzLmdldFJvb20oKS5nZXRVc2VyTGlzdCgpW2ldO1xuICAgICAgICAgICAgICAgIGlmKHUubmFtZSAhPSB0aGlzLlpvbmVJbnN0YW5jZS5teVNlbGYubmFtZSAmJiB1c2Vycy5sZW5ndGggPCA2KXtcbiAgICAgICAgICAgICAgICAgICAgdXNlcnMucHVzaCh1KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLmdldFVJKCkuc2hvd0xpc3RVc2Vycyh1c2Vycyk7XG4gICAgICAgICAgICBpZih0aGlzLm1fdGFibGVJbmZvLmlzQmV0dGluZyl7XG4gICAgICAgICAgICAgICAgdGhpcy5nZXRVSSgpLl90dXJuT25UaW1lKHRoaXMubV90YWJsZUluZm8udGltZSwgdGhpcy5tX3RhYmxlSW5mby50aW1lLCB0aGlzLm1fdGFibGVJbmZvLmlzQmV0dGluZyk7XG4gICAgICAgICAgICAgICAgdGhpcy5nZXRVSSgpLnNob3dOb3RpKFwiQuG6r3QgxJHhuqd1IGPGsOG7o2NcIik7XG4gICAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICAgICB0aGlzLmdldFVJKCkuX3R1cm5PZmZUaW1lKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5nZXRVSSgpLl90dXJuT25UaW1lKHRoaXMubV90YWJsZUluZm8udGltZSwgdGhpcy5tX3RhYmxlSW5mby50aW1lLCB0aGlzLm1fdGFibGVJbmZvLmlzQmV0dGluZyk7XG4gICAgICAgICAgICAgICAgdGhpcy5nZXRVSSgpLnJlc3VtZUdhbWUoIHRoaXMubV90YWJsZUluZm8ud2lucG90LCB0aGlzLm1fdGFibGVJbmZvLnRpbWUsIHRoaXMubV90YWJsZUluZm8udXNlcnNPbmJvYXJkLCB0aGlzLm1fdGFibGVJbmZvLmNoaXBVc2VyT25Cb2FyZCwgdGhpcy5tX3RhYmxlSW5mby5yZXN1bHQsICB0aGlzLm1fdGFibGVJbmZvLndpbkNoaXApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5nZXRVSSgpLnVwZGF0ZVRvdGFsQmV0KHRoaXMubV90YWJsZUluZm8udG90YWxVc2VyQmV0KTtcbiAgICAgICAgICAgIHRoaXMuZ2V0VUkoKS5hZGRDaGlwVG9Qb3QodGhpcy5tX3RhYmxlSW5mby5saXN0VHlwZVBvdEJldCwgdGhpcy5tX3RhYmxlSW5mby5saXN0TXlDaGlwUG90KTtcbiAgICAgICAgfS5iaW5kKHRoaXMpKVxuICAgIH0sXG4gICAgb25Vc2VyQmV0RXZlbnQoZXZlbnQpe1xuICAgICAgICBsZXQgdXNlckJldCA9IG5ldyBSb3VsZXR0ZUV2ZW50LkJldEV2ZW50KCkuZnJvbUV2ZW50KGV2ZW50KTtcbiAgICAgICAgbGV0IHVzZXJOYW1lID0gdXNlckJldC51c2VyTmFtZTtcbiAgICAgICAgbGV0IGJldENoaXAgPSB1c2VyQmV0LmJldENoaXA7XG4gICAgICAgIGxldCB0eXBlUG90ID0gdXNlckJldC50eXBlUG90O1xuICAgICAgICBsZXQgdG90YWxCZXQ9IHVzZXJCZXQudG90YWxCZXQ7XG4gICAgICAgIGlmKHRoaXMuWm9uZUluc3RhbmNlLm15U2VsZi5uYW1lID09IHVzZXJOYW1lKXtcbiAgICAgICAgICAgIHRoaXMuZ2V0VUkoKS51cGRhdGVMaXN0Q2hpcEJldCh1c2VyQmV0LnR5cGVQb3QsIHVzZXJCZXQuYmV0Q2hpcCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5nZXRVSSgpLnVwZGF0ZVRvdGFsQmV0KHRvdGFsQmV0KTtcbiAgICAgICAgdGhpcy5nZXRVSSgpLnJ1bkFjdGlvbkNoYW5nZU1vbmV5KHVzZXJOYW1lLCAtYmV0Q2hpcCwgMSk7XG4gICAgICAgIHRoaXMuZ2V0VUkoKS5hY3Rpb25GbHlDaGlwVG9Qb3QodXNlck5hbWUsIHR5cGVQb3QsIGJldENoaXApO1xuICAgICAgICBsZXQgdXNlciA9IHRoaXMuZ2V0Um9vbSgpLmdldFVzZXJCeU5hbWUodXNlck5hbWUpO1xuICAgICAgICBpZih1c2VyKVxuICAgICAgICAgICAgdGhpcy5nZXRVSSgpLnVwZGF0ZUNoaXAodXNlcik7XG4gICAgfSxcbiAgICBvbkVuZEJldHRpbmdFdmVudChldmVudCl7XG4gICAgICAgIGxldCBlbmRCZXR0aW5nID0gbmV3IFJvdWxldHRlRXZlbnQuRW5kQmV0dGluZygpLmZyb21FdmVudChldmVudCk7XG4gICAgICAgIHRoaXMubV90YWJsZUluZm8uaXNCZXR0aW5nICAgICAgID0gZmFsc2U7XG4gICAgICAgIHRoaXMubV90YWJsZUluZm8uY2hpcFVzZXJPbkJvYXJkID0gZW5kQmV0dGluZy5jaGlwVXNlck9uQm9hcmQ7XG4gICAgICAgIHRoaXMubV90YWJsZUluZm8udXNlcnNPbmJvYXJkICAgID0gZW5kQmV0dGluZy51c2Vyc09uYm9hcmQ7XG4gICAgICAgIHRoaXMubV90YWJsZUluZm8ud2lucG90ICAgICAgICAgID0gZW5kQmV0dGluZy53aW5wb3Q7XG4gICAgICAgIHRoaXMubV90YWJsZUluZm8ud2luQ2hpcCAgICAgICAgID0gZW5kQmV0dGluZy53aW5DaGlwO1xuICAgICAgICB0aGlzLm1fdGFibGVJbmZvLnJlc3VsdCAgICAgICAgICA9IGVuZEJldHRpbmcucmVzdWx0O1xuICAgICAgICB0aGlzLmdldFVJKCkuX3R1cm5PZmZUaW1lKCk7XG4gICAgICAgIHRoaXMuZ2V0VUkoKS5fdHVybk9uVGltZSgyMCwgMjAsIHRoaXMubV90YWJsZUluZm8uaXNCZXR0aW5nKTtcbiAgICAgICAgdGhpcy5nZXRVSSgpLnNob3dOb3RpKFwiS+G6v3QgdGjDumMgY8aw4bujYyFcIik7XG4gICAgICAgIHRoaXMuZ2V0VUkoKS5zaG93UmVzdWx0KHRoaXMubV90YWJsZUluZm8ucmVzdWx0KTtcbiAgICB9LFxuICAgIG9uSGlzdG9yeVJlc3VsdEV2ZW50KGV2ZW50KXtcbiAgICAgICAgbGV0IGhpc3RvcnkgPSBuZXcgUm91bGV0dGVFdmVudC5IaXN0b3J5UmVzcG9uc2UoKS5mcm9tRXZlbnQoZXZlbnQpO1xuICAgICAgICB0aGlzLmdldFVJKCkuc2hvd1NvaUNhdShoaXN0b3J5LnJlc3VsdCk7XG4gICAgfSxcbiAgICBvbkhpc3RvcnlFdmVudChldmVudCl7XG4gICAgICAgIGxldCBoaXN0b3J5RXZlbnQgPSBuZXcgUm91bGV0dGVFdmVudC5IaXN0b3J5RXZlbnQoKS5mcm9tRXZlbnQoZXZlbnQpO1xuICAgICAgICB0aGlzLmdldFVJKCkuc2hvdyhcIlVJUm91bGV0dGVUcmFuc2FjdGlvblwiLCB7cG9wOiB0cnVlLCBzcmM6ICdyb3VsZXR0ZScsIGRhdGE6IHtpdGVtczogaGlzdG9yeUV2ZW50Lml0ZW1zfX0pO1xuICAgIH0sXG4gICAgb25MZWFkZXJCb2FyZEV2ZW50KGV2ZW50KXtcbiAgICAgICAgbGV0IGxlYWRlckJvYXJkRXZlbnQgPSBuZXcgUm91bGV0dGVFdmVudC5MZWFkZXJCb2FyZEV2ZW50KCkuZnJvbUV2ZW50KGV2ZW50KTtcbiAgICAgICAgdGhpcy5nZXRVSSgpLnNob3coXCJVSVJvdWxldHRlUmFua1wiLCB7cG9wOiB0cnVlLCBzcmM6ICdyb3VsZXR0ZScsIGRhdGE6IHtpdGVtczogbGVhZGVyQm9hcmRFdmVudC5pdGVtc319KTtcbiAgICB9LFxuICAgIG9uUHVibGljTWVzc2FnZShldmVudCl7XG4gICAgICAgIGxldCBzZW5kZXIgPSBldmVudC5zZW5kZXI7XG4gICAgICAgIGxldCBtc2cgPSBldmVudC5tZXNzYWdlO1xuICAgICAgICBsZXQgZGF0YSA9IGV2ZW50LmRhdGE7XG4gICAgICAgIGxldCBkYXRhU2VuZGVyID0gZGF0YSAhPSBudWxsID8ge2RuOiBkYXRhLmdldChcImRuXCIpLCBmYiA6IGRhdGEuZ2V0KFwiZmJcIil9IDoge2RuOiBcIi4uLlwiLCBmYiA6IFwiXCJ9O1xuICAgICAgICBsZXQgbXNnSXRlbSA9IHt9O1xuICAgICAgICBtc2dJdGVtLnNlbmRlciA9IHNlbmRlcjtcbiAgICAgICAgbXNnSXRlbS5tc2cgPSBtc2c7XG4gICAgICAgIG1zZ0l0ZW0uZGF0YVNlbmRlciA9IGRhdGFTZW5kZXI7XG4gICAgICAgIHRoaXMuZ2V0VUkoKS5vblB1YmxpY01lc3NhZ2UobXNnSXRlbSk7XG4gICAgfSxcbn0pO1xubGV0IGluc3RhbmNlID0gbnVsbDtcbmxldCBnZXRJbnN0YW5jZSA9IGZ1bmN0aW9uICgpIHtcbiAgICBpZihpbnN0YW5jZSA9PSBudWxsKVxuICAgICAgICBpbnN0YW5jZSA9IG5ldyBSb3VsZXR0ZUNvbnRyb2xsZXIoJ1VJUm91bGV0dGUnLCAncm91bGV0dGUnKTtcbiAgICByZXR1cm4gaW5zdGFuY2U7XG59XG5TbWFydEZveFNESy5Sb3VsZXR0ZUNvbnRyb2xsZXIgPSBtb2R1bGUuZXhwb3J0cyA9IGdldEluc3RhbmNlKCk7XG4iXX0=