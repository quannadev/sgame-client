
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/scripts/rongho/RongHoController.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, 'ce1f1W1Q3FHpK8BxD09rRTH', 'RongHoController');
// scripts/rongho/RongHoController.js

"use strict";

var RongHoEvent = require('RongHoEvent');

var RongHoController = SmartFoxSDK.BaseController.extend({
  m_tableInfo: null,
  registerEvents: function registerEvents() {
    this._super();

    this.ZoneInstance.addEventListenerExtension(RongHoEvent.RESPONSE_NAME.LOAD_GAME_RES, this.onLoadGameEvent, this);
    this.ZoneInstance.addEventListenerExtension(RongHoEvent.RESPONSE_NAME.BET_RES, this.onUserBetEvent, this);
    this.ZoneInstance.addEventListenerExtension(RongHoEvent.RESPONSE_NAME.END_BETTING, this.onEndBettingEvent, this);
  },
  removeEvents: function removeEvents() {
    this._super();

    this.ZoneInstance.removeEventListenerExtension(RongHoEvent.RESPONSE_NAME.LOAD_GAME_RES, this.onLoadGameEvent, this);
    this.ZoneInstance.removeEventListenerExtension(RongHoEvent.RESPONSE_NAME.BET_RES, this.onUserBetEvent, this);
    this.ZoneInstance.removeEventListenerExtension(RongHoEvent.RESPONSE_NAME.END_BETTING, this.onEndBettingEvent, this);
  },
  onHistoryEvent: function onHistoryEvent(event) {
    var history = new RongHoEvent.HistoryEvent().fromEvent(event);
    this.getUI().show("UIRongHoTransaction", {
      pop: true,
      src: 'rongho',
      data: {
        items: history.items
      }
    });
  },
  onLeaderBoardEvent: function onLeaderBoardEvent(event) {
    var rank = new RongHoEvent.LeaderBoardEvent().fromEvent(event);
    this.getUI().show("UIRongHoRank", {
      pop: true,
      src: 'rongho',
      data: {
        items: rank.items
      }
    });
  },
  onEventLogin: function onEventLogin(event) {
    this._super(event);

    this._requestJoinRoom(this.zoneName);
  },
  onEventRoomJoin: function onEventRoomJoin(event) {
    this._super(event);

    if (this.getUI()) this.getUI().updateUserCount();
  },
  onEventUserEnterRoom: function onEventUserEnterRoom(event) {
    this._super(event);

    var user = event.user;

    if (this.getUI()) {
      this.getUI().updateUserCount();
      this.getUI().addNodePlayerEnterRoom(user);
    }
  },
  onEventUserExitRoom: function onEventUserExitRoom(event) {
    var user = event.user;

    if (user.isItMe) {
      if (this.getUI() != null) this.getUI().node.active = false;
      UIManger.show("UIHome");
    } else {
      if (this.getUI()) {
        this.getUI().updateUserCount();
        this.getUI().removeNodePlayer(user);
      }
    }
  },
  onLoadGameEvent: function onLoadGameEvent(event) {
    this.preLoadUI({
      pop: true
    }, function () {
      this.m_tableInfo = new RongHoEvent.LoadGameEvent().fromEvent(event);
      this.getUI().controller = this;
      cc.lastTime = this.m_tableInfo.time + new Date().getTime() / 1000;
      this.getUI().resetBetRongHo();
      this.resumeGame();
    }.bind(this));
  },
  resumeGame: function resumeGame() {
    if (this.m_tableInfo != null) {
      this.m_tableInfo.time = Math.floor(cc.lastTime - new Date().getTime() / 1000);
      this.getUI().showListMyChipBet(this.m_tableInfo.listMyChipPot);
      this.getUI().showListChipBet(this.m_tableInfo.listChipPot);
      var users = [];
      users.push(this.ZoneInstance.mySelf);

      for (var i = 0; i < this.getRoom().getUserList().length; i++) {
        var u = this.getRoom().getUserList()[i];

        if (u.name != this.ZoneInstance.mySelf.name && users.length < 6) {
          users.push(u);
        }
      }

      this.getUI().showListUsers(users);

      if (this.m_tableInfo.isBetting) {
        this.getUI()._stopEffectWinPot();

        this.getUI().ToastDatCua();

        this.getUI()._turnOnTime(this.m_tableInfo.time, this.m_tableInfo.isBetting);
      } else {
        this.getUI()._turnOffTime();

        this.getUI().xocxoc(this.m_tableInfo.result, this.m_tableInfo.winpot, this.m_tableInfo.isWin);
      }
    }
  },
  onUserBetEvent: function onUserBetEvent(event) {
    var userBet = new RongHoEvent.BetEvent().fromEvent(event);
    var userName = userBet.userName;
    var betChip = userBet.betChip;
    var typePot = userBet.typePot;
    this.m_tableInfo.listChipPot[typePot] += betChip;
    this.getUI().showListChipBet(this.m_tableInfo.listChipPot);

    if (this.ZoneInstance.mySelf.name == userName) {
      this.m_tableInfo.listMyChipPot[typePot] += betChip;
      this.getUI().showListMyChipBet(this.m_tableInfo.listMyChipPot);
    }

    this.getUI().actionFlyChipToPot(userName, typePot, betChip); // user bet

    var user = this.getRoom().getUserByName(userName);
    if (user) this.getUI().updateChip(user);
  },
  onEndBettingEvent: function onEndBettingEvent(event) {
    var endBetting = new RongHoEvent.EndBetting().fromEvent(event);
    this.m_tableInfo.isBetting = false;
    this.m_tableInfo.result = endBetting.result;
    this.m_tableInfo.winpot = endBetting.winpot;
    this.m_tableInfo.winChip = endBetting.winChip;

    this.getUI()._turnOffTime();

    this.getUI().xocxoc(endBetting.result, endBetting.winpot, endBetting.winChip > 0 ? true : false);
  },
  onPublicMessage: function onPublicMessage(event) {
    var sender = event.sender;
    var msg = event.message;
    var data = event.data;
    var dataSender = data != null ? {
      dn: data.get("dn"),
      fb: data.get("fb")
    } : {
      dn: "...",
      fb: ""
    };
    var msgItem = {};
    msgItem.sender = sender;
    msgItem.msg = msg;
    msgItem.dataSender = dataSender;
    this.getUI().onPublicMessage(msgItem);
  }
});
var instance = null;

var getInstance = function getInstance() {
  if (instance == null) instance = new RongHoController('UIRongHo', 'rongho');
  return instance;
};

SmartFoxSDK.RongHoController = module.exports = getInstance();

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0cy9zY3JpcHRzL3Jvbmdoby9Sb25nSG9Db250cm9sbGVyLmpzIl0sIm5hbWVzIjpbIlJvbmdIb0V2ZW50IiwicmVxdWlyZSIsIlJvbmdIb0NvbnRyb2xsZXIiLCJTbWFydEZveFNESyIsIkJhc2VDb250cm9sbGVyIiwiZXh0ZW5kIiwibV90YWJsZUluZm8iLCJyZWdpc3RlckV2ZW50cyIsIl9zdXBlciIsIlpvbmVJbnN0YW5jZSIsImFkZEV2ZW50TGlzdGVuZXJFeHRlbnNpb24iLCJSRVNQT05TRV9OQU1FIiwiTE9BRF9HQU1FX1JFUyIsIm9uTG9hZEdhbWVFdmVudCIsIkJFVF9SRVMiLCJvblVzZXJCZXRFdmVudCIsIkVORF9CRVRUSU5HIiwib25FbmRCZXR0aW5nRXZlbnQiLCJyZW1vdmVFdmVudHMiLCJyZW1vdmVFdmVudExpc3RlbmVyRXh0ZW5zaW9uIiwib25IaXN0b3J5RXZlbnQiLCJldmVudCIsImhpc3RvcnkiLCJIaXN0b3J5RXZlbnQiLCJmcm9tRXZlbnQiLCJnZXRVSSIsInNob3ciLCJwb3AiLCJzcmMiLCJkYXRhIiwiaXRlbXMiLCJvbkxlYWRlckJvYXJkRXZlbnQiLCJyYW5rIiwiTGVhZGVyQm9hcmRFdmVudCIsIm9uRXZlbnRMb2dpbiIsIl9yZXF1ZXN0Sm9pblJvb20iLCJ6b25lTmFtZSIsIm9uRXZlbnRSb29tSm9pbiIsInVwZGF0ZVVzZXJDb3VudCIsIm9uRXZlbnRVc2VyRW50ZXJSb29tIiwidXNlciIsImFkZE5vZGVQbGF5ZXJFbnRlclJvb20iLCJvbkV2ZW50VXNlckV4aXRSb29tIiwiaXNJdE1lIiwibm9kZSIsImFjdGl2ZSIsIlVJTWFuZ2VyIiwicmVtb3ZlTm9kZVBsYXllciIsInByZUxvYWRVSSIsIkxvYWRHYW1lRXZlbnQiLCJjb250cm9sbGVyIiwiY2MiLCJsYXN0VGltZSIsInRpbWUiLCJEYXRlIiwiZ2V0VGltZSIsInJlc2V0QmV0Um9uZ0hvIiwicmVzdW1lR2FtZSIsImJpbmQiLCJNYXRoIiwiZmxvb3IiLCJzaG93TGlzdE15Q2hpcEJldCIsImxpc3RNeUNoaXBQb3QiLCJzaG93TGlzdENoaXBCZXQiLCJsaXN0Q2hpcFBvdCIsInVzZXJzIiwicHVzaCIsIm15U2VsZiIsImkiLCJnZXRSb29tIiwiZ2V0VXNlckxpc3QiLCJsZW5ndGgiLCJ1IiwibmFtZSIsInNob3dMaXN0VXNlcnMiLCJpc0JldHRpbmciLCJfc3RvcEVmZmVjdFdpblBvdCIsIlRvYXN0RGF0Q3VhIiwiX3R1cm5PblRpbWUiLCJfdHVybk9mZlRpbWUiLCJ4b2N4b2MiLCJyZXN1bHQiLCJ3aW5wb3QiLCJpc1dpbiIsInVzZXJCZXQiLCJCZXRFdmVudCIsInVzZXJOYW1lIiwiYmV0Q2hpcCIsInR5cGVQb3QiLCJhY3Rpb25GbHlDaGlwVG9Qb3QiLCJnZXRVc2VyQnlOYW1lIiwidXBkYXRlQ2hpcCIsImVuZEJldHRpbmciLCJFbmRCZXR0aW5nIiwid2luQ2hpcCIsIm9uUHVibGljTWVzc2FnZSIsInNlbmRlciIsIm1zZyIsIm1lc3NhZ2UiLCJkYXRhU2VuZGVyIiwiZG4iLCJnZXQiLCJmYiIsIm1zZ0l0ZW0iLCJpbnN0YW5jZSIsImdldEluc3RhbmNlIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSxJQUFJQSxXQUFXLEdBQUdDLE9BQU8sQ0FBQyxhQUFELENBQXpCOztBQUNBLElBQUlDLGdCQUFnQixHQUFHQyxXQUFXLENBQUNDLGNBQVosQ0FBMkJDLE1BQTNCLENBQWtDO0FBQ3JEQyxFQUFBQSxXQUFXLEVBQUcsSUFEdUM7QUFFckRDLEVBQUFBLGNBRnFELDRCQUVyQztBQUNaLFNBQUtDLE1BQUw7O0FBQ0EsU0FBS0MsWUFBTCxDQUFrQkMseUJBQWxCLENBQTRDVixXQUFXLENBQUNXLGFBQVosQ0FBMEJDLGFBQXRFLEVBQXFGLEtBQUtDLGVBQTFGLEVBQTJHLElBQTNHO0FBQ0EsU0FBS0osWUFBTCxDQUFrQkMseUJBQWxCLENBQTRDVixXQUFXLENBQUNXLGFBQVosQ0FBMEJHLE9BQXRFLEVBQStF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QXJCO0FBQ0EsU0FBSzFFLEtBQUwsR0FBYXNFLGVBQWIsQ0FBNkJRLE9BQTdCO0FBQ0g7QUExSG9ELENBQWxDLENBQXZCO0FBNEhBLElBQUlDLFFBQVEsR0FBRyxJQUFmOztBQUNBLElBQUlDLFdBQVcsR0FBRyxTQUFkQSxXQUFjLEdBQVk7QUFDMUIsTUFBR0QsUUFBUSxJQUFJLElBQWYsRUFDSUEsUUFBUSxHQUFHLElBQUl0RyxnQkFBSixDQUFxQixVQUFyQixFQUFpQyxRQUFqQyxDQUFYO0FBQ0osU0FBT3NHLFFBQVA7QUFDSCxDQUpEOztBQUtBckcsV0FBVyxDQUFDRCxnQkFBWixHQUErQndHLE1BQU0sQ0FBQ0MsT0FBUCxHQUFpQkYsV0FBVyxFQUEzRCIsInNvdXJjZVJvb3QiOiIvIiwic291cmNlc0NvbnRlbnQiOlsibGV0IFJvbmdIb0V2ZW50ID0gcmVxdWlyZSgnUm9uZ0hvRXZlbnQnKVxubGV0IFJvbmdIb0NvbnRyb2xsZXIgPSBTbWFydEZveFNESy5CYXNlQ29udHJvbGxlci5leHRlbmQoe1xuICAgIG1fdGFibGVJbmZvIDogbnVsbCxcbiAgICByZWdpc3RlckV2ZW50cygpe1xuICAgICAgICB0aGlzLl9zdXBlcigpO1xuICAgICAgICB0aGlzLlpvbmVJbnN0YW5jZS5hZGRFdmVudExpc3RlbmVyRXh0ZW5zaW9uKFJvbmdIb0V2ZW50LlJFU1BPTlNFX05BTUUuTE9BRF9HQU1FX1JFUywgdGhpcy5vbkxvYWRHYW1lRXZlbnQsIHRoaXMpO1xuICAgICAgICB0aGlzLlpvbmVJbnN0YW5jZS5hZGRFdmVudExpc3RlbmVyRXh0ZW5zaW9uKFJvbmdIb0V2ZW50LlJFU1BPTlNFX05BTUUuQkVUX1JFUywgdGhpcy5vblVzZXJCZXRFdmVudCwgdGhpcyk7XG4gICAgICAgIHRoaXMuWm9uZUluc3RhbmNlLmFkZEV2ZW50TGlzdGVuZXJFeHRlbnNpb24oUm9uZ0hvRXZlbnQuUkVTUE9OU0VfTkFNRS5FTkRfQkVUVElORywgdGhpcy5vbkVuZEJldHRpbmdFdmVudCwgdGhpcyk7XG4gICAgfSxcbiAgICByZW1vdmVFdmVudHMoKXtcbiAgICAgICAgdGhpcy5fc3VwZXIoKTtcbiAgICAgICAgdGhpcy5ab25lSW5zdGFuY2UucmVtb3ZlRXZlbnRMaXN0ZW5lckV4dGVuc2lvbihSb25nSG9FdmVudC5SRVNQT05TRV9OQU1FLkxPQURfR0FNRV9SRVMsIHRoaXMub25Mb2FkR2FtZUV2ZW50LCB0aGlzKTtcbiAgICAgICAgdGhpcy5ab25lSW5zdGFuY2UucmVtb3ZlRXZlbnRMaXN0ZW5lckV4dGVuc2lvbihSb25nSG9FdmVudC5SRVNQT05TRV9OQU1FLkJFVF9SRVMsIHRoaXMub25Vc2VyQmV0RXZlbnQsIHRoaXMpO1xuICAgICAgICB0aGlzLlpvbmVJbnN0YW5jZS5yZW1vdmVFdmVudExpc3RlbmVyRXh0ZW5zaW9uKFJvbmdIb0V2ZW50LlJFU1BPTlNFX05BTUUuRU5EX0JFVFRJTkcsIHRoaXMub25FbmRCZXR0aW5nRXZlbnQsIHRoaXMpO1xuICAgIH0sXG4gICAgb25IaXN0b3J5RXZlbnQoZXZlbnQpe1xuICAgICAgICBsZXQgaGlzdG9yeSA9IG5ldyBSb25nSG9FdmVudC5IaXN0b3J5RXZlbnQoKS5mcm9tRXZlbnQoZXZlbnQpO1xuICAgICAgICB0aGlzLmdldFVJKCkuc2hvdyhcIlVJUm9uZ0hvVHJhbnNhY3Rpb25cIiwge3BvcDogdHJ1ZSwgc3JjOiAncm9uZ2hvJywgZGF0YToge2l0ZW1zOiBoaXN0b3J5Lml0ZW1zfX0pO1xuICAgIH0sXG4gICAgb25MZWFkZXJCb2FyZEV2ZW50KGV2ZW50KXtcbiAgICAgICAgbGV0IHJhbmsgPSBuZXcgUm9uZ0hvRXZlbnQuTGVhZGVyQm9hcmRFdmVudCgpLmZyb21FdmVudChldmVudCk7XG4gICAgICAgIHRoaXMuZ2V0VUkoKS5zaG93KFwiVUlSb25nSG9SYW5rXCIsIHtwb3A6IHRydWUsIHNyYzogJ3JvbmdobycsIGRhdGE6IHtpdGVtczogcmFuay5pdGVtc319KTtcbiAgICB9LFxuICAgIG9uRXZlbnRMb2dpbihldmVudCl7XG4gICAgICAgIHRoaXMuX3N1cGVyKGV2ZW50KTtcbiAgICAgICAgdGhpcy5fcmVxdWVzdEpvaW5Sb29tKHRoaXMuem9uZU5hbWUpO1xuICAgIH0sXG4gICAgb25FdmVudFJvb21Kb2luKGV2ZW50KXtcbiAgICAgICAgdGhpcy5fc3VwZXIoZXZlbnQpO1xuICAgICAgICBpZih0aGlzLmdldFVJKCkpXG4gICAgICAgICAgICB0aGlzLmdldFVJKCkudXBkYXRlVXNlckNvdW50KCk7XG4gICAgfSxcbiAgICBvbkV2ZW50VXNlckVudGVyUm9vbShldmVudCl7XG4gICAgICAgIHRoaXMuX3N1cGVyKGV2ZW50KTtcbiAgICAgICAgbGV0IHVzZXIgPSBldmVudC51c2VyO1xuICAgICAgICBpZih0aGlzLmdldFVJKCkpe1xuICAgICAgICAgICAgdGhpcy5nZXRVSSgpLnVwZGF0ZVVzZXJDb3VudCgpO1xuICAgICAgICAgICAgdGhpcy5nZXRVSSgpLmFkZE5vZGVQbGF5ZXJFbnRlclJvb20odXNlcik7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIG9uRXZlbnRVc2VyRXhpdFJvb20oZXZlbnQpe1xuICAgICAgICBsZXQgdXNlciA9IGV2ZW50LnVzZXI7XG4gICAgICAgIGlmKHVzZXIuaXNJdE1lKXtcbiAgICAgICAgICAgIGlmICh0aGlzLmdldFVJKCkgIT0gbnVsbClcbiAgICAgICAgICAgICAgICB0aGlzLmdldFVJKCkubm9kZS5hY3RpdmUgPSBmYWxzZTtcbiAgICAgICAgICAgIFVJTWFuZ2VyLnNob3coXCJVSUhvbWVcIik7XG4gICAgICAgIH1lbHNle1xuICAgICAgICAgICAgaWYodGhpcy5nZXRVSSgpKXtcbiAgICAgICAgICAgICAgICB0aGlzLmdldFVJKCkudXBkYXRlVXNlckNvdW50KCk7XG4gICAgICAgICAgICAgICAgdGhpcy5nZXRVSSgpLnJlbW92ZU5vZGVQbGF5ZXIodXNlcik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9LFxuICAgIG9uTG9hZEdhbWVFdmVudChldmVudCl7XG4gICAgICAgIHRoaXMucHJlTG9hZFVJKHtwb3A6IHRydWV9LGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHRoaXMubV90YWJsZUluZm8gPSBuZXcgUm9uZ0hvRXZlbnQuTG9hZEdhbWVFdmVudCgpLmZyb21FdmVudChldmVudCk7XG4gICAgICAgICAgICB0aGlzLmdldFVJKCkuY29udHJvbGxlciA9IHRoaXM7XG4gICAgICAgICAgICBjYy5sYXN0VGltZSAgICAgID0gdGhpcy5tX3RhYmxlSW5mby50aW1lICsgbmV3IERhdGUoKS5nZXRUaW1lKCkvMTAwMDtcbiAgICAgICAgICAgIHRoaXMuZ2V0VUkoKS5yZXNldEJldFJvbmdIbygpO1xuICAgICAgICAgICAgdGhpcy5yZXN1bWVHYW1lKCk7XG4gICAgICAgIH0uYmluZCh0aGlzKSlcbiAgICB9LFxuICAgIHJlc3VtZUdhbWUoKSB7XG4gICAgICAgIGlmICh0aGlzLm1fdGFibGVJbmZvICE9IG51bGwpIHtcbiAgICAgICAgICAgIHRoaXMubV90YWJsZUluZm8udGltZSA9IE1hdGguZmxvb3IoY2MubGFzdFRpbWUgLSBuZXcgRGF0ZSgpLmdldFRpbWUoKSAvIDEwMDApO1xuICAgICAgICAgICAgdGhpcy5nZXRVSSgpLnNob3dMaXN0TXlDaGlwQmV0KHRoaXMubV90YWJsZUluZm8ubGlzdE15Q2hpcFBvdCk7XG4gICAgICAgICAgICB0aGlzLmdldFVJKCkuc2hvd0xpc3RDaGlwQmV0KHRoaXMubV90YWJsZUluZm8ubGlzdENoaXBQb3QpO1xuICAgICAgICAgICAgbGV0IHVzZXJzID0gW107XG4gICAgICAgICAgICB1c2Vycy5wdXNoKHRoaXMuWm9uZUluc3RhbmNlLm15U2VsZik7XG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuZ2V0Um9vbSgpLmdldFVzZXJMaXN0KCkubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICBsZXQgdSA9IHRoaXMuZ2V0Um9vbSgpLmdldFVzZXJMaXN0KClbaV07XG4gICAgICAgICAgICAgICAgaWYgKHUubmFtZSAhPSB0aGlzLlpvbmVJbnN0YW5jZS5teVNlbGYubmFtZSAmJiB1c2Vycy5sZW5ndGggPCA2KSB7XG4gICAgICAgICAgICAgICAgICAgIHVzZXJzLnB1c2godSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5nZXRVSSgpLnNob3dMaXN0VXNlcnModXNlcnMpO1xuICAgICAgICAgICAgaWYgKHRoaXMubV90YWJsZUluZm8uaXNCZXR0aW5nKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5nZXRVSSgpLl9zdG9wRWZmZWN0V2luUG90KCk7XG4gICAgICAgICAgICAgICAgdGhpcy5nZXRVSSgpLlRvYXN0RGF0Q3VhKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5nZXRVSSgpLl90dXJuT25UaW1lKHRoaXMubV90YWJsZUluZm8udGltZSwgdGhpcy5tX3RhYmxlSW5mby5pc0JldHRpbmcpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLmdldFVJKCkuX3R1cm5PZmZUaW1lKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5nZXRVSSgpLnhvY3hvYyh0aGlzLm1fdGFibGVJbmZvLnJlc3VsdCwgdGhpcy5tX3RhYmxlSW5mby53aW5wb3QsIHRoaXMubV90YWJsZUluZm8uaXNXaW4pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSxcbiAgICBvblVzZXJCZXRFdmVudChldmVudCl7XG4gICAgICAgIGxldCB1c2VyQmV0ID0gbmV3IFJvbmdIb0V2ZW50LkJldEV2ZW50KCkuZnJvbUV2ZW50KGV2ZW50KTtcbiAgICAgICAgbGV0IHVzZXJOYW1lID0gdXNlckJldC51c2VyTmFtZTtcbiAgICAgICAgbGV0IGJldENoaXAgPSB1c2VyQmV0LmJldENoaXA7XG4gICAgICAgIGxldCB0eXBlUG90ID0gdXNlckJldC50eXBlUG90O1xuXG4gICAgICAgIHRoaXMubV90YWJsZUluZm8ubGlzdENoaXBQb3RbdHlwZVBvdF0gKz0gYmV0Q2hpcDtcbiAgICAgICAgdGhpcy5nZXRVSSgpLnNob3dMaXN0Q2hpcEJldCh0aGlzLm1fdGFibGVJbmZvLmxpc3RDaGlwUG90KTtcbiAgICAgICAgaWYodGhpcy5ab25lSW5zdGFuY2UubXlTZWxmLm5hbWUgPT0gdXNlck5hbWUpe1xuICAgICAgICAgICAgdGhpcy5tX3RhYmxlSW5mby5saXN0TXlDaGlwUG90W3R5cGVQb3RdICs9IGJldENoaXA7XG4gICAgICAgICAgICB0aGlzLmdldFVJKCkuc2hvd0xpc3RNeUNoaXBCZXQodGhpcy5tX3RhYmxlSW5mby5saXN0TXlDaGlwUG90KTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmdldFVJKCkuYWN0aW9uRmx5Q2hpcFRvUG90KHVzZXJOYW1lLCB0eXBlUG90LCBiZXRDaGlwKTtcbiAgICAgICAgLy8gdXNlciBiZXRcbiAgICAgICAgbGV0IHVzZXIgPSB0aGlzLmdldFJvb20oKS5nZXRVc2VyQnlOYW1lKHVzZXJOYW1lKTtcbiAgICAgICAgaWYodXNlcilcbiAgICAgICAgICAgIHRoaXMuZ2V0VUkoKS51cGRhdGVDaGlwKHVzZXIpO1xuICAgIH0sXG4gICAgb25FbmRCZXR0aW5nRXZlbnQoZXZlbnQpe1xuICAgICAgICBsZXQgZW5kQmV0dGluZyA9IG5ldyBSb25nSG9FdmVudC5FbmRCZXR0aW5nKCkuZnJvbUV2ZW50KGV2ZW50KTtcbiAgICAgICAgdGhpcy5tX3RhYmxlSW5mby5pc0JldHRpbmcgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5tX3RhYmxlSW5mby5yZXN1bHQgID0gZW5kQmV0dGluZy5yZXN1bHQ7XG4gICAgICAgIHRoaXMubV90YWJsZUluZm8ud2lucG90ICA9IGVuZEJldHRpbmcud2lucG90O1xuICAgICAgICB0aGlzLm1fdGFibGVJbmZvLndpbkNoaXAgPSBlbmRCZXR0aW5nLndpbkNoaXA7XG4gICAgICAgIHRoaXMuZ2V0VUkoKS5fdHVybk9mZlRpbWUoKTtcbiAgICAgICAgdGhpcy5nZXRVSSgpLnhvY3hvYyhlbmRCZXR0aW5nLnJlc3VsdCwgZW5kQmV0dGluZy53aW5wb3QsICBlbmRCZXR0aW5nLndpbkNoaXAgPiAwID8gdHJ1ZSA6IGZhbHNlKTtcbiAgICB9LFxuICAgIG9uUHVibGljTWVzc2FnZShldmVudCl7XG4gICAgICAgIGxldCBzZW5kZXIgPSBldmVudC5zZW5kZXI7XG4gICAgICAgIGxldCBtc2cgPSBldmVudC5tZXNzYWdlO1xuICAgICAgICBsZXQgZGF0YSA9IGV2ZW50LmRhdGE7XG4gICAgICAgIGxldCBkYXRhU2VuZGVyID0gZGF0YSAhPSBudWxsID8ge2RuOiBkYXRhLmdldChcImRuXCIpLCBmYiA6IGRhdGEuZ2V0KFwiZmJcIil9IDoge2RuOiBcIi4uLlwiLCBmYiA6IFwiXCJ9O1xuICAgICAgICBsZXQgbXNnSXRlbSA9IHt9O1xuICAgICAgICBtc2dJdGVtLnNlbmRlciA9IHNlbmRlcjtcbiAgICAgICAgbXNnSXRlbS5tc2cgPSBtc2c7XG4gICAgICAgIG1zZ0l0ZW0uZGF0YVNlbmRlciA9IGRhdGFTZW5kZXI7XG4gICAgICAgIHRoaXMuZ2V0VUkoKS5vblB1YmxpY01lc3NhZ2UobXNnSXRlbSk7XG4gICAgfSxcbn0pO1xubGV0IGluc3RhbmNlID0gbnVsbDtcbmxldCBnZXRJbnN0YW5jZSA9IGZ1bmN0aW9uICgpIHtcbiAgICBpZihpbnN0YW5jZSA9PSBudWxsKVxuICAgICAgICBpbnN0YW5jZSA9IG5ldyBSb25nSG9Db250cm9sbGVyKCdVSVJvbmdIbycsICdyb25naG8nKTtcbiAgICByZXR1cm4gaW5zdGFuY2U7XG59XG5TbWFydEZveFNESy5Sb25nSG9Db250cm9sbGVyID0gbW9kdWxlLmV4cG9ydHMgPSBnZXRJbnN0YW5jZSgpO1xuIl19