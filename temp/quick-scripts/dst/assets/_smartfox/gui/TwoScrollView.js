
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/_smartfox/gui/TwoScrollView.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '9a4f8BGOLxGoY0ou8QG16sf', 'TwoScrollView');
// _smartfox/gui/TwoScrollView.js

"use strict";

var self;
cc.Class({
  "extends": cc.ViewGroup,
  properties: {
    scrollView: cc.ScrollView,
    parentListView: cc.ScrollView,
    cancelInnerEvents: {
      "default": true,
      animatable: false
    }
  },
  onLoad: function onLoad() {
    self = this;
    this.direction = null;
    this.start_loc = null;
    this.node.on(cc.Node.EventType.TOUCH_START, this._onTouchBegan, this, true);
    this.node.on(cc.Node.EventType.TOUCH_MOVE, this._onTouchMoved, this, true);
    this.node.on(cc.Node.EventType.TOUCH_END, this._onTouchEnded, this, true);
    this.node.on(cc.Node.EventType.TOUCH_CANCEL, this._onTouchCancelled, this, true);
    this.scrollView.stopAutoScroll();
  },
  update: function update() {
    if (this.parentListView.getContentPosition().y < 500) {
      if (this.scrollView.vertical) {
        this.scrollView.vertical = false;
        this.parentListView.vertical = true;
      }
    } else {
      if (!this.scrollView.vertical) {
        this.scrollView.vertical = true;
        this.parentListView.vertical = false;
      } else {
        if (this.scrollView.getContentPosition().y < 5) {
          if (this.scrollView.vertical) {
            this.scrollView.vertical = false;
            this.parentListView.vertical = true;
          }
        }
      }
    }
  },
  //this is for nested scrollview
  _hasNestedViewGroup: function _hasNestedViewGroup(event, captureListeners) {
    if (event.eventPhase !== cc.Event.CAPTURING_PHASE) return;

    if (captureListeners) {
      //captureListeners are arranged from child to parent
      for (var i = 0; i < captureListeners.length; ++i) {
        var item = captureListeners[i];

        if (this.node === item) {
          if (event.target.getComponent(cc.ViewGroup)) {
            return true;
          }

          return false;
        }

        if (item.getComponent(cc.ViewGroup)) {
          return true;
        }
      }
    }

    return false;
  },
  //This is for Scrollview as children of a Button
  _stopPropagationIfTargetIsMe: function _stopPropagationIfTargetIsMe(event) {
    if (event.eventPhase === cc.Event.AT_TARGET && event.target === this.node) {
      event.stopPropagation();
    }
  },
  // touch event handler
  _onTouchBegan: function _onTouchBegan(event, captureListeners) {
    if (!this.enabledInHierarchy) return;
    if (this._hasNestedViewGroup(event, captureListeners)) return;
    var touch = event.touch;
    this.start_loc = event.touch.getLocation();

    if (this.node) {
      if (this.parentListView) {
        this.parentListView._handlePressLogic(touch);
      }

      if (this.scrollView) {
        this.scrollView._handlePressLogic(touch);
      }
    }

    this._touchMoved = false;

    this._stopPropagationIfTargetIsMe(event);
  },
  _onTouchMoved: function _onTouchMoved(event, captureListeners) {
    var now_pos = event.touch.getLocation();
    var delta_x = Math.abs(this.start_loc.x - now_pos.x);
    var delta_y = Math.abs(this.start_loc.y - now_pos.y);

    if ((delta_x > 5 || delta_y > 5) && !this.direction) {
      this.direction = delta_x < delta_y ? "parent_scrollview_move" : "scrollview_move";
    }

    if (!this.enabledInHierarchy) return;
    if (this._hasNestedViewGroup(event, captureListeners)) return;
    var touch = event.touch;

    if (this.node) {
      this._handleMoveLogic(touch);
    } // Do not prevent touch events in inner nodes


    if (!this.cancelInnerEvents) {
      return;
    }

    var deltaMove = touch.getLocation().sub(touch.getStartLocation()); //FIXME: touch move delta should be calculated by DPI.

    if (deltaMove.mag() > 7) {
      if (!this._touchMoved && event.target !== this.node) {
        // Simulate touch cancel for target node
        var cancelEvent = new cc.Event.EventTouch(event.getTouches(), event.bubbles);
        cancelEvent.type = cc.Node.EventType.TOUCH_CANCEL;
        cancelEvent.touch = event.touch;
        cancelEvent.simulate = true;
        event.target.dispatchEvent(cancelEvent);
        this._touchMoved = true;
      }
    }

    this._stopPropagationIfTargetIsMe(event);
  },
  _onTouchEnded: function _onTouchEnded(event, captureListeners) {
    this.direction = null;
    if (!this.enabledInHierarchy) return;
    if (this._hasNestedViewGroup(event, captureListeners)) return;
    var touch = event.touch;

    if (this.node) {
      this._handleReleaseLogic(touch);
    }

    if (this.parentListView) {
      this.parentListView._dispatchEvent('touch-up');
    }

    if (this.scrollView) {
      this.scrollView._dispatchEvent('touch-up');
    }

    if (this._touchMoved) {
      event.stopPropagation();
    } else {
      this._stopPropagationIfTargetIsMe(event);
    }
  },
  _onTouchCancelled: function _onTouchCancelled(event, captureListeners) {
    this.direction = null;
    if (!this.enabledInHierarchy) return;
    if (this._hasNestedViewGroup(event, captureListeners)) return; // Filte touch cancel event send from self

    if (!event.simulate) {
      var touch = event.touch;

      if (this.node) {
        this._handleReleaseLogic(touch);
      }
    }

    this._stopPropagationIfTargetIsMe(event);
  },
  _clampDelta: function _clampDelta(delta) {
    var x = Math.abs(delta.x);
    var y = Math.abs(delta.y);

    if (x < y) {
      delta.x = 0;
    } else {
      delta.y = 0;
    }

    return delta;
  },
  _handleMoveLogic: function _handleMoveLogic(touch) {
    var deltaMove = this._clampDelta(touch.getDelta());

    if (this.direction === "parent_scrollview_move") {
      if (this.parentListView) {
        this.parentListView._processDeltaMove(deltaMove);
      }
    } else {
      if (this.scrollView) {
        this.scrollView._processDeltaMove(deltaMove);
      }

      if (this.parentListView) {
        this.parentListView._processDeltaMove(deltaMove);
      }
    }
  },
  _handleReleaseLogic: function _handleReleaseLogic(touch) {
    var delta = touch.getDelta();
    delta = this._clampDelta(delta);

    if (this.parentListView) {
      this.parentListView._gatherTouchMove(delta);

      this.parentListView._processInertiaScroll();
    }

    if (this.scrollView) {
      this.scrollView._gatherTouchMove(delta);

      this.scrollView._processInertiaScroll();
    }
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcX3NtYXJ0Zm94XFxndWlcXFR3b1Njcm9sbFZpZXcuanMiXSwibmFtZXMiOlsic2VsZiIsImNjIiwiQ2xhc3MiLCJWaWV3R3JvdXAiLCJwcm9wZXJ0aWVzIiwic2Nyb2xsVmlldyIsIlNjcm9sbFZpZXciLCJwYXJlbnRMaXN0VmlldyIsImNhbmNlbElubmVyRXZlbnRzIiwiYW5pbWF0YWJsZSIsIm9uTG9hZCIsImRpcmVjdGlvbiIsInN0YXJ0X2xvYyIsIm5vZGUiLCJvbiIsIk5vZGUiLCJFdmVudFR5cGUiLCJUT1VDSF9TVEFSVCIsIl9vblRvdWNoQmVnYW4iLCJUT1VDSF9NT1ZFIiwiX29uVG91Y2hNb3ZlZCIsIlRPVUNIX0VORCIsIl9vblRvdWNoRW5kZWQiLCJUT1VDSF9DQU5DRUwiLCJfb25Ub3VjaENhbmNlbGxlZCIsInN0b3BBdXRvU2Nyb2xsIiwidXBkYXRlIiwiZ2V0Q29udGVudFBvc2l0aW9uIiwieSIsInZlcnRpY2FsIiwiX2hhc05lc3RlZFZpZXdHcm91cCIsImV2ZW50IiwiY2FwdHVyZUxpc3RlbmVycyIsImV2ZW50UGhhc2UiLCJFdmVudCIsIkNBUFRVUklOR19QSEFTRSIsImkiLCJsZW5ndGgiLCJpdGVtIiwidGFyZ2V0IiwiZ2V0Q29tcG9uZW50IiwiX3N0b3BQcm9wYWdhdGlvbklmVGFyZ2V0SXNNZSIsIkFUX1RBUkdFVCIsInN0b3BQcm9wYWdhdGlvbiIsImVuYWJsZWRJbkhpZXJhcmNoeSIsInRvdWNoIiwiZ2V0TG9jYXRpb24iLCJfaGFuZGxlUHJlc3NMb2dpYyIsIl90b3VjaE1vdmVkIiwibm93X3BvcyIsImRlbHRhX3giLCJNYXRoIiwiYWJzIiwieCIsImRlbHRhX3kiLCJfaGFuZGxlTW92ZUxvZ2ljIiwiZGVsdGFNb3ZlIiwic3ViIiwiZ2V0U3RhcnRMb2NhdGlvbiIsIm1hZyIsImNhbmNlbEV2ZW50IiwiRXZlbnRUb3VjaCIsImdldFRvdWNoZXMiLCJidWJibGVzIiwidHlwZSIsInNpbXVsYXRlIiwiZGlzcGF0Y2hFdmVudCIsIl9oYW5kbGVSZWxlYXNlTG9naWMiLCJfZGlzcGF0Y2hFdmVudCIsIl9jbGFtcERlbHRhIiwiZGVsdGEiLCJnZXREZWx0YSIsIl9wcm9jZXNzRGVsdGFNb3ZlIiwiX2dhdGhlclRvdWNoTW92ZSIsIl9wcm9jZXNzSW5lcnRpYVNjcm9sbCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSxJQUFJQSxJQUFKO0FBQ0FDLEVBQUUsQ0FBQ0MsS0FBSCxDQUFTO0FBQ0wsYUFBU0QsRUFBRSxDQUFDRSxTQURQO0FBR0xDLEVBQUFBLFVBQVUsRUFBRTtBQUNSQyxJQUFBQSxVQUFVLEVBQWdCSixFQUFFLENBQUNLLFVBRHJCO0FBRVJDLElBQUFBLGNBQWMsRUFBWU4sRUFBRSxDQUFDSyxVQUZyQjtBQUdSRSxJQUFBQSxpQkFBaUIsRUFBRTtBQUNmLGlCQUFTLElBRE07QUFFZkMsTUFBQUEsVUFBVSxFQUFFO0FBRkc7QUFIWCxHQUhQO0FBWUxDLEVBQUFBLE1BWkssb0JBWUs7QUFDTlYsSUFBQUEsSUFBSSxHQUFHLElBQVA7QUFDQSxTQUFLVyxTQUFMLEdBQWlCLElBQWpCO0FBQ0EsU0FBS0MsU0FBTCxHQUFpQixJQUFqQjtBQUNBLFNBQUtDLElBQUwsQ0FBVUMsRUFBVixDQUFhYixFQUFFLENBQUNjLElBQUgsQ0FBUUMsU0FBUixDQUFrQkMsV0FBL0IsRUFBNEMsS0FBS0MsYUFBakQsRUFBZ0UsSUFBaEUsRUFBc0UsSUFBdEU7QUFDQSxTQUFLTCxJQUFMLENBQVVDLEVBQVYsQ0FBYWIsRUFBRSxDQUFDYyxJQUFILENBQVFDLFNBQVIsQ0FBa0JHLFVBQS9CLEVBQTJDLEtBQUtDLGFBQWhELEVBQStELElBQS9ELEVBQXFFLElBQXJFO0FBQ0EsU0FBS1AsSUFBTCxDQUFVQyxFQUFWLENBQWFiLEVBQUUsQ0FBQ2MsSUFBSCxDQUFRQyxTQUFSLENBQWtCSyxTQUEvQixFQUEwQyxLQUFLQyxhQUEvQyxFQUE4RCxJQUE5RCxFQUFvRSxJQUFwRTtBQUNBLFNBQUtULElBQUwsQ0FBVUMsRUFB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QXBCO0FBQ0g7O0FBQ0QsUUFBSSxLQUFLckUsVUFBVCxFQUFxQjtBQUNqQixXQUFLQSxVQUFMLENBQWdCb0UsZ0JBQWhCLENBQWlDSCxLQUFqQzs7QUFDQSxXQUFLakUsVUFBTCxDQUFnQnFFLHFCQUFoQjtBQUNIO0FBQ0o7QUFwTkksQ0FBVCIsInNvdXJjZVJvb3QiOiIvIiwic291cmNlc0NvbnRlbnQiOlsibGV0IHNlbGY7XHJcbmNjLkNsYXNzKHtcclxuICAgIGV4dGVuZHM6IGNjLlZpZXdHcm91cCxcclxuXHJcbiAgICBwcm9wZXJ0aWVzOiB7XHJcbiAgICAgICAgc2Nyb2xsVmlldyAgICAgICAgICAgICAgOiBjYy5TY3JvbGxWaWV3LFxyXG4gICAgICAgIHBhcmVudExpc3RWaWV3ICAgICAgICAgIDogY2MuU2Nyb2xsVmlldyxcclxuICAgICAgICBjYW5jZWxJbm5lckV2ZW50czoge1xyXG4gICAgICAgICAgICBkZWZhdWx0OiB0cnVlLFxyXG4gICAgICAgICAgICBhbmltYXRhYmxlOiBmYWxzZSxcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG5cclxuICAgIG9uTG9hZCAoKSB7XHJcbiAgICAgICAgc2VsZiA9IHRoaXM7XHJcbiAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSBudWxsO1xyXG4gICAgICAgIHRoaXMuc3RhcnRfbG9jID0gbnVsbDtcclxuICAgICAgICB0aGlzLm5vZGUub24oY2MuTm9kZS5FdmVudFR5cGUuVE9VQ0hfU1RBUlQsIHRoaXMuX29uVG91Y2hCZWdhbiwgdGhpcywgdHJ1ZSk7XHJcbiAgICAgICAgdGhpcy5ub2RlLm9uKGNjLk5vZGUuRXZlbnRUeXBlLlRPVUNIX01PVkUsIHRoaXMuX29uVG91Y2hNb3ZlZCwgdGhpcywgdHJ1ZSk7XHJcbiAgICAgICAgdGhpcy5ub2RlLm9uKGNjLk5vZGUuRXZlbnRUeXBlLlRPVUNIX0VORCwgdGhpcy5fb25Ub3VjaEVuZGVkLCB0aGlzLCB0cnVlKTtcclxuICAgICAgICB0aGlzLm5vZGUub24oY2MuTm9kZS5FdmVudFR5cGUuVE9VQ0hfQ0FOQ0VMLCB0aGlzLl9vblRvdWNoQ2FuY2VsbGVkLCB0aGlzLCB0cnVlKTtcclxuICAgICAgICB0aGlzLnNjcm9sbFZpZXcuc3RvcEF1dG9TY3JvbGwoKTtcclxuXHJcbiAgICB9LFxyXG4gICAgdXBkYXRlKCkge1xyXG4gICAgICAgIGlmICh0aGlzLnBhcmVudExpc3RWaWV3LmdldENvbnRlbnRQb3NpdGlvbigpLnkgPCA1MDApIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuc2Nyb2xsVmlldy52ZXJ0aWNhbCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zY3JvbGxWaWV3LnZlcnRpY2FsICAgICAgICA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5wYXJlbnRMaXN0Vmlldy52ZXJ0aWNhbCAgICA9IHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgaWYgKCF0aGlzLnNjcm9sbFZpZXcudmVydGljYWwpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2Nyb2xsVmlldy52ZXJ0aWNhbCAgICAgICAgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5wYXJlbnRMaXN0Vmlldy52ZXJ0aWNhbCAgICA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9ZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5zY3JvbGxWaWV3LmdldENvbnRlbnRQb3NpdGlvbigpLnkgPCA1KXtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5zY3JvbGxWaWV3LnZlcnRpY2FsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2Nyb2xsVmlldy52ZXJ0aWNhbCAgICAgICAgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wYXJlbnRMaXN0Vmlldy52ZXJ0aWNhbCAgICA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxuICAgIC8vdGhpcyBpcyBmb3IgbmVzdGVkIHNjcm9sbHZpZXdcclxuICAgIF9oYXNOZXN0ZWRWaWV3R3JvdXAgKGV2ZW50LCBjYXB0dXJlTGlzdGVuZXJzKSB7XHJcbiAgICAgICAgaWYgKGV2ZW50LmV2ZW50UGhhc2UgIT09IGNjLkV2ZW50LkNBUFRVUklOR19QSEFTRSkgcmV0dXJuO1xyXG4gICAgICAgIGlmIChjYXB0dXJlTGlzdGVuZXJzKSB7XHJcbiAgICAgICAgICAgIC8vY2FwdHVyZUxpc3RlbmVycyBhcmUgYXJyYW5nZWQgZnJvbSBjaGlsZCB0byBwYXJlbnRcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjYXB0dXJlTGlzdGVuZXJzLmxlbmd0aDsgKytpKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgaXRlbSA9IGNhcHR1cmVMaXN0ZW5lcnNbaV07XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMubm9kZSA9PT0gaXRlbSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChldmVudC50YXJnZXQuZ2V0Q29tcG9uZW50KGNjLlZpZXdHcm91cCkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChpdGVtLmdldENvbXBvbmVudChjYy5WaWV3R3JvdXApKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfSxcclxuXHJcbiAgICAvL1RoaXMgaXMgZm9yIFNjcm9sbHZpZXcgYXMgY2hpbGRyZW4gb2YgYSBCdXR0b25cclxuICAgIF9zdG9wUHJvcGFnYXRpb25JZlRhcmdldElzTWUgKGV2ZW50KSB7XHJcbiAgICAgICAgaWYgKGV2ZW50LmV2ZW50UGhhc2UgPT09IGNjLkV2ZW50LkFUX1RBUkdFVCAmJiBldmVudC50YXJnZXQgPT09IHRoaXMubm9kZSkge1xyXG4gICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG5cclxuICAgIC8vIHRvdWNoIGV2ZW50IGhhbmRsZXJcclxuICAgIF9vblRvdWNoQmVnYW4gKGV2ZW50LCBjYXB0dXJlTGlzdGVuZXJzKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLmVuYWJsZWRJbkhpZXJhcmNoeSlcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIGlmICh0aGlzLl9oYXNOZXN0ZWRWaWV3R3JvdXAoZXZlbnQsIGNhcHR1cmVMaXN0ZW5lcnMpKSByZXR1cm47XHJcblxyXG4gICAgICAgIHZhciB0b3VjaCA9IGV2ZW50LnRvdWNoO1xyXG4gICAgICAgIHRoaXMuc3RhcnRfbG9jID0gZXZlbnQudG91Y2guZ2V0TG9jYXRpb24oKTtcclxuICAgICAgICBpZiAodGhpcy5ub2RlKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnBhcmVudExpc3RWaWV3KSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnBhcmVudExpc3RWaWV3Ll9oYW5kbGVQcmVzc0xvZ2ljKHRvdWNoKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKHRoaXMuc2Nyb2xsVmlldykge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zY3JvbGxWaWV3Ll9oYW5kbGVQcmVzc0xvZ2ljKHRvdWNoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5fdG91Y2hNb3ZlZCA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMuX3N0b3BQcm9wYWdhdGlvbklmVGFyZ2V0SXNNZShldmVudCk7XHJcbiAgICB9LFxyXG5cclxuICAgIF9vblRvdWNoTW92ZWQgKGV2ZW50LCBjYXB0dXJlTGlzdGVuZXJzKSB7XHJcbiAgICAgICAgbGV0IG5vd19wb3MgPSBldmVudC50b3VjaC5nZXRMb2NhdGlvbigpO1xyXG4gICAgICAgIGxldCBkZWx0YV94ID0gTWF0aC5hYnModGhpcy5zdGFydF9sb2MueCAtIG5vd19wb3MueCk7XHJcbiAgICAgICAgbGV0IGRlbHRhX3kgPSBNYXRoLmFicyh0aGlzLnN0YXJ0X2xvYy55IC0gbm93X3Bvcy55KTtcclxuICAgICAgICBpZiAoKGRlbHRhX3ggPiA1IHx8IGRlbHRhX3kgPiA1KSAmJiAhdGhpcy5kaXJlY3Rpb24pIHtcclxuICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSBkZWx0YV94IDwgZGVsdGFfeSA/IFwicGFyZW50X3Njcm9sbHZpZXdfbW92ZVwiIDogXCJzY3JvbGx2aWV3X21vdmVcIjtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKCF0aGlzLmVuYWJsZWRJbkhpZXJhcmNoeSkgcmV0dXJuO1xyXG4gICAgICAgIGlmICh0aGlzLl9oYXNOZXN0ZWRWaWV3R3JvdXAoZXZlbnQsIGNhcHR1cmVMaXN0ZW5lcnMpKSByZXR1cm47XHJcblxyXG4gICAgICAgIHZhciB0b3VjaCA9IGV2ZW50LnRvdWNoO1xyXG4gICAgICAgIGlmICh0aGlzLm5vZGUpIHtcclxuICAgICAgICAgICAgdGhpcy5faGFuZGxlTW92ZUxvZ2ljKHRvdWNoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIERvIG5vdCBwcmV2ZW50IHRvdWNoIGV2ZW50cyBpbiBpbm5lciBub2Rlc1xyXG4gICAgICAgIGlmICghdGhpcy5jYW5jZWxJbm5lckV2ZW50cykge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2YXIgZGVsdGFNb3ZlID0gIHRvdWNoLmdldExvY2F0aW9uKCkuc3ViKHRvdWNoLmdldFN0YXJ0TG9jYXRpb24oKSk7XHJcblxyXG4gICAgICAgIC8vRklYTUU6IHRvdWNoIG1vdmUgZGVsdGEgc2hvdWxkIGJlIGNhbGN1bGF0ZWQgYnkgRFBJLlxyXG4gICAgICAgIGlmIChkZWx0YU1vdmUubWFnKCkgPiA3KSB7XHJcbiAgICAgICAgICAgIGlmICghdGhpcy5fdG91Y2hNb3ZlZCAmJiBldmVudC50YXJnZXQgIT09IHRoaXMubm9kZSkge1xyXG4gICAgICAgICAgICAgICAgLy8gU2ltdWxhdGUgdG91Y2ggY2FuY2VsIGZvciB0YXJnZXQgbm9kZVxyXG4gICAgICAgICAgICAgICAgbGV0IGNhbmNlbEV2ZW50ID0gbmV3IGNjLkV2ZW50LkV2ZW50VG91Y2goZXZlbnQuZ2V0VG91Y2hlcygpLCBldmVudC5idWJibGVzKTtcclxuICAgICAgICAgICAgICAgIGNhbmNlbEV2ZW50LnR5cGUgPSBjYy5Ob2RlLkV2ZW50VHlwZS5UT1VDSF9DQU5DRUw7XHJcbiAgICAgICAgICAgICAgICBjYW5jZWxFdmVudC50b3VjaCA9IGV2ZW50LnRvdWNoO1xyXG4gICAgICAgICAgICAgICAgY2FuY2VsRXZlbnQuc2ltdWxhdGUgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgZXZlbnQudGFyZ2V0LmRpc3BhdGNoRXZlbnQoY2FuY2VsRXZlbnQpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fdG91Y2hNb3ZlZCA9IHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuX3N0b3BQcm9wYWdhdGlvbklmVGFyZ2V0SXNNZShldmVudCk7XHJcbiAgICB9LFxyXG5cclxuICAgIF9vblRvdWNoRW5kZWQgKGV2ZW50LCBjYXB0dXJlTGlzdGVuZXJzKSB7XHJcbiAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSBudWxsO1xyXG4gICAgICAgIGlmICghdGhpcy5lbmFibGVkSW5IaWVyYXJjaHkpIHJldHVybjtcclxuICAgICAgICBpZiAodGhpcy5faGFzTmVzdGVkVmlld0dyb3VwKGV2ZW50LCBjYXB0dXJlTGlzdGVuZXJzKSkgcmV0dXJuO1xyXG5cclxuICAgICAgICB2YXIgdG91Y2ggPSBldmVudC50b3VjaDtcclxuICAgICAgICBpZiAodGhpcy5ub2RlKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2hhbmRsZVJlbGVhc2VMb2dpYyh0b3VjaCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5wYXJlbnRMaXN0Vmlldykge1xyXG4gICAgICAgICAgICB0aGlzLnBhcmVudExpc3RWaWV3Ll9kaXNwYXRjaEV2ZW50KCd0b3VjaC11cCcpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoaXMuc2Nyb2xsVmlldykge1xyXG4gICAgICAgICAgICB0aGlzLnNjcm9sbFZpZXcuX2Rpc3BhdGNoRXZlbnQoJ3RvdWNoLXVwJyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5fdG91Y2hNb3ZlZCkge1xyXG4gICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLl9zdG9wUHJvcGFnYXRpb25JZlRhcmdldElzTWUoZXZlbnQpO1xyXG4gICAgICAgIH1cclxuICAgIH0sXHJcblxyXG4gICAgX29uVG91Y2hDYW5jZWxsZWQgKGV2ZW50LCBjYXB0dXJlTGlzdGVuZXJzKSB7XHJcbiAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSBudWxsO1xyXG4gICAgICAgIGlmICghdGhpcy5lbmFibGVkSW5IaWVyYXJjaHkpIHJldHVybjtcclxuICAgICAgICBpZiAodGhpcy5faGFzTmVzdGVkVmlld0dyb3VwKGV2ZW50LCBjYXB0dXJlTGlzdGVuZXJzKSkgcmV0dXJuO1xyXG5cclxuICAgICAgICAvLyBGaWx0ZSB0b3VjaCBjYW5jZWwgZXZlbnQgc2VuZCBmcm9tIHNlbGZcclxuICAgICAgICBpZiAoIWV2ZW50LnNpbXVsYXRlKSB7XHJcbiAgICAgICAgICAgIHZhciB0b3VjaCA9IGV2ZW50LnRvdWNoO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5ub2RlKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9oYW5kbGVSZWxlYXNlTG9naWModG91Y2gpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLl9zdG9wUHJvcGFnYXRpb25JZlRhcmdldElzTWUoZXZlbnQpO1xyXG4gICAgfSxcclxuXHJcbiAgICBfY2xhbXBEZWx0YSAoZGVsdGEpIHtcclxuICAgICAgICBsZXQgeCA9IE1hdGguYWJzKGRlbHRhLngpO1xyXG4gICAgICAgIGxldCB5ID0gTWF0aC5hYnMoZGVsdGEueSk7XHJcbiAgICAgICAgaWYgKHggPCB5KSB7XHJcbiAgICAgICAgICAgIGRlbHRhLnggPSAwO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGRlbHRhLnkgPSAwO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIGRlbHRhO1xyXG4gICAgfSxcclxuXHJcbiAgICBfaGFuZGxlTW92ZUxvZ2ljICh0b3VjaCkge1xyXG4gICAgICAgIGxldCBkZWx0YU1vdmUgPSB0aGlzLl9jbGFtcERlbHRhKHRvdWNoLmdldERlbHRhKCkpO1xyXG4gICAgICAgIGlmICh0aGlzLmRpcmVjdGlvbiA9PT0gXCJwYXJlbnRfc2Nyb2xsdmlld19tb3ZlXCIpIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMucGFyZW50TGlzdFZpZXcpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMucGFyZW50TGlzdFZpZXcuX3Byb2Nlc3NEZWx0YU1vdmUoZGVsdGFNb3ZlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnNjcm9sbFZpZXcpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2Nyb2xsVmlldy5fcHJvY2Vzc0RlbHRhTW92ZShkZWx0YU1vdmUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnBhcmVudExpc3RWaWV3KSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnBhcmVudExpc3RWaWV3Ll9wcm9jZXNzRGVsdGFNb3ZlKGRlbHRhTW92ZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9LFxyXG5cclxuICAgIF9oYW5kbGVSZWxlYXNlTG9naWMgKHRvdWNoKSB7XHJcbiAgICAgICAgdmFyIGRlbHRhID0gdG91Y2guZ2V0RGVsdGEoKTtcclxuICAgICAgICBkZWx0YSA9IHRoaXMuX2NsYW1wRGVsdGEoZGVsdGEpO1xyXG4gICAgICAgIGlmICh0aGlzLnBhcmVudExpc3RWaWV3KSB7XHJcbiAgICAgICAgICAgIHRoaXMucGFyZW50TGlzdFZpZXcuX2dhdGhlclRvdWNoTW92ZShkZWx0YSk7XHJcbiAgICAgICAgICAgIHRoaXMucGFyZW50TGlzdFZpZXcuX3Byb2Nlc3NJbmVydGlhU2Nyb2xsKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLnNjcm9sbFZpZXcpIHtcclxuICAgICAgICAgICAgdGhpcy5zY3JvbGxWaWV3Ll9nYXRoZXJUb3VjaE1vdmUoZGVsdGEpO1xyXG4gICAgICAgICAgICB0aGlzLnNjcm9sbFZpZXcuX3Byb2Nlc3NJbmVydGlhU2Nyb2xsKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxufSk7XHJcbiJdfQ==