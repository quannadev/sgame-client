
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/_smartfox/gui/TwoScrollView.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '9a4f8BGOLxGoY0ou8QG16sf', 'TwoScrollView');
// _smartfox/gui/TwoScrollView.js

"use strict";

var self;
cc.Class({
  "extends": cc.ViewGroup,
  properties: {
    scrollView: cc.ScrollView,
    parentListView: cc.ScrollView,
    cancelInnerEvents: {
      "default": true,
      animatable: false
    }
  },
  onLoad: function onLoad() {
    self = this;
    this.direction = null;
    this.start_loc = null;
    this.node.on(cc.Node.EventType.TOUCH_START, this._onTouchBegan, this, true);
    this.node.on(cc.Node.EventType.TOUCH_MOVE, this._onTouchMoved, this, true);
    this.node.on(cc.Node.EventType.TOUCH_END, this._onTouchEnded, this, true);
    this.node.on(cc.Node.EventType.TOUCH_CANCEL, this._onTouchCancelled, this, true);
    this.scrollView.stopAutoScroll();
  },
  update: function update() {
    if (this.parentListView.getContentPosition().y < 500) {
      if (this.scrollView.vertical) {
        this.scrollView.vertical = false;
        this.parentListView.vertical = true;
      }
    } else {
      if (!this.scrollView.vertical) {
        this.scrollView.vertical = true;
        this.parentListView.vertical = false;
      } else {
        if (this.scrollView.getContentPosition().y < 5) {
          if (this.scrollView.vertical) {
            this.scrollView.vertical = false;
            this.parentListView.vertical = true;
          }
        }
      }
    }
  },
  //this is for nested scrollview
  _hasNestedViewGroup: function _hasNestedViewGroup(event, captureListeners) {
    if (event.eventPhase !== cc.Event.CAPTURING_PHASE) return;

    if (captureListeners) {
      //captureListeners are arranged from child to parent
      for (var i = 0; i < captureListeners.length; ++i) {
        var item = captureListeners[i];

        if (this.node === item) {
          if (event.target.getComponent(cc.ViewGroup)) {
            return true;
          }

          return false;
        }

        if (item.getComponent(cc.ViewGroup)) {
          return true;
        }
      }
    }

    return false;
  },
  //This is for Scrollview as children of a Button
  _stopPropagationIfTargetIsMe: function _stopPropagationIfTargetIsMe(event) {
    if (event.eventPhase === cc.Event.AT_TARGET && event.target === this.node) {
      event.stopPropagation();
    }
  },
  // touch event handler
  _onTouchBegan: function _onTouchBegan(event, captureListeners) {
    if (!this.enabledInHierarchy) return;
    if (this._hasNestedViewGroup(event, captureListeners)) return;
    var touch = event.touch;
    this.start_loc = event.touch.getLocation();

    if (this.node) {
      if (this.parentListView) {
        this.parentListView._handlePressLogic(touch);
      }

      if (this.scrollView) {
        this.scrollView._handlePressLogic(touch);
      }
    }

    this._touchMoved = false;

    this._stopPropagationIfTargetIsMe(event);
  },
  _onTouchMoved: function _onTouchMoved(event, captureListeners) {
    var now_pos = event.touch.getLocation();
    var delta_x = Math.abs(this.start_loc.x - now_pos.x);
    var delta_y = Math.abs(this.start_loc.y - now_pos.y);

    if ((delta_x > 5 || delta_y > 5) && !this.direction) {
      this.direction = delta_x < delta_y ? "parent_scrollview_move" : "scrollview_move";
    }

    if (!this.enabledInHierarchy) return;
    if (this._hasNestedViewGroup(event, captureListeners)) return;
    var touch = event.touch;

    if (this.node) {
      this._handleMoveLogic(touch);
    } // Do not prevent touch events in inner nodes


    if (!this.cancelInnerEvents) {
      return;
    }

    var deltaMove = touch.getLocation().sub(touch.getStartLocation()); //FIXME: touch move delta should be calculated by DPI.

    if (deltaMove.mag() > 7) {
      if (!this._touchMoved && event.target !== this.node) {
        // Simulate touch cancel for target node
        var cancelEvent = new cc.Event.EventTouch(event.getTouches(), event.bubbles);
        cancelEvent.type = cc.Node.EventType.TOUCH_CANCEL;
        cancelEvent.touch = event.touch;
        cancelEvent.simulate = true;
        event.target.dispatchEvent(cancelEvent);
        this._touchMoved = true;
      }
    }

    this._stopPropagationIfTargetIsMe(event);
  },
  _onTouchEnded: function _onTouchEnded(event, captureListeners) {
    this.direction = null;
    if (!this.enabledInHierarchy) return;
    if (this._hasNestedViewGroup(event, captureListeners)) return;
    var touch = event.touch;

    if (this.node) {
      this._handleReleaseLogic(touch);
    }

    if (this.parentListView) {
      this.parentListView._dispatchEvent('touch-up');
    }

    if (this.scrollView) {
      this.scrollView._dispatchEvent('touch-up');
    }

    if (this._touchMoved) {
      event.stopPropagation();
    } else {
      this._stopPropagationIfTargetIsMe(event);
    }
  },
  _onTouchCancelled: function _onTouchCancelled(event, captureListeners) {
    this.direction = null;
    if (!this.enabledInHierarchy) return;
    if (this._hasNestedViewGroup(event, captureListeners)) return; // Filte touch cancel event send from self

    if (!event.simulate) {
      var touch = event.touch;

      if (this.node) {
        this._handleReleaseLogic(touch);
      }
    }

    this._stopPropagationIfTargetIsMe(event);
  },
  _clampDelta: function _clampDelta(delta) {
    var x = Math.abs(delta.x);
    var y = Math.abs(delta.y);

    if (x < y) {
      delta.x = 0;
    } else {
      delta.y = 0;
    }

    return delta;
  },
  _handleMoveLogic: function _handleMoveLogic(touch) {
    var deltaMove = this._clampDelta(touch.getDelta());

    if (this.direction === "parent_scrollview_move") {
      if (this.parentListView) {
        this.parentListView._processDeltaMove(deltaMove);
      }
    } else {
      if (this.scrollView) {
        this.scrollView._processDeltaMove(deltaMove);
      }

      if (this.parentListView) {
        this.parentListView._processDeltaMove(deltaMove);
      }
    }
  },
  _handleReleaseLogic: function _handleReleaseLogic(touch) {
    var delta = touch.getDelta();
    delta = this._clampDelta(delta);

    if (this.parentListView) {
      this.parentListView._gatherTouchMove(delta);

      this.parentListView._processInertiaScroll();
    }

    if (this.scrollView) {
      this.scrollView._gatherTouchMove(delta);

      this.scrollView._processInertiaScroll();
    }
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0cy9fc21hcnRmb3gvZ3VpL1R3b1Njcm9sbFZpZXcuanMiXSwibmFtZXMiOlsic2VsZiIsImNjIiwiQ2xhc3MiLCJWaWV3R3JvdXAiLCJwcm9wZXJ0aWVzIiwic2Nyb2xsVmlldyIsIlNjcm9sbFZpZXciLCJwYXJlbnRMaXN0VmlldyIsImNhbmNlbElubmVyRXZlbnRzIiwiYW5pbWF0YWJsZSIsIm9uTG9hZCIsImRpcmVjdGlvbiIsInN0YXJ0X2xvYyIsIm5vZGUiLCJvbiIsIk5vZGUiLCJFdmVudFR5cGUiLCJUT1VDSF9TVEFSVCIsIl9vblRvdWNoQmVnYW4iLCJUT1VDSF9NT1ZFIiwiX29uVG91Y2hNb3ZlZCIsIlRPVUNIX0VORCIsIl9vblRvdWNoRW5kZWQiLCJUT1VDSF9DQU5DRUwiLCJfb25Ub3VjaENhbmNlbGxlZCIsInN0b3BBdXRvU2Nyb2xsIiwidXBkYXRlIiwiZ2V0Q29udGVudFBvc2l0aW9uIiwieSIsInZlcnRpY2FsIiwiX2hhc05lc3RlZFZpZXdHcm91cCIsImV2ZW50IiwiY2FwdHVyZUxpc3RlbmVycyIsImV2ZW50UGhhc2UiLCJFdmVudCIsIkNBUFRVUklOR19QSEFTRSIsImkiLCJsZW5ndGgiLCJpdGVtIiwidGFyZ2V0IiwiZ2V0Q29tcG9uZW50IiwiX3N0b3BQcm9wYWdhdGlvbklmVGFyZ2V0SXNNZSIsIkFUX1RBUkdFVCIsInN0b3BQcm9wYWdhdGlvbiIsImVuYWJsZWRJbkhpZXJhcmNoeSIsInRvdWNoIiwiZ2V0TG9jYXRpb24iLCJfaGFuZGxlUHJlc3NMb2dpYyIsIl90b3VjaE1vdmVkIiwibm93X3BvcyIsImRlbHRhX3giLCJNYXRoIiwiYWJzIiwieCIsImRlbHRhX3kiLCJfaGFuZGxlTW92ZUxvZ2ljIiwiZGVsdGFNb3ZlIiwic3ViIiwiZ2V0U3RhcnRMb2NhdGlvbiIsIm1hZyIsImNhbmNlbEV2ZW50IiwiRXZlbnRUb3VjaCIsImdldFRvdWNoZXMiLCJidWJibGVzIiwidHlwZSIsInNpbXVsYXRlIiwiZGlzcGF0Y2hFdmVudCIsIl9oYW5kbGVSZWxlYXNlTG9naWMiLCJfZGlzcGF0Y2hFdmVudCIsIl9jbGFtcERlbHRhIiwiZGVsdGEiLCJnZXREZWx0YSIsIl9wcm9jZXNzRGVsdGFNb3ZlIiwiX2dhdGhlclRvdWNoTW92ZSIsIl9wcm9jZXNzSW5lcnRpYVNjcm9sbCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSxJQUFJQSxJQUFKO0FBQ0FDLEVBQUUsQ0FBQ0MsS0FBSCxDQUFTO0FBQ0wsYUFBU0QsRUFBRSxDQUFDRSxTQURQO0FBR0xDLEVBQUFBLFVBQVUsRUFBRTtBQUNSQyxJQUFBQSxVQUFVLEVBQWdCSixFQUFFLENBQUNLLFVBRHJCO0FBRVJDLElBQUFBLGNBQWMsRUFBWU4sRUFBRSxDQUFDSyxVQUZyQjtBQUdSRSxJQUFBQSxpQkFBaUIsRUFBRTtBQUNmLGlCQUFTLElBRE07QUFFZkMsTUFBQUEsVUFBVSxFQUFFO0FBRkc7QUFIWCxHQUhQO0FBWUxDLEVBQUFBLE1BWkssb0JBWUs7QUFDTlYsSUFBQUEsSUFBSSxHQUFHLElBQVA7QUFDQSxTQUFLVyxTQUFMLEdBQWlCLElBQWpCO0FBQ0EsU0FBS0MsU0FBTCxHQUFpQixJQUFqQjtBQUNBLFNBQUtDLElBQUwsQ0FBVUMsRUFBVixDQUFhYixFQUFFLENBQUNjLElBQUgsQ0FBUUMsU0FBUixDQUFrQkMsV0FBL0IsRUFBNEMsS0FBS0MsYUFBakQsRUFBZ0UsSUFBaEUsRUFBc0UsSUFBdEU7QUFDQSxTQUFLTCxJQUFMLENBQVVDLEVBQVYsQ0FBYWIsRUFBRSxDQUFDYyxJQUFILENBQVFDLFNBQVIsQ0FBa0JHLFVBQS9CLEVBQTJDLEtBQUtDLGFBQWhELEVBQStELElBQS9ELEVBQXFFLElBQXJFO0FBQ0EsU0FBS1AsSUFBTCxDQUFVQyxFQUFWLENBQWFiLEVBQUUsQ0FBQ2MsSUFBSCxDQUFRQyxTQUFSLENBQWtCSyxTQUEvQixFQUEwQyxLQUFLQyxhQUEvQyxFQUE4RCxJQUE5RCxFQUFvRSxJQUFwRTtBQUNBLFNBQUtULElBQUwsQ0FBVUMsRUFBVixD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O0FBQ0g7O0FBQ0QsUUFBSSxLQUFLckUsVUFBVCxFQUFxQjtBQUNqQixXQUFLQSxVQUFMLENBQWdCb0UsZ0JBQWhCLENBQWlDSCxLQUFqQzs7QUFDQSxXQUFLakUsVUFBTCxDQUFnQnFFLHFCQUFoQjtBQUNIO0FBQ0o7QUFwTkksQ0FBVCIsInNvdXJjZVJvb3QiOiIvIiwic291cmNlc0NvbnRlbnQiOlsibGV0IHNlbGY7XG5jYy5DbGFzcyh7XG4gICAgZXh0ZW5kczogY2MuVmlld0dyb3VwLFxuXG4gICAgcHJvcGVydGllczoge1xuICAgICAgICBzY3JvbGxWaWV3ICAgICAgICAgICAgICA6IGNjLlNjcm9sbFZpZXcsXG4gICAgICAgIHBhcmVudExpc3RWaWV3ICAgICAgICAgIDogY2MuU2Nyb2xsVmlldyxcbiAgICAgICAgY2FuY2VsSW5uZXJFdmVudHM6IHtcbiAgICAgICAgICAgIGRlZmF1bHQ6IHRydWUsXG4gICAgICAgICAgICBhbmltYXRhYmxlOiBmYWxzZSxcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBvbkxvYWQgKCkge1xuICAgICAgICBzZWxmID0gdGhpcztcbiAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSBudWxsO1xuICAgICAgICB0aGlzLnN0YXJ0X2xvYyA9IG51bGw7XG4gICAgICAgIHRoaXMubm9kZS5vbihjYy5Ob2RlLkV2ZW50VHlwZS5UT1VDSF9TVEFSVCwgdGhpcy5fb25Ub3VjaEJlZ2FuLCB0aGlzLCB0cnVlKTtcbiAgICAgICAgdGhpcy5ub2RlLm9uKGNjLk5vZGUuRXZlbnRUeXBlLlRPVUNIX01PVkUsIHRoaXMuX29uVG91Y2hNb3ZlZCwgdGhpcywgdHJ1ZSk7XG4gICAgICAgIHRoaXMubm9kZS5vbihjYy5Ob2RlLkV2ZW50VHlwZS5UT1VDSF9FTkQsIHRoaXMuX29uVG91Y2hFbmRlZCwgdGhpcywgdHJ1ZSk7XG4gICAgICAgIHRoaXMubm9kZS5vbihjYy5Ob2RlLkV2ZW50VHlwZS5UT1VDSF9DQU5DRUwsIHRoaXMuX29uVG91Y2hDYW5jZWxsZWQsIHRoaXMsIHRydWUpO1xuICAgICAgICB0aGlzLnNjcm9sbFZpZXcuc3RvcEF1dG9TY3JvbGwoKTtcblxuICAgIH0sXG4gICAgdXBkYXRlKCkge1xuICAgICAgICBpZiAodGhpcy5wYXJlbnRMaXN0Vmlldy5nZXRDb250ZW50UG9zaXRpb24oKS55IDwgNTAwKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5zY3JvbGxWaWV3LnZlcnRpY2FsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zY3JvbGxWaWV3LnZlcnRpY2FsICAgICAgICA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIHRoaXMucGFyZW50TGlzdFZpZXcudmVydGljYWwgICAgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgIGlmICghdGhpcy5zY3JvbGxWaWV3LnZlcnRpY2FsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zY3JvbGxWaWV3LnZlcnRpY2FsICAgICAgICA9IHRydWU7XG4gICAgICAgICAgICAgICAgdGhpcy5wYXJlbnRMaXN0Vmlldy52ZXJ0aWNhbCAgICA9IGZhbHNlO1xuICAgICAgICAgICAgfWVsc2Uge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnNjcm9sbFZpZXcuZ2V0Q29udGVudFBvc2l0aW9uKCkueSA8IDUpe1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5zY3JvbGxWaWV3LnZlcnRpY2FsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNjcm9sbFZpZXcudmVydGljYWwgICAgICAgID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBhcmVudExpc3RWaWV3LnZlcnRpY2FsICAgID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0sXG4gICAgLy90aGlzIGlzIGZvciBuZXN0ZWQgc2Nyb2xsdmlld1xuICAgIF9oYXNOZXN0ZWRWaWV3R3JvdXAgKGV2ZW50LCBjYXB0dXJlTGlzdGVuZXJzKSB7XG4gICAgICAgIGlmIChldmVudC5ldmVudFBoYXNlICE9PSBjYy5FdmVudC5DQVBUVVJJTkdfUEhBU0UpIHJldHVybjtcbiAgICAgICAgaWYgKGNhcHR1cmVMaXN0ZW5lcnMpIHtcbiAgICAgICAgICAgIC8vY2FwdHVyZUxpc3RlbmVycyBhcmUgYXJyYW5nZWQgZnJvbSBjaGlsZCB0byBwYXJlbnRcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY2FwdHVyZUxpc3RlbmVycy5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgICAgIHZhciBpdGVtID0gY2FwdHVyZUxpc3RlbmVyc1tpXTtcblxuICAgICAgICAgICAgICAgIGlmICh0aGlzLm5vZGUgPT09IGl0ZW0pIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGV2ZW50LnRhcmdldC5nZXRDb21wb25lbnQoY2MuVmlld0dyb3VwKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoaXRlbS5nZXRDb21wb25lbnQoY2MuVmlld0dyb3VwKSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0sXG5cbiAgICAvL1RoaXMgaXMgZm9yIFNjcm9sbHZpZXcgYXMgY2hpbGRyZW4gb2YgYSBCdXR0b25cbiAgICBfc3RvcFByb3BhZ2F0aW9uSWZUYXJnZXRJc01lIChldmVudCkge1xuICAgICAgICBpZiAoZXZlbnQuZXZlbnRQaGFzZSA9PT0gY2MuRXZlbnQuQVRfVEFSR0VUICYmIGV2ZW50LnRhcmdldCA9PT0gdGhpcy5ub2RlKSB7XG4gICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICAvLyB0b3VjaCBldmVudCBoYW5kbGVyXG4gICAgX29uVG91Y2hCZWdhbiAoZXZlbnQsIGNhcHR1cmVMaXN0ZW5lcnMpIHtcbiAgICAgICAgaWYgKCF0aGlzLmVuYWJsZWRJbkhpZXJhcmNoeSlcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgaWYgKHRoaXMuX2hhc05lc3RlZFZpZXdHcm91cChldmVudCwgY2FwdHVyZUxpc3RlbmVycykpIHJldHVybjtcblxuICAgICAgICB2YXIgdG91Y2ggPSBldmVudC50b3VjaDtcbiAgICAgICAgdGhpcy5zdGFydF9sb2MgPSBldmVudC50b3VjaC5nZXRMb2NhdGlvbigpO1xuICAgICAgICBpZiAodGhpcy5ub2RlKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5wYXJlbnRMaXN0Vmlldykge1xuICAgICAgICAgICAgICAgIHRoaXMucGFyZW50TGlzdFZpZXcuX2hhbmRsZVByZXNzTG9naWModG91Y2gpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodGhpcy5zY3JvbGxWaWV3KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zY3JvbGxWaWV3Ll9oYW5kbGVQcmVzc0xvZ2ljKHRvdWNoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuX3RvdWNoTW92ZWQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5fc3RvcFByb3BhZ2F0aW9uSWZUYXJnZXRJc01lKGV2ZW50KTtcbiAgICB9LFxuXG4gICAgX29uVG91Y2hNb3ZlZCAoZXZlbnQsIGNhcHR1cmVMaXN0ZW5lcnMpIHtcbiAgICAgICAgbGV0IG5vd19wb3MgPSBldmVudC50b3VjaC5nZXRMb2NhdGlvbigpO1xuICAgICAgICBsZXQgZGVsdGFfeCA9IE1hdGguYWJzKHRoaXMuc3RhcnRfbG9jLnggLSBub3dfcG9zLngpO1xuICAgICAgICBsZXQgZGVsdGFfeSA9IE1hdGguYWJzKHRoaXMuc3RhcnRfbG9jLnkgLSBub3dfcG9zLnkpO1xuICAgICAgICBpZiAoKGRlbHRhX3ggPiA1IHx8IGRlbHRhX3kgPiA1KSAmJiAhdGhpcy5kaXJlY3Rpb24pIHtcbiAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gZGVsdGFfeCA8IGRlbHRhX3kgPyBcInBhcmVudF9zY3JvbGx2aWV3X21vdmVcIiA6IFwic2Nyb2xsdmlld19tb3ZlXCI7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCF0aGlzLmVuYWJsZWRJbkhpZXJhcmNoeSkgcmV0dXJuO1xuICAgICAgICBpZiAodGhpcy5faGFzTmVzdGVkVmlld0dyb3VwKGV2ZW50LCBjYXB0dXJlTGlzdGVuZXJzKSkgcmV0dXJuO1xuXG4gICAgICAgIHZhciB0b3VjaCA9IGV2ZW50LnRvdWNoO1xuICAgICAgICBpZiAodGhpcy5ub2RlKSB7XG4gICAgICAgICAgICB0aGlzLl9oYW5kbGVNb3ZlTG9naWModG91Y2gpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gRG8gbm90IHByZXZlbnQgdG91Y2ggZXZlbnRzIGluIGlubmVyIG5vZGVzXG4gICAgICAgIGlmICghdGhpcy5jYW5jZWxJbm5lckV2ZW50cykge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIGRlbHRhTW92ZSA9ICB0b3VjaC5nZXRMb2NhdGlvbigpLnN1Yih0b3VjaC5nZXRTdGFydExvY2F0aW9uKCkpO1xuXG4gICAgICAgIC8vRklYTUU6IHRvdWNoIG1vdmUgZGVsdGEgc2hvdWxkIGJlIGNhbGN1bGF0ZWQgYnkgRFBJLlxuICAgICAgICBpZiAoZGVsdGFNb3ZlLm1hZygpID4gNykge1xuICAgICAgICAgICAgaWYgKCF0aGlzLl90b3VjaE1vdmVkICYmIGV2ZW50LnRhcmdldCAhPT0gdGhpcy5ub2RlKSB7XG4gICAgICAgICAgICAgICAgLy8gU2ltdWxhdGUgdG91Y2ggY2FuY2VsIGZvciB0YXJnZXQgbm9kZVxuICAgICAgICAgICAgICAgIGxldCBjYW5jZWxFdmVudCA9IG5ldyBjYy5FdmVudC5FdmVudFRvdWNoKGV2ZW50LmdldFRvdWNoZXMoKSwgZXZlbnQuYnViYmxlcyk7XG4gICAgICAgICAgICAgICAgY2FuY2VsRXZlbnQudHlwZSA9IGNjLk5vZGUuRXZlbnRUeXBlLlRPVUNIX0NBTkNFTDtcbiAgICAgICAgICAgICAgICBjYW5jZWxFdmVudC50b3VjaCA9IGV2ZW50LnRvdWNoO1xuICAgICAgICAgICAgICAgIGNhbmNlbEV2ZW50LnNpbXVsYXRlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBldmVudC50YXJnZXQuZGlzcGF0Y2hFdmVudChjYW5jZWxFdmVudCk7XG4gICAgICAgICAgICAgICAgdGhpcy5fdG91Y2hNb3ZlZCA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLl9zdG9wUHJvcGFnYXRpb25JZlRhcmdldElzTWUoZXZlbnQpO1xuICAgIH0sXG5cbiAgICBfb25Ub3VjaEVuZGVkIChldmVudCwgY2FwdHVyZUxpc3RlbmVycykge1xuICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IG51bGw7XG4gICAgICAgIGlmICghdGhpcy5lbmFibGVkSW5IaWVyYXJjaHkpIHJldHVybjtcbiAgICAgICAgaWYgKHRoaXMuX2hhc05lc3RlZFZpZXdHcm91cChldmVudCwgY2FwdHVyZUxpc3RlbmVycykpIHJldHVybjtcblxuICAgICAgICB2YXIgdG91Y2ggPSBldmVudC50b3VjaDtcbiAgICAgICAgaWYgKHRoaXMubm9kZSkge1xuICAgICAgICAgICAgdGhpcy5faGFuZGxlUmVsZWFzZUxvZ2ljKHRvdWNoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLnBhcmVudExpc3RWaWV3KSB7XG4gICAgICAgICAgICB0aGlzLnBhcmVudExpc3RWaWV3Ll9kaXNwYXRjaEV2ZW50KCd0b3VjaC11cCcpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuc2Nyb2xsVmlldykge1xuICAgICAgICAgICAgdGhpcy5zY3JvbGxWaWV3Ll9kaXNwYXRjaEV2ZW50KCd0b3VjaC11cCcpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuX3RvdWNoTW92ZWQpIHtcbiAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5fc3RvcFByb3BhZ2F0aW9uSWZUYXJnZXRJc01lKGV2ZW50KTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBfb25Ub3VjaENhbmNlbGxlZCAoZXZlbnQsIGNhcHR1cmVMaXN0ZW5lcnMpIHtcbiAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSBudWxsO1xuICAgICAgICBpZiAoIXRoaXMuZW5hYmxlZEluSGllcmFyY2h5KSByZXR1cm47XG4gICAgICAgIGlmICh0aGlzLl9oYXNOZXN0ZWRWaWV3R3JvdXAoZXZlbnQsIGNhcHR1cmVMaXN0ZW5lcnMpKSByZXR1cm47XG5cbiAgICAgICAgLy8gRmlsdGUgdG91Y2ggY2FuY2VsIGV2ZW50IHNlbmQgZnJvbSBzZWxmXG4gICAgICAgIGlmICghZXZlbnQuc2ltdWxhdGUpIHtcbiAgICAgICAgICAgIHZhciB0b3VjaCA9IGV2ZW50LnRvdWNoO1xuICAgICAgICAgICAgaWYgKHRoaXMubm9kZSkge1xuICAgICAgICAgICAgICAgIHRoaXMuX2hhbmRsZVJlbGVhc2VMb2dpYyh0b3VjaCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLl9zdG9wUHJvcGFnYXRpb25JZlRhcmdldElzTWUoZXZlbnQpO1xuICAgIH0sXG5cbiAgICBfY2xhbXBEZWx0YSAoZGVsdGEpIHtcbiAgICAgICAgbGV0IHggPSBNYXRoLmFicyhkZWx0YS54KTtcbiAgICAgICAgbGV0IHkgPSBNYXRoLmFicyhkZWx0YS55KTtcbiAgICAgICAgaWYgKHggPCB5KSB7XG4gICAgICAgICAgICBkZWx0YS54ID0gMDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGRlbHRhLnkgPSAwO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGRlbHRhO1xuICAgIH0sXG5cbiAgICBfaGFuZGxlTW92ZUxvZ2ljICh0b3VjaCkge1xuICAgICAgICBsZXQgZGVsdGFNb3ZlID0gdGhpcy5fY2xhbXBEZWx0YSh0b3VjaC5nZXREZWx0YSgpKTtcbiAgICAgICAgaWYgKHRoaXMuZGlyZWN0aW9uID09PSBcInBhcmVudF9zY3JvbGx2aWV3X21vdmVcIikge1xuICAgICAgICAgICAgaWYgKHRoaXMucGFyZW50TGlzdFZpZXcpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnBhcmVudExpc3RWaWV3Ll9wcm9jZXNzRGVsdGFNb3ZlKGRlbHRhTW92ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpZiAodGhpcy5zY3JvbGxWaWV3KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zY3JvbGxWaWV3Ll9wcm9jZXNzRGVsdGFNb3ZlKGRlbHRhTW92ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGhpcy5wYXJlbnRMaXN0Vmlldykge1xuICAgICAgICAgICAgICAgIHRoaXMucGFyZW50TGlzdFZpZXcuX3Byb2Nlc3NEZWx0YU1vdmUoZGVsdGFNb3ZlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBfaGFuZGxlUmVsZWFzZUxvZ2ljICh0b3VjaCkge1xuICAgICAgICB2YXIgZGVsdGEgPSB0b3VjaC5nZXREZWx0YSgpO1xuICAgICAgICBkZWx0YSA9IHRoaXMuX2NsYW1wRGVsdGEoZGVsdGEpO1xuICAgICAgICBpZiAodGhpcy5wYXJlbnRMaXN0Vmlldykge1xuICAgICAgICAgICAgdGhpcy5wYXJlbnRMaXN0Vmlldy5fZ2F0aGVyVG91Y2hNb3ZlKGRlbHRhKTtcbiAgICAgICAgICAgIHRoaXMucGFyZW50TGlzdFZpZXcuX3Byb2Nlc3NJbmVydGlhU2Nyb2xsKCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuc2Nyb2xsVmlldykge1xuICAgICAgICAgICAgdGhpcy5zY3JvbGxWaWV3Ll9nYXRoZXJUb3VjaE1vdmUoZGVsdGEpO1xuICAgICAgICAgICAgdGhpcy5zY3JvbGxWaWV3Ll9wcm9jZXNzSW5lcnRpYVNjcm9sbCgpO1xuICAgICAgICB9XG4gICAgfSxcbn0pO1xuIl19