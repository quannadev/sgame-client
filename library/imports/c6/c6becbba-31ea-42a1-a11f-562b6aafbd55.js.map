{"version":3,"sources":["assets/scripts/roulette/RouletteController.js"],"names":["RouletteEvent","require","RouletteController","SmartFoxSDK","BaseController","extend","m_tableInfo","registerEvents","_super","ZoneInstance","addEventListenerExtension","RESPONSE_NAME","LOAD_GAME_RES","onLoadGameEvent","BET_RES","onUserBetEvent","END_BETTING","onEndBettingEvent","HISTORY_RESULT","onHistoryResultEvent","removeEvents","removeEventListenerExtension","onEventLogin","event","_requestJoinRoom","zoneName","onEventUserExitRoom","user","isItMe","getUI","node","active","UIManger","show","preLoadUI","pop","LoadGameEvent","fromEvent","hideAll","users","push","mySelf","i","getRoom","getUserList","length","u","name","showListUsers","isBetting","_turnOnTime","time","showNoti","_turnOffTime","resumeGame","winpot","usersOnboard","chipUserOnBoard","result","winChip","updateTotalBet","totalUserBet","addChipToPot","listTypePotBet","listMyChipPot","bind","userBet","BetEvent","userName","betChip","typePot","totalBet","updateListChipBet","runActionChangeMoney","actionFlyChipToPot","getUserByName","updateChip","endBetting","EndBetting","showResult","history","HistoryResponse","showSoiCau","onHistoryEvent","historyEvent","HistoryEvent","src","data","items","onLeaderBoardEvent","leaderBoardEvent","LeaderBoardEvent","onPublicMessage","sender","msg","message","dataSender","dn","get","fb","msgItem","instance","getInstance","module","exports"],"mappings":"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","sourceRoot":"/","sourcesContent":["let RouletteEvent = require('RouletteEvent')\nlet RouletteController = SmartFoxSDK.BaseController.extend({\n    m_tableInfo : null,\n    registerEvents(){\n        this._super();\n        this.ZoneInstance.addEventListenerExtension(RouletteEvent.RESPONSE_NAME.LOAD_GAME_RES, this.onLoadGameEvent, this);\n        this.ZoneInstance.addEventListenerExtension(RouletteEvent.RESPONSE_NAME.BET_RES, this.onUserBetEvent, this);\n        this.ZoneInstance.addEventListenerExtension(RouletteEvent.RESPONSE_NAME.END_BETTING, this.onEndBettingEvent, this);\n        this.ZoneInstance.addEventListenerExtension(RouletteEvent.RESPONSE_NAME.HISTORY_RESULT, this.onHistoryResultEvent, this);\n    },\n    removeEvents(){\n        this._super();\n        this.ZoneInstance.removeEventListenerExtension(RouletteEvent.RESPONSE_NAME.LOAD_GAME_RES, this.onLoadGameEvent, this);\n        this.ZoneInstance.removeEventListenerExtension(RouletteEvent.RESPONSE_NAME.BET_RES, this.onUserBetEvent, this);\n        this.ZoneInstance.removeEventListenerExtension(RouletteEvent.RESPONSE_NAME.END_BETTING, this.onEndBettingEvent, this);\n        this.ZoneInstance.removeEventListenerExtension(RouletteEvent.RESPONSE_NAME.HISTORY_RESULT, this.onHistoryResultEvent, this);\n    },\n    onEventLogin(event){\n        this._super(event);\n        this._requestJoinRoom(this.zoneName);\n    },\n    onEventUserExitRoom(event){\n        let user = event.user;\n        if(user.isItMe){\n            if (this.getUI() != null)\n                this.getUI().node.active = false;\n            UIManger.show(\"UIHome\");\n        }\n    },\n    onLoadGameEvent(event){\n        this.preLoadUI({pop: true},function () {\n            this.m_tableInfo = new RouletteEvent.LoadGameEvent().fromEvent(event);\n            this.getUI().hideAll();\n            let users = [];\n            users.push(this.ZoneInstance.mySelf);\n            for(let i = 0; i < this.getRoom().getUserList().length;i++){\n                let u = this.getRoom().getUserList()[i];\n                if(u.name != this.ZoneInstance.mySelf.name && users.length < 6){\n                    users.push(u);\n                }\n            }\n            this.getUI().showListUsers(users);\n            if(this.m_tableInfo.isBetting){\n                this.getUI()._turnOnTime(this.m_tableInfo.time, this.m_tableInfo.time, this.m_tableInfo.isBetting);\n                this.getUI().showNoti(\"Bắt đầu cược\");\n            }else{\n                this.getUI()._turnOffTime();\n                this.getUI()._turnOnTime(this.m_tableInfo.time, this.m_tableInfo.time, this.m_tableInfo.isBetting);\n                this.getUI().resumeGame( this.m_tableInfo.winpot, this.m_tableInfo.time, this.m_tableInfo.usersOnboard, this.m_tableInfo.chipUserOnBoard, this.m_tableInfo.result,  this.m_tableInfo.winChip);\n            }\n            this.getUI().updateTotalBet(this.m_tableInfo.totalUserBet);\n            this.getUI().addChipToPot(this.m_tableInfo.listTypePotBet, this.m_tableInfo.listMyChipPot);\n        }.bind(this))\n    },\n    onUserBetEvent(event){\n        let userBet = new RouletteEvent.BetEvent().fromEvent(event);\n        let userName = userBet.userName;\n        let betChip = userBet.betChip;\n        let typePot = userBet.typePot;\n        let totalBet= userBet.totalBet;\n        if(this.ZoneInstance.mySelf.name == userName){\n            this.getUI().updateListChipBet(userBet.typePot, userBet.betChip);\n        }\n        this.getUI().updateTotalBet(totalBet);\n        this.getUI().runActionChangeMoney(userName, -betChip, 1);\n        this.getUI().actionFlyChipToPot(userName, typePot, betChip);\n        let user = this.getRoom().getUserByName(userName);\n        if(user)\n            this.getUI().updateChip(user);\n    },\n    onEndBettingEvent(event){\n        let endBetting = new RouletteEvent.EndBetting().fromEvent(event);\n        this.m_tableInfo.isBetting       = false;\n        this.m_tableInfo.chipUserOnBoard = endBetting.chipUserOnBoard;\n        this.m_tableInfo.usersOnboard    = endBetting.usersOnboard;\n        this.m_tableInfo.winpot          = endBetting.winpot;\n        this.m_tableInfo.winChip         = endBetting.winChip;\n        this.m_tableInfo.result          = endBetting.result;\n        this.getUI()._turnOffTime();\n        this.getUI()._turnOnTime(20, 20, this.m_tableInfo.isBetting);\n        this.getUI().showNoti(\"Kết thúc cược!\");\n        this.getUI().showResult(this.m_tableInfo.result);\n    },\n    onHistoryResultEvent(event){\n        let history = new RouletteEvent.HistoryResponse().fromEvent(event);\n        this.getUI().showSoiCau(history.result);\n    },\n    onHistoryEvent(event){\n        let historyEvent = new RouletteEvent.HistoryEvent().fromEvent(event);\n        this.getUI().show(\"UIRouletteTransaction\", {pop: true, src: 'roulette', data: {items: historyEvent.items}});\n    },\n    onLeaderBoardEvent(event){\n        let leaderBoardEvent = new RouletteEvent.LeaderBoardEvent().fromEvent(event);\n        this.getUI().show(\"UIRouletteRank\", {pop: true, src: 'roulette', data: {items: leaderBoardEvent.items}});\n    },\n    onPublicMessage(event){\n        let sender = event.sender;\n        let msg = event.message;\n        let data = event.data;\n        let dataSender = data != null ? {dn: data.get(\"dn\"), fb : data.get(\"fb\")} : {dn: \"...\", fb : \"\"};\n        let msgItem = {};\n        msgItem.sender = sender;\n        msgItem.msg = msg;\n        msgItem.dataSender = dataSender;\n        this.getUI().onPublicMessage(msgItem);\n    },\n});\nlet instance = null;\nlet getInstance = function () {\n    if(instance == null)\n        instance = new RouletteController('UIRoulette', 'roulette');\n    return instance;\n}\nSmartFoxSDK.RouletteController = module.exports = getInstance();\n"]}